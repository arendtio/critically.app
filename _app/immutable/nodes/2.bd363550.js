import{s as Rt,n as ht,e as pt,o as qt,f as dt,b as Ht,r as Bt}from"../chunks/scheduler.72a81396.js";import{S as St,i as Nt,g as U,h as X,j as V,f as T,k as $,a as nt,s as st,r as Mt,x as Tt,c as it,u as Ot,y as P,v as jt,d as Dt,t as Wt,A as ot,w as Ft,m as At,n as kt,o as It,B as rt,z as lt}from"../chunks/index.45de7edf.js";import{e as tt}from"../chunks/each.e59479a4.js";import{c as Pt,g as Ut,z as Xt}from"../chunks/drawflow.store.aa0a6cb1.js";import{d as ut,c as Yt,t as at,r as ct}from"../chunks/criticalPath.store.4f990f9d.js";var zt={exports:{}};(function(b,g){(function(_,w){b.exports=w()})(typeof self<"u"?self:Pt,function(){return function(_){var w={};function m(r){if(w[r])return w[r].exports;var y=w[r]={i:r,l:!1,exports:{}};return _[r].call(y.exports,y,y.exports,m),y.l=!0,y.exports}return m.m=_,m.c=w,m.d=function(r,y,t){m.o(r,y)||Object.defineProperty(r,y,{enumerable:!0,get:t})},m.r=function(r){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},m.t=function(r,y){if(1&y&&(r=m(r)),8&y||4&y&&typeof r=="object"&&r&&r.__esModule)return r;var t=Object.create(null);if(m.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:r}),2&y&&typeof r!="string")for(var e in r)m.d(t,e,(function(o){return r[o]}).bind(null,e));return t},m.n=function(r){var y=r&&r.__esModule?function(){return r.default}:function(){return r};return m.d(y,"a",y),y},m.o=function(r,y){return Object.prototype.hasOwnProperty.call(r,y)},m.p="",m(m.s=0)}([function(_,w,m){m.r(w),m.d(w,"default",function(){return r});class r{constructor(t,e=null,o=null){this.events={},this.container=t,this.precanvas=null,this.nodeId=1,this.ele_selected=null,this.node_selected=null,this.drag=!1,this.reroute=!1,this.reroute_fix_curvature=!1,this.curvature=.5,this.reroute_curvature_start_end=.5,this.reroute_curvature=.5,this.reroute_width=6,this.drag_point=!1,this.editor_selected=!1,this.connection=!1,this.connection_ele=null,this.connection_selected=null,this.canvas_x=0,this.canvas_y=0,this.pos_x=0,this.pos_x_start=0,this.pos_y=0,this.pos_y_start=0,this.mouse_x=0,this.mouse_y=0,this.line_path=5,this.first_click=null,this.force_first_input=!1,this.draggable_inputs=!0,this.useuuid=!1,this.parent=o,this.noderegister={},this.render=e,this.drawflow={drawflow:{Home:{data:{}}}},this.module="Home",this.editor_mode="edit",this.zoom=1,this.zoom_max=1.6,this.zoom_min=.5,this.zoom_value=.1,this.zoom_last_value=1,this.evCache=new Array,this.prevDiff=-1}start(){this.container.classList.add("parent-drawflow"),this.container.tabIndex=0,this.precanvas=document.createElement("div"),this.precanvas.classList.add("drawflow"),this.container.appendChild(this.precanvas),this.container.addEventListener("mouseup",this.dragEnd.bind(this)),this.container.addEventListener("mousemove",this.position.bind(this)),this.container.addEventListener("mousedown",this.click.bind(this)),this.container.addEventListener("touchend",this.dragEnd.bind(this)),this.container.addEventListener("touchmove",this.position.bind(this)),this.container.addEventListener("touchstart",this.click.bind(this)),this.container.addEventListener("contextmenu",this.contextmenu.bind(this)),this.container.addEventListener("keydown",this.key.bind(this)),this.container.addEventListener("wheel",this.zoom_enter.bind(this)),this.container.addEventListener("input",this.updateNodeValue.bind(this)),this.container.addEventListener("dblclick",this.dblclick.bind(this)),this.container.onpointerdown=this.pointerdown_handler.bind(this),this.container.onpointermove=this.pointermove_handler.bind(this),this.container.onpointerup=this.pointerup_handler.bind(this),this.container.onpointercancel=this.pointerup_handler.bind(this),this.container.onpointerout=this.pointerup_handler.bind(this),this.container.onpointerleave=this.pointerup_handler.bind(this),this.load()}pointerdown_handler(t){this.evCache.push(t)}pointermove_handler(t){for(var e=0;e<this.evCache.length;e++)if(t.pointerId==this.evCache[e].pointerId){this.evCache[e]=t;break}if(this.evCache.length==2){var o=Math.abs(this.evCache[0].clientX-this.evCache[1].clientX);this.prevDiff>100&&(o>this.prevDiff&&this.zoom_in(),o<this.prevDiff&&this.zoom_out()),this.prevDiff=o}}pointerup_handler(t){this.remove_event(t),this.evCache.length<2&&(this.prevDiff=-1)}remove_event(t){for(var e=0;e<this.evCache.length;e++)if(this.evCache[e].pointerId==t.pointerId){this.evCache.splice(e,1);break}}load(){for(var t in this.drawflow.drawflow[this.module].data)this.addNodeImport(this.drawflow.drawflow[this.module].data[t],this.precanvas);if(this.reroute)for(var t in this.drawflow.drawflow[this.module].data)this.addRerouteImport(this.drawflow.drawflow[this.module].data[t]);for(var t in this.drawflow.drawflow[this.module].data)this.updateConnectionNodes("node-"+t);const e=this.drawflow.drawflow;let o=1;Object.keys(e).map(function(i,n){Object.keys(e[i].data).map(function(d,a){parseInt(d)>=o&&(o=parseInt(d)+1)})}),this.nodeId=o}removeReouteConnectionSelected(){this.dispatch("connectionUnselected",!0),this.reroute_fix_curvature&&this.connection_selected.parentElement.querySelectorAll(".main-path").forEach((t,e)=>{t.classList.remove("selected")})}click(t){if(this.dispatch("click",t),this.editor_mode==="fixed"){if(t.preventDefault(),t.target.classList[0]!=="parent-drawflow"&&t.target.classList[0]!=="drawflow")return!1;this.ele_selected=t.target.closest(".parent-drawflow")}else this.editor_mode==="view"?(t.target.closest(".drawflow")!=null||t.target.matches(".parent-drawflow"))&&(this.ele_selected=t.target.closest(".parent-drawflow"),t.preventDefault()):(this.first_click=t.target,this.ele_selected=t.target,t.button===0&&this.contextmenuDel(),t.target.closest(".drawflow_content_node")!=null&&(this.ele_selected=t.target.closest(".drawflow_content_node").parentElement));switch(this.ele_selected.classList[0]){case"drawflow-node":this.node_selected!=null&&(this.node_selected.classList.remove("selected"),this.node_selected!=this.ele_selected&&this.dispatch("nodeUnselected",!0)),this.connection_selected!=null&&(this.connection_selected.classList.remove("selected"),this.removeReouteConnectionSelected(),this.connection_selected=null),this.node_selected!=this.ele_selected&&this.dispatch("nodeSelected",this.ele_selected.id.slice(5)),this.node_selected=this.ele_selected,this.node_selected.classList.add("selected"),this.draggable_inputs?t.target.tagName!=="SELECT"&&(this.drag=!0):t.target.tagName!=="INPUT"&&t.target.tagName!=="TEXTAREA"&&t.target.tagName!=="SELECT"&&t.target.hasAttribute("contenteditable")!==!0&&(this.drag=!0);break;case"output":this.connection=!0,this.node_selected!=null&&(this.node_selected.classList.remove("selected"),this.node_selected=null,this.dispatch("nodeUnselected",!0)),this.connection_selected!=null&&(this.connection_selected.classList.remove("selected"),this.removeReouteConnectionSelected(),this.connection_selected=null),this.drawConnection(t.target);break;case"parent-drawflow":case"drawflow":this.node_selected!=null&&(this.node_selected.classList.remove("selected"),this.node_selected=null,this.dispatch("nodeUnselected",!0)),this.connection_selected!=null&&(this.connection_selected.classList.remove("selected"),this.removeReouteConnectionSelected(),this.connection_selected=null),this.editor_selected=!0;break;case"main-path":this.node_selected!=null&&(this.node_selected.classList.remove("selected"),this.node_selected=null,this.dispatch("nodeUnselected",!0)),this.connection_selected!=null&&(this.connection_selected.classList.remove("selected"),this.removeReouteConnectionSelected(),this.connection_selected=null),this.connection_selected=this.ele_selected,this.connection_selected.classList.add("selected");const e=this.connection_selected.parentElement.classList;e.length>1&&(this.dispatch("connectionSelected",{output_id:e[2].slice(14),input_id:e[1].slice(13),output_class:e[3],input_class:e[4]}),this.reroute_fix_curvature&&this.connection_selected.parentElement.querySelectorAll(".main-path").forEach((o,i)=>{o.classList.add("selected")}));break;case"point":this.drag_point=!0,this.ele_selected.classList.add("selected");break;case"drawflow-delete":this.node_selected&&this.removeNodeId(this.node_selected.id),this.connection_selected&&this.removeConnection(),this.node_selected!=null&&(this.node_selected.classList.remove("selected"),this.node_selected=null,this.dispatch("nodeUnselected",!0)),this.connection_selected!=null&&(this.connection_selected.classList.remove("selected"),this.removeReouteConnectionSelected(),this.connection_selected=null)}t.type==="touchstart"?(this.pos_x=t.touches[0].clientX,this.pos_x_start=t.touches[0].clientX,this.pos_y=t.touches[0].clientY,this.pos_y_start=t.touches[0].clientY,this.mouse_x=t.touches[0].clientX,this.mouse_y=t.touches[0].clientY):(this.pos_x=t.clientX,this.pos_x_start=t.clientX,this.pos_y=t.clientY,this.pos_y_start=t.clientY),["input","output","main-path"].includes(this.ele_selected.classList[0])&&t.preventDefault(),this.dispatch("clickEnd",t)}position(t){if(t.type==="touchmove")var e=t.touches[0].clientX,o=t.touches[0].clientY;else e=t.clientX,o=t.clientY;if(this.connection&&this.updateConnection(e,o),this.editor_selected&&(i=this.canvas_x+-(this.pos_x-e),n=this.canvas_y+-(this.pos_y-o),this.dispatch("translate",{x:i,y:n}),this.precanvas.style.transform="translate("+i+"px, "+n+"px) scale("+this.zoom+")"),this.drag){t.preventDefault();var i=(this.pos_x-e)*this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom),n=(this.pos_y-o)*this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom);this.pos_x=e,this.pos_y=o,this.ele_selected.style.top=this.ele_selected.offsetTop-n+"px",this.ele_selected.style.left=this.ele_selected.offsetLeft-i+"px",this.drawflow.drawflow[this.module].data[this.ele_selected.id.slice(5)].pos_x=this.ele_selected.offsetLeft-i,this.drawflow.drawflow[this.module].data[this.ele_selected.id.slice(5)].pos_y=this.ele_selected.offsetTop-n,this.updateConnectionNodes(this.ele_selected.id)}if(this.drag_point){i=(this.pos_x-e)*this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom),n=(this.pos_y-o)*this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom),this.pos_x=e,this.pos_y=o;var d=this.pos_x*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom))-this.precanvas.getBoundingClientRect().x*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom)),a=this.pos_y*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom))-this.precanvas.getBoundingClientRect().y*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom));this.ele_selected.setAttributeNS(null,"cx",d),this.ele_selected.setAttributeNS(null,"cy",a);const h=this.ele_selected.parentElement.classList[2].slice(9),l=this.ele_selected.parentElement.classList[1].slice(13),s=this.ele_selected.parentElement.classList[3],c=this.ele_selected.parentElement.classList[4];let u=Array.from(this.ele_selected.parentElement.children).indexOf(this.ele_selected)-1;this.reroute_fix_curvature&&(u-=this.ele_selected.parentElement.querySelectorAll(".main-path").length-1,u<0&&(u=0));const f=h.slice(5),v=this.drawflow.drawflow[this.module].data[f].outputs[s].connections.findIndex(function(x,R){return x.node===l&&x.output===c});this.drawflow.drawflow[this.module].data[f].outputs[s].connections[v].points[u]={pos_x:d,pos_y:a};const E=this.ele_selected.parentElement.classList[2].slice(9);this.updateConnectionNodes(E)}t.type==="touchmove"&&(this.mouse_x=e,this.mouse_y=o),this.dispatch("mouseMove",{x:e,y:o})}dragEnd(t){if(t.type==="touchend")var e=this.mouse_x,o=this.mouse_y,i=document.elementFromPoint(e,o);else e=t.clientX,o=t.clientY,i=t.target;if(this.drag&&(this.pos_x_start==e&&this.pos_y_start==o||this.dispatch("nodeMoved",this.ele_selected.id.slice(5))),this.drag_point&&(this.ele_selected.classList.remove("selected"),this.pos_x_start==e&&this.pos_y_start==o||this.dispatch("rerouteMoved",this.ele_selected.parentElement.classList[2].slice(14))),this.editor_selected&&(this.canvas_x=this.canvas_x+-(this.pos_x-e),this.canvas_y=this.canvas_y+-(this.pos_y-o),this.editor_selected=!1),this.connection===!0)if(i.classList[0]==="input"||this.force_first_input&&(i.closest(".drawflow_content_node")!=null||i.classList[0]==="drawflow-node")){if(!this.force_first_input||i.closest(".drawflow_content_node")==null&&i.classList[0]!=="drawflow-node")n=i.parentElement.parentElement.id,d=i.classList[1];else{if(i.closest(".drawflow_content_node")!=null)var n=i.closest(".drawflow_content_node").parentElement.id;else var n=i.id;if(Object.keys(this.getNodeFromId(n.slice(5)).inputs).length===0)var d=!1;else var d="input_1"}var a=this.ele_selected.parentElement.parentElement.id,h=this.ele_selected.classList[1];if(a!==n&&d!==!1){if(this.container.querySelectorAll(".connection.node_in_"+n+".node_out_"+a+"."+h+"."+d).length===0){this.connection_ele.classList.add("node_in_"+n),this.connection_ele.classList.add("node_out_"+a),this.connection_ele.classList.add(h),this.connection_ele.classList.add(d);var l=n.slice(5),s=a.slice(5);this.drawflow.drawflow[this.module].data[s].outputs[h].connections.push({node:l,output:d}),this.drawflow.drawflow[this.module].data[l].inputs[d].connections.push({node:s,input:h}),this.updateConnectionNodes("node-"+s),this.updateConnectionNodes("node-"+l),this.dispatch("connectionCreated",{output_id:s,input_id:l,output_class:h,input_class:d})}else this.dispatch("connectionCancel",!0),this.connection_ele.remove();this.connection_ele=null}else this.dispatch("connectionCancel",!0),this.connection_ele.remove(),this.connection_ele=null}else this.dispatch("connectionCancel",!0),this.connection_ele.remove(),this.connection_ele=null;this.drag=!1,this.drag_point=!1,this.connection=!1,this.ele_selected=null,this.editor_selected=!1,this.dispatch("mouseUp",t)}contextmenu(t){if(this.dispatch("contextmenu",t),t.preventDefault(),this.editor_mode==="fixed"||this.editor_mode==="view")return!1;if(this.precanvas.getElementsByClassName("drawflow-delete").length&&this.precanvas.getElementsByClassName("drawflow-delete")[0].remove(),this.node_selected||this.connection_selected){var e=document.createElement("div");e.classList.add("drawflow-delete"),e.innerHTML="x",this.node_selected&&this.node_selected.appendChild(e),this.connection_selected&&this.connection_selected.parentElement.classList.length>1&&(e.style.top=t.clientY*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom))-this.precanvas.getBoundingClientRect().y*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom))+"px",e.style.left=t.clientX*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom))-this.precanvas.getBoundingClientRect().x*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom))+"px",this.precanvas.appendChild(e))}}contextmenuDel(){this.precanvas.getElementsByClassName("drawflow-delete").length&&this.precanvas.getElementsByClassName("drawflow-delete")[0].remove()}key(t){if(this.dispatch("keydown",t),this.editor_mode==="fixed"||this.editor_mode==="view")return!1;(t.key==="Delete"||t.key==="Backspace"&&t.metaKey)&&(this.node_selected!=null&&this.first_click.tagName!=="INPUT"&&this.first_click.tagName!=="TEXTAREA"&&this.first_click.hasAttribute("contenteditable")!==!0&&this.removeNodeId(this.node_selected.id),this.connection_selected!=null&&this.removeConnection())}zoom_enter(t,e){t.ctrlKey&&(t.preventDefault(),t.deltaY>0?this.zoom_out():this.zoom_in())}zoom_refresh(){this.dispatch("zoom",this.zoom),this.canvas_x=this.canvas_x/this.zoom_last_value*this.zoom,this.canvas_y=this.canvas_y/this.zoom_last_value*this.zoom,this.zoom_last_value=this.zoom,this.precanvas.style.transform="translate("+this.canvas_x+"px, "+this.canvas_y+"px) scale("+this.zoom+")"}zoom_in(){this.zoom<this.zoom_max&&(this.zoom+=this.zoom_value,this.zoom_refresh())}zoom_out(){this.zoom>this.zoom_min&&(this.zoom-=this.zoom_value,this.zoom_refresh())}zoom_reset(){this.zoom!=1&&(this.zoom=1,this.zoom_refresh())}createCurvature(t,e,o,i,n,d){var a=t,h=e,l=o,s=i,c=n;switch(d){case"open":if(t>=o)var u=a+Math.abs(l-a)*c,f=l-Math.abs(l-a)*(-1*c);else u=a+Math.abs(l-a)*c,f=l-Math.abs(l-a)*c;return" M "+a+" "+h+" C "+u+" "+h+" "+f+" "+s+" "+l+"  "+s;case"close":return t>=o?(u=a+Math.abs(l-a)*(-1*c),f=l-Math.abs(l-a)*c):(u=a+Math.abs(l-a)*c,f=l-Math.abs(l-a)*c)," M "+a+" "+h+" C "+u+" "+h+" "+f+" "+s+" "+l+"  "+s;case"other":return t>=o?(u=a+Math.abs(l-a)*(-1*c),f=l-Math.abs(l-a)*(-1*c)):(u=a+Math.abs(l-a)*c,f=l-Math.abs(l-a)*c)," M "+a+" "+h+" C "+u+" "+h+" "+f+" "+s+" "+l+"  "+s;default:return" M "+a+" "+h+" C "+(u=a+Math.abs(l-a)*c)+" "+h+" "+(f=l-Math.abs(l-a)*c)+" "+s+" "+l+"  "+s}}drawConnection(t){var e=document.createElementNS("http://www.w3.org/2000/svg","svg");this.connection_ele=e;var o=document.createElementNS("http://www.w3.org/2000/svg","path");o.classList.add("main-path"),o.setAttributeNS(null,"d",""),e.classList.add("connection"),e.appendChild(o),this.precanvas.appendChild(e);var i=t.parentElement.parentElement.id.slice(5),n=t.classList[1];this.dispatch("connectionStart",{output_id:i,output_class:n})}updateConnection(t,e){const o=this.precanvas,i=this.zoom;let n=o.clientWidth/(o.clientWidth*i);n=n||0;let d=o.clientHeight/(o.clientHeight*i);d=d||0;var a=this.connection_ele.children[0],h=this.ele_selected.offsetWidth/2+(this.ele_selected.getBoundingClientRect().x-o.getBoundingClientRect().x)*n,l=this.ele_selected.offsetHeight/2+(this.ele_selected.getBoundingClientRect().y-o.getBoundingClientRect().y)*d,s=t*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom))-this.precanvas.getBoundingClientRect().x*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom)),c=e*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom))-this.precanvas.getBoundingClientRect().y*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom)),u=this.curvature,f=this.createCurvature(h,l,s,c,u,"openclose");a.setAttributeNS(null,"d",f)}addConnection(t,e,o,i){var n=this.getModuleFromNodeId(t);if(n===this.getModuleFromNodeId(e)){var d=this.getNodeFromId(t),a=!1;for(var h in d.outputs[o].connections){var l=d.outputs[o].connections[h];l.node==e&&l.output==i&&(a=!0)}if(a===!1){if(this.drawflow.drawflow[n].data[t].outputs[o].connections.push({node:e.toString(),output:i}),this.drawflow.drawflow[n].data[e].inputs[i].connections.push({node:t.toString(),input:o}),this.module===n){var s=document.createElementNS("http://www.w3.org/2000/svg","svg"),c=document.createElementNS("http://www.w3.org/2000/svg","path");c.classList.add("main-path"),c.setAttributeNS(null,"d",""),s.classList.add("connection"),s.classList.add("node_in_node-"+e),s.classList.add("node_out_node-"+t),s.classList.add(o),s.classList.add(i),s.appendChild(c),this.precanvas.appendChild(s),this.updateConnectionNodes("node-"+t),this.updateConnectionNodes("node-"+e)}this.dispatch("connectionCreated",{output_id:t,input_id:e,output_class:o,input_class:i})}}}updateConnectionNodes(t){const e="node_in_"+t,o="node_out_"+t;this.line_path;const i=this.container,n=this.precanvas,d=this.curvature,a=this.createCurvature,h=this.reroute_curvature,l=this.reroute_curvature_start_end,s=this.reroute_fix_curvature,c=this.reroute_width,u=this.zoom;let f=n.clientWidth/(n.clientWidth*u);f=f||0;let v=n.clientHeight/(n.clientHeight*u);v=v||0;const E=i.querySelectorAll("."+o);Object.keys(E).map(function(R,Y){if(E[R].querySelector(".point")===null){var B=i.querySelector("#"+t),S=E[R].classList[1].replace("node_in_",""),z=i.querySelector("#"+S).querySelectorAll("."+E[R].classList[4])[0],K=z.offsetWidth/2+(z.getBoundingClientRect().x-n.getBoundingClientRect().x)*f,O=z.offsetHeight/2+(z.getBoundingClientRect().y-n.getBoundingClientRect().y)*v,Q=B.querySelectorAll("."+E[R].classList[3])[0],H=Q.offsetWidth/2+(Q.getBoundingClientRect().x-n.getBoundingClientRect().x)*f,C=Q.offsetHeight/2+(Q.getBoundingClientRect().y-n.getBoundingClientRect().y)*v;const A=a(H,C,K,O,d,"openclose");E[R].children[0].setAttributeNS(null,"d",A)}else{const A=E[R].querySelectorAll(".point");let p="";const L=[];A.forEach((I,N)=>{if(N===0&&A.length-1==0){var q=i.querySelector("#"+t),j=((J=I).getBoundingClientRect().x-n.getBoundingClientRect().x)*f+c,D=(J.getBoundingClientRect().y-n.getBoundingClientRect().y)*v+c,W=(G=q.querySelectorAll("."+I.parentElement.classList[3])[0]).offsetWidth/2+(G.getBoundingClientRect().x-n.getBoundingClientRect().x)*f,k=G.offsetHeight/2+(G.getBoundingClientRect().y-n.getBoundingClientRect().y)*v,F=a(W,k,j,D,l,"open");p+=F,L.push(F),q=I;var Z=I.parentElement.classList[1].replace("node_in_",""),J=(M=i.querySelector("#"+Z)).querySelectorAll("."+I.parentElement.classList[4])[0];j=(et=M.querySelectorAll("."+I.parentElement.classList[4])[0]).offsetWidth/2+(et.getBoundingClientRect().x-n.getBoundingClientRect().x)*f,D=et.offsetHeight/2+(et.getBoundingClientRect().y-n.getBoundingClientRect().y)*v,W=(q.getBoundingClientRect().x-n.getBoundingClientRect().x)*f+c,k=(q.getBoundingClientRect().y-n.getBoundingClientRect().y)*v+c,F=a(W,k,j,D,l,"close"),p+=F,L.push(F)}else if(N===0){var G;q=i.querySelector("#"+t),j=((J=I).getBoundingClientRect().x-n.getBoundingClientRect().x)*f+c,D=(J.getBoundingClientRect().y-n.getBoundingClientRect().y)*v+c,W=(G=q.querySelectorAll("."+I.parentElement.classList[3])[0]).offsetWidth/2+(G.getBoundingClientRect().x-n.getBoundingClientRect().x)*f,k=G.offsetHeight/2+(G.getBoundingClientRect().y-n.getBoundingClientRect().y)*v,F=a(W,k,j,D,l,"open"),p+=F,L.push(F),q=I,j=((J=A[N+1]).getBoundingClientRect().x-n.getBoundingClientRect().x)*f+c,D=(J.getBoundingClientRect().y-n.getBoundingClientRect().y)*v+c,W=(q.getBoundingClientRect().x-n.getBoundingClientRect().x)*f+c,k=(q.getBoundingClientRect().y-n.getBoundingClientRect().y)*v+c,F=a(W,k,j,D,h,"other"),p+=F,L.push(F)}else if(N===A.length-1){var M,et;q=I,Z=I.parentElement.classList[1].replace("node_in_",""),J=(M=i.querySelector("#"+Z)).querySelectorAll("."+I.parentElement.classList[4])[0],j=(et=M.querySelectorAll("."+I.parentElement.classList[4])[0]).offsetWidth/2+(et.getBoundingClientRect().x-n.getBoundingClientRect().x)*f,D=et.offsetHeight/2+(et.getBoundingClientRect().y-n.getBoundingClientRect().y)*v,W=(q.getBoundingClientRect().x-n.getBoundingClientRect().x)*(n.clientWidth/(n.clientWidth*u))+c,k=(q.getBoundingClientRect().y-n.getBoundingClientRect().y)*(n.clientHeight/(n.clientHeight*u))+c,F=a(W,k,j,D,l,"close"),p+=F,L.push(F)}else q=I,j=((J=A[N+1]).getBoundingClientRect().x-n.getBoundingClientRect().x)*(n.clientWidth/(n.clientWidth*u))+c,D=(J.getBoundingClientRect().y-n.getBoundingClientRect().y)*(n.clientHeight/(n.clientHeight*u))+c,W=(q.getBoundingClientRect().x-n.getBoundingClientRect().x)*(n.clientWidth/(n.clientWidth*u))+c,k=(q.getBoundingClientRect().y-n.getBoundingClientRect().y)*(n.clientHeight/(n.clientHeight*u))+c,F=a(W,k,j,D,h,"other"),p+=F,L.push(F)}),s?L.forEach((I,N)=>{E[R].children[N].setAttributeNS(null,"d",I)}):E[R].children[0].setAttributeNS(null,"d",p)}});const x=i.querySelectorAll("."+e);Object.keys(x).map(function(R,Y){if(x[R].querySelector(".point")===null){var B=i.querySelector("#"+t),S=x[R].classList[2].replace("node_out_",""),z=i.querySelector("#"+S).querySelectorAll("."+x[R].classList[3])[0],K=z.offsetWidth/2+(z.getBoundingClientRect().x-n.getBoundingClientRect().x)*f,O=z.offsetHeight/2+(z.getBoundingClientRect().y-n.getBoundingClientRect().y)*v,Q=(B=B.querySelectorAll("."+x[R].classList[4])[0]).offsetWidth/2+(B.getBoundingClientRect().x-n.getBoundingClientRect().x)*f,H=B.offsetHeight/2+(B.getBoundingClientRect().y-n.getBoundingClientRect().y)*v;const C=a(K,O,Q,H,d,"openclose");x[R].children[0].setAttributeNS(null,"d",C)}else{const C=x[R].querySelectorAll(".point");let A="";const p=[];C.forEach((L,I)=>{if(I===0&&C.length-1==0){var N=i.querySelector("#"+t),q=((Z=L).getBoundingClientRect().x-n.getBoundingClientRect().x)*f+c,j=(Z.getBoundingClientRect().y-n.getBoundingClientRect().y)*v+c,D=(M=N.querySelectorAll("."+L.parentElement.classList[4])[0]).offsetWidth/2+(M.getBoundingClientRect().x-n.getBoundingClientRect().x)*f,W=M.offsetHeight/2+(M.getBoundingClientRect().y-n.getBoundingClientRect().y)*v,k=a(q,j,D,W,l,"close");A+=k,p.push(k),N=L;var F=L.parentElement.classList[2].replace("node_out_",""),Z=(G=i.querySelector("#"+F)).querySelectorAll("."+L.parentElement.classList[3])[0];q=(J=G.querySelectorAll("."+L.parentElement.classList[3])[0]).offsetWidth/2+(J.getBoundingClientRect().x-n.getBoundingClientRect().x)*f,j=J.offsetHeight/2+(J.getBoundingClientRect().y-n.getBoundingClientRect().y)*v,D=(N.getBoundingClientRect().x-n.getBoundingClientRect().x)*f+c,W=(N.getBoundingClientRect().y-n.getBoundingClientRect().y)*v+c,k=a(q,j,D,W,l,"open"),A+=k,p.push(k)}else if(I===0){var J;N=L,F=L.parentElement.classList[2].replace("node_out_",""),Z=(G=i.querySelector("#"+F)).querySelectorAll("."+L.parentElement.classList[3])[0],q=(J=G.querySelectorAll("."+L.parentElement.classList[3])[0]).offsetWidth/2+(J.getBoundingClientRect().x-n.getBoundingClientRect().x)*f,j=J.offsetHeight/2+(J.getBoundingClientRect().y-n.getBoundingClientRect().y)*v,D=(N.getBoundingClientRect().x-n.getBoundingClientRect().x)*f+c,W=(N.getBoundingClientRect().y-n.getBoundingClientRect().y)*v+c,k=a(q,j,D,W,l,"open"),A+=k,p.push(k),N=L,D=((Z=C[I+1]).getBoundingClientRect().x-n.getBoundingClientRect().x)*f+c,W=(Z.getBoundingClientRect().y-n.getBoundingClientRect().y)*v+c,q=(N.getBoundingClientRect().x-n.getBoundingClientRect().x)*f+c,j=(N.getBoundingClientRect().y-n.getBoundingClientRect().y)*v+c,k=a(q,j,D,W,h,"other"),A+=k,p.push(k)}else if(I===C.length-1){var G,M;N=L,F=L.parentElement.classList[1].replace("node_in_",""),Z=(G=i.querySelector("#"+F)).querySelectorAll("."+L.parentElement.classList[4])[0],D=(M=G.querySelectorAll("."+L.parentElement.classList[4])[0]).offsetWidth/2+(M.getBoundingClientRect().x-n.getBoundingClientRect().x)*f,W=M.offsetHeight/2+(M.getBoundingClientRect().y-n.getBoundingClientRect().y)*v,q=(N.getBoundingClientRect().x-n.getBoundingClientRect().x)*f+c,j=(N.getBoundingClientRect().y-n.getBoundingClientRect().y)*v+c,k=a(q,j,D,W,l,"close"),A+=k,p.push(k)}else N=L,D=((Z=C[I+1]).getBoundingClientRect().x-n.getBoundingClientRect().x)*f+c,W=(Z.getBoundingClientRect().y-n.getBoundingClientRect().y)*v+c,q=(N.getBoundingClientRect().x-n.getBoundingClientRect().x)*f+c,j=(N.getBoundingClientRect().y-n.getBoundingClientRect().y)*v+c,k=a(q,j,D,W,h,"other"),A+=k,p.push(k)}),s?p.forEach((L,I)=>{x[R].children[I].setAttributeNS(null,"d",L)}):x[R].children[0].setAttributeNS(null,"d",A)}})}dblclick(t){this.connection_selected!=null&&this.reroute&&this.createReroutePoint(this.connection_selected),t.target.classList[0]==="point"&&this.removeReroutePoint(t.target)}createReroutePoint(t){this.connection_selected.classList.remove("selected");const e=this.connection_selected.parentElement.classList[2].slice(9),o=this.connection_selected.parentElement.classList[1].slice(13),i=this.connection_selected.parentElement.classList[3],n=this.connection_selected.parentElement.classList[4];this.connection_selected=null;const d=document.createElementNS("http://www.w3.org/2000/svg","circle");d.classList.add("point");var a=this.pos_x*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom))-this.precanvas.getBoundingClientRect().x*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom)),h=this.pos_y*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom))-this.precanvas.getBoundingClientRect().y*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom));d.setAttributeNS(null,"cx",a),d.setAttributeNS(null,"cy",h),d.setAttributeNS(null,"r",this.reroute_width);let l=0;if(this.reroute_fix_curvature){const f=t.parentElement.querySelectorAll(".main-path").length;var s=document.createElementNS("http://www.w3.org/2000/svg","path");if(s.classList.add("main-path"),s.setAttributeNS(null,"d",""),t.parentElement.insertBefore(s,t.parentElement.children[f]),f===1)t.parentElement.appendChild(d);else{const v=Array.from(t.parentElement.children).indexOf(t);l=v,t.parentElement.insertBefore(d,t.parentElement.children[v+f+1])}}else t.parentElement.appendChild(d);const c=e.slice(5),u=this.drawflow.drawflow[this.module].data[c].outputs[i].connections.findIndex(function(f,v){return f.node===o&&f.output===n});this.drawflow.drawflow[this.module].data[c].outputs[i].connections[u].points===void 0&&(this.drawflow.drawflow[this.module].data[c].outputs[i].connections[u].points=[]),this.reroute_fix_curvature?(l>0||this.drawflow.drawflow[this.module].data[c].outputs[i].connections[u].points!==[]?this.drawflow.drawflow[this.module].data[c].outputs[i].connections[u].points.splice(l,0,{pos_x:a,pos_y:h}):this.drawflow.drawflow[this.module].data[c].outputs[i].connections[u].points.push({pos_x:a,pos_y:h}),t.parentElement.querySelectorAll(".main-path").forEach((f,v)=>{f.classList.remove("selected")})):this.drawflow.drawflow[this.module].data[c].outputs[i].connections[u].points.push({pos_x:a,pos_y:h}),this.dispatch("addReroute",c),this.updateConnectionNodes(e)}removeReroutePoint(t){const e=t.parentElement.classList[2].slice(9),o=t.parentElement.classList[1].slice(13),i=t.parentElement.classList[3],n=t.parentElement.classList[4];let d=Array.from(t.parentElement.children).indexOf(t);const a=e.slice(5),h=this.drawflow.drawflow[this.module].data[a].outputs[i].connections.findIndex(function(l,s){return l.node===o&&l.output===n});if(this.reroute_fix_curvature){const l=t.parentElement.querySelectorAll(".main-path").length;t.parentElement.children[l-1].remove(),d-=l,d<0&&(d=0)}else d--;this.drawflow.drawflow[this.module].data[a].outputs[i].connections[h].points.splice(d,1),t.remove(),this.dispatch("removeReroute",a),this.updateConnectionNodes(e)}registerNode(t,e,o=null,i=null){this.noderegister[t]={html:e,props:o,options:i}}getNodeFromId(t){var e=this.getModuleFromNodeId(t);return JSON.parse(JSON.stringify(this.drawflow.drawflow[e].data[t]))}getNodesFromName(t){var e=[];const o=this.drawflow.drawflow;return Object.keys(o).map(function(i,n){for(var d in o[i].data)o[i].data[d].name==t&&e.push(o[i].data[d].id)}),e}addNode(t,e,o,i,n,d,a,h,l=!1){if(this.useuuid)var s=this.getUuid();else s=this.nodeId;const c=document.createElement("div");c.classList.add("parent-node");const u=document.createElement("div");u.innerHTML="",u.setAttribute("id","node-"+s),u.classList.add("drawflow-node"),d!=""&&u.classList.add(...d.split(" "));const f=document.createElement("div");f.classList.add("inputs");const v=document.createElement("div");v.classList.add("outputs");const E={};for(var x=0;x<e;x++){const S=document.createElement("div");S.classList.add("input"),S.classList.add("input_"+(x+1)),E["input_"+(x+1)]={connections:[]},f.appendChild(S)}const R={};for(x=0;x<o;x++){const S=document.createElement("div");S.classList.add("output"),S.classList.add("output_"+(x+1)),R["output_"+(x+1)]={connections:[]},v.appendChild(S)}const Y=document.createElement("div");if(Y.classList.add("drawflow_content_node"),l===!1)Y.innerHTML=h;else if(l===!0)Y.appendChild(this.noderegister[h].html.cloneNode(!0));else if(parseInt(this.render.version)===3){let S=this.render.h(this.noderegister[h].html,this.noderegister[h].props,this.noderegister[h].options);S.appContext=this.parent,this.render.render(S,Y)}else{let S=new this.render({parent:this.parent,render:z=>z(this.noderegister[h].html,{props:this.noderegister[h].props}),...this.noderegister[h].options}).$mount();Y.appendChild(S.$el)}Object.entries(a).forEach(function(S,z){if(typeof S[1]=="object")(function Q(H,C,A){H===null?H=a[C]:H=H[C],H!==null&&Object.entries(H).forEach(function(p,L){if(typeof p[1]=="object")Q(H,p[0],A+"-"+p[0]);else for(var I=Y.querySelectorAll("[df-"+A+"-"+p[0]+"]"),N=0;N<I.length;N++)I[N].value=p[1],I[N].isContentEditable&&(I[N].innerText=p[1])})})(null,S[0],S[0]);else for(var K=Y.querySelectorAll("[df-"+S[0]+"]"),O=0;O<K.length;O++)K[O].value=S[1],K[O].isContentEditable&&(K[O].innerText=S[1])}),u.appendChild(f),u.appendChild(Y),u.appendChild(v),u.style.top=n+"px",u.style.left=i+"px",c.appendChild(u),this.precanvas.appendChild(c);var B={id:s,name:t,data:a,class:d,html:h,typenode:l,inputs:E,outputs:R,pos_x:i,pos_y:n};return this.drawflow.drawflow[this.module].data[s]=B,this.dispatch("nodeCreated",s),this.useuuid||this.nodeId++,s}addNodeImport(t,e){const o=document.createElement("div");o.classList.add("parent-node");const i=document.createElement("div");i.innerHTML="",i.setAttribute("id","node-"+t.id),i.classList.add("drawflow-node"),t.class!=""&&i.classList.add(...t.class.split(" "));const n=document.createElement("div");n.classList.add("inputs");const d=document.createElement("div");d.classList.add("outputs"),Object.keys(t.inputs).map(function(l,s){const c=document.createElement("div");c.classList.add("input"),c.classList.add(l),n.appendChild(c),Object.keys(t.inputs[l].connections).map(function(u,f){var v=document.createElementNS("http://www.w3.org/2000/svg","svg"),E=document.createElementNS("http://www.w3.org/2000/svg","path");E.classList.add("main-path"),E.setAttributeNS(null,"d",""),v.classList.add("connection"),v.classList.add("node_in_node-"+t.id),v.classList.add("node_out_node-"+t.inputs[l].connections[u].node),v.classList.add(t.inputs[l].connections[u].input),v.classList.add(l),v.appendChild(E),e.appendChild(v)})});for(var a=0;a<Object.keys(t.outputs).length;a++){const l=document.createElement("div");l.classList.add("output"),l.classList.add("output_"+(a+1)),d.appendChild(l)}const h=document.createElement("div");if(h.classList.add("drawflow_content_node"),t.typenode===!1)h.innerHTML=t.html;else if(t.typenode===!0)h.appendChild(this.noderegister[t.html].html.cloneNode(!0));else if(parseInt(this.render.version)===3){let l=this.render.h(this.noderegister[t.html].html,this.noderegister[t.html].props,this.noderegister[t.html].options);l.appContext=this.parent,this.render.render(l,h)}else{let l=new this.render({parent:this.parent,render:s=>s(this.noderegister[t.html].html,{props:this.noderegister[t.html].props}),...this.noderegister[t.html].options}).$mount();h.appendChild(l.$el)}Object.entries(t.data).forEach(function(l,s){if(typeof l[1]=="object")(function f(v,E,x){v===null?v=t.data[E]:v=v[E],v!==null&&Object.entries(v).forEach(function(R,Y){if(typeof R[1]=="object")f(v,R[0],x+"-"+R[0]);else for(var B=h.querySelectorAll("[df-"+x+"-"+R[0]+"]"),S=0;S<B.length;S++)B[S].value=R[1],B[S].isContentEditable&&(B[S].innerText=R[1])})})(null,l[0],l[0]);else for(var c=h.querySelectorAll("[df-"+l[0]+"]"),u=0;u<c.length;u++)c[u].value=l[1],c[u].isContentEditable&&(c[u].innerText=l[1])}),i.appendChild(n),i.appendChild(h),i.appendChild(d),i.style.top=t.pos_y+"px",i.style.left=t.pos_x+"px",o.appendChild(i),this.precanvas.appendChild(o)}addRerouteImport(t){const e=this.reroute_width,o=this.reroute_fix_curvature,i=this.container;Object.keys(t.outputs).map(function(n,d){Object.keys(t.outputs[n].connections).map(function(a,h){const l=t.outputs[n].connections[a].points;l!==void 0&&l.forEach((s,c)=>{const u=t.outputs[n].connections[a].node,f=t.outputs[n].connections[a].output,v=i.querySelector(".connection.node_in_node-"+u+".node_out_node-"+t.id+"."+n+"."+f);if(o&&c===0)for(var E=0;E<l.length;E++){var x=document.createElementNS("http://www.w3.org/2000/svg","path");x.classList.add("main-path"),x.setAttributeNS(null,"d",""),v.appendChild(x)}const R=document.createElementNS("http://www.w3.org/2000/svg","circle");R.classList.add("point");var Y=s.pos_x,B=s.pos_y;R.setAttributeNS(null,"cx",Y),R.setAttributeNS(null,"cy",B),R.setAttributeNS(null,"r",e),v.appendChild(R)})})})}updateNodeValue(t){for(var e=t.target.attributes,o=0;o<e.length;o++)if(e[o].nodeName.startsWith("df-")){for(var i=e[o].nodeName.slice(3).split("-"),n=this.drawflow.drawflow[this.module].data[t.target.closest(".drawflow_content_node").parentElement.id.slice(5)].data,d=0;d<i.length-1;d+=1)n[i[d]]==null&&(n[i[d]]={}),n=n[i[d]];n[i[i.length-1]]=t.target.value,t.target.isContentEditable&&(n[i[i.length-1]]=t.target.innerText),this.dispatch("nodeDataChanged",t.target.closest(".drawflow_content_node").parentElement.id.slice(5))}}updateNodeDataFromId(t,e){var o=this.getModuleFromNodeId(t);if(this.drawflow.drawflow[o].data[t].data=e,this.module===o){const i=this.container.querySelector("#node-"+t);Object.entries(e).forEach(function(n,d){if(typeof n[1]=="object")(function l(s,c,u){s===null?s=e[c]:s=s[c],s!==null&&Object.entries(s).forEach(function(f,v){if(typeof f[1]=="object")l(s,f[0],u+"-"+f[0]);else for(var E=i.querySelectorAll("[df-"+u+"-"+f[0]+"]"),x=0;x<E.length;x++)E[x].value=f[1],E[x].isContentEditable&&(E[x].innerText=f[1])})})(null,n[0],n[0]);else for(var a=i.querySelectorAll("[df-"+n[0]+"]"),h=0;h<a.length;h++)a[h].value=n[1],a[h].isContentEditable&&(a[h].innerText=n[1])})}}addNodeInput(t){var e=this.getModuleFromNodeId(t);const o=this.getNodeFromId(t),i=Object.keys(o.inputs).length;if(this.module===e){const n=document.createElement("div");n.classList.add("input"),n.classList.add("input_"+(i+1)),this.container.querySelector("#node-"+t+" .inputs").appendChild(n),this.updateConnectionNodes("node-"+t)}this.drawflow.drawflow[e].data[t].inputs["input_"+(i+1)]={connections:[]}}addNodeOutput(t){var e=this.getModuleFromNodeId(t);const o=this.getNodeFromId(t),i=Object.keys(o.outputs).length;if(this.module===e){const n=document.createElement("div");n.classList.add("output"),n.classList.add("output_"+(i+1)),this.container.querySelector("#node-"+t+" .outputs").appendChild(n),this.updateConnectionNodes("node-"+t)}this.drawflow.drawflow[e].data[t].outputs["output_"+(i+1)]={connections:[]}}removeNodeInput(t,e){var o=this.getModuleFromNodeId(t);const i=this.getNodeFromId(t);this.module===o&&this.container.querySelector("#node-"+t+" .inputs .input."+e).remove();const n=[];Object.keys(i.inputs[e].connections).map(function(s,c){const u=i.inputs[e].connections[c].node,f=i.inputs[e].connections[c].input;n.push({id_output:u,id:t,output_class:f,input_class:e})}),n.forEach((s,c)=>{this.removeSingleConnection(s.id_output,s.id,s.output_class,s.input_class)}),delete this.drawflow.drawflow[o].data[t].inputs[e];const d=[],a=this.drawflow.drawflow[o].data[t].inputs;Object.keys(a).map(function(s,c){d.push(a[s])}),this.drawflow.drawflow[o].data[t].inputs={};const h=e.slice(6);let l=[];d.forEach((s,c)=>{s.connections.forEach((u,f)=>{l.push(u)}),this.drawflow.drawflow[o].data[t].inputs["input_"+(c+1)]=s}),l=new Set(l.map(s=>JSON.stringify(s))),l=Array.from(l).map(s=>JSON.parse(s)),this.module===o&&this.container.querySelectorAll("#node-"+t+" .inputs .input").forEach((s,c)=>{const u=s.classList[1].slice(6);parseInt(h)<parseInt(u)&&(s.classList.remove("input_"+u),s.classList.add("input_"+(u-1)))}),l.forEach((s,c)=>{this.drawflow.drawflow[o].data[s.node].outputs[s.input].connections.forEach((u,f)=>{if(u.node==t){const v=u.output.slice(6);if(parseInt(h)<parseInt(v)){if(this.module===o){const E=this.container.querySelector(".connection.node_in_node-"+t+".node_out_node-"+s.node+"."+s.input+".input_"+v);E.classList.remove("input_"+v),E.classList.add("input_"+(v-1))}u.points?this.drawflow.drawflow[o].data[s.node].outputs[s.input].connections[f]={node:u.node,output:"input_"+(v-1),points:u.points}:this.drawflow.drawflow[o].data[s.node].outputs[s.input].connections[f]={node:u.node,output:"input_"+(v-1)}}}})}),this.updateConnectionNodes("node-"+t)}removeNodeOutput(t,e){var o=this.getModuleFromNodeId(t);const i=this.getNodeFromId(t);this.module===o&&this.container.querySelector("#node-"+t+" .outputs .output."+e).remove();const n=[];Object.keys(i.outputs[e].connections).map(function(s,c){const u=i.outputs[e].connections[c].node,f=i.outputs[e].connections[c].output;n.push({id:t,id_input:u,output_class:e,input_class:f})}),n.forEach((s,c)=>{this.removeSingleConnection(s.id,s.id_input,s.output_class,s.input_class)}),delete this.drawflow.drawflow[o].data[t].outputs[e];const d=[],a=this.drawflow.drawflow[o].data[t].outputs;Object.keys(a).map(function(s,c){d.push(a[s])}),this.drawflow.drawflow[o].data[t].outputs={};const h=e.slice(7);let l=[];d.forEach((s,c)=>{s.connections.forEach((u,f)=>{l.push({node:u.node,output:u.output})}),this.drawflow.drawflow[o].data[t].outputs["output_"+(c+1)]=s}),l=new Set(l.map(s=>JSON.stringify(s))),l=Array.from(l).map(s=>JSON.parse(s)),this.module===o&&this.container.querySelectorAll("#node-"+t+" .outputs .output").forEach((s,c)=>{const u=s.classList[1].slice(7);parseInt(h)<parseInt(u)&&(s.classList.remove("output_"+u),s.classList.add("output_"+(u-1)))}),l.forEach((s,c)=>{this.drawflow.drawflow[o].data[s.node].inputs[s.output].connections.forEach((u,f)=>{if(u.node==t){const v=u.input.slice(7);if(parseInt(h)<parseInt(v)){if(this.module===o){const E=this.container.querySelector(".connection.node_in_node-"+s.node+".node_out_node-"+t+".output_"+v+"."+s.output);E.classList.remove("output_"+v),E.classList.remove(s.output),E.classList.add("output_"+(v-1)),E.classList.add(s.output)}u.points?this.drawflow.drawflow[o].data[s.node].inputs[s.output].connections[f]={node:u.node,input:"output_"+(v-1),points:u.points}:this.drawflow.drawflow[o].data[s.node].inputs[s.output].connections[f]={node:u.node,input:"output_"+(v-1)}}}})}),this.updateConnectionNodes("node-"+t)}removeNodeId(t){this.removeConnectionNodeId(t);var e=this.getModuleFromNodeId(t.slice(5));this.module===e&&this.container.querySelector("#"+t).remove(),delete this.drawflow.drawflow[e].data[t.slice(5)],this.dispatch("nodeRemoved",t.slice(5))}removeConnection(){if(this.connection_selected!=null){var t=this.connection_selected.parentElement.classList;this.connection_selected.parentElement.remove();var e=this.drawflow.drawflow[this.module].data[t[2].slice(14)].outputs[t[3]].connections.findIndex(function(i,n){return i.node===t[1].slice(13)&&i.output===t[4]});this.drawflow.drawflow[this.module].data[t[2].slice(14)].outputs[t[3]].connections.splice(e,1);var o=this.drawflow.drawflow[this.module].data[t[1].slice(13)].inputs[t[4]].connections.findIndex(function(i,n){return i.node===t[2].slice(14)&&i.input===t[3]});this.drawflow.drawflow[this.module].data[t[1].slice(13)].inputs[t[4]].connections.splice(o,1),this.dispatch("connectionRemoved",{output_id:t[2].slice(14),input_id:t[1].slice(13),output_class:t[3],input_class:t[4]}),this.connection_selected=null}}removeSingleConnection(t,e,o,i){var n=this.getModuleFromNodeId(t);if(n===this.getModuleFromNodeId(e)){if(this.drawflow.drawflow[n].data[t].outputs[o].connections.findIndex(function(h,l){return h.node==e&&h.output===i})>-1){this.module===n&&this.container.querySelector(".connection.node_in_node-"+e+".node_out_node-"+t+"."+o+"."+i).remove();var d=this.drawflow.drawflow[n].data[t].outputs[o].connections.findIndex(function(h,l){return h.node==e&&h.output===i});this.drawflow.drawflow[n].data[t].outputs[o].connections.splice(d,1);var a=this.drawflow.drawflow[n].data[e].inputs[i].connections.findIndex(function(h,l){return h.node==t&&h.input===o});return this.drawflow.drawflow[n].data[e].inputs[i].connections.splice(a,1),this.dispatch("connectionRemoved",{output_id:t,input_id:e,output_class:o,input_class:i}),!0}return!1}return!1}removeConnectionNodeId(t){const e="node_in_"+t,o="node_out_"+t,i=this.container.querySelectorAll("."+o);for(var n=i.length-1;n>=0;n--){var d=i[n].classList,a=this.drawflow.drawflow[this.module].data[d[1].slice(13)].inputs[d[4]].connections.findIndex(function(s,c){return s.node===d[2].slice(14)&&s.input===d[3]});this.drawflow.drawflow[this.module].data[d[1].slice(13)].inputs[d[4]].connections.splice(a,1);var h=this.drawflow.drawflow[this.module].data[d[2].slice(14)].outputs[d[3]].connections.findIndex(function(s,c){return s.node===d[1].slice(13)&&s.output===d[4]});this.drawflow.drawflow[this.module].data[d[2].slice(14)].outputs[d[3]].connections.splice(h,1),i[n].remove(),this.dispatch("connectionRemoved",{output_id:d[2].slice(14),input_id:d[1].slice(13),output_class:d[3],input_class:d[4]})}const l=this.container.querySelectorAll("."+e);for(n=l.length-1;n>=0;n--)d=l[n].classList,h=this.drawflow.drawflow[this.module].data[d[2].slice(14)].outputs[d[3]].connections.findIndex(function(s,c){return s.node===d[1].slice(13)&&s.output===d[4]}),this.drawflow.drawflow[this.module].data[d[2].slice(14)].outputs[d[3]].connections.splice(h,1),a=this.drawflow.drawflow[this.module].data[d[1].slice(13)].inputs[d[4]].connections.findIndex(function(s,c){return s.node===d[2].slice(14)&&s.input===d[3]}),this.drawflow.drawflow[this.module].data[d[1].slice(13)].inputs[d[4]].connections.splice(a,1),l[n].remove(),this.dispatch("connectionRemoved",{output_id:d[2].slice(14),input_id:d[1].slice(13),output_class:d[3],input_class:d[4]})}getModuleFromNodeId(t){var e;const o=this.drawflow.drawflow;return Object.keys(o).map(function(i,n){Object.keys(o[i].data).map(function(d,a){d==t&&(e=i)})}),e}addModule(t){this.drawflow.drawflow[t]={data:{}},this.dispatch("moduleCreated",t)}changeModule(t){this.dispatch("moduleChanged",t),this.module=t,this.precanvas.innerHTML="",this.canvas_x=0,this.canvas_y=0,this.pos_x=0,this.pos_y=0,this.mouse_x=0,this.mouse_y=0,this.zoom=1,this.zoom_last_value=1,this.precanvas.style.transform="",this.import(this.drawflow,!1)}removeModule(t){this.module===t&&this.changeModule("Home"),delete this.drawflow.drawflow[t],this.dispatch("moduleRemoved",t)}clearModuleSelected(){this.precanvas.innerHTML="",this.drawflow.drawflow[this.module]={data:{}}}clear(){this.precanvas.innerHTML="",this.drawflow={drawflow:{Home:{data:{}}}}}export(){const t=JSON.parse(JSON.stringify(this.drawflow));return this.dispatch("export",t),t}import(t,e=!0){this.clear(),this.drawflow=JSON.parse(JSON.stringify(t)),this.load(),e&&this.dispatch("import","import")}on(t,e){return typeof e!="function"?(console.error("The listener callback must be a function, the given type is "+typeof e),!1):typeof t!="string"?(console.error("The event name must be a string, the given type is "+typeof t),!1):(this.events[t]===void 0&&(this.events[t]={listeners:[]}),void this.events[t].listeners.push(e))}removeListener(t,e){if(!this.events[t])return!1;const o=this.events[t].listeners,i=o.indexOf(e);i>-1&&o.splice(i,1)}dispatch(t,e){if(this.events[t]===void 0)return!1;this.events[t].listeners.forEach(o=>{o(e)})}getUuid(){for(var t=[],e=0;e<36;e++)t[e]="0123456789abcdef".substr(Math.floor(16*Math.random()),1);return t[14]="4",t[19]="0123456789abcdef".substr(3&t[19]|8,1),t[8]=t[13]=t[18]=t[23]="-",t.join("")}}}]).default})})(zt);var Jt=zt.exports;const Vt=Ut(Jt);function $t(b){let g;return{c(){g=U("div"),this.h()},l(_){g=X(_,"DIV",{class:!0}),V(g).forEach(T),this.h()},h(){$(g,"class","parent-drawflow h-100 my-editor svelte-1jjj000")},m(_,w){nt(_,g,w),b[1](g)},p:ht,i:ht,o:ht,d(_){_&&T(g),b[1](null)}}}function Gt(b,g,_){let w;pt(b,ut,e=>_(3,w=e));let m,r,y=e=>{if(r)if(r.clear(),e.starts&&e.starts.length>0){if(console.log("drawing"),w!==void 0){console.log("using cache"),r.import(w);return}let o=e.ends,i=(h,l)=>{let s=e.map[l],c=Array.from(new Set(s.predecessors.concat()));for(let u=0;u<c.length;u++){let f=c[u];if(h.indexOf(f)>=0)continue;h.unshift(f);let v=i(h,f);h=Array.from(new Set(v.concat(h)))}return h},d=o.map(h=>i([],h).sort()).reduce((h,l)=>{let s=l[0];return h[s]===void 0&&(h[s]=l),h},{});console.log("groups:",d);let a=Math.max(...e.ends.map(h=>e.map[h].earlyCol));for(let h=1;h<a+1;h++){let l=Object.keys(e.map).filter(s=>e.map[s].earlyCol==h);l.sort((s,c)=>e.map[s].slack>e.map[c].slack);for(let s=0;s<l.length;s++){let c=l[s],u=e.map[c],f="normal",v="bg-darkBlue";u.slack===0&&(f="critical",v="bg-darkSteel");let E=`
						<div class="heading `+v+'">'+u.name+`</div>
						<table style="width:99.9%;">
							<tr><th class="text-left third">Start</th><th>Duration</th><th class="text-right third">Finish</th></tr>
							<tr><td>`+u.es+'</td><td class="text-center va-middle" rowspan=2>'+u.expected+'</td><td class="text-right">'+u.ef+`</td></tr>
							<tr><td>`+u.ls+'</td><td class="text-right">'+u.lf+`</td></tr>
						</table>
						<hr/>
						<table style="width:99.9%;">
							<tr><th class="text-left third">Min</th><th>Likely</th><th class="text-right third">Max</th></tr>
							<tr><td>`+u.min+'</td><td class="text-center">'+u.likely+'</td><td class="text-right">'+u.max+`</td></tr>
						</table>
					`,x=r.addNode(u.name,1,1,20+400*(h-1),20+200*s,f,e.map[c],E);e.map[c].drawId=x,e.map[c].predecessors.map(R=>{let Y=e.map[R].drawId;if(r.addConnection(Y,x,"output_1","input_1"),e.map[R].slack===0&&e.map[c].slack===0){let B=document.getElementsByClassName("connection node_in_node-"+x+" node_out_node-"+Y);B.length>0&&B[0].classList.add("critical")}})}}console.log("exporting to cache"),dt(ut,w=r.export(),w)}else console.log("dont draw yet")};qt(()=>{r=new Vt(m),r.draggable_inputs=!1,r.zoom_min=.2,r.start(),Yt.subscribe(e=>{setTimeout(()=>y(e),100)}),Xt.subscribe(e=>{e>0?r.zoom_in():e<0&&r.zoom_out()}),r.on("nodeMoved",function(e){dt(ut,w=r.export(),w)})});function t(e){Ht[e?"unshift":"push"](()=>{m=e,_(0,m)})}return[m,t]}class Kt extends St{constructor(g){super(),Nt(this,g,Gt,$t,Rt,{})}}function ft(b,g,_){const w=b.slice();return w[10]=g[_],w}function _t(b,g,_){const w=b.slice();return w[13]=g[_],w[14]=g,w[15]=_,w}function mt(b,g,_){const w=b.slice();return w[16]=g[_],w}function gt(b,g,_){const w=b.slice();return w[19]=g[_],w}function wt(b,g,_){const w=b.slice();return w[13]=g[_],w[22]=g,w[23]=_,w}function vt(b,g,_){const w=b.slice();return w[16]=g[_],w}function yt(b){let g,_=b[16]+"",w;return{c(){g=U("th"),w=At(_)},l(m){g=X(m,"TH",{});var r=V(g);w=kt(r,_),r.forEach(T)},m(m,r){nt(m,g,r),P(g,w)},p(m,r){r&1&&_!==(_=m[16]+"")&&It(w,_)},d(m){m&&T(g)}}}function Ct(b){let g,_,w,m;function r(){b[6].call(_,b[22],b[23])}return{c(){g=U("td"),_=U("input"),this.h()},l(y){g=X(y,"TD",{class:!0});var t=V(g);_=X(t,"INPUT",{type:!0,class:!0}),t.forEach(T),this.h()},h(){$(_,"type","text"),$(_,"class","metro-input svelte-5bc4oa"),$(g,"class","svelte-5bc4oa")},m(y,t){nt(y,g,t),P(g,_),rt(_,b[13]),w||(m=[lt(_,"input",r),lt(_,"paste",b[2]),lt(_,"blur",b[4])],w=!0)},p(y,t){b=y,t&1&&_.value!==b[13]&&rt(_,b[13])},d(y){y&&T(g),w=!1,Bt(m)}}}function bt(b){let g,_,w=tt(b[19]),m=[];for(let r=0;r<w.length;r+=1)m[r]=Ct(wt(b,w,r));return{c(){g=U("tr");for(let r=0;r<m.length;r+=1)m[r].c();_=st()},l(r){g=X(r,"TR",{});var y=V(g);for(let t=0;t<m.length;t+=1)m[t].l(y);_=it(y),y.forEach(T)},m(r,y){nt(r,g,y);for(let t=0;t<m.length;t+=1)m[t]&&m[t].m(g,null);P(g,_)},p(r,y){if(y&21){w=tt(r[19]);let t;for(t=0;t<w.length;t+=1){const e=wt(r,w,t);m[t]?m[t].p(e,y):(m[t]=Ct(e),m[t].c(),m[t].m(g,_))}for(;t<m.length;t+=1)m[t].d(1);m.length=w.length}},d(r){r&&T(g),ot(m,r)}}}function xt(b){let g,_=b[16]+"",w;return{c(){g=U("th"),w=At(_)},l(m){g=X(m,"TH",{});var r=V(g);w=kt(r,_),r.forEach(T)},m(m,r){nt(m,g,r),P(g,w)},p(m,r){r&2&&_!==(_=m[16]+"")&&It(w,_)},d(m){m&&T(g)}}}function Et(b){let g,_,w,m;function r(){b[7].call(_,b[14],b[15])}return{c(){g=U("td"),_=U("input"),this.h()},l(y){g=X(y,"TD",{class:!0});var t=V(g);_=X(t,"INPUT",{type:!0,class:!0}),t.forEach(T),this.h()},h(){$(_,"type","text"),$(_,"class","metro-input svelte-5bc4oa"),$(g,"class","svelte-5bc4oa")},m(y,t){nt(y,g,t),P(g,_),rt(_,b[13]),w||(m=[lt(_,"input",r),lt(_,"paste",b[3]),lt(_,"blur",b[5])],w=!0)},p(y,t){b=y,t&2&&_.value!==b[13]&&rt(_,b[13])},d(y){y&&T(g),w=!1,Bt(m)}}}function Lt(b){let g,_,w=tt(b[10]),m=[];for(let r=0;r<w.length;r+=1)m[r]=Et(_t(b,w,r));return{c(){g=U("tr");for(let r=0;r<m.length;r+=1)m[r].c();_=st()},l(r){g=X(r,"TR",{});var y=V(g);for(let t=0;t<m.length;t+=1)m[t].l(y);_=it(y),y.forEach(T)},m(r,y){nt(r,g,y);for(let t=0;t<m.length;t+=1)m[t]&&m[t].m(g,null);P(g,_)},p(r,y){if(y&42){w=tt(r[10]);let t;for(t=0;t<w.length;t+=1){const e=_t(r,w,t);m[t]?m[t].p(e,y):(m[t]=Et(e),m[t].c(),m[t].m(g,_))}for(;t<m.length;t+=1)m[t].d(1);m.length=w.length}},d(r){r&&T(g),ot(m,r)}}}function Qt(b){let g,_,w,m='<li><a href="#_target_1">Tasks</a></li> <li><a href="#_target_2">Resources</a></li>',r,y,t,e,o,i,n,d,a,h,l,s,c,u,f,v,E,x,R,Y=tt(b[0][0]),B=[];for(let C=0;C<Y.length;C+=1)B[C]=yt(vt(b,Y,C));let S=tt(b[0].slice(1)),z=[];for(let C=0;C<S.length;C+=1)z[C]=bt(gt(b,S,C));let K=tt(b[1][0]),O=[];for(let C=0;C<K.length;C+=1)O[C]=xt(mt(b,K,C));let Q=tt(b[1].slice(1)),H=[];for(let C=0;C<Q.length;C+=1)H[C]=Lt(ft(b,Q,C));return x=new Kt({}),{c(){g=U("div"),_=U("div"),w=U("ul"),w.innerHTML=m,r=st(),y=U("div"),t=U("div"),e=U("table"),o=U("thead"),i=U("tr");for(let C=0;C<B.length;C+=1)B[C].c();n=st(),d=U("tbody");for(let C=0;C<z.length;C+=1)z[C].c();a=st(),h=U("div"),l=U("table"),s=U("thead"),c=U("tr");for(let C=0;C<O.length;C+=1)O[C].c();u=st(),f=U("tbody");for(let C=0;C<H.length;C+=1)H[C].c();v=st(),E=U("div"),Mt(x.$$.fragment),this.h()},l(C){g=X(C,"DIV",{"data-role":!0,class:!0,"data-split-sizes":!0});var A=V(g);_=X(A,"DIV",{class:!0});var p=V(_);w=X(p,"UL",{"data-role":!0,"data-expand":!0,"data-svelte-h":!0}),Tt(w)!=="svelte-10cc686"&&(w.innerHTML=m),r=it(p),y=X(p,"DIV",{class:!0});var L=V(y);t=X(L,"DIV",{id:!0});var I=V(t);e=X(I,"TABLE",{class:!0});var N=V(e);o=X(N,"THEAD",{});var q=V(o);i=X(q,"TR",{});var j=V(i);for(let M=0;M<B.length;M+=1)B[M].l(j);j.forEach(T),q.forEach(T),n=it(N),d=X(N,"TBODY",{});var D=V(d);for(let M=0;M<z.length;M+=1)z[M].l(D);D.forEach(T),N.forEach(T),I.forEach(T),a=it(L),h=X(L,"DIV",{id:!0});var W=V(h);l=X(W,"TABLE",{class:!0});var k=V(l);s=X(k,"THEAD",{});var F=V(s);c=X(F,"TR",{});var Z=V(c);for(let M=0;M<O.length;M+=1)O[M].l(Z);Z.forEach(T),F.forEach(T),u=it(k),f=X(k,"TBODY",{});var J=V(f);for(let M=0;M<H.length;M+=1)H[M].l(J);J.forEach(T),k.forEach(T),W.forEach(T),L.forEach(T),p.forEach(T),v=it(A),E=X(A,"DIV",{class:!0});var G=V(E);Ot(x.$$.fragment,G),G.forEach(T),A.forEach(T),this.h()},h(){$(w,"data-role","tabs"),$(w,"data-expand","true"),$(e,"class","table subcompact table-border cell-border striped"),$(t,"id","_target_1"),$(l,"class","table subcompact table-border cell-border striped"),$(h,"id","_target_2"),$(y,"class","border bd-default no-border-top p-2 scrollable svelte-5bc4oa"),$(_,"class",""),$(E,"class","d-flex flex-justify-center flex-align-center"),$(g,"data-role","splitter"),$(g,"class","h-100"),$(g,"data-split-sizes","30, 70")},m(C,A){nt(C,g,A),P(g,_),P(_,w),P(_,r),P(_,y),P(y,t),P(t,e),P(e,o),P(o,i);for(let p=0;p<B.length;p+=1)B[p]&&B[p].m(i,null);P(e,n),P(e,d);for(let p=0;p<z.length;p+=1)z[p]&&z[p].m(d,null);P(y,a),P(y,h),P(h,l),P(l,s),P(s,c);for(let p=0;p<O.length;p+=1)O[p]&&O[p].m(c,null);P(l,u),P(l,f);for(let p=0;p<H.length;p+=1)H[p]&&H[p].m(f,null);P(g,v),P(g,E),jt(x,E,null),R=!0},p(C,[A]){if(A&1){Y=tt(C[0][0]);let p;for(p=0;p<Y.length;p+=1){const L=vt(C,Y,p);B[p]?B[p].p(L,A):(B[p]=yt(L),B[p].c(),B[p].m(i,null))}for(;p<B.length;p+=1)B[p].d(1);B.length=Y.length}if(A&21){S=tt(C[0].slice(1));let p;for(p=0;p<S.length;p+=1){const L=gt(C,S,p);z[p]?z[p].p(L,A):(z[p]=bt(L),z[p].c(),z[p].m(d,null))}for(;p<z.length;p+=1)z[p].d(1);z.length=S.length}if(A&2){K=tt(C[1][0]);let p;for(p=0;p<K.length;p+=1){const L=mt(C,K,p);O[p]?O[p].p(L,A):(O[p]=xt(L),O[p].c(),O[p].m(c,null))}for(;p<O.length;p+=1)O[p].d(1);O.length=K.length}if(A&42){Q=tt(C[1].slice(1));let p;for(p=0;p<Q.length;p+=1){const L=ft(C,Q,p);H[p]?H[p].p(L,A):(H[p]=Lt(L),H[p].c(),H[p].m(f,null))}for(;p<H.length;p+=1)H[p].d(1);H.length=Q.length}},i(C){R||(Dt(x.$$.fragment,C),R=!0)},o(C){Wt(x.$$.fragment,C),R=!1},d(C){C&&T(g),ot(B,C),ot(z,C),ot(O,C),ot(H,C),Ft(x)}}}function Zt(b,g,_){let w,m;pt(b,ct,a=>_(8,w=a)),pt(b,at,a=>_(9,m=a));let r;at.subscribe(a=>{_(0,r=a.slice(0)),r.push(Array(a[0].length).fill(""))});let y;ct.subscribe(a=>{_(1,y=a.slice(0)),y.push(Array(a[0].length).fill(""))});function t(a){a.preventDefault();let h=(a.clipboardData||window.clipboardData).getData("text");dt(at,m=h.split(/\n|\r/).filter(l=>l.length).map(l=>l.split(/\t/)),m)}function e(a){a.preventDefault();let h=(a.clipboardData||window.clipboardData).getData("text");dt(ct,w=h.split(/\n|\r/).filter(l=>l.length).map(l=>l.split(/\t/)),w)}function o(){console.log("Update TaskList without empty lines"),at.set(r.filter(a=>a.join("")!==""))}function i(){console.log("Update ResourceList without empty lines"),ct.set(y.filter(a=>a.join("")!==""))}function n(a,h){a[h]=this.value,_(0,r)}function d(a,h){a[h]=this.value,_(1,y)}return[r,y,t,e,o,i,n,d]}class oe extends St{constructor(g){super(),Nt(this,g,Zt,Qt,Rt,{})}}export{oe as component};
