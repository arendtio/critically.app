import{s as Rt,n as ht,e as pt,o as qt,f as dt,b as Ht,r as Bt}from"../chunks/scheduler.72a81396.js";import{S as St,i as Nt,g as U,h as X,j as J,f as T,k as $,a as nt,s as st,r as Mt,x as Tt,c as it,u as Ot,y as P,v as jt,d as Dt,t as Wt,A as ot,w as Ft,m as kt,n as At,o as It,B as rt,z as lt}from"../chunks/index.69694ed8.js";import{e as tt}from"../chunks/each.e59479a4.js";import{c as Pt,g as Ut,z as Xt}from"../chunks/drawflow.store.aa0a6cb1.js";import{d as ut,c as Yt,t as at,r as ct}from"../chunks/criticalPath.store.4f990f9d.js";var zt={exports:{}};(function(b,g){(function(f,w){b.exports=w()})(typeof self<"u"?self:Pt,function(){return function(f){var w={};function _(d){if(w[d])return w[d].exports;var y=w[d]={i:d,l:!1,exports:{}};return f[d].call(y.exports,y,y.exports,_),y.l=!0,y.exports}return _.m=f,_.c=w,_.d=function(d,y,t){_.o(d,y)||Object.defineProperty(d,y,{enumerable:!0,get:t})},_.r=function(d){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(d,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(d,"__esModule",{value:!0})},_.t=function(d,y){if(1&y&&(d=_(d)),8&y||4&y&&typeof d=="object"&&d&&d.__esModule)return d;var t=Object.create(null);if(_.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:d}),2&y&&typeof d!="string")for(var e in d)_.d(t,e,(function(i){return d[i]}).bind(null,e));return t},_.n=function(d){var y=d&&d.__esModule?function(){return d.default}:function(){return d};return _.d(y,"a",y),y},_.o=function(d,y){return Object.prototype.hasOwnProperty.call(d,y)},_.p="",_(_.s=0)}([function(f,w,_){_.r(w),_.d(w,"default",function(){return d});class d{constructor(t,e=null,i=null){this.events={},this.container=t,this.precanvas=null,this.nodeId=1,this.ele_selected=null,this.node_selected=null,this.drag=!1,this.reroute=!1,this.reroute_fix_curvature=!1,this.curvature=.5,this.reroute_curvature_start_end=.5,this.reroute_curvature=.5,this.reroute_width=6,this.drag_point=!1,this.editor_selected=!1,this.connection=!1,this.connection_ele=null,this.connection_selected=null,this.canvas_x=0,this.canvas_y=0,this.pos_x=0,this.pos_x_start=0,this.pos_y=0,this.pos_y_start=0,this.mouse_x=0,this.mouse_y=0,this.line_path=5,this.first_click=null,this.force_first_input=!1,this.draggable_inputs=!0,this.useuuid=!1,this.parent=i,this.noderegister={},this.render=e,this.drawflow={drawflow:{Home:{data:{}}}},this.module="Home",this.editor_mode="edit",this.zoom=1,this.zoom_max=1.6,this.zoom_min=.5,this.zoom_value=.1,this.zoom_last_value=1,this.evCache=new Array,this.prevDiff=-1}start(){this.container.classList.add("parent-drawflow"),this.container.tabIndex=0,this.precanvas=document.createElement("div"),this.precanvas.classList.add("drawflow"),this.container.appendChild(this.precanvas),this.container.addEventListener("mouseup",this.dragEnd.bind(this)),this.container.addEventListener("mousemove",this.position.bind(this)),this.container.addEventListener("mousedown",this.click.bind(this)),this.container.addEventListener("touchend",this.dragEnd.bind(this)),this.container.addEventListener("touchmove",this.position.bind(this)),this.container.addEventListener("touchstart",this.click.bind(this)),this.container.addEventListener("contextmenu",this.contextmenu.bind(this)),this.container.addEventListener("keydown",this.key.bind(this)),this.container.addEventListener("wheel",this.zoom_enter.bind(this)),this.container.addEventListener("input",this.updateNodeValue.bind(this)),this.container.addEventListener("dblclick",this.dblclick.bind(this)),this.container.onpointerdown=this.pointerdown_handler.bind(this),this.container.onpointermove=this.pointermove_handler.bind(this),this.container.onpointerup=this.pointerup_handler.bind(this),this.container.onpointercancel=this.pointerup_handler.bind(this),this.container.onpointerout=this.pointerup_handler.bind(this),this.container.onpointerleave=this.pointerup_handler.bind(this),this.load()}pointerdown_handler(t){this.evCache.push(t)}pointermove_handler(t){for(var e=0;e<this.evCache.length;e++)if(t.pointerId==this.evCache[e].pointerId){this.evCache[e]=t;break}if(this.evCache.length==2){var i=Math.abs(this.evCache[0].clientX-this.evCache[1].clientX);this.prevDiff>100&&(i>this.prevDiff&&this.zoom_in(),i<this.prevDiff&&this.zoom_out()),this.prevDiff=i}}pointerup_handler(t){this.remove_event(t),this.evCache.length<2&&(this.prevDiff=-1)}remove_event(t){for(var e=0;e<this.evCache.length;e++)if(this.evCache[e].pointerId==t.pointerId){this.evCache.splice(e,1);break}}load(){for(var t in this.drawflow.drawflow[this.module].data)this.addNodeImport(this.drawflow.drawflow[this.module].data[t],this.precanvas);if(this.reroute)for(var t in this.drawflow.drawflow[this.module].data)this.addRerouteImport(this.drawflow.drawflow[this.module].data[t]);for(var t in this.drawflow.drawflow[this.module].data)this.updateConnectionNodes("node-"+t);const e=this.drawflow.drawflow;let i=1;Object.keys(e).map(function(s,n){Object.keys(e[s].data).map(function(c,l){parseInt(c)>=i&&(i=parseInt(c)+1)})}),this.nodeId=i}removeReouteConnectionSelected(){this.dispatch("connectionUnselected",!0),this.reroute_fix_curvature&&this.connection_selected.parentElement.querySelectorAll(".main-path").forEach((t,e)=>{t.classList.remove("selected")})}click(t){if(this.dispatch("click",t),this.editor_mode==="fixed"){if(t.preventDefault(),t.target.classList[0]!=="parent-drawflow"&&t.target.classList[0]!=="drawflow")return!1;this.ele_selected=t.target.closest(".parent-drawflow")}else this.editor_mode==="view"?(t.target.closest(".drawflow")!=null||t.target.matches(".parent-drawflow"))&&(this.ele_selected=t.target.closest(".parent-drawflow"),t.preventDefault()):(this.first_click=t.target,this.ele_selected=t.target,t.button===0&&this.contextmenuDel(),t.target.closest(".drawflow_content_node")!=null&&(this.ele_selected=t.target.closest(".drawflow_content_node").parentElement));switch(this.ele_selected.classList[0]){case"drawflow-node":this.node_selected!=null&&(this.node_selected.classList.remove("selected"),this.node_selected!=this.ele_selected&&this.dispatch("nodeUnselected",!0)),this.connection_selected!=null&&(this.connection_selected.classList.remove("selected"),this.removeReouteConnectionSelected(),this.connection_selected=null),this.node_selected!=this.ele_selected&&this.dispatch("nodeSelected",this.ele_selected.id.slice(5)),this.node_selected=this.ele_selected,this.node_selected.classList.add("selected"),this.draggable_inputs?t.target.tagName!=="SELECT"&&(this.drag=!0):t.target.tagName!=="INPUT"&&t.target.tagName!=="TEXTAREA"&&t.target.tagName!=="SELECT"&&t.target.hasAttribute("contenteditable")!==!0&&(this.drag=!0);break;case"output":this.connection=!0,this.node_selected!=null&&(this.node_selected.classList.remove("selected"),this.node_selected=null,this.dispatch("nodeUnselected",!0)),this.connection_selected!=null&&(this.connection_selected.classList.remove("selected"),this.removeReouteConnectionSelected(),this.connection_selected=null),this.drawConnection(t.target);break;case"parent-drawflow":case"drawflow":this.node_selected!=null&&(this.node_selected.classList.remove("selected"),this.node_selected=null,this.dispatch("nodeUnselected",!0)),this.connection_selected!=null&&(this.connection_selected.classList.remove("selected"),this.removeReouteConnectionSelected(),this.connection_selected=null),this.editor_selected=!0;break;case"main-path":this.node_selected!=null&&(this.node_selected.classList.remove("selected"),this.node_selected=null,this.dispatch("nodeUnselected",!0)),this.connection_selected!=null&&(this.connection_selected.classList.remove("selected"),this.removeReouteConnectionSelected(),this.connection_selected=null),this.connection_selected=this.ele_selected,this.connection_selected.classList.add("selected");const e=this.connection_selected.parentElement.classList;e.length>1&&(this.dispatch("connectionSelected",{output_id:e[2].slice(14),input_id:e[1].slice(13),output_class:e[3],input_class:e[4]}),this.reroute_fix_curvature&&this.connection_selected.parentElement.querySelectorAll(".main-path").forEach((i,s)=>{i.classList.add("selected")}));break;case"point":this.drag_point=!0,this.ele_selected.classList.add("selected");break;case"drawflow-delete":this.node_selected&&this.removeNodeId(this.node_selected.id),this.connection_selected&&this.removeConnection(),this.node_selected!=null&&(this.node_selected.classList.remove("selected"),this.node_selected=null,this.dispatch("nodeUnselected",!0)),this.connection_selected!=null&&(this.connection_selected.classList.remove("selected"),this.removeReouteConnectionSelected(),this.connection_selected=null)}t.type==="touchstart"?(this.pos_x=t.touches[0].clientX,this.pos_x_start=t.touches[0].clientX,this.pos_y=t.touches[0].clientY,this.pos_y_start=t.touches[0].clientY,this.mouse_x=t.touches[0].clientX,this.mouse_y=t.touches[0].clientY):(this.pos_x=t.clientX,this.pos_x_start=t.clientX,this.pos_y=t.clientY,this.pos_y_start=t.clientY),["input","output","main-path"].includes(this.ele_selected.classList[0])&&t.preventDefault(),this.dispatch("clickEnd",t)}position(t){if(t.type==="touchmove")var e=t.touches[0].clientX,i=t.touches[0].clientY;else e=t.clientX,i=t.clientY;if(this.connection&&this.updateConnection(e,i),this.editor_selected&&(s=this.canvas_x+-(this.pos_x-e),n=this.canvas_y+-(this.pos_y-i),this.dispatch("translate",{x:s,y:n}),this.precanvas.style.transform="translate("+s+"px, "+n+"px) scale("+this.zoom+")"),this.drag){t.preventDefault();var s=(this.pos_x-e)*this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom),n=(this.pos_y-i)*this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom);this.pos_x=e,this.pos_y=i,this.ele_selected.style.top=this.ele_selected.offsetTop-n+"px",this.ele_selected.style.left=this.ele_selected.offsetLeft-s+"px",this.drawflow.drawflow[this.module].data[this.ele_selected.id.slice(5)].pos_x=this.ele_selected.offsetLeft-s,this.drawflow.drawflow[this.module].data[this.ele_selected.id.slice(5)].pos_y=this.ele_selected.offsetTop-n,this.updateConnectionNodes(this.ele_selected.id)}if(this.drag_point){s=(this.pos_x-e)*this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom),n=(this.pos_y-i)*this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom),this.pos_x=e,this.pos_y=i;var c=this.pos_x*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom))-this.precanvas.getBoundingClientRect().x*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom)),l=this.pos_y*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom))-this.precanvas.getBoundingClientRect().y*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom));this.ele_selected.setAttributeNS(null,"cx",c),this.ele_selected.setAttributeNS(null,"cy",l);const h=this.ele_selected.parentElement.classList[2].slice(9),a=this.ele_selected.parentElement.classList[1].slice(13),o=this.ele_selected.parentElement.classList[3],r=this.ele_selected.parentElement.classList[4];let p=Array.from(this.ele_selected.parentElement.children).indexOf(this.ele_selected)-1;this.reroute_fix_curvature&&(p-=this.ele_selected.parentElement.querySelectorAll(".main-path").length-1,p<0&&(p=0));const m=h.slice(5),v=this.drawflow.drawflow[this.module].data[m].outputs[o].connections.findIndex(function(L,R){return L.node===a&&L.output===r});this.drawflow.drawflow[this.module].data[m].outputs[o].connections[v].points[p]={pos_x:c,pos_y:l};const x=this.ele_selected.parentElement.classList[2].slice(9);this.updateConnectionNodes(x)}t.type==="touchmove"&&(this.mouse_x=e,this.mouse_y=i),this.dispatch("mouseMove",{x:e,y:i})}dragEnd(t){if(t.type==="touchend")var e=this.mouse_x,i=this.mouse_y,s=document.elementFromPoint(e,i);else e=t.clientX,i=t.clientY,s=t.target;if(this.drag&&(this.pos_x_start==e&&this.pos_y_start==i||this.dispatch("nodeMoved",this.ele_selected.id.slice(5))),this.drag_point&&(this.ele_selected.classList.remove("selected"),this.pos_x_start==e&&this.pos_y_start==i||this.dispatch("rerouteMoved",this.ele_selected.parentElement.classList[2].slice(14))),this.editor_selected&&(this.canvas_x=this.canvas_x+-(this.pos_x-e),this.canvas_y=this.canvas_y+-(this.pos_y-i),this.editor_selected=!1),this.connection===!0)if(s.classList[0]==="input"||this.force_first_input&&(s.closest(".drawflow_content_node")!=null||s.classList[0]==="drawflow-node")){if(!this.force_first_input||s.closest(".drawflow_content_node")==null&&s.classList[0]!=="drawflow-node")n=s.parentElement.parentElement.id,c=s.classList[1];else{if(s.closest(".drawflow_content_node")!=null)var n=s.closest(".drawflow_content_node").parentElement.id;else var n=s.id;if(Object.keys(this.getNodeFromId(n.slice(5)).inputs).length===0)var c=!1;else var c="input_1"}var l=this.ele_selected.parentElement.parentElement.id,h=this.ele_selected.classList[1];if(l!==n&&c!==!1){if(this.container.querySelectorAll(".connection.node_in_"+n+".node_out_"+l+"."+h+"."+c).length===0){this.connection_ele.classList.add("node_in_"+n),this.connection_ele.classList.add("node_out_"+l),this.connection_ele.classList.add(h),this.connection_ele.classList.add(c);var a=n.slice(5),o=l.slice(5);this.drawflow.drawflow[this.module].data[o].outputs[h].connections.push({node:a,output:c}),this.drawflow.drawflow[this.module].data[a].inputs[c].connections.push({node:o,input:h}),this.updateConnectionNodes("node-"+o),this.updateConnectionNodes("node-"+a),this.dispatch("connectionCreated",{output_id:o,input_id:a,output_class:h,input_class:c})}else this.dispatch("connectionCancel",!0),this.connection_ele.remove();this.connection_ele=null}else this.dispatch("connectionCancel",!0),this.connection_ele.remove(),this.connection_ele=null}else this.dispatch("connectionCancel",!0),this.connection_ele.remove(),this.connection_ele=null;this.drag=!1,this.drag_point=!1,this.connection=!1,this.ele_selected=null,this.editor_selected=!1,this.dispatch("mouseUp",t)}contextmenu(t){if(this.dispatch("contextmenu",t),t.preventDefault(),this.editor_mode==="fixed"||this.editor_mode==="view")return!1;if(this.precanvas.getElementsByClassName("drawflow-delete").length&&this.precanvas.getElementsByClassName("drawflow-delete")[0].remove(),this.node_selected||this.connection_selected){var e=document.createElement("div");e.classList.add("drawflow-delete"),e.innerHTML="x",this.node_selected&&this.node_selected.appendChild(e),this.connection_selected&&this.connection_selected.parentElement.classList.length>1&&(e.style.top=t.clientY*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom))-this.precanvas.getBoundingClientRect().y*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom))+"px",e.style.left=t.clientX*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom))-this.precanvas.getBoundingClientRect().x*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom))+"px",this.precanvas.appendChild(e))}}contextmenuDel(){this.precanvas.getElementsByClassName("drawflow-delete").length&&this.precanvas.getElementsByClassName("drawflow-delete")[0].remove()}key(t){if(this.dispatch("keydown",t),this.editor_mode==="fixed"||this.editor_mode==="view")return!1;(t.key==="Delete"||t.key==="Backspace"&&t.metaKey)&&(this.node_selected!=null&&this.first_click.tagName!=="INPUT"&&this.first_click.tagName!=="TEXTAREA"&&this.first_click.hasAttribute("contenteditable")!==!0&&this.removeNodeId(this.node_selected.id),this.connection_selected!=null&&this.removeConnection())}zoom_enter(t,e){t.ctrlKey&&(t.preventDefault(),t.deltaY>0?this.zoom_out():this.zoom_in())}zoom_refresh(){this.dispatch("zoom",this.zoom),this.canvas_x=this.canvas_x/this.zoom_last_value*this.zoom,this.canvas_y=this.canvas_y/this.zoom_last_value*this.zoom,this.zoom_last_value=this.zoom,this.precanvas.style.transform="translate("+this.canvas_x+"px, "+this.canvas_y+"px) scale("+this.zoom+")"}zoom_in(){this.zoom<this.zoom_max&&(this.zoom+=this.zoom_value,this.zoom_refresh())}zoom_out(){this.zoom>this.zoom_min&&(this.zoom-=this.zoom_value,this.zoom_refresh())}zoom_reset(){this.zoom!=1&&(this.zoom=1,this.zoom_refresh())}createCurvature(t,e,i,s,n,c){var l=t,h=e,a=i,o=s,r=n;switch(c){case"open":if(t>=i)var p=l+Math.abs(a-l)*r,m=a-Math.abs(a-l)*(-1*r);else p=l+Math.abs(a-l)*r,m=a-Math.abs(a-l)*r;return" M "+l+" "+h+" C "+p+" "+h+" "+m+" "+o+" "+a+"  "+o;case"close":return t>=i?(p=l+Math.abs(a-l)*(-1*r),m=a-Math.abs(a-l)*r):(p=l+Math.abs(a-l)*r,m=a-Math.abs(a-l)*r)," M "+l+" "+h+" C "+p+" "+h+" "+m+" "+o+" "+a+"  "+o;case"other":return t>=i?(p=l+Math.abs(a-l)*(-1*r),m=a-Math.abs(a-l)*(-1*r)):(p=l+Math.abs(a-l)*r,m=a-Math.abs(a-l)*r)," M "+l+" "+h+" C "+p+" "+h+" "+m+" "+o+" "+a+"  "+o;default:return" M "+l+" "+h+" C "+(p=l+Math.abs(a-l)*r)+" "+h+" "+(m=a-Math.abs(a-l)*r)+" "+o+" "+a+"  "+o}}drawConnection(t){var e=document.createElementNS("http://www.w3.org/2000/svg","svg");this.connection_ele=e;var i=document.createElementNS("http://www.w3.org/2000/svg","path");i.classList.add("main-path"),i.setAttributeNS(null,"d",""),e.classList.add("connection"),e.appendChild(i),this.precanvas.appendChild(e);var s=t.parentElement.parentElement.id.slice(5),n=t.classList[1];this.dispatch("connectionStart",{output_id:s,output_class:n})}updateConnection(t,e){const i=this.precanvas,s=this.zoom;let n=i.clientWidth/(i.clientWidth*s);n=n||0;let c=i.clientHeight/(i.clientHeight*s);c=c||0;var l=this.connection_ele.children[0],h=this.ele_selected.offsetWidth/2+(this.ele_selected.getBoundingClientRect().x-i.getBoundingClientRect().x)*n,a=this.ele_selected.offsetHeight/2+(this.ele_selected.getBoundingClientRect().y-i.getBoundingClientRect().y)*c,o=t*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom))-this.precanvas.getBoundingClientRect().x*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom)),r=e*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom))-this.precanvas.getBoundingClientRect().y*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom)),p=this.curvature,m=this.createCurvature(h,a,o,r,p,"openclose");l.setAttributeNS(null,"d",m)}addConnection(t,e,i,s){var n=this.getModuleFromNodeId(t);if(n===this.getModuleFromNodeId(e)){var c=this.getNodeFromId(t),l=!1;for(var h in c.outputs[i].connections){var a=c.outputs[i].connections[h];a.node==e&&a.output==s&&(l=!0)}if(l===!1){if(this.drawflow.drawflow[n].data[t].outputs[i].connections.push({node:e.toString(),output:s}),this.drawflow.drawflow[n].data[e].inputs[s].connections.push({node:t.toString(),input:i}),this.module===n){var o=document.createElementNS("http://www.w3.org/2000/svg","svg"),r=document.createElementNS("http://www.w3.org/2000/svg","path");r.classList.add("main-path"),r.setAttributeNS(null,"d",""),o.classList.add("connection"),o.classList.add("node_in_node-"+e),o.classList.add("node_out_node-"+t),o.classList.add(i),o.classList.add(s),o.appendChild(r),this.precanvas.appendChild(o),this.updateConnectionNodes("node-"+t),this.updateConnectionNodes("node-"+e)}this.dispatch("connectionCreated",{output_id:t,input_id:e,output_class:i,input_class:s})}}}updateConnectionNodes(t){const e="node_in_"+t,i="node_out_"+t;this.line_path;const s=this.container,n=this.precanvas,c=this.curvature,l=this.createCurvature,h=this.reroute_curvature,a=this.reroute_curvature_start_end,o=this.reroute_fix_curvature,r=this.reroute_width,p=this.zoom;let m=n.clientWidth/(n.clientWidth*p);m=m||0;let v=n.clientHeight/(n.clientHeight*p);v=v||0;const x=s.querySelectorAll("."+i);Object.keys(x).map(function(R,V){if(x[R].querySelector(".point")===null){var N=s.querySelector("#"+t),B=x[R].classList[1].replace("node_in_",""),z=s.querySelector("#"+B).querySelectorAll("."+x[R].classList[4])[0],G=z.offsetWidth/2+(z.getBoundingClientRect().x-n.getBoundingClientRect().x)*m,O=z.offsetHeight/2+(z.getBoundingClientRect().y-n.getBoundingClientRect().y)*v,Q=N.querySelectorAll("."+x[R].classList[3])[0],H=Q.offsetWidth/2+(Q.getBoundingClientRect().x-n.getBoundingClientRect().x)*m,C=Q.offsetHeight/2+(Q.getBoundingClientRect().y-n.getBoundingClientRect().y)*v;const k=l(H,C,G,O,c,"openclose");x[R].children[0].setAttributeNS(null,"d",k)}else{const k=x[R].querySelectorAll(".point");let u="";const E=[];k.forEach((I,S)=>{if(S===0&&k.length-1==0){var q=s.querySelector("#"+t),j=((Y=I).getBoundingClientRect().x-n.getBoundingClientRect().x)*m+r,D=(Y.getBoundingClientRect().y-n.getBoundingClientRect().y)*v+r,W=(K=q.querySelectorAll("."+I.parentElement.classList[3])[0]).offsetWidth/2+(K.getBoundingClientRect().x-n.getBoundingClientRect().x)*m,A=K.offsetHeight/2+(K.getBoundingClientRect().y-n.getBoundingClientRect().y)*v,F=l(W,A,j,D,a,"open");u+=F,E.push(F),q=I;var Z=I.parentElement.classList[1].replace("node_in_",""),Y=(M=s.querySelector("#"+Z)).querySelectorAll("."+I.parentElement.classList[4])[0];j=(et=M.querySelectorAll("."+I.parentElement.classList[4])[0]).offsetWidth/2+(et.getBoundingClientRect().x-n.getBoundingClientRect().x)*m,D=et.offsetHeight/2+(et.getBoundingClientRect().y-n.getBoundingClientRect().y)*v,W=(q.getBoundingClientRect().x-n.getBoundingClientRect().x)*m+r,A=(q.getBoundingClientRect().y-n.getBoundingClientRect().y)*v+r,F=l(W,A,j,D,a,"close"),u+=F,E.push(F)}else if(S===0){var K;q=s.querySelector("#"+t),j=((Y=I).getBoundingClientRect().x-n.getBoundingClientRect().x)*m+r,D=(Y.getBoundingClientRect().y-n.getBoundingClientRect().y)*v+r,W=(K=q.querySelectorAll("."+I.parentElement.classList[3])[0]).offsetWidth/2+(K.getBoundingClientRect().x-n.getBoundingClientRect().x)*m,A=K.offsetHeight/2+(K.getBoundingClientRect().y-n.getBoundingClientRect().y)*v,F=l(W,A,j,D,a,"open"),u+=F,E.push(F),q=I,j=((Y=k[S+1]).getBoundingClientRect().x-n.getBoundingClientRect().x)*m+r,D=(Y.getBoundingClientRect().y-n.getBoundingClientRect().y)*v+r,W=(q.getBoundingClientRect().x-n.getBoundingClientRect().x)*m+r,A=(q.getBoundingClientRect().y-n.getBoundingClientRect().y)*v+r,F=l(W,A,j,D,h,"other"),u+=F,E.push(F)}else if(S===k.length-1){var M,et;q=I,Z=I.parentElement.classList[1].replace("node_in_",""),Y=(M=s.querySelector("#"+Z)).querySelectorAll("."+I.parentElement.classList[4])[0],j=(et=M.querySelectorAll("."+I.parentElement.classList[4])[0]).offsetWidth/2+(et.getBoundingClientRect().x-n.getBoundingClientRect().x)*m,D=et.offsetHeight/2+(et.getBoundingClientRect().y-n.getBoundingClientRect().y)*v,W=(q.getBoundingClientRect().x-n.getBoundingClientRect().x)*(n.clientWidth/(n.clientWidth*p))+r,A=(q.getBoundingClientRect().y-n.getBoundingClientRect().y)*(n.clientHeight/(n.clientHeight*p))+r,F=l(W,A,j,D,a,"close"),u+=F,E.push(F)}else q=I,j=((Y=k[S+1]).getBoundingClientRect().x-n.getBoundingClientRect().x)*(n.clientWidth/(n.clientWidth*p))+r,D=(Y.getBoundingClientRect().y-n.getBoundingClientRect().y)*(n.clientHeight/(n.clientHeight*p))+r,W=(q.getBoundingClientRect().x-n.getBoundingClientRect().x)*(n.clientWidth/(n.clientWidth*p))+r,A=(q.getBoundingClientRect().y-n.getBoundingClientRect().y)*(n.clientHeight/(n.clientHeight*p))+r,F=l(W,A,j,D,h,"other"),u+=F,E.push(F)}),o?E.forEach((I,S)=>{x[R].children[S].setAttributeNS(null,"d",I)}):x[R].children[0].setAttributeNS(null,"d",u)}});const L=s.querySelectorAll("."+e);Object.keys(L).map(function(R,V){if(L[R].querySelector(".point")===null){var N=s.querySelector("#"+t),B=L[R].classList[2].replace("node_out_",""),z=s.querySelector("#"+B).querySelectorAll("."+L[R].classList[3])[0],G=z.offsetWidth/2+(z.getBoundingClientRect().x-n.getBoundingClientRect().x)*m,O=z.offsetHeight/2+(z.getBoundingClientRect().y-n.getBoundingClientRect().y)*v,Q=(N=N.querySelectorAll("."+L[R].classList[4])[0]).offsetWidth/2+(N.getBoundingClientRect().x-n.getBoundingClientRect().x)*m,H=N.offsetHeight/2+(N.getBoundingClientRect().y-n.getBoundingClientRect().y)*v;const C=l(G,O,Q,H,c,"openclose");L[R].children[0].setAttributeNS(null,"d",C)}else{const C=L[R].querySelectorAll(".point");let k="";const u=[];C.forEach((E,I)=>{if(I===0&&C.length-1==0){var S=s.querySelector("#"+t),q=((Z=E).getBoundingClientRect().x-n.getBoundingClientRect().x)*m+r,j=(Z.getBoundingClientRect().y-n.getBoundingClientRect().y)*v+r,D=(M=S.querySelectorAll("."+E.parentElement.classList[4])[0]).offsetWidth/2+(M.getBoundingClientRect().x-n.getBoundingClientRect().x)*m,W=M.offsetHeight/2+(M.getBoundingClientRect().y-n.getBoundingClientRect().y)*v,A=l(q,j,D,W,a,"close");k+=A,u.push(A),S=E;var F=E.parentElement.classList[2].replace("node_out_",""),Z=(K=s.querySelector("#"+F)).querySelectorAll("."+E.parentElement.classList[3])[0];q=(Y=K.querySelectorAll("."+E.parentElement.classList[3])[0]).offsetWidth/2+(Y.getBoundingClientRect().x-n.getBoundingClientRect().x)*m,j=Y.offsetHeight/2+(Y.getBoundingClientRect().y-n.getBoundingClientRect().y)*v,D=(S.getBoundingClientRect().x-n.getBoundingClientRect().x)*m+r,W=(S.getBoundingClientRect().y-n.getBoundingClientRect().y)*v+r,A=l(q,j,D,W,a,"open"),k+=A,u.push(A)}else if(I===0){var Y;S=E,F=E.parentElement.classList[2].replace("node_out_",""),Z=(K=s.querySelector("#"+F)).querySelectorAll("."+E.parentElement.classList[3])[0],q=(Y=K.querySelectorAll("."+E.parentElement.classList[3])[0]).offsetWidth/2+(Y.getBoundingClientRect().x-n.getBoundingClientRect().x)*m,j=Y.offsetHeight/2+(Y.getBoundingClientRect().y-n.getBoundingClientRect().y)*v,D=(S.getBoundingClientRect().x-n.getBoundingClientRect().x)*m+r,W=(S.getBoundingClientRect().y-n.getBoundingClientRect().y)*v+r,A=l(q,j,D,W,a,"open"),k+=A,u.push(A),S=E,D=((Z=C[I+1]).getBoundingClientRect().x-n.getBoundingClientRect().x)*m+r,W=(Z.getBoundingClientRect().y-n.getBoundingClientRect().y)*v+r,q=(S.getBoundingClientRect().x-n.getBoundingClientRect().x)*m+r,j=(S.getBoundingClientRect().y-n.getBoundingClientRect().y)*v+r,A=l(q,j,D,W,h,"other"),k+=A,u.push(A)}else if(I===C.length-1){var K,M;S=E,F=E.parentElement.classList[1].replace("node_in_",""),Z=(K=s.querySelector("#"+F)).querySelectorAll("."+E.parentElement.classList[4])[0],D=(M=K.querySelectorAll("."+E.parentElement.classList[4])[0]).offsetWidth/2+(M.getBoundingClientRect().x-n.getBoundingClientRect().x)*m,W=M.offsetHeight/2+(M.getBoundingClientRect().y-n.getBoundingClientRect().y)*v,q=(S.getBoundingClientRect().x-n.getBoundingClientRect().x)*m+r,j=(S.getBoundingClientRect().y-n.getBoundingClientRect().y)*v+r,A=l(q,j,D,W,a,"close"),k+=A,u.push(A)}else S=E,D=((Z=C[I+1]).getBoundingClientRect().x-n.getBoundingClientRect().x)*m+r,W=(Z.getBoundingClientRect().y-n.getBoundingClientRect().y)*v+r,q=(S.getBoundingClientRect().x-n.getBoundingClientRect().x)*m+r,j=(S.getBoundingClientRect().y-n.getBoundingClientRect().y)*v+r,A=l(q,j,D,W,h,"other"),k+=A,u.push(A)}),o?u.forEach((E,I)=>{L[R].children[I].setAttributeNS(null,"d",E)}):L[R].children[0].setAttributeNS(null,"d",k)}})}dblclick(t){this.connection_selected!=null&&this.reroute&&this.createReroutePoint(this.connection_selected),t.target.classList[0]==="point"&&this.removeReroutePoint(t.target)}createReroutePoint(t){this.connection_selected.classList.remove("selected");const e=this.connection_selected.parentElement.classList[2].slice(9),i=this.connection_selected.parentElement.classList[1].slice(13),s=this.connection_selected.parentElement.classList[3],n=this.connection_selected.parentElement.classList[4];this.connection_selected=null;const c=document.createElementNS("http://www.w3.org/2000/svg","circle");c.classList.add("point");var l=this.pos_x*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom))-this.precanvas.getBoundingClientRect().x*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom)),h=this.pos_y*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom))-this.precanvas.getBoundingClientRect().y*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom));c.setAttributeNS(null,"cx",l),c.setAttributeNS(null,"cy",h),c.setAttributeNS(null,"r",this.reroute_width);let a=0;if(this.reroute_fix_curvature){const m=t.parentElement.querySelectorAll(".main-path").length;var o=document.createElementNS("http://www.w3.org/2000/svg","path");if(o.classList.add("main-path"),o.setAttributeNS(null,"d",""),t.parentElement.insertBefore(o,t.parentElement.children[m]),m===1)t.parentElement.appendChild(c);else{const v=Array.from(t.parentElement.children).indexOf(t);a=v,t.parentElement.insertBefore(c,t.parentElement.children[v+m+1])}}else t.parentElement.appendChild(c);const r=e.slice(5),p=this.drawflow.drawflow[this.module].data[r].outputs[s].connections.findIndex(function(m,v){return m.node===i&&m.output===n});this.drawflow.drawflow[this.module].data[r].outputs[s].connections[p].points===void 0&&(this.drawflow.drawflow[this.module].data[r].outputs[s].connections[p].points=[]),this.reroute_fix_curvature?(a>0||this.drawflow.drawflow[this.module].data[r].outputs[s].connections[p].points!==[]?this.drawflow.drawflow[this.module].data[r].outputs[s].connections[p].points.splice(a,0,{pos_x:l,pos_y:h}):this.drawflow.drawflow[this.module].data[r].outputs[s].connections[p].points.push({pos_x:l,pos_y:h}),t.parentElement.querySelectorAll(".main-path").forEach((m,v)=>{m.classList.remove("selected")})):this.drawflow.drawflow[this.module].data[r].outputs[s].connections[p].points.push({pos_x:l,pos_y:h}),this.dispatch("addReroute",r),this.updateConnectionNodes(e)}removeReroutePoint(t){const e=t.parentElement.classList[2].slice(9),i=t.parentElement.classList[1].slice(13),s=t.parentElement.classList[3],n=t.parentElement.classList[4];let c=Array.from(t.parentElement.children).indexOf(t);const l=e.slice(5),h=this.drawflow.drawflow[this.module].data[l].outputs[s].connections.findIndex(function(a,o){return a.node===i&&a.output===n});if(this.reroute_fix_curvature){const a=t.parentElement.querySelectorAll(".main-path").length;t.parentElement.children[a-1].remove(),c-=a,c<0&&(c=0)}else c--;this.drawflow.drawflow[this.module].data[l].outputs[s].connections[h].points.splice(c,1),t.remove(),this.dispatch("removeReroute",l),this.updateConnectionNodes(e)}registerNode(t,e,i=null,s=null){this.noderegister[t]={html:e,props:i,options:s}}getNodeFromId(t){var e=this.getModuleFromNodeId(t);return JSON.parse(JSON.stringify(this.drawflow.drawflow[e].data[t]))}getNodesFromName(t){var e=[];const i=this.drawflow.drawflow;return Object.keys(i).map(function(s,n){for(var c in i[s].data)i[s].data[c].name==t&&e.push(i[s].data[c].id)}),e}addNode(t,e,i,s,n,c,l,h,a=!1){if(this.useuuid)var o=this.getUuid();else o=this.nodeId;const r=document.createElement("div");r.classList.add("parent-node");const p=document.createElement("div");p.innerHTML="",p.setAttribute("id","node-"+o),p.classList.add("drawflow-node"),c!=""&&p.classList.add(...c.split(" "));const m=document.createElement("div");m.classList.add("inputs");const v=document.createElement("div");v.classList.add("outputs");const x={};for(var L=0;L<e;L++){const B=document.createElement("div");B.classList.add("input"),B.classList.add("input_"+(L+1)),x["input_"+(L+1)]={connections:[]},m.appendChild(B)}const R={};for(L=0;L<i;L++){const B=document.createElement("div");B.classList.add("output"),B.classList.add("output_"+(L+1)),R["output_"+(L+1)]={connections:[]},v.appendChild(B)}const V=document.createElement("div");if(V.classList.add("drawflow_content_node"),a===!1)V.innerHTML=h;else if(a===!0)V.appendChild(this.noderegister[h].html.cloneNode(!0));else if(parseInt(this.render.version)===3){let B=this.render.h(this.noderegister[h].html,this.noderegister[h].props,this.noderegister[h].options);B.appContext=this.parent,this.render.render(B,V)}else{let B=new this.render({parent:this.parent,render:z=>z(this.noderegister[h].html,{props:this.noderegister[h].props}),...this.noderegister[h].options}).$mount();V.appendChild(B.$el)}Object.entries(l).forEach(function(B,z){if(typeof B[1]=="object")(function Q(H,C,k){H===null?H=l[C]:H=H[C],H!==null&&Object.entries(H).forEach(function(u,E){if(typeof u[1]=="object")Q(H,u[0],k+"-"+u[0]);else for(var I=V.querySelectorAll("[df-"+k+"-"+u[0]+"]"),S=0;S<I.length;S++)I[S].value=u[1],I[S].isContentEditable&&(I[S].innerText=u[1])})})(null,B[0],B[0]);else for(var G=V.querySelectorAll("[df-"+B[0]+"]"),O=0;O<G.length;O++)G[O].value=B[1],G[O].isContentEditable&&(G[O].innerText=B[1])}),p.appendChild(m),p.appendChild(V),p.appendChild(v),p.style.top=n+"px",p.style.left=s+"px",r.appendChild(p),this.precanvas.appendChild(r);var N={id:o,name:t,data:l,class:c,html:h,typenode:a,inputs:x,outputs:R,pos_x:s,pos_y:n};return this.drawflow.drawflow[this.module].data[o]=N,this.dispatch("nodeCreated",o),this.useuuid||this.nodeId++,o}addNodeImport(t,e){const i=document.createElement("div");i.classList.add("parent-node");const s=document.createElement("div");s.innerHTML="",s.setAttribute("id","node-"+t.id),s.classList.add("drawflow-node"),t.class!=""&&s.classList.add(...t.class.split(" "));const n=document.createElement("div");n.classList.add("inputs");const c=document.createElement("div");c.classList.add("outputs"),Object.keys(t.inputs).map(function(a,o){const r=document.createElement("div");r.classList.add("input"),r.classList.add(a),n.appendChild(r),Object.keys(t.inputs[a].connections).map(function(p,m){var v=document.createElementNS("http://www.w3.org/2000/svg","svg"),x=document.createElementNS("http://www.w3.org/2000/svg","path");x.classList.add("main-path"),x.setAttributeNS(null,"d",""),v.classList.add("connection"),v.classList.add("node_in_node-"+t.id),v.classList.add("node_out_node-"+t.inputs[a].connections[p].node),v.classList.add(t.inputs[a].connections[p].input),v.classList.add(a),v.appendChild(x),e.appendChild(v)})});for(var l=0;l<Object.keys(t.outputs).length;l++){const a=document.createElement("div");a.classList.add("output"),a.classList.add("output_"+(l+1)),c.appendChild(a)}const h=document.createElement("div");if(h.classList.add("drawflow_content_node"),t.typenode===!1)h.innerHTML=t.html;else if(t.typenode===!0)h.appendChild(this.noderegister[t.html].html.cloneNode(!0));else if(parseInt(this.render.version)===3){let a=this.render.h(this.noderegister[t.html].html,this.noderegister[t.html].props,this.noderegister[t.html].options);a.appContext=this.parent,this.render.render(a,h)}else{let a=new this.render({parent:this.parent,render:o=>o(this.noderegister[t.html].html,{props:this.noderegister[t.html].props}),...this.noderegister[t.html].options}).$mount();h.appendChild(a.$el)}Object.entries(t.data).forEach(function(a,o){if(typeof a[1]=="object")(function m(v,x,L){v===null?v=t.data[x]:v=v[x],v!==null&&Object.entries(v).forEach(function(R,V){if(typeof R[1]=="object")m(v,R[0],L+"-"+R[0]);else for(var N=h.querySelectorAll("[df-"+L+"-"+R[0]+"]"),B=0;B<N.length;B++)N[B].value=R[1],N[B].isContentEditable&&(N[B].innerText=R[1])})})(null,a[0],a[0]);else for(var r=h.querySelectorAll("[df-"+a[0]+"]"),p=0;p<r.length;p++)r[p].value=a[1],r[p].isContentEditable&&(r[p].innerText=a[1])}),s.appendChild(n),s.appendChild(h),s.appendChild(c),s.style.top=t.pos_y+"px",s.style.left=t.pos_x+"px",i.appendChild(s),this.precanvas.appendChild(i)}addRerouteImport(t){const e=this.reroute_width,i=this.reroute_fix_curvature,s=this.container;Object.keys(t.outputs).map(function(n,c){Object.keys(t.outputs[n].connections).map(function(l,h){const a=t.outputs[n].connections[l].points;a!==void 0&&a.forEach((o,r)=>{const p=t.outputs[n].connections[l].node,m=t.outputs[n].connections[l].output,v=s.querySelector(".connection.node_in_node-"+p+".node_out_node-"+t.id+"."+n+"."+m);if(i&&r===0)for(var x=0;x<a.length;x++){var L=document.createElementNS("http://www.w3.org/2000/svg","path");L.classList.add("main-path"),L.setAttributeNS(null,"d",""),v.appendChild(L)}const R=document.createElementNS("http://www.w3.org/2000/svg","circle");R.classList.add("point");var V=o.pos_x,N=o.pos_y;R.setAttributeNS(null,"cx",V),R.setAttributeNS(null,"cy",N),R.setAttributeNS(null,"r",e),v.appendChild(R)})})})}updateNodeValue(t){for(var e=t.target.attributes,i=0;i<e.length;i++)if(e[i].nodeName.startsWith("df-")){for(var s=e[i].nodeName.slice(3).split("-"),n=this.drawflow.drawflow[this.module].data[t.target.closest(".drawflow_content_node").parentElement.id.slice(5)].data,c=0;c<s.length-1;c+=1)n[s[c]]==null&&(n[s[c]]={}),n=n[s[c]];n[s[s.length-1]]=t.target.value,t.target.isContentEditable&&(n[s[s.length-1]]=t.target.innerText),this.dispatch("nodeDataChanged",t.target.closest(".drawflow_content_node").parentElement.id.slice(5))}}updateNodeDataFromId(t,e){var i=this.getModuleFromNodeId(t);if(this.drawflow.drawflow[i].data[t].data=e,this.module===i){const s=this.container.querySelector("#node-"+t);Object.entries(e).forEach(function(n,c){if(typeof n[1]=="object")(function a(o,r,p){o===null?o=e[r]:o=o[r],o!==null&&Object.entries(o).forEach(function(m,v){if(typeof m[1]=="object")a(o,m[0],p+"-"+m[0]);else for(var x=s.querySelectorAll("[df-"+p+"-"+m[0]+"]"),L=0;L<x.length;L++)x[L].value=m[1],x[L].isContentEditable&&(x[L].innerText=m[1])})})(null,n[0],n[0]);else for(var l=s.querySelectorAll("[df-"+n[0]+"]"),h=0;h<l.length;h++)l[h].value=n[1],l[h].isContentEditable&&(l[h].innerText=n[1])})}}addNodeInput(t){var e=this.getModuleFromNodeId(t);const i=this.getNodeFromId(t),s=Object.keys(i.inputs).length;if(this.module===e){const n=document.createElement("div");n.classList.add("input"),n.classList.add("input_"+(s+1)),this.container.querySelector("#node-"+t+" .inputs").appendChild(n),this.updateConnectionNodes("node-"+t)}this.drawflow.drawflow[e].data[t].inputs["input_"+(s+1)]={connections:[]}}addNodeOutput(t){var e=this.getModuleFromNodeId(t);const i=this.getNodeFromId(t),s=Object.keys(i.outputs).length;if(this.module===e){const n=document.createElement("div");n.classList.add("output"),n.classList.add("output_"+(s+1)),this.container.querySelector("#node-"+t+" .outputs").appendChild(n),this.updateConnectionNodes("node-"+t)}this.drawflow.drawflow[e].data[t].outputs["output_"+(s+1)]={connections:[]}}removeNodeInput(t,e){var i=this.getModuleFromNodeId(t);const s=this.getNodeFromId(t);this.module===i&&this.container.querySelector("#node-"+t+" .inputs .input."+e).remove();const n=[];Object.keys(s.inputs[e].connections).map(function(o,r){const p=s.inputs[e].connections[r].node,m=s.inputs[e].connections[r].input;n.push({id_output:p,id:t,output_class:m,input_class:e})}),n.forEach((o,r)=>{this.removeSingleConnection(o.id_output,o.id,o.output_class,o.input_class)}),delete this.drawflow.drawflow[i].data[t].inputs[e];const c=[],l=this.drawflow.drawflow[i].data[t].inputs;Object.keys(l).map(function(o,r){c.push(l[o])}),this.drawflow.drawflow[i].data[t].inputs={};const h=e.slice(6);let a=[];c.forEach((o,r)=>{o.connections.forEach((p,m)=>{a.push(p)}),this.drawflow.drawflow[i].data[t].inputs["input_"+(r+1)]=o}),a=new Set(a.map(o=>JSON.stringify(o))),a=Array.from(a).map(o=>JSON.parse(o)),this.module===i&&this.container.querySelectorAll("#node-"+t+" .inputs .input").forEach((o,r)=>{const p=o.classList[1].slice(6);parseInt(h)<parseInt(p)&&(o.classList.remove("input_"+p),o.classList.add("input_"+(p-1)))}),a.forEach((o,r)=>{this.drawflow.drawflow[i].data[o.node].outputs[o.input].connections.forEach((p,m)=>{if(p.node==t){const v=p.output.slice(6);if(parseInt(h)<parseInt(v)){if(this.module===i){const x=this.container.querySelector(".connection.node_in_node-"+t+".node_out_node-"+o.node+"."+o.input+".input_"+v);x.classList.remove("input_"+v),x.classList.add("input_"+(v-1))}p.points?this.drawflow.drawflow[i].data[o.node].outputs[o.input].connections[m]={node:p.node,output:"input_"+(v-1),points:p.points}:this.drawflow.drawflow[i].data[o.node].outputs[o.input].connections[m]={node:p.node,output:"input_"+(v-1)}}}})}),this.updateConnectionNodes("node-"+t)}removeNodeOutput(t,e){var i=this.getModuleFromNodeId(t);const s=this.getNodeFromId(t);this.module===i&&this.container.querySelector("#node-"+t+" .outputs .output."+e).remove();const n=[];Object.keys(s.outputs[e].connections).map(function(o,r){const p=s.outputs[e].connections[r].node,m=s.outputs[e].connections[r].output;n.push({id:t,id_input:p,output_class:e,input_class:m})}),n.forEach((o,r)=>{this.removeSingleConnection(o.id,o.id_input,o.output_class,o.input_class)}),delete this.drawflow.drawflow[i].data[t].outputs[e];const c=[],l=this.drawflow.drawflow[i].data[t].outputs;Object.keys(l).map(function(o,r){c.push(l[o])}),this.drawflow.drawflow[i].data[t].outputs={};const h=e.slice(7);let a=[];c.forEach((o,r)=>{o.connections.forEach((p,m)=>{a.push({node:p.node,output:p.output})}),this.drawflow.drawflow[i].data[t].outputs["output_"+(r+1)]=o}),a=new Set(a.map(o=>JSON.stringify(o))),a=Array.from(a).map(o=>JSON.parse(o)),this.module===i&&this.container.querySelectorAll("#node-"+t+" .outputs .output").forEach((o,r)=>{const p=o.classList[1].slice(7);parseInt(h)<parseInt(p)&&(o.classList.remove("output_"+p),o.classList.add("output_"+(p-1)))}),a.forEach((o,r)=>{this.drawflow.drawflow[i].data[o.node].inputs[o.output].connections.forEach((p,m)=>{if(p.node==t){const v=p.input.slice(7);if(parseInt(h)<parseInt(v)){if(this.module===i){const x=this.container.querySelector(".connection.node_in_node-"+o.node+".node_out_node-"+t+".output_"+v+"."+o.output);x.classList.remove("output_"+v),x.classList.remove(o.output),x.classList.add("output_"+(v-1)),x.classList.add(o.output)}p.points?this.drawflow.drawflow[i].data[o.node].inputs[o.output].connections[m]={node:p.node,input:"output_"+(v-1),points:p.points}:this.drawflow.drawflow[i].data[o.node].inputs[o.output].connections[m]={node:p.node,input:"output_"+(v-1)}}}})}),this.updateConnectionNodes("node-"+t)}removeNodeId(t){this.removeConnectionNodeId(t);var e=this.getModuleFromNodeId(t.slice(5));this.module===e&&this.container.querySelector("#"+t).remove(),delete this.drawflow.drawflow[e].data[t.slice(5)],this.dispatch("nodeRemoved",t.slice(5))}removeConnection(){if(this.connection_selected!=null){var t=this.connection_selected.parentElement.classList;this.connection_selected.parentElement.remove();var e=this.drawflow.drawflow[this.module].data[t[2].slice(14)].outputs[t[3]].connections.findIndex(function(s,n){return s.node===t[1].slice(13)&&s.output===t[4]});this.drawflow.drawflow[this.module].data[t[2].slice(14)].outputs[t[3]].connections.splice(e,1);var i=this.drawflow.drawflow[this.module].data[t[1].slice(13)].inputs[t[4]].connections.findIndex(function(s,n){return s.node===t[2].slice(14)&&s.input===t[3]});this.drawflow.drawflow[this.module].data[t[1].slice(13)].inputs[t[4]].connections.splice(i,1),this.dispatch("connectionRemoved",{output_id:t[2].slice(14),input_id:t[1].slice(13),output_class:t[3],input_class:t[4]}),this.connection_selected=null}}removeSingleConnection(t,e,i,s){var n=this.getModuleFromNodeId(t);if(n===this.getModuleFromNodeId(e)){if(this.drawflow.drawflow[n].data[t].outputs[i].connections.findIndex(function(h,a){return h.node==e&&h.output===s})>-1){this.module===n&&this.container.querySelector(".connection.node_in_node-"+e+".node_out_node-"+t+"."+i+"."+s).remove();var c=this.drawflow.drawflow[n].data[t].outputs[i].connections.findIndex(function(h,a){return h.node==e&&h.output===s});this.drawflow.drawflow[n].data[t].outputs[i].connections.splice(c,1);var l=this.drawflow.drawflow[n].data[e].inputs[s].connections.findIndex(function(h,a){return h.node==t&&h.input===i});return this.drawflow.drawflow[n].data[e].inputs[s].connections.splice(l,1),this.dispatch("connectionRemoved",{output_id:t,input_id:e,output_class:i,input_class:s}),!0}return!1}return!1}removeConnectionNodeId(t){const e="node_in_"+t,i="node_out_"+t,s=this.container.querySelectorAll("."+i);for(var n=s.length-1;n>=0;n--){var c=s[n].classList,l=this.drawflow.drawflow[this.module].data[c[1].slice(13)].inputs[c[4]].connections.findIndex(function(o,r){return o.node===c[2].slice(14)&&o.input===c[3]});this.drawflow.drawflow[this.module].data[c[1].slice(13)].inputs[c[4]].connections.splice(l,1);var h=this.drawflow.drawflow[this.module].data[c[2].slice(14)].outputs[c[3]].connections.findIndex(function(o,r){return o.node===c[1].slice(13)&&o.output===c[4]});this.drawflow.drawflow[this.module].data[c[2].slice(14)].outputs[c[3]].connections.splice(h,1),s[n].remove(),this.dispatch("connectionRemoved",{output_id:c[2].slice(14),input_id:c[1].slice(13),output_class:c[3],input_class:c[4]})}const a=this.container.querySelectorAll("."+e);for(n=a.length-1;n>=0;n--)c=a[n].classList,h=this.drawflow.drawflow[this.module].data[c[2].slice(14)].outputs[c[3]].connections.findIndex(function(o,r){return o.node===c[1].slice(13)&&o.output===c[4]}),this.drawflow.drawflow[this.module].data[c[2].slice(14)].outputs[c[3]].connections.splice(h,1),l=this.drawflow.drawflow[this.module].data[c[1].slice(13)].inputs[c[4]].connections.findIndex(function(o,r){return o.node===c[2].slice(14)&&o.input===c[3]}),this.drawflow.drawflow[this.module].data[c[1].slice(13)].inputs[c[4]].connections.splice(l,1),a[n].remove(),this.dispatch("connectionRemoved",{output_id:c[2].slice(14),input_id:c[1].slice(13),output_class:c[3],input_class:c[4]})}getModuleFromNodeId(t){var e;const i=this.drawflow.drawflow;return Object.keys(i).map(function(s,n){Object.keys(i[s].data).map(function(c,l){c==t&&(e=s)})}),e}addModule(t){this.drawflow.drawflow[t]={data:{}},this.dispatch("moduleCreated",t)}changeModule(t){this.dispatch("moduleChanged",t),this.module=t,this.precanvas.innerHTML="",this.canvas_x=0,this.canvas_y=0,this.pos_x=0,this.pos_y=0,this.mouse_x=0,this.mouse_y=0,this.zoom=1,this.zoom_last_value=1,this.precanvas.style.transform="",this.import(this.drawflow,!1)}removeModule(t){this.module===t&&this.changeModule("Home"),delete this.drawflow.drawflow[t],this.dispatch("moduleRemoved",t)}clearModuleSelected(){this.precanvas.innerHTML="",this.drawflow.drawflow[this.module]={data:{}}}clear(){this.precanvas.innerHTML="",this.drawflow={drawflow:{Home:{data:{}}}}}export(){const t=JSON.parse(JSON.stringify(this.drawflow));return this.dispatch("export",t),t}import(t,e=!0){this.clear(),this.drawflow=JSON.parse(JSON.stringify(t)),this.load(),e&&this.dispatch("import","import")}on(t,e){return typeof e!="function"?(console.error("The listener callback must be a function, the given type is "+typeof e),!1):typeof t!="string"?(console.error("The event name must be a string, the given type is "+typeof t),!1):(this.events[t]===void 0&&(this.events[t]={listeners:[]}),void this.events[t].listeners.push(e))}removeListener(t,e){if(!this.events[t])return!1;const i=this.events[t].listeners,s=i.indexOf(e);s>-1&&i.splice(s,1)}dispatch(t,e){if(this.events[t]===void 0)return!1;this.events[t].listeners.forEach(i=>{i(e)})}getUuid(){for(var t=[],e=0;e<36;e++)t[e]="0123456789abcdef".substr(Math.floor(16*Math.random()),1);return t[14]="4",t[19]="0123456789abcdef".substr(3&t[19]|8,1),t[8]=t[13]=t[18]=t[23]="-",t.join("")}}}]).default})})(zt);var Jt=zt.exports;const Vt=Ut(Jt);function $t(b){let g;return{c(){g=U("div"),this.h()},l(f){g=X(f,"DIV",{class:!0}),J(g).forEach(T),this.h()},h(){$(g,"class","parent-drawflow h-100 my-editor svelte-1jjj000")},m(f,w){nt(f,g,w),b[1](g)},p:ht,i:ht,o:ht,d(f){f&&T(g),b[1](null)}}}function Kt(b,g,f){let w;pt(b,ut,e=>f(3,w=e));let _,d,y=e=>{if(d)if(d.clear(),e.starts&&e.starts.length>0){if(console.log("drawing"),w!==void 0){console.log("using cache"),d.import(w);return}let i=Math.max(...e.ends.map(s=>e.map[s].earlyCol));for(let s=1;s<i+1;s++){let n=Object.keys(e.map).filter(c=>e.map[c].earlyCol==s);n.sort((c,l)=>e.map[c].slack>e.map[l].slack);for(let c=0;c<n.length;c++){let l=n[c],h=e.map[l],a="normal",o="bg-darkBlue";h.slack===0&&(a="critical",o="bg-darkSteel");let r=`
						<div class="heading `+o+'">'+h.name+`</div>
						<table style="width:99.9%;">
							<tr><th class="text-left third">Start</th><th>Duration</th><th class="text-right third">Finish</th></tr>
							<tr><td>`+h.es+'</td><td class="text-center va-middle" rowspan=2>'+h.expected+'</td><td class="text-right">'+h.ef+`</td></tr>
							<tr><td>`+h.ls+'</td><td class="text-right">'+h.lf+`</td></tr>
						</table>
						<hr/>
						<table style="width:99.9%;">
							<tr><th class="text-left third">Min</th><th>Likely</th><th class="text-right third">Max</th></tr>
							<tr><td>`+h.min+'</td><td class="text-center">'+h.likely+'</td><td class="text-right">'+h.max+`</td></tr>
						</table>
					`,p=d.addNode(h.name,1,1,20+400*(s-1),20+200*c,a,e.map[l],r);e.map[l].drawId=p,e.map[l].predecessors.map(m=>{let v=e.map[m].drawId;if(d.addConnection(v,p,"output_1","input_1"),e.map[m].slack===0&&e.map[l].slack===0){let x=document.getElementsByClassName("connection node_in_node-"+p+" node_out_node-"+v);x.length>0&&x[0].classList.add("critical")}})}}console.log("exporting to cache"),dt(ut,w=d.export(),w)}else console.log("dont draw yet")};qt(()=>{d=new Vt(_),d.draggable_inputs=!1,d.zoom_min=.2,d.start(),Yt.subscribe(e=>{setTimeout(()=>y(e),100)}),Xt.subscribe(e=>{e>0?d.zoom_in():e<0&&d.zoom_out()}),d.on("nodeMoved",function(e){dt(ut,w=d.export(),w)})});function t(e){Ht[e?"unshift":"push"](()=>{_=e,f(0,_)})}return[_,t]}class Gt extends St{constructor(g){super(),Nt(this,g,Kt,$t,Rt,{})}}function ft(b,g,f){const w=b.slice();return w[10]=g[f],w}function _t(b,g,f){const w=b.slice();return w[13]=g[f],w[14]=g,w[15]=f,w}function mt(b,g,f){const w=b.slice();return w[16]=g[f],w}function gt(b,g,f){const w=b.slice();return w[19]=g[f],w}function wt(b,g,f){const w=b.slice();return w[13]=g[f],w[22]=g,w[23]=f,w}function vt(b,g,f){const w=b.slice();return w[16]=g[f],w}function yt(b){let g,f=b[16]+"",w;return{c(){g=U("th"),w=kt(f)},l(_){g=X(_,"TH",{});var d=J(g);w=At(d,f),d.forEach(T)},m(_,d){nt(_,g,d),P(g,w)},p(_,d){d&1&&f!==(f=_[16]+"")&&It(w,f)},d(_){_&&T(g)}}}function Ct(b){let g,f,w,_;function d(){b[6].call(f,b[22],b[23])}return{c(){g=U("td"),f=U("input"),this.h()},l(y){g=X(y,"TD",{class:!0});var t=J(g);f=X(t,"INPUT",{type:!0,class:!0}),t.forEach(T),this.h()},h(){$(f,"type","text"),$(f,"class","metro-input svelte-5bc4oa"),$(g,"class","svelte-5bc4oa")},m(y,t){nt(y,g,t),P(g,f),rt(f,b[13]),w||(_=[lt(f,"input",d),lt(f,"paste",b[2]),lt(f,"blur",b[4])],w=!0)},p(y,t){b=y,t&1&&f.value!==b[13]&&rt(f,b[13])},d(y){y&&T(g),w=!1,Bt(_)}}}function bt(b){let g,f,w=tt(b[19]),_=[];for(let d=0;d<w.length;d+=1)_[d]=Ct(wt(b,w,d));return{c(){g=U("tr");for(let d=0;d<_.length;d+=1)_[d].c();f=st()},l(d){g=X(d,"TR",{});var y=J(g);for(let t=0;t<_.length;t+=1)_[t].l(y);f=it(y),y.forEach(T)},m(d,y){nt(d,g,y);for(let t=0;t<_.length;t+=1)_[t]&&_[t].m(g,null);P(g,f)},p(d,y){if(y&21){w=tt(d[19]);let t;for(t=0;t<w.length;t+=1){const e=wt(d,w,t);_[t]?_[t].p(e,y):(_[t]=Ct(e),_[t].c(),_[t].m(g,f))}for(;t<_.length;t+=1)_[t].d(1);_.length=w.length}},d(d){d&&T(g),ot(_,d)}}}function xt(b){let g,f=b[16]+"",w;return{c(){g=U("th"),w=kt(f)},l(_){g=X(_,"TH",{});var d=J(g);w=At(d,f),d.forEach(T)},m(_,d){nt(_,g,d),P(g,w)},p(_,d){d&2&&f!==(f=_[16]+"")&&It(w,f)},d(_){_&&T(g)}}}function Et(b){let g,f,w,_;function d(){b[7].call(f,b[14],b[15])}return{c(){g=U("td"),f=U("input"),this.h()},l(y){g=X(y,"TD",{class:!0});var t=J(g);f=X(t,"INPUT",{type:!0,class:!0}),t.forEach(T),this.h()},h(){$(f,"type","text"),$(f,"class","metro-input svelte-5bc4oa"),$(g,"class","svelte-5bc4oa")},m(y,t){nt(y,g,t),P(g,f),rt(f,b[13]),w||(_=[lt(f,"input",d),lt(f,"paste",b[3]),lt(f,"blur",b[5])],w=!0)},p(y,t){b=y,t&2&&f.value!==b[13]&&rt(f,b[13])},d(y){y&&T(g),w=!1,Bt(_)}}}function Lt(b){let g,f,w=tt(b[10]),_=[];for(let d=0;d<w.length;d+=1)_[d]=Et(_t(b,w,d));return{c(){g=U("tr");for(let d=0;d<_.length;d+=1)_[d].c();f=st()},l(d){g=X(d,"TR",{});var y=J(g);for(let t=0;t<_.length;t+=1)_[t].l(y);f=it(y),y.forEach(T)},m(d,y){nt(d,g,y);for(let t=0;t<_.length;t+=1)_[t]&&_[t].m(g,null);P(g,f)},p(d,y){if(y&42){w=tt(d[10]);let t;for(t=0;t<w.length;t+=1){const e=_t(d,w,t);_[t]?_[t].p(e,y):(_[t]=Et(e),_[t].c(),_[t].m(g,f))}for(;t<_.length;t+=1)_[t].d(1);_.length=w.length}},d(d){d&&T(g),ot(_,d)}}}function Qt(b){let g,f,w,_='<li><a href="#_target_1">Tasks</a></li> <li><a href="#_target_2">Resources</a></li>',d,y,t,e,i,s,n,c,l,h,a,o,r,p,m,v,x,L,R,V=tt(b[0][0]),N=[];for(let C=0;C<V.length;C+=1)N[C]=yt(vt(b,V,C));let B=tt(b[0].slice(1)),z=[];for(let C=0;C<B.length;C+=1)z[C]=bt(gt(b,B,C));let G=tt(b[1][0]),O=[];for(let C=0;C<G.length;C+=1)O[C]=xt(mt(b,G,C));let Q=tt(b[1].slice(1)),H=[];for(let C=0;C<Q.length;C+=1)H[C]=Lt(ft(b,Q,C));return L=new Gt({}),{c(){g=U("div"),f=U("div"),w=U("ul"),w.innerHTML=_,d=st(),y=U("div"),t=U("div"),e=U("table"),i=U("thead"),s=U("tr");for(let C=0;C<N.length;C+=1)N[C].c();n=st(),c=U("tbody");for(let C=0;C<z.length;C+=1)z[C].c();l=st(),h=U("div"),a=U("table"),o=U("thead"),r=U("tr");for(let C=0;C<O.length;C+=1)O[C].c();p=st(),m=U("tbody");for(let C=0;C<H.length;C+=1)H[C].c();v=st(),x=U("div"),Mt(L.$$.fragment),this.h()},l(C){g=X(C,"DIV",{"data-role":!0,class:!0,"data-split-sizes":!0});var k=J(g);f=X(k,"DIV",{class:!0});var u=J(f);w=X(u,"UL",{"data-role":!0,"data-expand":!0,"data-svelte-h":!0}),Tt(w)!=="svelte-10cc686"&&(w.innerHTML=_),d=it(u),y=X(u,"DIV",{class:!0});var E=J(y);t=X(E,"DIV",{id:!0});var I=J(t);e=X(I,"TABLE",{class:!0});var S=J(e);i=X(S,"THEAD",{});var q=J(i);s=X(q,"TR",{});var j=J(s);for(let M=0;M<N.length;M+=1)N[M].l(j);j.forEach(T),q.forEach(T),n=it(S),c=X(S,"TBODY",{});var D=J(c);for(let M=0;M<z.length;M+=1)z[M].l(D);D.forEach(T),S.forEach(T),I.forEach(T),l=it(E),h=X(E,"DIV",{id:!0});var W=J(h);a=X(W,"TABLE",{class:!0});var A=J(a);o=X(A,"THEAD",{});var F=J(o);r=X(F,"TR",{});var Z=J(r);for(let M=0;M<O.length;M+=1)O[M].l(Z);Z.forEach(T),F.forEach(T),p=it(A),m=X(A,"TBODY",{});var Y=J(m);for(let M=0;M<H.length;M+=1)H[M].l(Y);Y.forEach(T),A.forEach(T),W.forEach(T),E.forEach(T),u.forEach(T),v=it(k),x=X(k,"DIV",{class:!0});var K=J(x);Ot(L.$$.fragment,K),K.forEach(T),k.forEach(T),this.h()},h(){$(w,"data-role","tabs"),$(w,"data-expand","true"),$(e,"class","table subcompact table-border cell-border striped"),$(t,"id","_target_1"),$(a,"class","table subcompact table-border cell-border striped"),$(h,"id","_target_2"),$(y,"class","border bd-default no-border-top p-2 scrollable svelte-5bc4oa"),$(f,"class",""),$(x,"class","d-flex flex-justify-center flex-align-center"),$(g,"data-role","splitter"),$(g,"class","h-100"),$(g,"data-split-sizes","30, 70")},m(C,k){nt(C,g,k),P(g,f),P(f,w),P(f,d),P(f,y),P(y,t),P(t,e),P(e,i),P(i,s);for(let u=0;u<N.length;u+=1)N[u]&&N[u].m(s,null);P(e,n),P(e,c);for(let u=0;u<z.length;u+=1)z[u]&&z[u].m(c,null);P(y,l),P(y,h),P(h,a),P(a,o),P(o,r);for(let u=0;u<O.length;u+=1)O[u]&&O[u].m(r,null);P(a,p),P(a,m);for(let u=0;u<H.length;u+=1)H[u]&&H[u].m(m,null);P(g,v),P(g,x),jt(L,x,null),R=!0},p(C,[k]){if(k&1){V=tt(C[0][0]);let u;for(u=0;u<V.length;u+=1){const E=vt(C,V,u);N[u]?N[u].p(E,k):(N[u]=yt(E),N[u].c(),N[u].m(s,null))}for(;u<N.length;u+=1)N[u].d(1);N.length=V.length}if(k&21){B=tt(C[0].slice(1));let u;for(u=0;u<B.length;u+=1){const E=gt(C,B,u);z[u]?z[u].p(E,k):(z[u]=bt(E),z[u].c(),z[u].m(c,null))}for(;u<z.length;u+=1)z[u].d(1);z.length=B.length}if(k&2){G=tt(C[1][0]);let u;for(u=0;u<G.length;u+=1){const E=mt(C,G,u);O[u]?O[u].p(E,k):(O[u]=xt(E),O[u].c(),O[u].m(r,null))}for(;u<O.length;u+=1)O[u].d(1);O.length=G.length}if(k&42){Q=tt(C[1].slice(1));let u;for(u=0;u<Q.length;u+=1){const E=ft(C,Q,u);H[u]?H[u].p(E,k):(H[u]=Lt(E),H[u].c(),H[u].m(m,null))}for(;u<H.length;u+=1)H[u].d(1);H.length=Q.length}},i(C){R||(Dt(L.$$.fragment,C),R=!0)},o(C){Wt(L.$$.fragment,C),R=!1},d(C){C&&T(g),ot(N,C),ot(z,C),ot(O,C),ot(H,C),Ft(L)}}}function Zt(b,g,f){let w,_;pt(b,ct,l=>f(8,w=l)),pt(b,at,l=>f(9,_=l));let d;at.subscribe(l=>{f(0,d=l.slice(0)),d.push(Array(l[0].length).fill(""))});let y;ct.subscribe(l=>{f(1,y=l.slice(0)),y.push(Array(l[0].length).fill(""))});function t(l){l.preventDefault();let h=(l.clipboardData||window.clipboardData).getData("text");dt(at,_=h.split(/\n|\r/).filter(a=>a.length).map(a=>a.split(/\t/)),_)}function e(l){l.preventDefault();let h=(l.clipboardData||window.clipboardData).getData("text");dt(ct,w=h.split(/\n|\r/).filter(a=>a.length).map(a=>a.split(/\t/)),w)}function i(){console.log("Update TaskList without empty lines"),at.set(d.filter(l=>l.join("")!==""))}function s(){console.log("Update ResourceList without empty lines"),ct.set(y.filter(l=>l.join("")!==""))}function n(l,h){l[h]=this.value,f(0,d)}function c(l,h){l[h]=this.value,f(1,y)}return[d,y,t,e,i,s,n,c]}class oe extends St{constructor(g){super(),Nt(this,g,Zt,Qt,Rt,{})}}export{oe as component};
