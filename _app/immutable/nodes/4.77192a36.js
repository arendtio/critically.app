import{s as F,n as I,e as z}from"../chunks/scheduler.72a81396.js";import{S as G,i as K,g as v,h as g,j as N,f as u,k as x,l as L,a as k,y as p,A as O,s as Q,c as U,e as S,m as b,n as D,o as A,x as W}from"../chunks/index.d11d4d66.js";import{e as y}from"../chunks/each.e59479a4.js";import{d as X}from"../chunks/index.2391f01a.js";import{l as Y,c as Z,r as P}from"../chunks/criticalPath.store.aedc5f59.js";import{g as $}from"../chunks/gantt.store.fbfbde26.js";const ee=X([Z,P],([i,l])=>{let s=l.slice(0,1),r=l.slice(1).map(n=>{let o=n.slice(0,1);return o=o.concat(n.slice(1).map(h=>({free:Y(h),allocations:[]}))),o});if(s=s.concat(r),console.log("timeline",s),i.map===void 0)return s;let t=Object.keys(i.map).sort((n,o)=>i.map[n].slack===i.map[o].slack?i.map[n].es>i.map[o].es?1:i.map[n].es<i.map[o].es?-1:0:i.map[n].slack>i.map[o].slack?1:-1);console.log("idList",t);let e=JSON.parse(JSON.stringify(i)),a=n=>{if(e.map[n].startDate!==void 0)return;let o=e.map[n].predecessors.reduce((c,f)=>(a(f),c===void 0||e.map[f].endDate>c?e.map[f].endDate:c),void 0),h=e.map[n].res.map(c=>{let f=s[0].indexOf(c);return f<0&&(console.log("The resource",c,"in task",n,"is not defined in the resource table"),alert("The resource "+c+" in task "+n+" is not defined in the resource table")),f}),B=(c,f,d)=>{let w=0,_=s[c][f].free;if(isNaN(_)||_===0)return!1;for(;d>0;){if(c+w>=s.length)return!1;if(_=s[c+w][f].free,isNaN(_)){w++;continue}if(_===0)return!1;d-=_,w++}return!0},V;for(let c=1;c<s.length&&!(!(s[c][0]<=o)&&(V=h.reduce((f,d)=>B(c,d,e.map[n].expected)?{resId:d,row:c}:f,void 0),V!==void 0));c++);V===void 0&&alert("Task "+n+" could not be allocated. Please provide more resources or adjust constraints."),((c,f,d)=>{let w=s[d][0],_,R,E=e.map[c].expected;for(let m=d;m<s.length;m++){let T=s[m][f].free;if(!isNaN(T))if(E>T)E-=T,s[m][f].allocations.push({task:c,amount:T}),s[m][f].free=0;else{s[m][f].free-=E,s[m][f].allocations.push({task:c,amount:E}),E=0,_=s[m][0],R=m;break}}e.map[c].startDate=w,e.map[c].endDate=_,e.map[c].resPlanned=s[0][f],e.map[c].firstRow=d,e.map[c].lastRow=R})(n,V.resId,V.row)};return t.forEach(a),$.set(e),s});function j(i,l,s){const r=i.slice();return r[1]=l[s],r}function C(i,l,s){const r=i.slice();return r[4]=l[s],r}function H(i,l,s){const r=i.slice();return r[7]=l[s],r}function te(i){let l,s=y(i[4].allocations),r=[];for(let t=0;t<s.length;t+=1)r[t]=J(H(i,s,t));return{c(){l=v("div");for(let t=0;t<r.length;t+=1)r[t].c();this.h()},l(t){l=g(t,"DIV",{class:!0});var e=N(l);for(let a=0;a<r.length;a+=1)r[a].l(e);e.forEach(u),this.h()},h(){x(l,"class","cell border bd-white bg-darkBlue fg-white")},m(t,e){k(t,l,e);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(l,null)},p(t,e){if(e&1){s=y(t[4].allocations);let a;for(a=0;a<s.length;a+=1){const n=H(t,s,a);r[a]?r[a].p(n,e):(r[a]=J(n),r[a].c(),r[a].m(l,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=s.length}},d(t){t&&u(l),O(r,t)}}}function le(i){let l,s,r=i[4].free+"",t;return{c(){l=v("div"),s=b("free: "),t=b(r),this.h()},l(e){l=g(e,"DIV",{class:!0,style:!0});var a=N(l);s=D(a,"free: "),t=D(a,r),a.forEach(u),this.h()},h(){x(l,"class","cell"),L(l,"color","#ccc")},m(e,a){k(e,l,a),p(l,s),p(l,t)},p(e,a){a&1&&r!==(r=e[4].free+"")&&A(t,r)},d(e){e&&u(l)}}}function ne(i){let l,s="";return{c(){l=v("div"),l.innerHTML=s,this.h()},l(r){l=g(r,"DIV",{class:!0,style:!0,"data-svelte-h":!0}),W(l)!=="svelte-1336dtu"&&(l.innerHTML=s),this.h()},h(){x(l,"class","cell"),L(l,"color","#ccc")},m(r,t){k(r,l,t)},p:I,d(r){r&&u(l)}}}function se(i){let l,s=i[4]+"",r;return{c(){l=v("div"),r=b(s),this.h()},l(t){l=g(t,"DIV",{class:!0});var e=N(l);r=D(e,s),e.forEach(u),this.h()},h(){x(l,"class","cell text-bold bg-light")},m(t,e){k(t,l,e),p(l,r)},p(t,e){e&1&&s!==(s=t[4]+"")&&A(r,s)},d(t){t&&u(l)}}}function J(i){let l,s,r=i[7].task+"",t,e,a=i[7].amount+"",n;return{c(){l=v("div"),s=b("Task "),t=b(r),e=b(": "),n=b(a)},l(o){l=g(o,"DIV",{});var h=N(l);s=D(h,"Task "),t=D(h,r),e=D(h,": "),n=D(h,a),h.forEach(u)},m(o,h){k(o,l,h),p(l,s),p(l,t),p(l,e),p(l,n)},p(o,h){h&1&&r!==(r=o[7].task+"")&&A(t,r),h&1&&a!==(a=o[7].amount+"")&&A(n,a)},d(o){o&&u(l)}}}function M(i){let l,s;function r(a,n){return n&1&&(l=null),a[4].allocations===void 0?se:(l==null&&(l=!!isNaN(a[4].free)),l?ne:a[4].allocations.length===0?le:te)}let t=r(i,-1),e=t(i);return{c(){e.c(),s=S()},l(a){e.l(a),s=S()},m(a,n){e.m(a,n),k(a,s,n)},p(a,n){t===(t=r(a,n))&&e?e.p(a,n):(e.d(1),e=t(a),e&&(e.c(),e.m(s.parentNode,s)))},d(a){a&&u(s),e.d(a)}}}function q(i){let l,s,r=y(i[1]),t=[];for(let e=0;e<r.length;e+=1)t[e]=M(C(i,r,e));return{c(){l=v("div");for(let e=0;e<t.length;e+=1)t[e].c();s=Q(),this.h()},l(e){l=g(e,"DIV",{class:!0});var a=N(l);for(let n=0;n<t.length;n+=1)t[n].l(a);s=U(a),a.forEach(u),this.h()},h(){x(l,"class","row text-center")},m(e,a){k(e,l,a);for(let n=0;n<t.length;n+=1)t[n]&&t[n].m(l,null);p(l,s)},p(e,a){if(a&1){r=y(e[1]);let n;for(n=0;n<r.length;n+=1){const o=C(e,r,n);t[n]?t[n].p(o,a):(t[n]=M(o),t[n].c(),t[n].m(l,s))}for(;n<t.length;n+=1)t[n].d(1);t.length=r.length}},d(e){e&&u(l),O(t,e)}}}function re(i){let l,s,r=y(i[0]),t=[];for(let e=0;e<r.length;e+=1)t[e]=q(j(i,r,e));return{c(){l=v("div"),s=v("div");for(let e=0;e<t.length;e+=1)t[e].c();this.h()},l(e){l=g(e,"DIV",{style:!0});var a=N(l);s=g(a,"DIV",{class:!0});var n=N(s);for(let o=0;o<t.length;o+=1)t[o].l(n);n.forEach(u),a.forEach(u),this.h()},h(){x(s,"class","grid"),L(l,"height","100%"),L(l,"overflow","scroll")},m(e,a){k(e,l,a),p(l,s);for(let n=0;n<t.length;n+=1)t[n]&&t[n].m(s,null)},p(e,[a]){if(a&1){r=y(e[0]);let n;for(n=0;n<r.length;n+=1){const o=j(e,r,n);t[n]?t[n].p(o,a):(t[n]=q(o),t[n].c(),t[n].m(s,null))}for(;n<t.length;n+=1)t[n].d(1);t.length=r.length}},i:I,o:I,d(e){e&&u(l),O(t,e)}}}function ae(i,l,s){let r;return z(i,ee,t=>s(0,r=t)),[r]}class _e extends G{constructor(l){super(),K(this,l,ae,re,F,{})}}export{_e as component};
