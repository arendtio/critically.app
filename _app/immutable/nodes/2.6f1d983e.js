import{s as Rt,n as ht,e as pt,o as qt,f as dt,b as Mt,r as Bt}from"../chunks/scheduler.72a81396.js";import{S as St,i as Nt,g as U,h as X,j as V,f as T,k as $,a as nt,s as st,r as Ht,x as Tt,c as it,u as Ot,y as P,v as jt,d as Dt,t as Wt,A as ot,w as Ft,m as It,n as kt,o as At,B as rt,z as lt}from"../chunks/index.45de7edf.js";import{e as tt}from"../chunks/each.e59479a4.js";import{c as Pt,g as Ut,z as Xt}from"../chunks/drawflow.store.aa0a6cb1.js";import{d as ut,c as Yt,t as at,r as ct}from"../chunks/criticalPath.store.298d41a7.js";var zt={exports:{}};(function(b,g){(function(_,w){b.exports=w()})(typeof self<"u"?self:Pt,function(){return function(_){var w={};function m(d){if(w[d])return w[d].exports;var y=w[d]={i:d,l:!1,exports:{}};return _[d].call(y.exports,y,y.exports,m),y.l=!0,y.exports}return m.m=_,m.c=w,m.d=function(d,y,t){m.o(d,y)||Object.defineProperty(d,y,{enumerable:!0,get:t})},m.r=function(d){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(d,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(d,"__esModule",{value:!0})},m.t=function(d,y){if(1&y&&(d=m(d)),8&y||4&y&&typeof d=="object"&&d&&d.__esModule)return d;var t=Object.create(null);if(m.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:d}),2&y&&typeof d!="string")for(var n in d)m.d(t,n,(function(s){return d[s]}).bind(null,n));return t},m.n=function(d){var y=d&&d.__esModule?function(){return d.default}:function(){return d};return m.d(y,"a",y),y},m.o=function(d,y){return Object.prototype.hasOwnProperty.call(d,y)},m.p="",m(m.s=0)}([function(_,w,m){m.r(w),m.d(w,"default",function(){return d});class d{constructor(t,n=null,s=null){this.events={},this.container=t,this.precanvas=null,this.nodeId=1,this.ele_selected=null,this.node_selected=null,this.drag=!1,this.reroute=!1,this.reroute_fix_curvature=!1,this.curvature=.5,this.reroute_curvature_start_end=.5,this.reroute_curvature=.5,this.reroute_width=6,this.drag_point=!1,this.editor_selected=!1,this.connection=!1,this.connection_ele=null,this.connection_selected=null,this.canvas_x=0,this.canvas_y=0,this.pos_x=0,this.pos_x_start=0,this.pos_y=0,this.pos_y_start=0,this.mouse_x=0,this.mouse_y=0,this.line_path=5,this.first_click=null,this.force_first_input=!1,this.draggable_inputs=!0,this.useuuid=!1,this.parent=s,this.noderegister={},this.render=n,this.drawflow={drawflow:{Home:{data:{}}}},this.module="Home",this.editor_mode="edit",this.zoom=1,this.zoom_max=1.6,this.zoom_min=.5,this.zoom_value=.1,this.zoom_last_value=1,this.evCache=new Array,this.prevDiff=-1}start(){this.container.classList.add("parent-drawflow"),this.container.tabIndex=0,this.precanvas=document.createElement("div"),this.precanvas.classList.add("drawflow"),this.container.appendChild(this.precanvas),this.container.addEventListener("mouseup",this.dragEnd.bind(this)),this.container.addEventListener("mousemove",this.position.bind(this)),this.container.addEventListener("mousedown",this.click.bind(this)),this.container.addEventListener("touchend",this.dragEnd.bind(this)),this.container.addEventListener("touchmove",this.position.bind(this)),this.container.addEventListener("touchstart",this.click.bind(this)),this.container.addEventListener("contextmenu",this.contextmenu.bind(this)),this.container.addEventListener("keydown",this.key.bind(this)),this.container.addEventListener("wheel",this.zoom_enter.bind(this)),this.container.addEventListener("input",this.updateNodeValue.bind(this)),this.container.addEventListener("dblclick",this.dblclick.bind(this)),this.container.onpointerdown=this.pointerdown_handler.bind(this),this.container.onpointermove=this.pointermove_handler.bind(this),this.container.onpointerup=this.pointerup_handler.bind(this),this.container.onpointercancel=this.pointerup_handler.bind(this),this.container.onpointerout=this.pointerup_handler.bind(this),this.container.onpointerleave=this.pointerup_handler.bind(this),this.load()}pointerdown_handler(t){this.evCache.push(t)}pointermove_handler(t){for(var n=0;n<this.evCache.length;n++)if(t.pointerId==this.evCache[n].pointerId){this.evCache[n]=t;break}if(this.evCache.length==2){var s=Math.abs(this.evCache[0].clientX-this.evCache[1].clientX);this.prevDiff>100&&(s>this.prevDiff&&this.zoom_in(),s<this.prevDiff&&this.zoom_out()),this.prevDiff=s}}pointerup_handler(t){this.remove_event(t),this.evCache.length<2&&(this.prevDiff=-1)}remove_event(t){for(var n=0;n<this.evCache.length;n++)if(this.evCache[n].pointerId==t.pointerId){this.evCache.splice(n,1);break}}load(){for(var t in this.drawflow.drawflow[this.module].data)this.addNodeImport(this.drawflow.drawflow[this.module].data[t],this.precanvas);if(this.reroute)for(var t in this.drawflow.drawflow[this.module].data)this.addRerouteImport(this.drawflow.drawflow[this.module].data[t]);for(var t in this.drawflow.drawflow[this.module].data)this.updateConnectionNodes("node-"+t);const n=this.drawflow.drawflow;let s=1;Object.keys(n).map(function(i,e){Object.keys(n[i].data).map(function(c,a){parseInt(c)>=s&&(s=parseInt(c)+1)})}),this.nodeId=s}removeReouteConnectionSelected(){this.dispatch("connectionUnselected",!0),this.reroute_fix_curvature&&this.connection_selected.parentElement.querySelectorAll(".main-path").forEach((t,n)=>{t.classList.remove("selected")})}click(t){if(this.dispatch("click",t),this.editor_mode==="fixed"){if(t.preventDefault(),t.target.classList[0]!=="parent-drawflow"&&t.target.classList[0]!=="drawflow")return!1;this.ele_selected=t.target.closest(".parent-drawflow")}else this.editor_mode==="view"?(t.target.closest(".drawflow")!=null||t.target.matches(".parent-drawflow"))&&(this.ele_selected=t.target.closest(".parent-drawflow"),t.preventDefault()):(this.first_click=t.target,this.ele_selected=t.target,t.button===0&&this.contextmenuDel(),t.target.closest(".drawflow_content_node")!=null&&(this.ele_selected=t.target.closest(".drawflow_content_node").parentElement));switch(this.ele_selected.classList[0]){case"drawflow-node":this.node_selected!=null&&(this.node_selected.classList.remove("selected"),this.node_selected!=this.ele_selected&&this.dispatch("nodeUnselected",!0)),this.connection_selected!=null&&(this.connection_selected.classList.remove("selected"),this.removeReouteConnectionSelected(),this.connection_selected=null),this.node_selected!=this.ele_selected&&this.dispatch("nodeSelected",this.ele_selected.id.slice(5)),this.node_selected=this.ele_selected,this.node_selected.classList.add("selected"),this.draggable_inputs?t.target.tagName!=="SELECT"&&(this.drag=!0):t.target.tagName!=="INPUT"&&t.target.tagName!=="TEXTAREA"&&t.target.tagName!=="SELECT"&&t.target.hasAttribute("contenteditable")!==!0&&(this.drag=!0);break;case"output":this.connection=!0,this.node_selected!=null&&(this.node_selected.classList.remove("selected"),this.node_selected=null,this.dispatch("nodeUnselected",!0)),this.connection_selected!=null&&(this.connection_selected.classList.remove("selected"),this.removeReouteConnectionSelected(),this.connection_selected=null),this.drawConnection(t.target);break;case"parent-drawflow":case"drawflow":this.node_selected!=null&&(this.node_selected.classList.remove("selected"),this.node_selected=null,this.dispatch("nodeUnselected",!0)),this.connection_selected!=null&&(this.connection_selected.classList.remove("selected"),this.removeReouteConnectionSelected(),this.connection_selected=null),this.editor_selected=!0;break;case"main-path":this.node_selected!=null&&(this.node_selected.classList.remove("selected"),this.node_selected=null,this.dispatch("nodeUnselected",!0)),this.connection_selected!=null&&(this.connection_selected.classList.remove("selected"),this.removeReouteConnectionSelected(),this.connection_selected=null),this.connection_selected=this.ele_selected,this.connection_selected.classList.add("selected");const n=this.connection_selected.parentElement.classList;n.length>1&&(this.dispatch("connectionSelected",{output_id:n[2].slice(14),input_id:n[1].slice(13),output_class:n[3],input_class:n[4]}),this.reroute_fix_curvature&&this.connection_selected.parentElement.querySelectorAll(".main-path").forEach((s,i)=>{s.classList.add("selected")}));break;case"point":this.drag_point=!0,this.ele_selected.classList.add("selected");break;case"drawflow-delete":this.node_selected&&this.removeNodeId(this.node_selected.id),this.connection_selected&&this.removeConnection(),this.node_selected!=null&&(this.node_selected.classList.remove("selected"),this.node_selected=null,this.dispatch("nodeUnselected",!0)),this.connection_selected!=null&&(this.connection_selected.classList.remove("selected"),this.removeReouteConnectionSelected(),this.connection_selected=null)}t.type==="touchstart"?(this.pos_x=t.touches[0].clientX,this.pos_x_start=t.touches[0].clientX,this.pos_y=t.touches[0].clientY,this.pos_y_start=t.touches[0].clientY,this.mouse_x=t.touches[0].clientX,this.mouse_y=t.touches[0].clientY):(this.pos_x=t.clientX,this.pos_x_start=t.clientX,this.pos_y=t.clientY,this.pos_y_start=t.clientY),["input","output","main-path"].includes(this.ele_selected.classList[0])&&t.preventDefault(),this.dispatch("clickEnd",t)}position(t){if(t.type==="touchmove")var n=t.touches[0].clientX,s=t.touches[0].clientY;else n=t.clientX,s=t.clientY;if(this.connection&&this.updateConnection(n,s),this.editor_selected&&(i=this.canvas_x+-(this.pos_x-n),e=this.canvas_y+-(this.pos_y-s),this.dispatch("translate",{x:i,y:e}),this.precanvas.style.transform="translate("+i+"px, "+e+"px) scale("+this.zoom+")"),this.drag){t.preventDefault();var i=(this.pos_x-n)*this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom),e=(this.pos_y-s)*this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom);this.pos_x=n,this.pos_y=s,this.ele_selected.style.top=this.ele_selected.offsetTop-e+"px",this.ele_selected.style.left=this.ele_selected.offsetLeft-i+"px",this.drawflow.drawflow[this.module].data[this.ele_selected.id.slice(5)].pos_x=this.ele_selected.offsetLeft-i,this.drawflow.drawflow[this.module].data[this.ele_selected.id.slice(5)].pos_y=this.ele_selected.offsetTop-e,this.updateConnectionNodes(this.ele_selected.id)}if(this.drag_point){i=(this.pos_x-n)*this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom),e=(this.pos_y-s)*this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom),this.pos_x=n,this.pos_y=s;var c=this.pos_x*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom))-this.precanvas.getBoundingClientRect().x*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom)),a=this.pos_y*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom))-this.precanvas.getBoundingClientRect().y*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom));this.ele_selected.setAttributeNS(null,"cx",c),this.ele_selected.setAttributeNS(null,"cy",a);const h=this.ele_selected.parentElement.classList[2].slice(9),o=this.ele_selected.parentElement.classList[1].slice(13),l=this.ele_selected.parentElement.classList[3],r=this.ele_selected.parentElement.classList[4];let f=Array.from(this.ele_selected.parentElement.children).indexOf(this.ele_selected)-1;this.reroute_fix_curvature&&(f-=this.ele_selected.parentElement.querySelectorAll(".main-path").length-1,f<0&&(f=0));const u=h.slice(5),v=this.drawflow.drawflow[this.module].data[u].outputs[l].connections.findIndex(function(E,R){return E.node===o&&E.output===r});this.drawflow.drawflow[this.module].data[u].outputs[l].connections[v].points[f]={pos_x:c,pos_y:a};const x=this.ele_selected.parentElement.classList[2].slice(9);this.updateConnectionNodes(x)}t.type==="touchmove"&&(this.mouse_x=n,this.mouse_y=s),this.dispatch("mouseMove",{x:n,y:s})}dragEnd(t){if(t.type==="touchend")var n=this.mouse_x,s=this.mouse_y,i=document.elementFromPoint(n,s);else n=t.clientX,s=t.clientY,i=t.target;if(this.drag&&(this.pos_x_start==n&&this.pos_y_start==s||this.dispatch("nodeMoved",this.ele_selected.id.slice(5))),this.drag_point&&(this.ele_selected.classList.remove("selected"),this.pos_x_start==n&&this.pos_y_start==s||this.dispatch("rerouteMoved",this.ele_selected.parentElement.classList[2].slice(14))),this.editor_selected&&(this.canvas_x=this.canvas_x+-(this.pos_x-n),this.canvas_y=this.canvas_y+-(this.pos_y-s),this.editor_selected=!1),this.connection===!0)if(i.classList[0]==="input"||this.force_first_input&&(i.closest(".drawflow_content_node")!=null||i.classList[0]==="drawflow-node")){if(!this.force_first_input||i.closest(".drawflow_content_node")==null&&i.classList[0]!=="drawflow-node")e=i.parentElement.parentElement.id,c=i.classList[1];else{if(i.closest(".drawflow_content_node")!=null)var e=i.closest(".drawflow_content_node").parentElement.id;else var e=i.id;if(Object.keys(this.getNodeFromId(e.slice(5)).inputs).length===0)var c=!1;else var c="input_1"}var a=this.ele_selected.parentElement.parentElement.id,h=this.ele_selected.classList[1];if(a!==e&&c!==!1){if(this.container.querySelectorAll(".connection.node_in_"+e+".node_out_"+a+"."+h+"."+c).length===0){this.connection_ele.classList.add("node_in_"+e),this.connection_ele.classList.add("node_out_"+a),this.connection_ele.classList.add(h),this.connection_ele.classList.add(c);var o=e.slice(5),l=a.slice(5);this.drawflow.drawflow[this.module].data[l].outputs[h].connections.push({node:o,output:c}),this.drawflow.drawflow[this.module].data[o].inputs[c].connections.push({node:l,input:h}),this.updateConnectionNodes("node-"+l),this.updateConnectionNodes("node-"+o),this.dispatch("connectionCreated",{output_id:l,input_id:o,output_class:h,input_class:c})}else this.dispatch("connectionCancel",!0),this.connection_ele.remove();this.connection_ele=null}else this.dispatch("connectionCancel",!0),this.connection_ele.remove(),this.connection_ele=null}else this.dispatch("connectionCancel",!0),this.connection_ele.remove(),this.connection_ele=null;this.drag=!1,this.drag_point=!1,this.connection=!1,this.ele_selected=null,this.editor_selected=!1,this.dispatch("mouseUp",t)}contextmenu(t){if(this.dispatch("contextmenu",t),t.preventDefault(),this.editor_mode==="fixed"||this.editor_mode==="view")return!1;if(this.precanvas.getElementsByClassName("drawflow-delete").length&&this.precanvas.getElementsByClassName("drawflow-delete")[0].remove(),this.node_selected||this.connection_selected){var n=document.createElement("div");n.classList.add("drawflow-delete"),n.innerHTML="x",this.node_selected&&this.node_selected.appendChild(n),this.connection_selected&&this.connection_selected.parentElement.classList.length>1&&(n.style.top=t.clientY*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom))-this.precanvas.getBoundingClientRect().y*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom))+"px",n.style.left=t.clientX*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom))-this.precanvas.getBoundingClientRect().x*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom))+"px",this.precanvas.appendChild(n))}}contextmenuDel(){this.precanvas.getElementsByClassName("drawflow-delete").length&&this.precanvas.getElementsByClassName("drawflow-delete")[0].remove()}key(t){if(this.dispatch("keydown",t),this.editor_mode==="fixed"||this.editor_mode==="view")return!1;(t.key==="Delete"||t.key==="Backspace"&&t.metaKey)&&(this.node_selected!=null&&this.first_click.tagName!=="INPUT"&&this.first_click.tagName!=="TEXTAREA"&&this.first_click.hasAttribute("contenteditable")!==!0&&this.removeNodeId(this.node_selected.id),this.connection_selected!=null&&this.removeConnection())}zoom_enter(t,n){t.ctrlKey&&(t.preventDefault(),t.deltaY>0?this.zoom_out():this.zoom_in())}zoom_refresh(){this.dispatch("zoom",this.zoom),this.canvas_x=this.canvas_x/this.zoom_last_value*this.zoom,this.canvas_y=this.canvas_y/this.zoom_last_value*this.zoom,this.zoom_last_value=this.zoom,this.precanvas.style.transform="translate("+this.canvas_x+"px, "+this.canvas_y+"px) scale("+this.zoom+")"}zoom_in(){this.zoom<this.zoom_max&&(this.zoom+=this.zoom_value,this.zoom_refresh())}zoom_out(){this.zoom>this.zoom_min&&(this.zoom-=this.zoom_value,this.zoom_refresh())}zoom_reset(){this.zoom!=1&&(this.zoom=1,this.zoom_refresh())}createCurvature(t,n,s,i,e,c){var a=t,h=n,o=s,l=i,r=e;switch(c){case"open":if(t>=s)var f=a+Math.abs(o-a)*r,u=o-Math.abs(o-a)*(-1*r);else f=a+Math.abs(o-a)*r,u=o-Math.abs(o-a)*r;return" M "+a+" "+h+" C "+f+" "+h+" "+u+" "+l+" "+o+"  "+l;case"close":return t>=s?(f=a+Math.abs(o-a)*(-1*r),u=o-Math.abs(o-a)*r):(f=a+Math.abs(o-a)*r,u=o-Math.abs(o-a)*r)," M "+a+" "+h+" C "+f+" "+h+" "+u+" "+l+" "+o+"  "+l;case"other":return t>=s?(f=a+Math.abs(o-a)*(-1*r),u=o-Math.abs(o-a)*(-1*r)):(f=a+Math.abs(o-a)*r,u=o-Math.abs(o-a)*r)," M "+a+" "+h+" C "+f+" "+h+" "+u+" "+l+" "+o+"  "+l;default:return" M "+a+" "+h+" C "+(f=a+Math.abs(o-a)*r)+" "+h+" "+(u=o-Math.abs(o-a)*r)+" "+l+" "+o+"  "+l}}drawConnection(t){var n=document.createElementNS("http://www.w3.org/2000/svg","svg");this.connection_ele=n;var s=document.createElementNS("http://www.w3.org/2000/svg","path");s.classList.add("main-path"),s.setAttributeNS(null,"d",""),n.classList.add("connection"),n.appendChild(s),this.precanvas.appendChild(n);var i=t.parentElement.parentElement.id.slice(5),e=t.classList[1];this.dispatch("connectionStart",{output_id:i,output_class:e})}updateConnection(t,n){const s=this.precanvas,i=this.zoom;let e=s.clientWidth/(s.clientWidth*i);e=e||0;let c=s.clientHeight/(s.clientHeight*i);c=c||0;var a=this.connection_ele.children[0],h=this.ele_selected.offsetWidth/2+(this.ele_selected.getBoundingClientRect().x-s.getBoundingClientRect().x)*e,o=this.ele_selected.offsetHeight/2+(this.ele_selected.getBoundingClientRect().y-s.getBoundingClientRect().y)*c,l=t*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom))-this.precanvas.getBoundingClientRect().x*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom)),r=n*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom))-this.precanvas.getBoundingClientRect().y*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom)),f=this.curvature,u=this.createCurvature(h,o,l,r,f,"openclose");a.setAttributeNS(null,"d",u)}addConnection(t,n,s,i){var e=this.getModuleFromNodeId(t);if(e===this.getModuleFromNodeId(n)){var c=this.getNodeFromId(t),a=!1;for(var h in c.outputs[s].connections){var o=c.outputs[s].connections[h];o.node==n&&o.output==i&&(a=!0)}if(a===!1){if(this.drawflow.drawflow[e].data[t].outputs[s].connections.push({node:n.toString(),output:i}),this.drawflow.drawflow[e].data[n].inputs[i].connections.push({node:t.toString(),input:s}),this.module===e){var l=document.createElementNS("http://www.w3.org/2000/svg","svg"),r=document.createElementNS("http://www.w3.org/2000/svg","path");r.classList.add("main-path"),r.setAttributeNS(null,"d",""),l.classList.add("connection"),l.classList.add("node_in_node-"+n),l.classList.add("node_out_node-"+t),l.classList.add(s),l.classList.add(i),l.appendChild(r),this.precanvas.appendChild(l),this.updateConnectionNodes("node-"+t),this.updateConnectionNodes("node-"+n)}this.dispatch("connectionCreated",{output_id:t,input_id:n,output_class:s,input_class:i})}}}updateConnectionNodes(t){const n="node_in_"+t,s="node_out_"+t;this.line_path;const i=this.container,e=this.precanvas,c=this.curvature,a=this.createCurvature,h=this.reroute_curvature,o=this.reroute_curvature_start_end,l=this.reroute_fix_curvature,r=this.reroute_width,f=this.zoom;let u=e.clientWidth/(e.clientWidth*f);u=u||0;let v=e.clientHeight/(e.clientHeight*f);v=v||0;const x=i.querySelectorAll("."+s);Object.keys(x).map(function(R,Y){if(x[R].querySelector(".point")===null){var B=i.querySelector("#"+t),S=x[R].classList[1].replace("node_in_",""),z=i.querySelector("#"+S).querySelectorAll("."+x[R].classList[4])[0],G=z.offsetWidth/2+(z.getBoundingClientRect().x-e.getBoundingClientRect().x)*u,O=z.offsetHeight/2+(z.getBoundingClientRect().y-e.getBoundingClientRect().y)*v,Q=B.querySelectorAll("."+x[R].classList[3])[0],M=Q.offsetWidth/2+(Q.getBoundingClientRect().x-e.getBoundingClientRect().x)*u,C=Q.offsetHeight/2+(Q.getBoundingClientRect().y-e.getBoundingClientRect().y)*v;const I=a(M,C,G,O,c,"openclose");x[R].children[0].setAttributeNS(null,"d",I)}else{const I=x[R].querySelectorAll(".point");let p="";const L=[];I.forEach((A,N)=>{if(N===0&&I.length-1==0){var q=i.querySelector("#"+t),j=((J=A).getBoundingClientRect().x-e.getBoundingClientRect().x)*u+r,D=(J.getBoundingClientRect().y-e.getBoundingClientRect().y)*v+r,W=(K=q.querySelectorAll("."+A.parentElement.classList[3])[0]).offsetWidth/2+(K.getBoundingClientRect().x-e.getBoundingClientRect().x)*u,k=K.offsetHeight/2+(K.getBoundingClientRect().y-e.getBoundingClientRect().y)*v,F=a(W,k,j,D,o,"open");p+=F,L.push(F),q=A;var Z=A.parentElement.classList[1].replace("node_in_",""),J=(H=i.querySelector("#"+Z)).querySelectorAll("."+A.parentElement.classList[4])[0];j=(et=H.querySelectorAll("."+A.parentElement.classList[4])[0]).offsetWidth/2+(et.getBoundingClientRect().x-e.getBoundingClientRect().x)*u,D=et.offsetHeight/2+(et.getBoundingClientRect().y-e.getBoundingClientRect().y)*v,W=(q.getBoundingClientRect().x-e.getBoundingClientRect().x)*u+r,k=(q.getBoundingClientRect().y-e.getBoundingClientRect().y)*v+r,F=a(W,k,j,D,o,"close"),p+=F,L.push(F)}else if(N===0){var K;q=i.querySelector("#"+t),j=((J=A).getBoundingClientRect().x-e.getBoundingClientRect().x)*u+r,D=(J.getBoundingClientRect().y-e.getBoundingClientRect().y)*v+r,W=(K=q.querySelectorAll("."+A.parentElement.classList[3])[0]).offsetWidth/2+(K.getBoundingClientRect().x-e.getBoundingClientRect().x)*u,k=K.offsetHeight/2+(K.getBoundingClientRect().y-e.getBoundingClientRect().y)*v,F=a(W,k,j,D,o,"open"),p+=F,L.push(F),q=A,j=((J=I[N+1]).getBoundingClientRect().x-e.getBoundingClientRect().x)*u+r,D=(J.getBoundingClientRect().y-e.getBoundingClientRect().y)*v+r,W=(q.getBoundingClientRect().x-e.getBoundingClientRect().x)*u+r,k=(q.getBoundingClientRect().y-e.getBoundingClientRect().y)*v+r,F=a(W,k,j,D,h,"other"),p+=F,L.push(F)}else if(N===I.length-1){var H,et;q=A,Z=A.parentElement.classList[1].replace("node_in_",""),J=(H=i.querySelector("#"+Z)).querySelectorAll("."+A.parentElement.classList[4])[0],j=(et=H.querySelectorAll("."+A.parentElement.classList[4])[0]).offsetWidth/2+(et.getBoundingClientRect().x-e.getBoundingClientRect().x)*u,D=et.offsetHeight/2+(et.getBoundingClientRect().y-e.getBoundingClientRect().y)*v,W=(q.getBoundingClientRect().x-e.getBoundingClientRect().x)*(e.clientWidth/(e.clientWidth*f))+r,k=(q.getBoundingClientRect().y-e.getBoundingClientRect().y)*(e.clientHeight/(e.clientHeight*f))+r,F=a(W,k,j,D,o,"close"),p+=F,L.push(F)}else q=A,j=((J=I[N+1]).getBoundingClientRect().x-e.getBoundingClientRect().x)*(e.clientWidth/(e.clientWidth*f))+r,D=(J.getBoundingClientRect().y-e.getBoundingClientRect().y)*(e.clientHeight/(e.clientHeight*f))+r,W=(q.getBoundingClientRect().x-e.getBoundingClientRect().x)*(e.clientWidth/(e.clientWidth*f))+r,k=(q.getBoundingClientRect().y-e.getBoundingClientRect().y)*(e.clientHeight/(e.clientHeight*f))+r,F=a(W,k,j,D,h,"other"),p+=F,L.push(F)}),l?L.forEach((A,N)=>{x[R].children[N].setAttributeNS(null,"d",A)}):x[R].children[0].setAttributeNS(null,"d",p)}});const E=i.querySelectorAll("."+n);Object.keys(E).map(function(R,Y){if(E[R].querySelector(".point")===null){var B=i.querySelector("#"+t),S=E[R].classList[2].replace("node_out_",""),z=i.querySelector("#"+S).querySelectorAll("."+E[R].classList[3])[0],G=z.offsetWidth/2+(z.getBoundingClientRect().x-e.getBoundingClientRect().x)*u,O=z.offsetHeight/2+(z.getBoundingClientRect().y-e.getBoundingClientRect().y)*v,Q=(B=B.querySelectorAll("."+E[R].classList[4])[0]).offsetWidth/2+(B.getBoundingClientRect().x-e.getBoundingClientRect().x)*u,M=B.offsetHeight/2+(B.getBoundingClientRect().y-e.getBoundingClientRect().y)*v;const C=a(G,O,Q,M,c,"openclose");E[R].children[0].setAttributeNS(null,"d",C)}else{const C=E[R].querySelectorAll(".point");let I="";const p=[];C.forEach((L,A)=>{if(A===0&&C.length-1==0){var N=i.querySelector("#"+t),q=((Z=L).getBoundingClientRect().x-e.getBoundingClientRect().x)*u+r,j=(Z.getBoundingClientRect().y-e.getBoundingClientRect().y)*v+r,D=(H=N.querySelectorAll("."+L.parentElement.classList[4])[0]).offsetWidth/2+(H.getBoundingClientRect().x-e.getBoundingClientRect().x)*u,W=H.offsetHeight/2+(H.getBoundingClientRect().y-e.getBoundingClientRect().y)*v,k=a(q,j,D,W,o,"close");I+=k,p.push(k),N=L;var F=L.parentElement.classList[2].replace("node_out_",""),Z=(K=i.querySelector("#"+F)).querySelectorAll("."+L.parentElement.classList[3])[0];q=(J=K.querySelectorAll("."+L.parentElement.classList[3])[0]).offsetWidth/2+(J.getBoundingClientRect().x-e.getBoundingClientRect().x)*u,j=J.offsetHeight/2+(J.getBoundingClientRect().y-e.getBoundingClientRect().y)*v,D=(N.getBoundingClientRect().x-e.getBoundingClientRect().x)*u+r,W=(N.getBoundingClientRect().y-e.getBoundingClientRect().y)*v+r,k=a(q,j,D,W,o,"open"),I+=k,p.push(k)}else if(A===0){var J;N=L,F=L.parentElement.classList[2].replace("node_out_",""),Z=(K=i.querySelector("#"+F)).querySelectorAll("."+L.parentElement.classList[3])[0],q=(J=K.querySelectorAll("."+L.parentElement.classList[3])[0]).offsetWidth/2+(J.getBoundingClientRect().x-e.getBoundingClientRect().x)*u,j=J.offsetHeight/2+(J.getBoundingClientRect().y-e.getBoundingClientRect().y)*v,D=(N.getBoundingClientRect().x-e.getBoundingClientRect().x)*u+r,W=(N.getBoundingClientRect().y-e.getBoundingClientRect().y)*v+r,k=a(q,j,D,W,o,"open"),I+=k,p.push(k),N=L,D=((Z=C[A+1]).getBoundingClientRect().x-e.getBoundingClientRect().x)*u+r,W=(Z.getBoundingClientRect().y-e.getBoundingClientRect().y)*v+r,q=(N.getBoundingClientRect().x-e.getBoundingClientRect().x)*u+r,j=(N.getBoundingClientRect().y-e.getBoundingClientRect().y)*v+r,k=a(q,j,D,W,h,"other"),I+=k,p.push(k)}else if(A===C.length-1){var K,H;N=L,F=L.parentElement.classList[1].replace("node_in_",""),Z=(K=i.querySelector("#"+F)).querySelectorAll("."+L.parentElement.classList[4])[0],D=(H=K.querySelectorAll("."+L.parentElement.classList[4])[0]).offsetWidth/2+(H.getBoundingClientRect().x-e.getBoundingClientRect().x)*u,W=H.offsetHeight/2+(H.getBoundingClientRect().y-e.getBoundingClientRect().y)*v,q=(N.getBoundingClientRect().x-e.getBoundingClientRect().x)*u+r,j=(N.getBoundingClientRect().y-e.getBoundingClientRect().y)*v+r,k=a(q,j,D,W,o,"close"),I+=k,p.push(k)}else N=L,D=((Z=C[A+1]).getBoundingClientRect().x-e.getBoundingClientRect().x)*u+r,W=(Z.getBoundingClientRect().y-e.getBoundingClientRect().y)*v+r,q=(N.getBoundingClientRect().x-e.getBoundingClientRect().x)*u+r,j=(N.getBoundingClientRect().y-e.getBoundingClientRect().y)*v+r,k=a(q,j,D,W,h,"other"),I+=k,p.push(k)}),l?p.forEach((L,A)=>{E[R].children[A].setAttributeNS(null,"d",L)}):E[R].children[0].setAttributeNS(null,"d",I)}})}dblclick(t){this.connection_selected!=null&&this.reroute&&this.createReroutePoint(this.connection_selected),t.target.classList[0]==="point"&&this.removeReroutePoint(t.target)}createReroutePoint(t){this.connection_selected.classList.remove("selected");const n=this.connection_selected.parentElement.classList[2].slice(9),s=this.connection_selected.parentElement.classList[1].slice(13),i=this.connection_selected.parentElement.classList[3],e=this.connection_selected.parentElement.classList[4];this.connection_selected=null;const c=document.createElementNS("http://www.w3.org/2000/svg","circle");c.classList.add("point");var a=this.pos_x*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom))-this.precanvas.getBoundingClientRect().x*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom)),h=this.pos_y*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom))-this.precanvas.getBoundingClientRect().y*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom));c.setAttributeNS(null,"cx",a),c.setAttributeNS(null,"cy",h),c.setAttributeNS(null,"r",this.reroute_width);let o=0;if(this.reroute_fix_curvature){const u=t.parentElement.querySelectorAll(".main-path").length;var l=document.createElementNS("http://www.w3.org/2000/svg","path");if(l.classList.add("main-path"),l.setAttributeNS(null,"d",""),t.parentElement.insertBefore(l,t.parentElement.children[u]),u===1)t.parentElement.appendChild(c);else{const v=Array.from(t.parentElement.children).indexOf(t);o=v,t.parentElement.insertBefore(c,t.parentElement.children[v+u+1])}}else t.parentElement.appendChild(c);const r=n.slice(5),f=this.drawflow.drawflow[this.module].data[r].outputs[i].connections.findIndex(function(u,v){return u.node===s&&u.output===e});this.drawflow.drawflow[this.module].data[r].outputs[i].connections[f].points===void 0&&(this.drawflow.drawflow[this.module].data[r].outputs[i].connections[f].points=[]),this.reroute_fix_curvature?(o>0||this.drawflow.drawflow[this.module].data[r].outputs[i].connections[f].points!==[]?this.drawflow.drawflow[this.module].data[r].outputs[i].connections[f].points.splice(o,0,{pos_x:a,pos_y:h}):this.drawflow.drawflow[this.module].data[r].outputs[i].connections[f].points.push({pos_x:a,pos_y:h}),t.parentElement.querySelectorAll(".main-path").forEach((u,v)=>{u.classList.remove("selected")})):this.drawflow.drawflow[this.module].data[r].outputs[i].connections[f].points.push({pos_x:a,pos_y:h}),this.dispatch("addReroute",r),this.updateConnectionNodes(n)}removeReroutePoint(t){const n=t.parentElement.classList[2].slice(9),s=t.parentElement.classList[1].slice(13),i=t.parentElement.classList[3],e=t.parentElement.classList[4];let c=Array.from(t.parentElement.children).indexOf(t);const a=n.slice(5),h=this.drawflow.drawflow[this.module].data[a].outputs[i].connections.findIndex(function(o,l){return o.node===s&&o.output===e});if(this.reroute_fix_curvature){const o=t.parentElement.querySelectorAll(".main-path").length;t.parentElement.children[o-1].remove(),c-=o,c<0&&(c=0)}else c--;this.drawflow.drawflow[this.module].data[a].outputs[i].connections[h].points.splice(c,1),t.remove(),this.dispatch("removeReroute",a),this.updateConnectionNodes(n)}registerNode(t,n,s=null,i=null){this.noderegister[t]={html:n,props:s,options:i}}getNodeFromId(t){var n=this.getModuleFromNodeId(t);return JSON.parse(JSON.stringify(this.drawflow.drawflow[n].data[t]))}getNodesFromName(t){var n=[];const s=this.drawflow.drawflow;return Object.keys(s).map(function(i,e){for(var c in s[i].data)s[i].data[c].name==t&&n.push(s[i].data[c].id)}),n}addNode(t,n,s,i,e,c,a,h,o=!1){if(this.useuuid)var l=this.getUuid();else l=this.nodeId;const r=document.createElement("div");r.classList.add("parent-node");const f=document.createElement("div");f.innerHTML="",f.setAttribute("id","node-"+l),f.classList.add("drawflow-node"),c!=""&&f.classList.add(...c.split(" "));const u=document.createElement("div");u.classList.add("inputs");const v=document.createElement("div");v.classList.add("outputs");const x={};for(var E=0;E<n;E++){const S=document.createElement("div");S.classList.add("input"),S.classList.add("input_"+(E+1)),x["input_"+(E+1)]={connections:[]},u.appendChild(S)}const R={};for(E=0;E<s;E++){const S=document.createElement("div");S.classList.add("output"),S.classList.add("output_"+(E+1)),R["output_"+(E+1)]={connections:[]},v.appendChild(S)}const Y=document.createElement("div");if(Y.classList.add("drawflow_content_node"),o===!1)Y.innerHTML=h;else if(o===!0)Y.appendChild(this.noderegister[h].html.cloneNode(!0));else if(parseInt(this.render.version)===3){let S=this.render.h(this.noderegister[h].html,this.noderegister[h].props,this.noderegister[h].options);S.appContext=this.parent,this.render.render(S,Y)}else{let S=new this.render({parent:this.parent,render:z=>z(this.noderegister[h].html,{props:this.noderegister[h].props}),...this.noderegister[h].options}).$mount();Y.appendChild(S.$el)}Object.entries(a).forEach(function(S,z){if(typeof S[1]=="object")(function Q(M,C,I){M===null?M=a[C]:M=M[C],M!==null&&Object.entries(M).forEach(function(p,L){if(typeof p[1]=="object")Q(M,p[0],I+"-"+p[0]);else for(var A=Y.querySelectorAll("[df-"+I+"-"+p[0]+"]"),N=0;N<A.length;N++)A[N].value=p[1],A[N].isContentEditable&&(A[N].innerText=p[1])})})(null,S[0],S[0]);else for(var G=Y.querySelectorAll("[df-"+S[0]+"]"),O=0;O<G.length;O++)G[O].value=S[1],G[O].isContentEditable&&(G[O].innerText=S[1])}),f.appendChild(u),f.appendChild(Y),f.appendChild(v),f.style.top=e+"px",f.style.left=i+"px",r.appendChild(f),this.precanvas.appendChild(r);var B={id:l,name:t,data:a,class:c,html:h,typenode:o,inputs:x,outputs:R,pos_x:i,pos_y:e};return this.drawflow.drawflow[this.module].data[l]=B,this.dispatch("nodeCreated",l),this.useuuid||this.nodeId++,l}addNodeImport(t,n){const s=document.createElement("div");s.classList.add("parent-node");const i=document.createElement("div");i.innerHTML="",i.setAttribute("id","node-"+t.id),i.classList.add("drawflow-node"),t.class!=""&&i.classList.add(...t.class.split(" "));const e=document.createElement("div");e.classList.add("inputs");const c=document.createElement("div");c.classList.add("outputs"),Object.keys(t.inputs).map(function(o,l){const r=document.createElement("div");r.classList.add("input"),r.classList.add(o),e.appendChild(r),Object.keys(t.inputs[o].connections).map(function(f,u){var v=document.createElementNS("http://www.w3.org/2000/svg","svg"),x=document.createElementNS("http://www.w3.org/2000/svg","path");x.classList.add("main-path"),x.setAttributeNS(null,"d",""),v.classList.add("connection"),v.classList.add("node_in_node-"+t.id),v.classList.add("node_out_node-"+t.inputs[o].connections[f].node),v.classList.add(t.inputs[o].connections[f].input),v.classList.add(o),v.appendChild(x),n.appendChild(v)})});for(var a=0;a<Object.keys(t.outputs).length;a++){const o=document.createElement("div");o.classList.add("output"),o.classList.add("output_"+(a+1)),c.appendChild(o)}const h=document.createElement("div");if(h.classList.add("drawflow_content_node"),t.typenode===!1)h.innerHTML=t.html;else if(t.typenode===!0)h.appendChild(this.noderegister[t.html].html.cloneNode(!0));else if(parseInt(this.render.version)===3){let o=this.render.h(this.noderegister[t.html].html,this.noderegister[t.html].props,this.noderegister[t.html].options);o.appContext=this.parent,this.render.render(o,h)}else{let o=new this.render({parent:this.parent,render:l=>l(this.noderegister[t.html].html,{props:this.noderegister[t.html].props}),...this.noderegister[t.html].options}).$mount();h.appendChild(o.$el)}Object.entries(t.data).forEach(function(o,l){if(typeof o[1]=="object")(function u(v,x,E){v===null?v=t.data[x]:v=v[x],v!==null&&Object.entries(v).forEach(function(R,Y){if(typeof R[1]=="object")u(v,R[0],E+"-"+R[0]);else for(var B=h.querySelectorAll("[df-"+E+"-"+R[0]+"]"),S=0;S<B.length;S++)B[S].value=R[1],B[S].isContentEditable&&(B[S].innerText=R[1])})})(null,o[0],o[0]);else for(var r=h.querySelectorAll("[df-"+o[0]+"]"),f=0;f<r.length;f++)r[f].value=o[1],r[f].isContentEditable&&(r[f].innerText=o[1])}),i.appendChild(e),i.appendChild(h),i.appendChild(c),i.style.top=t.pos_y+"px",i.style.left=t.pos_x+"px",s.appendChild(i),this.precanvas.appendChild(s)}addRerouteImport(t){const n=this.reroute_width,s=this.reroute_fix_curvature,i=this.container;Object.keys(t.outputs).map(function(e,c){Object.keys(t.outputs[e].connections).map(function(a,h){const o=t.outputs[e].connections[a].points;o!==void 0&&o.forEach((l,r)=>{const f=t.outputs[e].connections[a].node,u=t.outputs[e].connections[a].output,v=i.querySelector(".connection.node_in_node-"+f+".node_out_node-"+t.id+"."+e+"."+u);if(s&&r===0)for(var x=0;x<o.length;x++){var E=document.createElementNS("http://www.w3.org/2000/svg","path");E.classList.add("main-path"),E.setAttributeNS(null,"d",""),v.appendChild(E)}const R=document.createElementNS("http://www.w3.org/2000/svg","circle");R.classList.add("point");var Y=l.pos_x,B=l.pos_y;R.setAttributeNS(null,"cx",Y),R.setAttributeNS(null,"cy",B),R.setAttributeNS(null,"r",n),v.appendChild(R)})})})}updateNodeValue(t){for(var n=t.target.attributes,s=0;s<n.length;s++)if(n[s].nodeName.startsWith("df-")){for(var i=n[s].nodeName.slice(3).split("-"),e=this.drawflow.drawflow[this.module].data[t.target.closest(".drawflow_content_node").parentElement.id.slice(5)].data,c=0;c<i.length-1;c+=1)e[i[c]]==null&&(e[i[c]]={}),e=e[i[c]];e[i[i.length-1]]=t.target.value,t.target.isContentEditable&&(e[i[i.length-1]]=t.target.innerText),this.dispatch("nodeDataChanged",t.target.closest(".drawflow_content_node").parentElement.id.slice(5))}}updateNodeDataFromId(t,n){var s=this.getModuleFromNodeId(t);if(this.drawflow.drawflow[s].data[t].data=n,this.module===s){const i=this.container.querySelector("#node-"+t);Object.entries(n).forEach(function(e,c){if(typeof e[1]=="object")(function o(l,r,f){l===null?l=n[r]:l=l[r],l!==null&&Object.entries(l).forEach(function(u,v){if(typeof u[1]=="object")o(l,u[0],f+"-"+u[0]);else for(var x=i.querySelectorAll("[df-"+f+"-"+u[0]+"]"),E=0;E<x.length;E++)x[E].value=u[1],x[E].isContentEditable&&(x[E].innerText=u[1])})})(null,e[0],e[0]);else for(var a=i.querySelectorAll("[df-"+e[0]+"]"),h=0;h<a.length;h++)a[h].value=e[1],a[h].isContentEditable&&(a[h].innerText=e[1])})}}addNodeInput(t){var n=this.getModuleFromNodeId(t);const s=this.getNodeFromId(t),i=Object.keys(s.inputs).length;if(this.module===n){const e=document.createElement("div");e.classList.add("input"),e.classList.add("input_"+(i+1)),this.container.querySelector("#node-"+t+" .inputs").appendChild(e),this.updateConnectionNodes("node-"+t)}this.drawflow.drawflow[n].data[t].inputs["input_"+(i+1)]={connections:[]}}addNodeOutput(t){var n=this.getModuleFromNodeId(t);const s=this.getNodeFromId(t),i=Object.keys(s.outputs).length;if(this.module===n){const e=document.createElement("div");e.classList.add("output"),e.classList.add("output_"+(i+1)),this.container.querySelector("#node-"+t+" .outputs").appendChild(e),this.updateConnectionNodes("node-"+t)}this.drawflow.drawflow[n].data[t].outputs["output_"+(i+1)]={connections:[]}}removeNodeInput(t,n){var s=this.getModuleFromNodeId(t);const i=this.getNodeFromId(t);this.module===s&&this.container.querySelector("#node-"+t+" .inputs .input."+n).remove();const e=[];Object.keys(i.inputs[n].connections).map(function(l,r){const f=i.inputs[n].connections[r].node,u=i.inputs[n].connections[r].input;e.push({id_output:f,id:t,output_class:u,input_class:n})}),e.forEach((l,r)=>{this.removeSingleConnection(l.id_output,l.id,l.output_class,l.input_class)}),delete this.drawflow.drawflow[s].data[t].inputs[n];const c=[],a=this.drawflow.drawflow[s].data[t].inputs;Object.keys(a).map(function(l,r){c.push(a[l])}),this.drawflow.drawflow[s].data[t].inputs={};const h=n.slice(6);let o=[];c.forEach((l,r)=>{l.connections.forEach((f,u)=>{o.push(f)}),this.drawflow.drawflow[s].data[t].inputs["input_"+(r+1)]=l}),o=new Set(o.map(l=>JSON.stringify(l))),o=Array.from(o).map(l=>JSON.parse(l)),this.module===s&&this.container.querySelectorAll("#node-"+t+" .inputs .input").forEach((l,r)=>{const f=l.classList[1].slice(6);parseInt(h)<parseInt(f)&&(l.classList.remove("input_"+f),l.classList.add("input_"+(f-1)))}),o.forEach((l,r)=>{this.drawflow.drawflow[s].data[l.node].outputs[l.input].connections.forEach((f,u)=>{if(f.node==t){const v=f.output.slice(6);if(parseInt(h)<parseInt(v)){if(this.module===s){const x=this.container.querySelector(".connection.node_in_node-"+t+".node_out_node-"+l.node+"."+l.input+".input_"+v);x.classList.remove("input_"+v),x.classList.add("input_"+(v-1))}f.points?this.drawflow.drawflow[s].data[l.node].outputs[l.input].connections[u]={node:f.node,output:"input_"+(v-1),points:f.points}:this.drawflow.drawflow[s].data[l.node].outputs[l.input].connections[u]={node:f.node,output:"input_"+(v-1)}}}})}),this.updateConnectionNodes("node-"+t)}removeNodeOutput(t,n){var s=this.getModuleFromNodeId(t);const i=this.getNodeFromId(t);this.module===s&&this.container.querySelector("#node-"+t+" .outputs .output."+n).remove();const e=[];Object.keys(i.outputs[n].connections).map(function(l,r){const f=i.outputs[n].connections[r].node,u=i.outputs[n].connections[r].output;e.push({id:t,id_input:f,output_class:n,input_class:u})}),e.forEach((l,r)=>{this.removeSingleConnection(l.id,l.id_input,l.output_class,l.input_class)}),delete this.drawflow.drawflow[s].data[t].outputs[n];const c=[],a=this.drawflow.drawflow[s].data[t].outputs;Object.keys(a).map(function(l,r){c.push(a[l])}),this.drawflow.drawflow[s].data[t].outputs={};const h=n.slice(7);let o=[];c.forEach((l,r)=>{l.connections.forEach((f,u)=>{o.push({node:f.node,output:f.output})}),this.drawflow.drawflow[s].data[t].outputs["output_"+(r+1)]=l}),o=new Set(o.map(l=>JSON.stringify(l))),o=Array.from(o).map(l=>JSON.parse(l)),this.module===s&&this.container.querySelectorAll("#node-"+t+" .outputs .output").forEach((l,r)=>{const f=l.classList[1].slice(7);parseInt(h)<parseInt(f)&&(l.classList.remove("output_"+f),l.classList.add("output_"+(f-1)))}),o.forEach((l,r)=>{this.drawflow.drawflow[s].data[l.node].inputs[l.output].connections.forEach((f,u)=>{if(f.node==t){const v=f.input.slice(7);if(parseInt(h)<parseInt(v)){if(this.module===s){const x=this.container.querySelector(".connection.node_in_node-"+l.node+".node_out_node-"+t+".output_"+v+"."+l.output);x.classList.remove("output_"+v),x.classList.remove(l.output),x.classList.add("output_"+(v-1)),x.classList.add(l.output)}f.points?this.drawflow.drawflow[s].data[l.node].inputs[l.output].connections[u]={node:f.node,input:"output_"+(v-1),points:f.points}:this.drawflow.drawflow[s].data[l.node].inputs[l.output].connections[u]={node:f.node,input:"output_"+(v-1)}}}})}),this.updateConnectionNodes("node-"+t)}removeNodeId(t){this.removeConnectionNodeId(t);var n=this.getModuleFromNodeId(t.slice(5));this.module===n&&this.container.querySelector("#"+t).remove(),delete this.drawflow.drawflow[n].data[t.slice(5)],this.dispatch("nodeRemoved",t.slice(5))}removeConnection(){if(this.connection_selected!=null){var t=this.connection_selected.parentElement.classList;this.connection_selected.parentElement.remove();var n=this.drawflow.drawflow[this.module].data[t[2].slice(14)].outputs[t[3]].connections.findIndex(function(i,e){return i.node===t[1].slice(13)&&i.output===t[4]});this.drawflow.drawflow[this.module].data[t[2].slice(14)].outputs[t[3]].connections.splice(n,1);var s=this.drawflow.drawflow[this.module].data[t[1].slice(13)].inputs[t[4]].connections.findIndex(function(i,e){return i.node===t[2].slice(14)&&i.input===t[3]});this.drawflow.drawflow[this.module].data[t[1].slice(13)].inputs[t[4]].connections.splice(s,1),this.dispatch("connectionRemoved",{output_id:t[2].slice(14),input_id:t[1].slice(13),output_class:t[3],input_class:t[4]}),this.connection_selected=null}}removeSingleConnection(t,n,s,i){var e=this.getModuleFromNodeId(t);if(e===this.getModuleFromNodeId(n)){if(this.drawflow.drawflow[e].data[t].outputs[s].connections.findIndex(function(h,o){return h.node==n&&h.output===i})>-1){this.module===e&&this.container.querySelector(".connection.node_in_node-"+n+".node_out_node-"+t+"."+s+"."+i).remove();var c=this.drawflow.drawflow[e].data[t].outputs[s].connections.findIndex(function(h,o){return h.node==n&&h.output===i});this.drawflow.drawflow[e].data[t].outputs[s].connections.splice(c,1);var a=this.drawflow.drawflow[e].data[n].inputs[i].connections.findIndex(function(h,o){return h.node==t&&h.input===s});return this.drawflow.drawflow[e].data[n].inputs[i].connections.splice(a,1),this.dispatch("connectionRemoved",{output_id:t,input_id:n,output_class:s,input_class:i}),!0}return!1}return!1}removeConnectionNodeId(t){const n="node_in_"+t,s="node_out_"+t,i=this.container.querySelectorAll("."+s);for(var e=i.length-1;e>=0;e--){var c=i[e].classList,a=this.drawflow.drawflow[this.module].data[c[1].slice(13)].inputs[c[4]].connections.findIndex(function(l,r){return l.node===c[2].slice(14)&&l.input===c[3]});this.drawflow.drawflow[this.module].data[c[1].slice(13)].inputs[c[4]].connections.splice(a,1);var h=this.drawflow.drawflow[this.module].data[c[2].slice(14)].outputs[c[3]].connections.findIndex(function(l,r){return l.node===c[1].slice(13)&&l.output===c[4]});this.drawflow.drawflow[this.module].data[c[2].slice(14)].outputs[c[3]].connections.splice(h,1),i[e].remove(),this.dispatch("connectionRemoved",{output_id:c[2].slice(14),input_id:c[1].slice(13),output_class:c[3],input_class:c[4]})}const o=this.container.querySelectorAll("."+n);for(e=o.length-1;e>=0;e--)c=o[e].classList,h=this.drawflow.drawflow[this.module].data[c[2].slice(14)].outputs[c[3]].connections.findIndex(function(l,r){return l.node===c[1].slice(13)&&l.output===c[4]}),this.drawflow.drawflow[this.module].data[c[2].slice(14)].outputs[c[3]].connections.splice(h,1),a=this.drawflow.drawflow[this.module].data[c[1].slice(13)].inputs[c[4]].connections.findIndex(function(l,r){return l.node===c[2].slice(14)&&l.input===c[3]}),this.drawflow.drawflow[this.module].data[c[1].slice(13)].inputs[c[4]].connections.splice(a,1),o[e].remove(),this.dispatch("connectionRemoved",{output_id:c[2].slice(14),input_id:c[1].slice(13),output_class:c[3],input_class:c[4]})}getModuleFromNodeId(t){var n;const s=this.drawflow.drawflow;return Object.keys(s).map(function(i,e){Object.keys(s[i].data).map(function(c,a){c==t&&(n=i)})}),n}addModule(t){this.drawflow.drawflow[t]={data:{}},this.dispatch("moduleCreated",t)}changeModule(t){this.dispatch("moduleChanged",t),this.module=t,this.precanvas.innerHTML="",this.canvas_x=0,this.canvas_y=0,this.pos_x=0,this.pos_y=0,this.mouse_x=0,this.mouse_y=0,this.zoom=1,this.zoom_last_value=1,this.precanvas.style.transform="",this.import(this.drawflow,!1)}removeModule(t){this.module===t&&this.changeModule("Home"),delete this.drawflow.drawflow[t],this.dispatch("moduleRemoved",t)}clearModuleSelected(){this.precanvas.innerHTML="",this.drawflow.drawflow[this.module]={data:{}}}clear(){this.precanvas.innerHTML="",this.drawflow={drawflow:{Home:{data:{}}}}}export(){const t=JSON.parse(JSON.stringify(this.drawflow));return this.dispatch("export",t),t}import(t,n=!0){this.clear(),this.drawflow=JSON.parse(JSON.stringify(t)),this.load(),n&&this.dispatch("import","import")}on(t,n){return typeof n!="function"?(console.error("The listener callback must be a function, the given type is "+typeof n),!1):typeof t!="string"?(console.error("The event name must be a string, the given type is "+typeof t),!1):(this.events[t]===void 0&&(this.events[t]={listeners:[]}),void this.events[t].listeners.push(n))}removeListener(t,n){if(!this.events[t])return!1;const s=this.events[t].listeners,i=s.indexOf(n);i>-1&&s.splice(i,1)}dispatch(t,n){if(this.events[t]===void 0)return!1;this.events[t].listeners.forEach(s=>{s(n)})}getUuid(){for(var t=[],n=0;n<36;n++)t[n]="0123456789abcdef".substr(Math.floor(16*Math.random()),1);return t[14]="4",t[19]="0123456789abcdef".substr(3&t[19]|8,1),t[8]=t[13]=t[18]=t[23]="-",t.join("")}}}]).default})})(zt);var Jt=zt.exports;const Vt=Ut(Jt);function $t(b){let g;return{c(){g=U("div"),this.h()},l(_){g=X(_,"DIV",{class:!0}),V(g).forEach(T),this.h()},h(){$(g,"class","parent-drawflow h-100 my-editor svelte-1jjj000")},m(_,w){nt(_,g,w),b[1](g)},p:ht,i:ht,o:ht,d(_){_&&T(g),b[1](null)}}}function Kt(b,g,_){let w;pt(b,ut,s=>_(3,w=s));let m,d,y=new Map,t=s=>{if(d)if(d.clear(),s.starts&&s.starts.length>0){if(console.log("drawing"),w!==void 0){console.log("using cache"),d.import(w),Object.values(s.map).map(e=>{if(e.drawId!==void 0){let c=d.getNodeFromId(e.drawId);y.set(e.id,{x:c.pos_x,y:c.pos_y})}});return}let i=Math.max(...s.ends.map(e=>s.map[e].earlyCol));for(let e=1;e<i+1;e++){let c=Object.keys(s.map).filter(a=>s.map[a].earlyCol==e);c.sort((a,h)=>s.map[a].slack>s.map[h].slack);for(let a=0;a<c.length;a++){let h=c[a],o=s.map[h],l="normal",r="bg-darkBlue";o.slack===0&&(l="critical",r="bg-darkSteel");let f=`
						<div class="heading `+r+'">'+o.name+`</div>
						<table style="width:99.9%;">
							<tr><th class="text-left third">Start</th><th>Duration</th><th class="text-right third">Finish</th></tr>
							<tr><td>`+o.es+'</td><td class="text-center va-middle" rowspan=2>'+o.expected+'</td><td class="text-right">'+o.ef+`</td></tr>
							<tr><td>`+o.ls+'</td><td class="text-right">'+o.lf+`</td></tr>
						</table>
						<hr/>
						<table style="width:99.9%;">
							<tr><th class="text-left third">Min</th><th>Likely</th><th class="text-right third">Max</th></tr>
							<tr><td>`+o.min+'</td><td class="text-center">'+o.likely+'</td><td class="text-right">'+o.max+`</td></tr>
						</table>
					`,u=y.get(o.id);u===void 0&&(u={x:20+400*(e-1),y:20+200*a});let v=40,x={x:u.x<0?-1:1,y:u.y<0?-1:1};u.x+=v/2*x.x,u.x-=Math.abs(u.x)%v*x.x,u.y+=v/2*x.y,u.y-=Math.abs(u.y)%v*x.y;let E=d.addNode(o.name,1,1,u.x,u.y,l,s.map[h],f);y.set(o.id,u),s.map[h].drawId=E,s.map[h].predecessors.map(R=>{let Y=s.map[R].drawId;if(d.addConnection(Y,E,"output_1","input_1"),s.map[R].slack===0&&s.map[h].slack===0){let B=document.getElementsByClassName("connection node_in_node-"+E+" node_out_node-"+Y);B.length>0&&B[0].classList.add("critical")}})}}console.log("exporting to cache"),dt(ut,w=d.export(),w)}else console.log("dont draw yet")};qt(()=>{d=new Vt(m),d.draggable_inputs=!1,d.zoom_min=.2,d.start(),Yt.subscribe(s=>{setTimeout(()=>t(s),100)}),Xt.subscribe(s=>{s>0?d.zoom_in():s<0&&d.zoom_out()}),d.on("nodeMoved",function(s){dt(ut,w=d.export(),w);let i=d.getNodeFromId(s);y.set(i.data.id,{x:i.pos_x,y:i.pos_y})})});function n(s){Mt[s?"unshift":"push"](()=>{m=s,_(0,m)})}return[m,n]}class Gt extends St{constructor(g){super(),Nt(this,g,Kt,$t,Rt,{})}}function ft(b,g,_){const w=b.slice();return w[10]=g[_],w}function _t(b,g,_){const w=b.slice();return w[13]=g[_],w[14]=g,w[15]=_,w}function mt(b,g,_){const w=b.slice();return w[16]=g[_],w}function gt(b,g,_){const w=b.slice();return w[19]=g[_],w}function wt(b,g,_){const w=b.slice();return w[13]=g[_],w[22]=g,w[23]=_,w}function vt(b,g,_){const w=b.slice();return w[16]=g[_],w}function yt(b){let g,_=b[16]+"",w;return{c(){g=U("th"),w=It(_)},l(m){g=X(m,"TH",{});var d=V(g);w=kt(d,_),d.forEach(T)},m(m,d){nt(m,g,d),P(g,w)},p(m,d){d&1&&_!==(_=m[16]+"")&&At(w,_)},d(m){m&&T(g)}}}function Ct(b){let g,_,w,m;function d(){b[6].call(_,b[22],b[23])}return{c(){g=U("td"),_=U("input"),this.h()},l(y){g=X(y,"TD",{class:!0});var t=V(g);_=X(t,"INPUT",{type:!0,class:!0}),t.forEach(T),this.h()},h(){$(_,"type","text"),$(_,"class","metro-input svelte-5bc4oa"),$(g,"class","svelte-5bc4oa")},m(y,t){nt(y,g,t),P(g,_),rt(_,b[13]),w||(m=[lt(_,"input",d),lt(_,"paste",b[2]),lt(_,"blur",b[4])],w=!0)},p(y,t){b=y,t&1&&_.value!==b[13]&&rt(_,b[13])},d(y){y&&T(g),w=!1,Bt(m)}}}function bt(b){let g,_,w=tt(b[19]),m=[];for(let d=0;d<w.length;d+=1)m[d]=Ct(wt(b,w,d));return{c(){g=U("tr");for(let d=0;d<m.length;d+=1)m[d].c();_=st()},l(d){g=X(d,"TR",{});var y=V(g);for(let t=0;t<m.length;t+=1)m[t].l(y);_=it(y),y.forEach(T)},m(d,y){nt(d,g,y);for(let t=0;t<m.length;t+=1)m[t]&&m[t].m(g,null);P(g,_)},p(d,y){if(y&21){w=tt(d[19]);let t;for(t=0;t<w.length;t+=1){const n=wt(d,w,t);m[t]?m[t].p(n,y):(m[t]=Ct(n),m[t].c(),m[t].m(g,_))}for(;t<m.length;t+=1)m[t].d(1);m.length=w.length}},d(d){d&&T(g),ot(m,d)}}}function xt(b){let g,_=b[16]+"",w;return{c(){g=U("th"),w=It(_)},l(m){g=X(m,"TH",{});var d=V(g);w=kt(d,_),d.forEach(T)},m(m,d){nt(m,g,d),P(g,w)},p(m,d){d&2&&_!==(_=m[16]+"")&&At(w,_)},d(m){m&&T(g)}}}function Et(b){let g,_,w,m;function d(){b[7].call(_,b[14],b[15])}return{c(){g=U("td"),_=U("input"),this.h()},l(y){g=X(y,"TD",{class:!0});var t=V(g);_=X(t,"INPUT",{type:!0,class:!0}),t.forEach(T),this.h()},h(){$(_,"type","text"),$(_,"class","metro-input svelte-5bc4oa"),$(g,"class","svelte-5bc4oa")},m(y,t){nt(y,g,t),P(g,_),rt(_,b[13]),w||(m=[lt(_,"input",d),lt(_,"paste",b[3]),lt(_,"blur",b[5])],w=!0)},p(y,t){b=y,t&2&&_.value!==b[13]&&rt(_,b[13])},d(y){y&&T(g),w=!1,Bt(m)}}}function Lt(b){let g,_,w=tt(b[10]),m=[];for(let d=0;d<w.length;d+=1)m[d]=Et(_t(b,w,d));return{c(){g=U("tr");for(let d=0;d<m.length;d+=1)m[d].c();_=st()},l(d){g=X(d,"TR",{});var y=V(g);for(let t=0;t<m.length;t+=1)m[t].l(y);_=it(y),y.forEach(T)},m(d,y){nt(d,g,y);for(let t=0;t<m.length;t+=1)m[t]&&m[t].m(g,null);P(g,_)},p(d,y){if(y&42){w=tt(d[10]);let t;for(t=0;t<w.length;t+=1){const n=_t(d,w,t);m[t]?m[t].p(n,y):(m[t]=Et(n),m[t].c(),m[t].m(g,_))}for(;t<m.length;t+=1)m[t].d(1);m.length=w.length}},d(d){d&&T(g),ot(m,d)}}}function Qt(b){let g,_,w,m='<li><a href="#_target_1">Tasks</a></li> <li><a href="#_target_2">Resources</a></li>',d,y,t,n,s,i,e,c,a,h,o,l,r,f,u,v,x,E,R,Y=tt(b[0][0]),B=[];for(let C=0;C<Y.length;C+=1)B[C]=yt(vt(b,Y,C));let S=tt(b[0].slice(1)),z=[];for(let C=0;C<S.length;C+=1)z[C]=bt(gt(b,S,C));let G=tt(b[1][0]),O=[];for(let C=0;C<G.length;C+=1)O[C]=xt(mt(b,G,C));let Q=tt(b[1].slice(1)),M=[];for(let C=0;C<Q.length;C+=1)M[C]=Lt(ft(b,Q,C));return E=new Gt({}),{c(){g=U("div"),_=U("div"),w=U("ul"),w.innerHTML=m,d=st(),y=U("div"),t=U("div"),n=U("table"),s=U("thead"),i=U("tr");for(let C=0;C<B.length;C+=1)B[C].c();e=st(),c=U("tbody");for(let C=0;C<z.length;C+=1)z[C].c();a=st(),h=U("div"),o=U("table"),l=U("thead"),r=U("tr");for(let C=0;C<O.length;C+=1)O[C].c();f=st(),u=U("tbody");for(let C=0;C<M.length;C+=1)M[C].c();v=st(),x=U("div"),Ht(E.$$.fragment),this.h()},l(C){g=X(C,"DIV",{"data-role":!0,class:!0,"data-split-sizes":!0});var I=V(g);_=X(I,"DIV",{class:!0});var p=V(_);w=X(p,"UL",{"data-role":!0,"data-expand":!0,"data-svelte-h":!0}),Tt(w)!=="svelte-10cc686"&&(w.innerHTML=m),d=it(p),y=X(p,"DIV",{class:!0});var L=V(y);t=X(L,"DIV",{id:!0});var A=V(t);n=X(A,"TABLE",{class:!0});var N=V(n);s=X(N,"THEAD",{});var q=V(s);i=X(q,"TR",{});var j=V(i);for(let H=0;H<B.length;H+=1)B[H].l(j);j.forEach(T),q.forEach(T),e=it(N),c=X(N,"TBODY",{});var D=V(c);for(let H=0;H<z.length;H+=1)z[H].l(D);D.forEach(T),N.forEach(T),A.forEach(T),a=it(L),h=X(L,"DIV",{id:!0});var W=V(h);o=X(W,"TABLE",{class:!0});var k=V(o);l=X(k,"THEAD",{});var F=V(l);r=X(F,"TR",{});var Z=V(r);for(let H=0;H<O.length;H+=1)O[H].l(Z);Z.forEach(T),F.forEach(T),f=it(k),u=X(k,"TBODY",{});var J=V(u);for(let H=0;H<M.length;H+=1)M[H].l(J);J.forEach(T),k.forEach(T),W.forEach(T),L.forEach(T),p.forEach(T),v=it(I),x=X(I,"DIV",{class:!0});var K=V(x);Ot(E.$$.fragment,K),K.forEach(T),I.forEach(T),this.h()},h(){$(w,"data-role","tabs"),$(w,"data-expand","true"),$(n,"class","table subcompact table-border cell-border striped"),$(t,"id","_target_1"),$(o,"class","table subcompact table-border cell-border striped"),$(h,"id","_target_2"),$(y,"class","border bd-default no-border-top p-2 scrollable svelte-5bc4oa"),$(_,"class",""),$(x,"class","d-flex flex-justify-center flex-align-center"),$(g,"data-role","splitter"),$(g,"class","h-100"),$(g,"data-split-sizes","30, 70")},m(C,I){nt(C,g,I),P(g,_),P(_,w),P(_,d),P(_,y),P(y,t),P(t,n),P(n,s),P(s,i);for(let p=0;p<B.length;p+=1)B[p]&&B[p].m(i,null);P(n,e),P(n,c);for(let p=0;p<z.length;p+=1)z[p]&&z[p].m(c,null);P(y,a),P(y,h),P(h,o),P(o,l),P(l,r);for(let p=0;p<O.length;p+=1)O[p]&&O[p].m(r,null);P(o,f),P(o,u);for(let p=0;p<M.length;p+=1)M[p]&&M[p].m(u,null);P(g,v),P(g,x),jt(E,x,null),R=!0},p(C,[I]){if(I&1){Y=tt(C[0][0]);let p;for(p=0;p<Y.length;p+=1){const L=vt(C,Y,p);B[p]?B[p].p(L,I):(B[p]=yt(L),B[p].c(),B[p].m(i,null))}for(;p<B.length;p+=1)B[p].d(1);B.length=Y.length}if(I&21){S=tt(C[0].slice(1));let p;for(p=0;p<S.length;p+=1){const L=gt(C,S,p);z[p]?z[p].p(L,I):(z[p]=bt(L),z[p].c(),z[p].m(c,null))}for(;p<z.length;p+=1)z[p].d(1);z.length=S.length}if(I&2){G=tt(C[1][0]);let p;for(p=0;p<G.length;p+=1){const L=mt(C,G,p);O[p]?O[p].p(L,I):(O[p]=xt(L),O[p].c(),O[p].m(r,null))}for(;p<O.length;p+=1)O[p].d(1);O.length=G.length}if(I&42){Q=tt(C[1].slice(1));let p;for(p=0;p<Q.length;p+=1){const L=ft(C,Q,p);M[p]?M[p].p(L,I):(M[p]=Lt(L),M[p].c(),M[p].m(u,null))}for(;p<M.length;p+=1)M[p].d(1);M.length=Q.length}},i(C){R||(Dt(E.$$.fragment,C),R=!0)},o(C){Wt(E.$$.fragment,C),R=!1},d(C){C&&T(g),ot(B,C),ot(z,C),ot(O,C),ot(M,C),Ft(E)}}}function Zt(b,g,_){let w,m;pt(b,ct,a=>_(8,w=a)),pt(b,at,a=>_(9,m=a));let d;at.subscribe(a=>{_(0,d=a.slice(0)),d.push(Array(a[0].length).fill(""))});let y;ct.subscribe(a=>{_(1,y=a.slice(0)),y.push(Array(a[0].length).fill(""))});function t(a){a.preventDefault();let h=(a.clipboardData||window.clipboardData).getData("text");dt(at,m=h.split(/\n|\r/).filter(o=>o.length).map(o=>o.split(/\t/)),m)}function n(a){a.preventDefault();let h=(a.clipboardData||window.clipboardData).getData("text");dt(ct,w=h.split(/\n|\r/).filter(o=>o.length).map(o=>o.split(/\t/)),w)}function s(){console.log("Update TaskList without empty lines"),at.set(d.filter(a=>a.join("")!==""))}function i(){console.log("Update ResourceList without empty lines"),ct.set(y.filter(a=>a.join("")!==""))}function e(a,h){a[h]=this.value,_(0,d)}function c(a,h){a[h]=this.value,_(1,y)}return[d,y,t,n,s,i,e,c]}class oe extends St{constructor(g){super(),Nt(this,g,Zt,Qt,Rt,{})}}export{oe as component};
