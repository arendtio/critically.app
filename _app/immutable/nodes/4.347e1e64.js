import{s as F,n as L,e as z}from"../chunks/scheduler.72a81396.js";import{S as G,i as K,g as v,h as g,j as N,f as u,k as x,l as A,a as k,y as p,A as O,s as Q,c as U,e as S,m as b,n as D,o as I,x as W}from"../chunks/index.d11d4d66.js";import{e as y}from"../chunks/each.e59479a4.js";import{d as X}from"../chunks/index.2391f01a.js";import{l as Y,c as Z,r as P}from"../chunks/criticalPath.store.aedc5f59.js";import{g as $}from"../chunks/gantt.store.fbfbde26.js";const ee=X([Z,P],([i,l])=>{let r=l.slice(0,1),s=l.slice(1).map(n=>{let o=n.slice(0,1);return o=o.concat(n.slice(1).map(h=>({free:Y(h),allocations:[]}))),o});if(r=r.concat(s),i.map===void 0)return r;let t=Object.keys(i.map).sort((n,o)=>i.map[n].slack===i.map[o].slack?i.map[n].es>i.map[o].es?1:i.map[n].es<i.map[o].es?-1:0:i.map[n].slack>i.map[o].slack?1:-1),e=JSON.parse(JSON.stringify(i)),a=n=>{if(e.map[n].startDate!==void 0)return;let o=e.map[n].predecessors.reduce((c,f)=>(a(f),c===void 0||e.map[f].endDate>c?e.map[f].endDate:c),void 0),h=e.map[n].res.map(c=>{let f=r[0].indexOf(c);return f<0&&(console.log("The resource",c,"in task",n,"is not defined in the resource table"),alert("The resource "+c+" in task "+n+" is not defined in the resource table")),f}),B=(c,f,d)=>{let w=0,_=r[c][f].free;if(isNaN(_)||_===0)return!1;for(;d>0;){if(c+w>=r.length)return!1;if(_=r[c+w][f].free,isNaN(_)){w++;continue}if(_===0)return!1;d-=_,w++}return!0},V;for(let c=1;c<r.length&&!(!(r[c][0]<=o)&&(V=h.reduce((f,d)=>B(c,d,e.map[n].expected)?{resId:d,row:c}:f,void 0),V!==void 0));c++);V===void 0&&alert("Task "+n+" could not be allocated. Please provide more resources or adjust constraints."),((c,f,d)=>{let w=r[d][0],_,R,E=e.map[c].expected;for(let m=d;m<r.length;m++){let T=r[m][f].free;if(!isNaN(T))if(E>T)E-=T,r[m][f].allocations.push({task:c,amount:T}),r[m][f].free=0;else{r[m][f].free-=E,r[m][f].allocations.push({task:c,amount:E}),E=0,_=r[m][0],R=m;break}}e.map[c].startDate=w,e.map[c].endDate=_,e.map[c].resPlanned=r[0][f],e.map[c].firstRow=d,e.map[c].lastRow=R})(n,V.resId,V.row)};return t.forEach(a),$.set(e),r});function j(i,l,r){const s=i.slice();return s[1]=l[r],s}function C(i,l,r){const s=i.slice();return s[4]=l[r],s}function H(i,l,r){const s=i.slice();return s[7]=l[r],s}function te(i){let l,r=y(i[4].allocations),s=[];for(let t=0;t<r.length;t+=1)s[t]=J(H(i,r,t));return{c(){l=v("div");for(let t=0;t<s.length;t+=1)s[t].c();this.h()},l(t){l=g(t,"DIV",{class:!0});var e=N(l);for(let a=0;a<s.length;a+=1)s[a].l(e);e.forEach(u),this.h()},h(){x(l,"class","cell border bd-white bg-darkBlue fg-white")},m(t,e){k(t,l,e);for(let a=0;a<s.length;a+=1)s[a]&&s[a].m(l,null)},p(t,e){if(e&1){r=y(t[4].allocations);let a;for(a=0;a<r.length;a+=1){const n=H(t,r,a);s[a]?s[a].p(n,e):(s[a]=J(n),s[a].c(),s[a].m(l,null))}for(;a<s.length;a+=1)s[a].d(1);s.length=r.length}},d(t){t&&u(l),O(s,t)}}}function le(i){let l,r,s=i[4].free+"",t;return{c(){l=v("div"),r=b("free: "),t=b(s),this.h()},l(e){l=g(e,"DIV",{class:!0,style:!0});var a=N(l);r=D(a,"free: "),t=D(a,s),a.forEach(u),this.h()},h(){x(l,"class","cell"),A(l,"color","#ccc")},m(e,a){k(e,l,a),p(l,r),p(l,t)},p(e,a){a&1&&s!==(s=e[4].free+"")&&I(t,s)},d(e){e&&u(l)}}}function ne(i){let l,r="";return{c(){l=v("div"),l.innerHTML=r,this.h()},l(s){l=g(s,"DIV",{class:!0,style:!0,"data-svelte-h":!0}),W(l)!=="svelte-1336dtu"&&(l.innerHTML=r),this.h()},h(){x(l,"class","cell"),A(l,"color","#ccc")},m(s,t){k(s,l,t)},p:L,d(s){s&&u(l)}}}function re(i){let l,r=i[4]+"",s;return{c(){l=v("div"),s=b(r),this.h()},l(t){l=g(t,"DIV",{class:!0});var e=N(l);s=D(e,r),e.forEach(u),this.h()},h(){x(l,"class","cell text-bold bg-light")},m(t,e){k(t,l,e),p(l,s)},p(t,e){e&1&&r!==(r=t[4]+"")&&I(s,r)},d(t){t&&u(l)}}}function J(i){let l,r,s=i[7].task+"",t,e,a=i[7].amount+"",n;return{c(){l=v("div"),r=b("Task "),t=b(s),e=b(": "),n=b(a)},l(o){l=g(o,"DIV",{});var h=N(l);r=D(h,"Task "),t=D(h,s),e=D(h,": "),n=D(h,a),h.forEach(u)},m(o,h){k(o,l,h),p(l,r),p(l,t),p(l,e),p(l,n)},p(o,h){h&1&&s!==(s=o[7].task+"")&&I(t,s),h&1&&a!==(a=o[7].amount+"")&&I(n,a)},d(o){o&&u(l)}}}function M(i){let l,r;function s(a,n){return n&1&&(l=null),a[4].allocations===void 0?re:(l==null&&(l=!!isNaN(a[4].free)),l?ne:a[4].allocations.length===0?le:te)}let t=s(i,-1),e=t(i);return{c(){e.c(),r=S()},l(a){e.l(a),r=S()},m(a,n){e.m(a,n),k(a,r,n)},p(a,n){t===(t=s(a,n))&&e?e.p(a,n):(e.d(1),e=t(a),e&&(e.c(),e.m(r.parentNode,r)))},d(a){a&&u(r),e.d(a)}}}function q(i){let l,r,s=y(i[1]),t=[];for(let e=0;e<s.length;e+=1)t[e]=M(C(i,s,e));return{c(){l=v("div");for(let e=0;e<t.length;e+=1)t[e].c();r=Q(),this.h()},l(e){l=g(e,"DIV",{class:!0});var a=N(l);for(let n=0;n<t.length;n+=1)t[n].l(a);r=U(a),a.forEach(u),this.h()},h(){x(l,"class","row text-center")},m(e,a){k(e,l,a);for(let n=0;n<t.length;n+=1)t[n]&&t[n].m(l,null);p(l,r)},p(e,a){if(a&1){s=y(e[1]);let n;for(n=0;n<s.length;n+=1){const o=C(e,s,n);t[n]?t[n].p(o,a):(t[n]=M(o),t[n].c(),t[n].m(l,r))}for(;n<t.length;n+=1)t[n].d(1);t.length=s.length}},d(e){e&&u(l),O(t,e)}}}function se(i){let l,r,s=y(i[0]),t=[];for(let e=0;e<s.length;e+=1)t[e]=q(j(i,s,e));return{c(){l=v("div"),r=v("div");for(let e=0;e<t.length;e+=1)t[e].c();this.h()},l(e){l=g(e,"DIV",{style:!0});var a=N(l);r=g(a,"DIV",{class:!0});var n=N(r);for(let o=0;o<t.length;o+=1)t[o].l(n);n.forEach(u),a.forEach(u),this.h()},h(){x(r,"class","grid"),A(l,"height","100%"),A(l,"overflow","scroll")},m(e,a){k(e,l,a),p(l,r);for(let n=0;n<t.length;n+=1)t[n]&&t[n].m(r,null)},p(e,[a]){if(a&1){s=y(e[0]);let n;for(n=0;n<s.length;n+=1){const o=j(e,s,n);t[n]?t[n].p(o,a):(t[n]=q(o),t[n].c(),t[n].m(r,null))}for(;n<t.length;n+=1)t[n].d(1);t.length=s.length}},i:L,o:L,d(e){e&&u(l),O(t,e)}}}function ae(i,l,r){let s;return z(i,ee,t=>r(0,s=t)),[s]}class _e extends G{constructor(l){super(),K(this,l,ae,se,F,{})}}export{_e as component};
