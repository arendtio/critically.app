import{s as wt,n as at,e as rt,o as Tt,f as bt,b as jt,r as Ht}from"../chunks/scheduler.72a81396.js";import{S as vt,i as yt,g as M,h as H,j as $,f as B,k,a as Z,s as et,c as nt,x as Ct,y as z,A as ct,m as Ot,n as Wt,o as Dt,B as ot,z as lt,r as dt,u as ht,v as ut,d as pt,t as ft,w as _t,e as xt}from"../chunks/index.45de7edf.js";import{e as Q}from"../chunks/each.e59479a4.js";import{c as $t,g as Ft,z as Pt}from"../chunks/drawflow.store.aa0a6cb1.js";import{d as mt,c as Xt}from"../chunks/criticalPath.store.1c85e9a0.js";import{g as Ut,T as Yt}from"../chunks/tables.store.42dbbbd7.js";import{w as Jt}from"../chunks/index.2391f01a.js";import{c as gt}from"../chunks/assistant.store.d6b54812.js";var qt={exports:{}};(function(C,h){(function(v,g){C.exports=g()})(typeof self<"u"?self:$t,function(){return function(v){var g={};function y(f){if(g[f])return g[f].exports;var w=g[f]={i:f,l:!1,exports:{}};return v[f].call(w.exports,w,w.exports,y),w.l=!0,w.exports}return y.m=v,y.c=g,y.d=function(f,w,t){y.o(f,w)||Object.defineProperty(f,w,{enumerable:!0,get:t})},y.r=function(f){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(f,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(f,"__esModule",{value:!0})},y.t=function(f,w){if(1&w&&(f=y(f)),8&w||4&w&&typeof f=="object"&&f&&f.__esModule)return f;var t=Object.create(null);if(y.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:f}),2&w&&typeof f!="string")for(var s in f)y.d(t,s,(function(e){return f[e]}).bind(null,s));return t},y.n=function(f){var w=f&&f.__esModule?function(){return f.default}:function(){return f};return y.d(w,"a",w),w},y.o=function(f,w){return Object.prototype.hasOwnProperty.call(f,w)},y.p="",y(y.s=0)}([function(v,g,y){y.r(g),y.d(g,"default",function(){return f});class f{constructor(t,s=null,e=null){this.events={},this.container=t,this.precanvas=null,this.nodeId=1,this.ele_selected=null,this.node_selected=null,this.drag=!1,this.reroute=!1,this.reroute_fix_curvature=!1,this.curvature=.5,this.reroute_curvature_start_end=.5,this.reroute_curvature=.5,this.reroute_width=6,this.drag_point=!1,this.editor_selected=!1,this.connection=!1,this.connection_ele=null,this.connection_selected=null,this.canvas_x=0,this.canvas_y=0,this.pos_x=0,this.pos_x_start=0,this.pos_y=0,this.pos_y_start=0,this.mouse_x=0,this.mouse_y=0,this.line_path=5,this.first_click=null,this.force_first_input=!1,this.draggable_inputs=!0,this.useuuid=!1,this.parent=e,this.noderegister={},this.render=s,this.drawflow={drawflow:{Home:{data:{}}}},this.module="Home",this.editor_mode="edit",this.zoom=1,this.zoom_max=1.6,this.zoom_min=.5,this.zoom_value=.1,this.zoom_last_value=1,this.evCache=new Array,this.prevDiff=-1}start(){this.container.classList.add("parent-drawflow"),this.container.tabIndex=0,this.precanvas=document.createElement("div"),this.precanvas.classList.add("drawflow"),this.container.appendChild(this.precanvas),this.container.addEventListener("mouseup",this.dragEnd.bind(this)),this.container.addEventListener("mousemove",this.position.bind(this)),this.container.addEventListener("mousedown",this.click.bind(this)),this.container.addEventListener("touchend",this.dragEnd.bind(this)),this.container.addEventListener("touchmove",this.position.bind(this)),this.container.addEventListener("touchstart",this.click.bind(this)),this.container.addEventListener("contextmenu",this.contextmenu.bind(this)),this.container.addEventListener("keydown",this.key.bind(this)),this.container.addEventListener("wheel",this.zoom_enter.bind(this)),this.container.addEventListener("input",this.updateNodeValue.bind(this)),this.container.addEventListener("dblclick",this.dblclick.bind(this)),this.container.onpointerdown=this.pointerdown_handler.bind(this),this.container.onpointermove=this.pointermove_handler.bind(this),this.container.onpointerup=this.pointerup_handler.bind(this),this.container.onpointercancel=this.pointerup_handler.bind(this),this.container.onpointerout=this.pointerup_handler.bind(this),this.container.onpointerleave=this.pointerup_handler.bind(this),this.load()}pointerdown_handler(t){this.evCache.push(t)}pointermove_handler(t){for(var s=0;s<this.evCache.length;s++)if(t.pointerId==this.evCache[s].pointerId){this.evCache[s]=t;break}if(this.evCache.length==2){var e=Math.abs(this.evCache[0].clientX-this.evCache[1].clientX);this.prevDiff>100&&(e>this.prevDiff&&this.zoom_in(),e<this.prevDiff&&this.zoom_out()),this.prevDiff=e}}pointerup_handler(t){this.remove_event(t),this.evCache.length<2&&(this.prevDiff=-1)}remove_event(t){for(var s=0;s<this.evCache.length;s++)if(this.evCache[s].pointerId==t.pointerId){this.evCache.splice(s,1);break}}load(){for(var t in this.drawflow.drawflow[this.module].data)this.addNodeImport(this.drawflow.drawflow[this.module].data[t],this.precanvas);if(this.reroute)for(var t in this.drawflow.drawflow[this.module].data)this.addRerouteImport(this.drawflow.drawflow[this.module].data[t]);for(var t in this.drawflow.drawflow[this.module].data)this.updateConnectionNodes("node-"+t);const s=this.drawflow.drawflow;let e=1;Object.keys(s).map(function(o,n){Object.keys(s[o].data).map(function(c,d){parseInt(c)>=e&&(e=parseInt(c)+1)})}),this.nodeId=e}removeReouteConnectionSelected(){this.dispatch("connectionUnselected",!0),this.reroute_fix_curvature&&this.connection_selected.parentElement.querySelectorAll(".main-path").forEach((t,s)=>{t.classList.remove("selected")})}click(t){if(this.dispatch("click",t),this.editor_mode==="fixed"){if(t.preventDefault(),t.target.classList[0]!=="parent-drawflow"&&t.target.classList[0]!=="drawflow")return!1;this.ele_selected=t.target.closest(".parent-drawflow")}else this.editor_mode==="view"?(t.target.closest(".drawflow")!=null||t.target.matches(".parent-drawflow"))&&(this.ele_selected=t.target.closest(".parent-drawflow"),t.preventDefault()):(this.first_click=t.target,this.ele_selected=t.target,t.button===0&&this.contextmenuDel(),t.target.closest(".drawflow_content_node")!=null&&(this.ele_selected=t.target.closest(".drawflow_content_node").parentElement));switch(this.ele_selected.classList[0]){case"drawflow-node":this.node_selected!=null&&(this.node_selected.classList.remove("selected"),this.node_selected!=this.ele_selected&&this.dispatch("nodeUnselected",!0)),this.connection_selected!=null&&(this.connection_selected.classList.remove("selected"),this.removeReouteConnectionSelected(),this.connection_selected=null),this.node_selected!=this.ele_selected&&this.dispatch("nodeSelected",this.ele_selected.id.slice(5)),this.node_selected=this.ele_selected,this.node_selected.classList.add("selected"),this.draggable_inputs?t.target.tagName!=="SELECT"&&(this.drag=!0):t.target.tagName!=="INPUT"&&t.target.tagName!=="TEXTAREA"&&t.target.tagName!=="SELECT"&&t.target.hasAttribute("contenteditable")!==!0&&(this.drag=!0);break;case"output":this.connection=!0,this.node_selected!=null&&(this.node_selected.classList.remove("selected"),this.node_selected=null,this.dispatch("nodeUnselected",!0)),this.connection_selected!=null&&(this.connection_selected.classList.remove("selected"),this.removeReouteConnectionSelected(),this.connection_selected=null),this.drawConnection(t.target);break;case"parent-drawflow":case"drawflow":this.node_selected!=null&&(this.node_selected.classList.remove("selected"),this.node_selected=null,this.dispatch("nodeUnselected",!0)),this.connection_selected!=null&&(this.connection_selected.classList.remove("selected"),this.removeReouteConnectionSelected(),this.connection_selected=null),this.editor_selected=!0;break;case"main-path":this.node_selected!=null&&(this.node_selected.classList.remove("selected"),this.node_selected=null,this.dispatch("nodeUnselected",!0)),this.connection_selected!=null&&(this.connection_selected.classList.remove("selected"),this.removeReouteConnectionSelected(),this.connection_selected=null),this.connection_selected=this.ele_selected,this.connection_selected.classList.add("selected");const s=this.connection_selected.parentElement.classList;s.length>1&&(this.dispatch("connectionSelected",{output_id:s[2].slice(14),input_id:s[1].slice(13),output_class:s[3],input_class:s[4]}),this.reroute_fix_curvature&&this.connection_selected.parentElement.querySelectorAll(".main-path").forEach((e,o)=>{e.classList.add("selected")}));break;case"point":this.drag_point=!0,this.ele_selected.classList.add("selected");break;case"drawflow-delete":this.node_selected&&this.removeNodeId(this.node_selected.id),this.connection_selected&&this.removeConnection(),this.node_selected!=null&&(this.node_selected.classList.remove("selected"),this.node_selected=null,this.dispatch("nodeUnselected",!0)),this.connection_selected!=null&&(this.connection_selected.classList.remove("selected"),this.removeReouteConnectionSelected(),this.connection_selected=null)}t.type==="touchstart"?(this.pos_x=t.touches[0].clientX,this.pos_x_start=t.touches[0].clientX,this.pos_y=t.touches[0].clientY,this.pos_y_start=t.touches[0].clientY,this.mouse_x=t.touches[0].clientX,this.mouse_y=t.touches[0].clientY):(this.pos_x=t.clientX,this.pos_x_start=t.clientX,this.pos_y=t.clientY,this.pos_y_start=t.clientY),["input","output","main-path"].includes(this.ele_selected.classList[0])&&t.preventDefault(),this.dispatch("clickEnd",t)}position(t){if(t.type==="touchmove")var s=t.touches[0].clientX,e=t.touches[0].clientY;else s=t.clientX,e=t.clientY;if(this.connection&&this.updateConnection(s,e),this.editor_selected&&(o=this.canvas_x+-(this.pos_x-s),n=this.canvas_y+-(this.pos_y-e),this.dispatch("translate",{x:o,y:n}),this.precanvas.style.transform="translate("+o+"px, "+n+"px) scale("+this.zoom+")"),this.drag){t.preventDefault();var o=(this.pos_x-s)*this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom),n=(this.pos_y-e)*this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom);this.pos_x=s,this.pos_y=e,this.ele_selected.style.top=this.ele_selected.offsetTop-n+"px",this.ele_selected.style.left=this.ele_selected.offsetLeft-o+"px",this.drawflow.drawflow[this.module].data[this.ele_selected.id.slice(5)].pos_x=this.ele_selected.offsetLeft-o,this.drawflow.drawflow[this.module].data[this.ele_selected.id.slice(5)].pos_y=this.ele_selected.offsetTop-n,this.updateConnectionNodes(this.ele_selected.id)}if(this.drag_point){o=(this.pos_x-s)*this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom),n=(this.pos_y-e)*this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom),this.pos_x=s,this.pos_y=e;var c=this.pos_x*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom))-this.precanvas.getBoundingClientRect().x*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom)),d=this.pos_y*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom))-this.precanvas.getBoundingClientRect().y*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom));this.ele_selected.setAttributeNS(null,"cx",c),this.ele_selected.setAttributeNS(null,"cy",d);const _=this.ele_selected.parentElement.classList[2].slice(9),a=this.ele_selected.parentElement.classList[1].slice(13),i=this.ele_selected.parentElement.classList[3],r=this.ele_selected.parentElement.classList[4];let p=Array.from(this.ele_selected.parentElement.children).indexOf(this.ele_selected)-1;this.reroute_fix_curvature&&(p-=this.ele_selected.parentElement.querySelectorAll(".main-path").length-1,p<0&&(p=0));const l=_.slice(5),u=this.drawflow.drawflow[this.module].data[l].outputs[i].connections.findIndex(function(b,x){return b.node===a&&b.output===r});this.drawflow.drawflow[this.module].data[l].outputs[i].connections[u].points[p]={pos_x:c,pos_y:d};const m=this.ele_selected.parentElement.classList[2].slice(9);this.updateConnectionNodes(m)}t.type==="touchmove"&&(this.mouse_x=s,this.mouse_y=e),this.dispatch("mouseMove",{x:s,y:e})}dragEnd(t){if(t.type==="touchend")var s=this.mouse_x,e=this.mouse_y,o=document.elementFromPoint(s,e);else s=t.clientX,e=t.clientY,o=t.target;if(this.drag&&(this.pos_x_start==s&&this.pos_y_start==e||this.dispatch("nodeMoved",this.ele_selected.id.slice(5))),this.drag_point&&(this.ele_selected.classList.remove("selected"),this.pos_x_start==s&&this.pos_y_start==e||this.dispatch("rerouteMoved",this.ele_selected.parentElement.classList[2].slice(14))),this.editor_selected&&(this.canvas_x=this.canvas_x+-(this.pos_x-s),this.canvas_y=this.canvas_y+-(this.pos_y-e),this.editor_selected=!1),this.connection===!0)if(o.classList[0]==="input"||this.force_first_input&&(o.closest(".drawflow_content_node")!=null||o.classList[0]==="drawflow-node")){if(!this.force_first_input||o.closest(".drawflow_content_node")==null&&o.classList[0]!=="drawflow-node")n=o.parentElement.parentElement.id,c=o.classList[1];else{if(o.closest(".drawflow_content_node")!=null)var n=o.closest(".drawflow_content_node").parentElement.id;else var n=o.id;if(Object.keys(this.getNodeFromId(n.slice(5)).inputs).length===0)var c=!1;else var c="input_1"}var d=this.ele_selected.parentElement.parentElement.id,_=this.ele_selected.classList[1];if(d!==n&&c!==!1){if(this.container.querySelectorAll(".connection.node_in_"+n+".node_out_"+d+"."+_+"."+c).length===0){this.connection_ele.classList.add("node_in_"+n),this.connection_ele.classList.add("node_out_"+d),this.connection_ele.classList.add(_),this.connection_ele.classList.add(c);var a=n.slice(5),i=d.slice(5);this.drawflow.drawflow[this.module].data[i].outputs[_].connections.push({node:a,output:c}),this.drawflow.drawflow[this.module].data[a].inputs[c].connections.push({node:i,input:_}),this.updateConnectionNodes("node-"+i),this.updateConnectionNodes("node-"+a),this.dispatch("connectionCreated",{output_id:i,input_id:a,output_class:_,input_class:c})}else this.dispatch("connectionCancel",!0),this.connection_ele.remove();this.connection_ele=null}else this.dispatch("connectionCancel",!0),this.connection_ele.remove(),this.connection_ele=null}else this.dispatch("connectionCancel",!0),this.connection_ele.remove(),this.connection_ele=null;this.drag=!1,this.drag_point=!1,this.connection=!1,this.ele_selected=null,this.editor_selected=!1,this.dispatch("mouseUp",t)}contextmenu(t){if(this.dispatch("contextmenu",t),t.preventDefault(),this.editor_mode==="fixed"||this.editor_mode==="view")return!1;if(this.precanvas.getElementsByClassName("drawflow-delete").length&&this.precanvas.getElementsByClassName("drawflow-delete")[0].remove(),this.node_selected||this.connection_selected){var s=document.createElement("div");s.classList.add("drawflow-delete"),s.innerHTML="x",this.node_selected&&this.node_selected.appendChild(s),this.connection_selected&&this.connection_selected.parentElement.classList.length>1&&(s.style.top=t.clientY*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom))-this.precanvas.getBoundingClientRect().y*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom))+"px",s.style.left=t.clientX*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom))-this.precanvas.getBoundingClientRect().x*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom))+"px",this.precanvas.appendChild(s))}}contextmenuDel(){this.precanvas.getElementsByClassName("drawflow-delete").length&&this.precanvas.getElementsByClassName("drawflow-delete")[0].remove()}key(t){if(this.dispatch("keydown",t),this.editor_mode==="fixed"||this.editor_mode==="view")return!1;(t.key==="Delete"||t.key==="Backspace"&&t.metaKey)&&(this.node_selected!=null&&this.first_click.tagName!=="INPUT"&&this.first_click.tagName!=="TEXTAREA"&&this.first_click.hasAttribute("contenteditable")!==!0&&this.removeNodeId(this.node_selected.id),this.connection_selected!=null&&this.removeConnection())}zoom_enter(t,s){t.ctrlKey&&(t.preventDefault(),t.deltaY>0?this.zoom_out():this.zoom_in())}zoom_refresh(){this.dispatch("zoom",this.zoom),this.canvas_x=this.canvas_x/this.zoom_last_value*this.zoom,this.canvas_y=this.canvas_y/this.zoom_last_value*this.zoom,this.zoom_last_value=this.zoom,this.precanvas.style.transform="translate("+this.canvas_x+"px, "+this.canvas_y+"px) scale("+this.zoom+")"}zoom_in(){this.zoom<this.zoom_max&&(this.zoom+=this.zoom_value,this.zoom_refresh())}zoom_out(){this.zoom>this.zoom_min&&(this.zoom-=this.zoom_value,this.zoom_refresh())}zoom_reset(){this.zoom!=1&&(this.zoom=1,this.zoom_refresh())}createCurvature(t,s,e,o,n,c){var d=t,_=s,a=e,i=o,r=n;switch(c){case"open":if(t>=e)var p=d+Math.abs(a-d)*r,l=a-Math.abs(a-d)*(-1*r);else p=d+Math.abs(a-d)*r,l=a-Math.abs(a-d)*r;return" M "+d+" "+_+" C "+p+" "+_+" "+l+" "+i+" "+a+"  "+i;case"close":return t>=e?(p=d+Math.abs(a-d)*(-1*r),l=a-Math.abs(a-d)*r):(p=d+Math.abs(a-d)*r,l=a-Math.abs(a-d)*r)," M "+d+" "+_+" C "+p+" "+_+" "+l+" "+i+" "+a+"  "+i;case"other":return t>=e?(p=d+Math.abs(a-d)*(-1*r),l=a-Math.abs(a-d)*(-1*r)):(p=d+Math.abs(a-d)*r,l=a-Math.abs(a-d)*r)," M "+d+" "+_+" C "+p+" "+_+" "+l+" "+i+" "+a+"  "+i;default:return" M "+d+" "+_+" C "+(p=d+Math.abs(a-d)*r)+" "+_+" "+(l=a-Math.abs(a-d)*r)+" "+i+" "+a+"  "+i}}drawConnection(t){var s=document.createElementNS("http://www.w3.org/2000/svg","svg");this.connection_ele=s;var e=document.createElementNS("http://www.w3.org/2000/svg","path");e.classList.add("main-path"),e.setAttributeNS(null,"d",""),s.classList.add("connection"),s.appendChild(e),this.precanvas.appendChild(s);var o=t.parentElement.parentElement.id.slice(5),n=t.classList[1];this.dispatch("connectionStart",{output_id:o,output_class:n})}updateConnection(t,s){const e=this.precanvas,o=this.zoom;let n=e.clientWidth/(e.clientWidth*o);n=n||0;let c=e.clientHeight/(e.clientHeight*o);c=c||0;var d=this.connection_ele.children[0],_=this.ele_selected.offsetWidth/2+(this.ele_selected.getBoundingClientRect().x-e.getBoundingClientRect().x)*n,a=this.ele_selected.offsetHeight/2+(this.ele_selected.getBoundingClientRect().y-e.getBoundingClientRect().y)*c,i=t*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom))-this.precanvas.getBoundingClientRect().x*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom)),r=s*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom))-this.precanvas.getBoundingClientRect().y*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom)),p=this.curvature,l=this.createCurvature(_,a,i,r,p,"openclose");d.setAttributeNS(null,"d",l)}addConnection(t,s,e,o){var n=this.getModuleFromNodeId(t);if(n===this.getModuleFromNodeId(s)){var c=this.getNodeFromId(t),d=!1;for(var _ in c.outputs[e].connections){var a=c.outputs[e].connections[_];a.node==s&&a.output==o&&(d=!0)}if(d===!1){if(this.drawflow.drawflow[n].data[t].outputs[e].connections.push({node:s.toString(),output:o}),this.drawflow.drawflow[n].data[s].inputs[o].connections.push({node:t.toString(),input:e}),this.module===n){var i=document.createElementNS("http://www.w3.org/2000/svg","svg"),r=document.createElementNS("http://www.w3.org/2000/svg","path");r.classList.add("main-path"),r.setAttributeNS(null,"d",""),i.classList.add("connection"),i.classList.add("node_in_node-"+s),i.classList.add("node_out_node-"+t),i.classList.add(e),i.classList.add(o),i.appendChild(r),this.precanvas.appendChild(i),this.updateConnectionNodes("node-"+t),this.updateConnectionNodes("node-"+s)}this.dispatch("connectionCreated",{output_id:t,input_id:s,output_class:e,input_class:o})}}}updateConnectionNodes(t){const s="node_in_"+t,e="node_out_"+t;this.line_path;const o=this.container,n=this.precanvas,c=this.curvature,d=this.createCurvature,_=this.reroute_curvature,a=this.reroute_curvature_start_end,i=this.reroute_fix_curvature,r=this.reroute_width,p=this.zoom;let l=n.clientWidth/(n.clientWidth*p);l=l||0;let u=n.clientHeight/(n.clientHeight*p);u=u||0;const m=o.querySelectorAll("."+e);Object.keys(m).map(function(x,q){if(m[x].querySelector(".point")===null){var E=o.querySelector("#"+t),L=m[x].classList[1].replace("node_in_",""),X=o.querySelector("#"+L).querySelectorAll("."+m[x].classList[4])[0],J=X.offsetWidth/2+(X.getBoundingClientRect().x-n.getBoundingClientRect().x)*l,tt=X.offsetHeight/2+(X.getBoundingClientRect().y-n.getBoundingClientRect().y)*u,st=E.querySelectorAll("."+m[x].classList[3])[0],G=st.offsetWidth/2+(st.getBoundingClientRect().x-n.getBoundingClientRect().x)*l,V=st.offsetHeight/2+(st.getBoundingClientRect().y-n.getBoundingClientRect().y)*u;const F=d(G,V,J,tt,c,"openclose");m[x].children[0].setAttributeNS(null,"d",F)}else{const F=m[x].querySelectorAll(".point");let D="";const I=[];F.forEach((S,R)=>{if(R===0&&F.length-1==0){var A=o.querySelector("#"+t),T=((P=S).getBoundingClientRect().x-n.getBoundingClientRect().x)*l+r,j=(P.getBoundingClientRect().y-n.getBoundingClientRect().y)*u+r,O=(U=A.querySelectorAll("."+S.parentElement.classList[3])[0]).offsetWidth/2+(U.getBoundingClientRect().x-n.getBoundingClientRect().x)*l,N=U.offsetHeight/2+(U.getBoundingClientRect().y-n.getBoundingClientRect().y)*u,W=d(O,N,T,j,a,"open");D+=W,I.push(W),A=S;var K=S.parentElement.classList[1].replace("node_in_",""),P=(Y=o.querySelector("#"+K)).querySelectorAll("."+S.parentElement.classList[4])[0];T=(it=Y.querySelectorAll("."+S.parentElement.classList[4])[0]).offsetWidth/2+(it.getBoundingClientRect().x-n.getBoundingClientRect().x)*l,j=it.offsetHeight/2+(it.getBoundingClientRect().y-n.getBoundingClientRect().y)*u,O=(A.getBoundingClientRect().x-n.getBoundingClientRect().x)*l+r,N=(A.getBoundingClientRect().y-n.getBoundingClientRect().y)*u+r,W=d(O,N,T,j,a,"close"),D+=W,I.push(W)}else if(R===0){var U;A=o.querySelector("#"+t),T=((P=S).getBoundingClientRect().x-n.getBoundingClientRect().x)*l+r,j=(P.getBoundingClientRect().y-n.getBoundingClientRect().y)*u+r,O=(U=A.querySelectorAll("."+S.parentElement.classList[3])[0]).offsetWidth/2+(U.getBoundingClientRect().x-n.getBoundingClientRect().x)*l,N=U.offsetHeight/2+(U.getBoundingClientRect().y-n.getBoundingClientRect().y)*u,W=d(O,N,T,j,a,"open"),D+=W,I.push(W),A=S,T=((P=F[R+1]).getBoundingClientRect().x-n.getBoundingClientRect().x)*l+r,j=(P.getBoundingClientRect().y-n.getBoundingClientRect().y)*u+r,O=(A.getBoundingClientRect().x-n.getBoundingClientRect().x)*l+r,N=(A.getBoundingClientRect().y-n.getBoundingClientRect().y)*u+r,W=d(O,N,T,j,_,"other"),D+=W,I.push(W)}else if(R===F.length-1){var Y,it;A=S,K=S.parentElement.classList[1].replace("node_in_",""),P=(Y=o.querySelector("#"+K)).querySelectorAll("."+S.parentElement.classList[4])[0],T=(it=Y.querySelectorAll("."+S.parentElement.classList[4])[0]).offsetWidth/2+(it.getBoundingClientRect().x-n.getBoundingClientRect().x)*l,j=it.offsetHeight/2+(it.getBoundingClientRect().y-n.getBoundingClientRect().y)*u,O=(A.getBoundingClientRect().x-n.getBoundingClientRect().x)*(n.clientWidth/(n.clientWidth*p))+r,N=(A.getBoundingClientRect().y-n.getBoundingClientRect().y)*(n.clientHeight/(n.clientHeight*p))+r,W=d(O,N,T,j,a,"close"),D+=W,I.push(W)}else A=S,T=((P=F[R+1]).getBoundingClientRect().x-n.getBoundingClientRect().x)*(n.clientWidth/(n.clientWidth*p))+r,j=(P.getBoundingClientRect().y-n.getBoundingClientRect().y)*(n.clientHeight/(n.clientHeight*p))+r,O=(A.getBoundingClientRect().x-n.getBoundingClientRect().x)*(n.clientWidth/(n.clientWidth*p))+r,N=(A.getBoundingClientRect().y-n.getBoundingClientRect().y)*(n.clientHeight/(n.clientHeight*p))+r,W=d(O,N,T,j,_,"other"),D+=W,I.push(W)}),i?I.forEach((S,R)=>{m[x].children[R].setAttributeNS(null,"d",S)}):m[x].children[0].setAttributeNS(null,"d",D)}});const b=o.querySelectorAll("."+s);Object.keys(b).map(function(x,q){if(b[x].querySelector(".point")===null){var E=o.querySelector("#"+t),L=b[x].classList[2].replace("node_out_",""),X=o.querySelector("#"+L).querySelectorAll("."+b[x].classList[3])[0],J=X.offsetWidth/2+(X.getBoundingClientRect().x-n.getBoundingClientRect().x)*l,tt=X.offsetHeight/2+(X.getBoundingClientRect().y-n.getBoundingClientRect().y)*u,st=(E=E.querySelectorAll("."+b[x].classList[4])[0]).offsetWidth/2+(E.getBoundingClientRect().x-n.getBoundingClientRect().x)*l,G=E.offsetHeight/2+(E.getBoundingClientRect().y-n.getBoundingClientRect().y)*u;const V=d(J,tt,st,G,c,"openclose");b[x].children[0].setAttributeNS(null,"d",V)}else{const V=b[x].querySelectorAll(".point");let F="";const D=[];V.forEach((I,S)=>{if(S===0&&V.length-1==0){var R=o.querySelector("#"+t),A=((K=I).getBoundingClientRect().x-n.getBoundingClientRect().x)*l+r,T=(K.getBoundingClientRect().y-n.getBoundingClientRect().y)*u+r,j=(Y=R.querySelectorAll("."+I.parentElement.classList[4])[0]).offsetWidth/2+(Y.getBoundingClientRect().x-n.getBoundingClientRect().x)*l,O=Y.offsetHeight/2+(Y.getBoundingClientRect().y-n.getBoundingClientRect().y)*u,N=d(A,T,j,O,a,"close");F+=N,D.push(N),R=I;var W=I.parentElement.classList[2].replace("node_out_",""),K=(U=o.querySelector("#"+W)).querySelectorAll("."+I.parentElement.classList[3])[0];A=(P=U.querySelectorAll("."+I.parentElement.classList[3])[0]).offsetWidth/2+(P.getBoundingClientRect().x-n.getBoundingClientRect().x)*l,T=P.offsetHeight/2+(P.getBoundingClientRect().y-n.getBoundingClientRect().y)*u,j=(R.getBoundingClientRect().x-n.getBoundingClientRect().x)*l+r,O=(R.getBoundingClientRect().y-n.getBoundingClientRect().y)*u+r,N=d(A,T,j,O,a,"open"),F+=N,D.push(N)}else if(S===0){var P;R=I,W=I.parentElement.classList[2].replace("node_out_",""),K=(U=o.querySelector("#"+W)).querySelectorAll("."+I.parentElement.classList[3])[0],A=(P=U.querySelectorAll("."+I.parentElement.classList[3])[0]).offsetWidth/2+(P.getBoundingClientRect().x-n.getBoundingClientRect().x)*l,T=P.offsetHeight/2+(P.getBoundingClientRect().y-n.getBoundingClientRect().y)*u,j=(R.getBoundingClientRect().x-n.getBoundingClientRect().x)*l+r,O=(R.getBoundingClientRect().y-n.getBoundingClientRect().y)*u+r,N=d(A,T,j,O,a,"open"),F+=N,D.push(N),R=I,j=((K=V[S+1]).getBoundingClientRect().x-n.getBoundingClientRect().x)*l+r,O=(K.getBoundingClientRect().y-n.getBoundingClientRect().y)*u+r,A=(R.getBoundingClientRect().x-n.getBoundingClientRect().x)*l+r,T=(R.getBoundingClientRect().y-n.getBoundingClientRect().y)*u+r,N=d(A,T,j,O,_,"other"),F+=N,D.push(N)}else if(S===V.length-1){var U,Y;R=I,W=I.parentElement.classList[1].replace("node_in_",""),K=(U=o.querySelector("#"+W)).querySelectorAll("."+I.parentElement.classList[4])[0],j=(Y=U.querySelectorAll("."+I.parentElement.classList[4])[0]).offsetWidth/2+(Y.getBoundingClientRect().x-n.getBoundingClientRect().x)*l,O=Y.offsetHeight/2+(Y.getBoundingClientRect().y-n.getBoundingClientRect().y)*u,A=(R.getBoundingClientRect().x-n.getBoundingClientRect().x)*l+r,T=(R.getBoundingClientRect().y-n.getBoundingClientRect().y)*u+r,N=d(A,T,j,O,a,"close"),F+=N,D.push(N)}else R=I,j=((K=V[S+1]).getBoundingClientRect().x-n.getBoundingClientRect().x)*l+r,O=(K.getBoundingClientRect().y-n.getBoundingClientRect().y)*u+r,A=(R.getBoundingClientRect().x-n.getBoundingClientRect().x)*l+r,T=(R.getBoundingClientRect().y-n.getBoundingClientRect().y)*u+r,N=d(A,T,j,O,_,"other"),F+=N,D.push(N)}),i?D.forEach((I,S)=>{b[x].children[S].setAttributeNS(null,"d",I)}):b[x].children[0].setAttributeNS(null,"d",F)}})}dblclick(t){this.connection_selected!=null&&this.reroute&&this.createReroutePoint(this.connection_selected),t.target.classList[0]==="point"&&this.removeReroutePoint(t.target)}createReroutePoint(t){this.connection_selected.classList.remove("selected");const s=this.connection_selected.parentElement.classList[2].slice(9),e=this.connection_selected.parentElement.classList[1].slice(13),o=this.connection_selected.parentElement.classList[3],n=this.connection_selected.parentElement.classList[4];this.connection_selected=null;const c=document.createElementNS("http://www.w3.org/2000/svg","circle");c.classList.add("point");var d=this.pos_x*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom))-this.precanvas.getBoundingClientRect().x*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom)),_=this.pos_y*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom))-this.precanvas.getBoundingClientRect().y*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom));c.setAttributeNS(null,"cx",d),c.setAttributeNS(null,"cy",_),c.setAttributeNS(null,"r",this.reroute_width);let a=0;if(this.reroute_fix_curvature){const l=t.parentElement.querySelectorAll(".main-path").length;var i=document.createElementNS("http://www.w3.org/2000/svg","path");if(i.classList.add("main-path"),i.setAttributeNS(null,"d",""),t.parentElement.insertBefore(i,t.parentElement.children[l]),l===1)t.parentElement.appendChild(c);else{const u=Array.from(t.parentElement.children).indexOf(t);a=u,t.parentElement.insertBefore(c,t.parentElement.children[u+l+1])}}else t.parentElement.appendChild(c);const r=s.slice(5),p=this.drawflow.drawflow[this.module].data[r].outputs[o].connections.findIndex(function(l,u){return l.node===e&&l.output===n});this.drawflow.drawflow[this.module].data[r].outputs[o].connections[p].points===void 0&&(this.drawflow.drawflow[this.module].data[r].outputs[o].connections[p].points=[]),this.reroute_fix_curvature?(a>0||this.drawflow.drawflow[this.module].data[r].outputs[o].connections[p].points!==[]?this.drawflow.drawflow[this.module].data[r].outputs[o].connections[p].points.splice(a,0,{pos_x:d,pos_y:_}):this.drawflow.drawflow[this.module].data[r].outputs[o].connections[p].points.push({pos_x:d,pos_y:_}),t.parentElement.querySelectorAll(".main-path").forEach((l,u)=>{l.classList.remove("selected")})):this.drawflow.drawflow[this.module].data[r].outputs[o].connections[p].points.push({pos_x:d,pos_y:_}),this.dispatch("addReroute",r),this.updateConnectionNodes(s)}removeReroutePoint(t){const s=t.parentElement.classList[2].slice(9),e=t.parentElement.classList[1].slice(13),o=t.parentElement.classList[3],n=t.parentElement.classList[4];let c=Array.from(t.parentElement.children).indexOf(t);const d=s.slice(5),_=this.drawflow.drawflow[this.module].data[d].outputs[o].connections.findIndex(function(a,i){return a.node===e&&a.output===n});if(this.reroute_fix_curvature){const a=t.parentElement.querySelectorAll(".main-path").length;t.parentElement.children[a-1].remove(),c-=a,c<0&&(c=0)}else c--;this.drawflow.drawflow[this.module].data[d].outputs[o].connections[_].points.splice(c,1),t.remove(),this.dispatch("removeReroute",d),this.updateConnectionNodes(s)}registerNode(t,s,e=null,o=null){this.noderegister[t]={html:s,props:e,options:o}}getNodeFromId(t){var s=this.getModuleFromNodeId(t);return JSON.parse(JSON.stringify(this.drawflow.drawflow[s].data[t]))}getNodesFromName(t){var s=[];const e=this.drawflow.drawflow;return Object.keys(e).map(function(o,n){for(var c in e[o].data)e[o].data[c].name==t&&s.push(e[o].data[c].id)}),s}addNode(t,s,e,o,n,c,d,_,a=!1){if(this.useuuid)var i=this.getUuid();else i=this.nodeId;const r=document.createElement("div");r.classList.add("parent-node");const p=document.createElement("div");p.innerHTML="",p.setAttribute("id","node-"+i),p.classList.add("drawflow-node"),c!=""&&p.classList.add(...c.split(" "));const l=document.createElement("div");l.classList.add("inputs");const u=document.createElement("div");u.classList.add("outputs");const m={};for(var b=0;b<s;b++){const L=document.createElement("div");L.classList.add("input"),L.classList.add("input_"+(b+1)),m["input_"+(b+1)]={connections:[]},l.appendChild(L)}const x={};for(b=0;b<e;b++){const L=document.createElement("div");L.classList.add("output"),L.classList.add("output_"+(b+1)),x["output_"+(b+1)]={connections:[]},u.appendChild(L)}const q=document.createElement("div");if(q.classList.add("drawflow_content_node"),a===!1)q.innerHTML=_;else if(a===!0)q.appendChild(this.noderegister[_].html.cloneNode(!0));else if(parseInt(this.render.version)===3){let L=this.render.h(this.noderegister[_].html,this.noderegister[_].props,this.noderegister[_].options);L.appContext=this.parent,this.render.render(L,q)}else{let L=new this.render({parent:this.parent,render:X=>X(this.noderegister[_].html,{props:this.noderegister[_].props}),...this.noderegister[_].options}).$mount();q.appendChild(L.$el)}Object.entries(d).forEach(function(L,X){if(typeof L[1]=="object")(function st(G,V,F){G===null?G=d[V]:G=G[V],G!==null&&Object.entries(G).forEach(function(D,I){if(typeof D[1]=="object")st(G,D[0],F+"-"+D[0]);else for(var S=q.querySelectorAll("[df-"+F+"-"+D[0]+"]"),R=0;R<S.length;R++)S[R].value=D[1],S[R].isContentEditable&&(S[R].innerText=D[1])})})(null,L[0],L[0]);else for(var J=q.querySelectorAll("[df-"+L[0]+"]"),tt=0;tt<J.length;tt++)J[tt].value=L[1],J[tt].isContentEditable&&(J[tt].innerText=L[1])}),p.appendChild(l),p.appendChild(q),p.appendChild(u),p.style.top=n+"px",p.style.left=o+"px",r.appendChild(p),this.precanvas.appendChild(r);var E={id:i,name:t,data:d,class:c,html:_,typenode:a,inputs:m,outputs:x,pos_x:o,pos_y:n};return this.drawflow.drawflow[this.module].data[i]=E,this.dispatch("nodeCreated",i),this.useuuid||this.nodeId++,i}addNodeImport(t,s){const e=document.createElement("div");e.classList.add("parent-node");const o=document.createElement("div");o.innerHTML="",o.setAttribute("id","node-"+t.id),o.classList.add("drawflow-node"),t.class!=""&&o.classList.add(...t.class.split(" "));const n=document.createElement("div");n.classList.add("inputs");const c=document.createElement("div");c.classList.add("outputs"),Object.keys(t.inputs).map(function(a,i){const r=document.createElement("div");r.classList.add("input"),r.classList.add(a),n.appendChild(r),Object.keys(t.inputs[a].connections).map(function(p,l){var u=document.createElementNS("http://www.w3.org/2000/svg","svg"),m=document.createElementNS("http://www.w3.org/2000/svg","path");m.classList.add("main-path"),m.setAttributeNS(null,"d",""),u.classList.add("connection"),u.classList.add("node_in_node-"+t.id),u.classList.add("node_out_node-"+t.inputs[a].connections[p].node),u.classList.add(t.inputs[a].connections[p].input),u.classList.add(a),u.appendChild(m),s.appendChild(u)})});for(var d=0;d<Object.keys(t.outputs).length;d++){const a=document.createElement("div");a.classList.add("output"),a.classList.add("output_"+(d+1)),c.appendChild(a)}const _=document.createElement("div");if(_.classList.add("drawflow_content_node"),t.typenode===!1)_.innerHTML=t.html;else if(t.typenode===!0)_.appendChild(this.noderegister[t.html].html.cloneNode(!0));else if(parseInt(this.render.version)===3){let a=this.render.h(this.noderegister[t.html].html,this.noderegister[t.html].props,this.noderegister[t.html].options);a.appContext=this.parent,this.render.render(a,_)}else{let a=new this.render({parent:this.parent,render:i=>i(this.noderegister[t.html].html,{props:this.noderegister[t.html].props}),...this.noderegister[t.html].options}).$mount();_.appendChild(a.$el)}Object.entries(t.data).forEach(function(a,i){if(typeof a[1]=="object")(function l(u,m,b){u===null?u=t.data[m]:u=u[m],u!==null&&Object.entries(u).forEach(function(x,q){if(typeof x[1]=="object")l(u,x[0],b+"-"+x[0]);else for(var E=_.querySelectorAll("[df-"+b+"-"+x[0]+"]"),L=0;L<E.length;L++)E[L].value=x[1],E[L].isContentEditable&&(E[L].innerText=x[1])})})(null,a[0],a[0]);else for(var r=_.querySelectorAll("[df-"+a[0]+"]"),p=0;p<r.length;p++)r[p].value=a[1],r[p].isContentEditable&&(r[p].innerText=a[1])}),o.appendChild(n),o.appendChild(_),o.appendChild(c),o.style.top=t.pos_y+"px",o.style.left=t.pos_x+"px",e.appendChild(o),this.precanvas.appendChild(e)}addRerouteImport(t){const s=this.reroute_width,e=this.reroute_fix_curvature,o=this.container;Object.keys(t.outputs).map(function(n,c){Object.keys(t.outputs[n].connections).map(function(d,_){const a=t.outputs[n].connections[d].points;a!==void 0&&a.forEach((i,r)=>{const p=t.outputs[n].connections[d].node,l=t.outputs[n].connections[d].output,u=o.querySelector(".connection.node_in_node-"+p+".node_out_node-"+t.id+"."+n+"."+l);if(e&&r===0)for(var m=0;m<a.length;m++){var b=document.createElementNS("http://www.w3.org/2000/svg","path");b.classList.add("main-path"),b.setAttributeNS(null,"d",""),u.appendChild(b)}const x=document.createElementNS("http://www.w3.org/2000/svg","circle");x.classList.add("point");var q=i.pos_x,E=i.pos_y;x.setAttributeNS(null,"cx",q),x.setAttributeNS(null,"cy",E),x.setAttributeNS(null,"r",s),u.appendChild(x)})})})}updateNodeValue(t){for(var s=t.target.attributes,e=0;e<s.length;e++)if(s[e].nodeName.startsWith("df-")){for(var o=s[e].nodeName.slice(3).split("-"),n=this.drawflow.drawflow[this.module].data[t.target.closest(".drawflow_content_node").parentElement.id.slice(5)].data,c=0;c<o.length-1;c+=1)n[o[c]]==null&&(n[o[c]]={}),n=n[o[c]];n[o[o.length-1]]=t.target.value,t.target.isContentEditable&&(n[o[o.length-1]]=t.target.innerText),this.dispatch("nodeDataChanged",t.target.closest(".drawflow_content_node").parentElement.id.slice(5))}}updateNodeDataFromId(t,s){var e=this.getModuleFromNodeId(t);if(this.drawflow.drawflow[e].data[t].data=s,this.module===e){const o=this.container.querySelector("#node-"+t);Object.entries(s).forEach(function(n,c){if(typeof n[1]=="object")(function a(i,r,p){i===null?i=s[r]:i=i[r],i!==null&&Object.entries(i).forEach(function(l,u){if(typeof l[1]=="object")a(i,l[0],p+"-"+l[0]);else for(var m=o.querySelectorAll("[df-"+p+"-"+l[0]+"]"),b=0;b<m.length;b++)m[b].value=l[1],m[b].isContentEditable&&(m[b].innerText=l[1])})})(null,n[0],n[0]);else for(var d=o.querySelectorAll("[df-"+n[0]+"]"),_=0;_<d.length;_++)d[_].value=n[1],d[_].isContentEditable&&(d[_].innerText=n[1])})}}addNodeInput(t){var s=this.getModuleFromNodeId(t);const e=this.getNodeFromId(t),o=Object.keys(e.inputs).length;if(this.module===s){const n=document.createElement("div");n.classList.add("input"),n.classList.add("input_"+(o+1)),this.container.querySelector("#node-"+t+" .inputs").appendChild(n),this.updateConnectionNodes("node-"+t)}this.drawflow.drawflow[s].data[t].inputs["input_"+(o+1)]={connections:[]}}addNodeOutput(t){var s=this.getModuleFromNodeId(t);const e=this.getNodeFromId(t),o=Object.keys(e.outputs).length;if(this.module===s){const n=document.createElement("div");n.classList.add("output"),n.classList.add("output_"+(o+1)),this.container.querySelector("#node-"+t+" .outputs").appendChild(n),this.updateConnectionNodes("node-"+t)}this.drawflow.drawflow[s].data[t].outputs["output_"+(o+1)]={connections:[]}}removeNodeInput(t,s){var e=this.getModuleFromNodeId(t);const o=this.getNodeFromId(t);this.module===e&&this.container.querySelector("#node-"+t+" .inputs .input."+s).remove();const n=[];Object.keys(o.inputs[s].connections).map(function(i,r){const p=o.inputs[s].connections[r].node,l=o.inputs[s].connections[r].input;n.push({id_output:p,id:t,output_class:l,input_class:s})}),n.forEach((i,r)=>{this.removeSingleConnection(i.id_output,i.id,i.output_class,i.input_class)}),delete this.drawflow.drawflow[e].data[t].inputs[s];const c=[],d=this.drawflow.drawflow[e].data[t].inputs;Object.keys(d).map(function(i,r){c.push(d[i])}),this.drawflow.drawflow[e].data[t].inputs={};const _=s.slice(6);let a=[];c.forEach((i,r)=>{i.connections.forEach((p,l)=>{a.push(p)}),this.drawflow.drawflow[e].data[t].inputs["input_"+(r+1)]=i}),a=new Set(a.map(i=>JSON.stringify(i))),a=Array.from(a).map(i=>JSON.parse(i)),this.module===e&&this.container.querySelectorAll("#node-"+t+" .inputs .input").forEach((i,r)=>{const p=i.classList[1].slice(6);parseInt(_)<parseInt(p)&&(i.classList.remove("input_"+p),i.classList.add("input_"+(p-1)))}),a.forEach((i,r)=>{this.drawflow.drawflow[e].data[i.node].outputs[i.input].connections.forEach((p,l)=>{if(p.node==t){const u=p.output.slice(6);if(parseInt(_)<parseInt(u)){if(this.module===e){const m=this.container.querySelector(".connection.node_in_node-"+t+".node_out_node-"+i.node+"."+i.input+".input_"+u);m.classList.remove("input_"+u),m.classList.add("input_"+(u-1))}p.points?this.drawflow.drawflow[e].data[i.node].outputs[i.input].connections[l]={node:p.node,output:"input_"+(u-1),points:p.points}:this.drawflow.drawflow[e].data[i.node].outputs[i.input].connections[l]={node:p.node,output:"input_"+(u-1)}}}})}),this.updateConnectionNodes("node-"+t)}removeNodeOutput(t,s){var e=this.getModuleFromNodeId(t);const o=this.getNodeFromId(t);this.module===e&&this.container.querySelector("#node-"+t+" .outputs .output."+s).remove();const n=[];Object.keys(o.outputs[s].connections).map(function(i,r){const p=o.outputs[s].connections[r].node,l=o.outputs[s].connections[r].output;n.push({id:t,id_input:p,output_class:s,input_class:l})}),n.forEach((i,r)=>{this.removeSingleConnection(i.id,i.id_input,i.output_class,i.input_class)}),delete this.drawflow.drawflow[e].data[t].outputs[s];const c=[],d=this.drawflow.drawflow[e].data[t].outputs;Object.keys(d).map(function(i,r){c.push(d[i])}),this.drawflow.drawflow[e].data[t].outputs={};const _=s.slice(7);let a=[];c.forEach((i,r)=>{i.connections.forEach((p,l)=>{a.push({node:p.node,output:p.output})}),this.drawflow.drawflow[e].data[t].outputs["output_"+(r+1)]=i}),a=new Set(a.map(i=>JSON.stringify(i))),a=Array.from(a).map(i=>JSON.parse(i)),this.module===e&&this.container.querySelectorAll("#node-"+t+" .outputs .output").forEach((i,r)=>{const p=i.classList[1].slice(7);parseInt(_)<parseInt(p)&&(i.classList.remove("output_"+p),i.classList.add("output_"+(p-1)))}),a.forEach((i,r)=>{this.drawflow.drawflow[e].data[i.node].inputs[i.output].connections.forEach((p,l)=>{if(p.node==t){const u=p.input.slice(7);if(parseInt(_)<parseInt(u)){if(this.module===e){const m=this.container.querySelector(".connection.node_in_node-"+i.node+".node_out_node-"+t+".output_"+u+"."+i.output);m.classList.remove("output_"+u),m.classList.remove(i.output),m.classList.add("output_"+(u-1)),m.classList.add(i.output)}p.points?this.drawflow.drawflow[e].data[i.node].inputs[i.output].connections[l]={node:p.node,input:"output_"+(u-1),points:p.points}:this.drawflow.drawflow[e].data[i.node].inputs[i.output].connections[l]={node:p.node,input:"output_"+(u-1)}}}})}),this.updateConnectionNodes("node-"+t)}removeNodeId(t){this.removeConnectionNodeId(t);var s=this.getModuleFromNodeId(t.slice(5));this.module===s&&this.container.querySelector("#"+t).remove(),delete this.drawflow.drawflow[s].data[t.slice(5)],this.dispatch("nodeRemoved",t.slice(5))}removeConnection(){if(this.connection_selected!=null){var t=this.connection_selected.parentElement.classList;this.connection_selected.parentElement.remove();var s=this.drawflow.drawflow[this.module].data[t[2].slice(14)].outputs[t[3]].connections.findIndex(function(o,n){return o.node===t[1].slice(13)&&o.output===t[4]});this.drawflow.drawflow[this.module].data[t[2].slice(14)].outputs[t[3]].connections.splice(s,1);var e=this.drawflow.drawflow[this.module].data[t[1].slice(13)].inputs[t[4]].connections.findIndex(function(o,n){return o.node===t[2].slice(14)&&o.input===t[3]});this.drawflow.drawflow[this.module].data[t[1].slice(13)].inputs[t[4]].connections.splice(e,1),this.dispatch("connectionRemoved",{output_id:t[2].slice(14),input_id:t[1].slice(13),output_class:t[3],input_class:t[4]}),this.connection_selected=null}}removeSingleConnection(t,s,e,o){var n=this.getModuleFromNodeId(t);if(n===this.getModuleFromNodeId(s)){if(this.drawflow.drawflow[n].data[t].outputs[e].connections.findIndex(function(_,a){return _.node==s&&_.output===o})>-1){this.module===n&&this.container.querySelector(".connection.node_in_node-"+s+".node_out_node-"+t+"."+e+"."+o).remove();var c=this.drawflow.drawflow[n].data[t].outputs[e].connections.findIndex(function(_,a){return _.node==s&&_.output===o});this.drawflow.drawflow[n].data[t].outputs[e].connections.splice(c,1);var d=this.drawflow.drawflow[n].data[s].inputs[o].connections.findIndex(function(_,a){return _.node==t&&_.input===e});return this.drawflow.drawflow[n].data[s].inputs[o].connections.splice(d,1),this.dispatch("connectionRemoved",{output_id:t,input_id:s,output_class:e,input_class:o}),!0}return!1}return!1}removeConnectionNodeId(t){const s="node_in_"+t,e="node_out_"+t,o=this.container.querySelectorAll("."+e);for(var n=o.length-1;n>=0;n--){var c=o[n].classList,d=this.drawflow.drawflow[this.module].data[c[1].slice(13)].inputs[c[4]].connections.findIndex(function(i,r){return i.node===c[2].slice(14)&&i.input===c[3]});this.drawflow.drawflow[this.module].data[c[1].slice(13)].inputs[c[4]].connections.splice(d,1);var _=this.drawflow.drawflow[this.module].data[c[2].slice(14)].outputs[c[3]].connections.findIndex(function(i,r){return i.node===c[1].slice(13)&&i.output===c[4]});this.drawflow.drawflow[this.module].data[c[2].slice(14)].outputs[c[3]].connections.splice(_,1),o[n].remove(),this.dispatch("connectionRemoved",{output_id:c[2].slice(14),input_id:c[1].slice(13),output_class:c[3],input_class:c[4]})}const a=this.container.querySelectorAll("."+s);for(n=a.length-1;n>=0;n--)c=a[n].classList,_=this.drawflow.drawflow[this.module].data[c[2].slice(14)].outputs[c[3]].connections.findIndex(function(i,r){return i.node===c[1].slice(13)&&i.output===c[4]}),this.drawflow.drawflow[this.module].data[c[2].slice(14)].outputs[c[3]].connections.splice(_,1),d=this.drawflow.drawflow[this.module].data[c[1].slice(13)].inputs[c[4]].connections.findIndex(function(i,r){return i.node===c[2].slice(14)&&i.input===c[3]}),this.drawflow.drawflow[this.module].data[c[1].slice(13)].inputs[c[4]].connections.splice(d,1),a[n].remove(),this.dispatch("connectionRemoved",{output_id:c[2].slice(14),input_id:c[1].slice(13),output_class:c[3],input_class:c[4]})}getModuleFromNodeId(t){var s;const e=this.drawflow.drawflow;return Object.keys(e).map(function(o,n){Object.keys(e[o].data).map(function(c,d){c==t&&(s=o)})}),s}addModule(t){this.drawflow.drawflow[t]={data:{}},this.dispatch("moduleCreated",t)}changeModule(t){this.dispatch("moduleChanged",t),this.module=t,this.precanvas.innerHTML="",this.canvas_x=0,this.canvas_y=0,this.pos_x=0,this.pos_y=0,this.mouse_x=0,this.mouse_y=0,this.zoom=1,this.zoom_last_value=1,this.precanvas.style.transform="",this.import(this.drawflow,!1)}removeModule(t){this.module===t&&this.changeModule("Home"),delete this.drawflow.drawflow[t],this.dispatch("moduleRemoved",t)}clearModuleSelected(){this.precanvas.innerHTML="",this.drawflow.drawflow[this.module]={data:{}}}clear(){this.precanvas.innerHTML="",this.drawflow={drawflow:{Home:{data:{}}}}}export(){const t=JSON.parse(JSON.stringify(this.drawflow));return this.dispatch("export",t),t}import(t,s=!0){this.clear(),this.drawflow=JSON.parse(JSON.stringify(t)),this.load(),s&&this.dispatch("import","import")}on(t,s){return typeof s!="function"?(console.error("The listener callback must be a function, the given type is "+typeof s),!1):typeof t!="string"?(console.error("The event name must be a string, the given type is "+typeof t),!1):(this.events[t]===void 0&&(this.events[t]={listeners:[]}),void this.events[t].listeners.push(s))}removeListener(t,s){if(!this.events[t])return!1;const e=this.events[t].listeners,o=e.indexOf(s);o>-1&&e.splice(o,1)}dispatch(t,s){if(this.events[t]===void 0)return!1;this.events[t].listeners.forEach(e=>{e(s)})}getUuid(){for(var t=[],s=0;s<36;s++)t[s]="0123456789abcdef".substr(Math.floor(16*Math.random()),1);return t[14]="4",t[19]="0123456789abcdef".substr(3&t[19]|8,1),t[8]=t[13]=t[18]=t[23]="-",t.join("")}}}]).default})})(qt);var Vt=qt.exports;const Kt=Ft(Vt);function Gt(C){let h;return{c(){h=M("div"),this.h()},l(v){h=H(v,"DIV",{class:!0}),$(h).forEach(B),this.h()},h(){k(h,"class","parent-drawflow h-100 my-editor svelte-1jjj000")},m(v,g){Z(v,h,g),C[1](h)},p:at,i:at,o:at,d(v){v&&B(h),C[1](null)}}}function Qt(C,h,v){let g;rt(C,mt,e=>v(3,g=e));let y,f,w=new Map,t=e=>{if(f)if(f.clear(),e.starts&&e.starts.length>0){if(console.log("drawing"),g!==void 0){console.log("using cache"),f.import(g),Object.values(e.map).map(n=>{if(n.drawId!==void 0){let c=f.getNodeFromId(n.drawId);w.set(n.id,{x:c.pos_x,y:c.pos_y})}});return}let o=Math.max(...e.ends.map(n=>e.map[n].earlyCol));for(let n=1;n<o+1;n++){let c=Object.keys(e.map).filter(d=>e.map[d].earlyCol==n);c.sort((d,_)=>e.map[d].slack>e.map[_].slack);for(let d=0;d<c.length;d++){let _=c[d],a=e.map[_],i="normal",r="bg-darkBlue";a.slack===0&&(i="critical",r="bg-darkSteel"),a.progress>="100"&&(r="bg-emerald");let p=`
						<div class="heading `+r+'">'+a.name+`</div>
						<table style="width:99.9%;">
							<tr><th class="text-left third">Start</th><th>Duration</th><th class="text-right third">Finish</th></tr>
							<tr><td>`+a.es+'</td><td class="text-center va-middle" rowspan=2>'+a.expected+'</td><td class="text-right">'+a.ef+`</td></tr>
							<tr><td>`+a.ls+'</td><td class="text-right">'+a.lf+`</td></tr>
						</table>
						<hr/>
						<table style="width:99.9%;">
							<tr><th class="text-left third">Min</th><th>Likely</th><th class="text-right third">Max</th></tr>
							<tr><td>`+a.min+'</td><td class="text-center">'+a.likely+'</td><td class="text-right">'+a.max+`</td></tr>
						</table>
					`,l=w.get(a.id);l===void 0&&(l={x:20+400*(n-1),y:20+200*d});let u=40,m={x:l.x<0?-1:1,y:l.y<0?-1:1};l.x+=u/2*m.x,l.x-=Math.abs(l.x)%u*m.x,l.y+=u/2*m.y,l.y-=Math.abs(l.y)%u*m.y;let b=f.addNode(a.name,1,1,l.x,l.y,i,e.map[_],p);w.set(a.id,l),e.map[_].drawId=b,e.map[_].predecessors.map(x=>{let q=e.map[x].drawId;if(f.addConnection(q,b,"output_1","input_1"),e.map[x].slack===0&&e.map[_].slack===0){let E=document.getElementsByClassName("connection node_in_node-"+b+" node_out_node-"+q);E.length>0&&E[0].classList.add("critical")}})}}console.log("exporting to cache"),bt(mt,g=f.export(),g)}else console.log("dont draw yet")};Tt(()=>{f=new Kt(y),f.draggable_inputs=!1,f.zoom_min=.2,f.start(),Xt.subscribe(e=>{setTimeout(()=>t(e),100)}),Pt.subscribe(e=>{e>0?f.zoom_in():e<0&&f.zoom_out()}),f.on("nodeMoved",function(e){bt(mt,g=f.export(),g);let o=f.getNodeFromId(e);w.set(o.data.id,{x:o.pos_x,y:o.pos_y})})});function s(e){jt[e?"unshift":"push"](()=>{y=e,v(0,y)})}return[y,s]}class Zt extends vt{constructor(h){super(),yt(this,h,Qt,Gt,wt,{})}}function Et(C,h,v){const g=C.slice();return g[9]=h[v],g[10]=h,g[11]=v,g}function Lt(C,h,v){const g=C.slice();return g[12]=h[v],g}function Rt(C,h,v){const g=C.slice();return g[9]=h[v],g[15]=h,g[16]=v,g}function Bt(C,h,v){const g=C.slice();return g[17]=h[v],g}function St(C){let h,v=C[17]+"",g;return{c(){h=M("th"),g=Ot(v)},l(y){h=H(y,"TH",{});var f=$(h);g=Wt(f,v),f.forEach(B)},m(y,f){Z(y,h,f),z(h,g)},p(y,f){f&4&&v!==(v=y[17]+"")&&Dt(g,v)},d(y){y&&B(h)}}}function Nt(C){let h,v,g,y;function f(){C[7].call(v,C[15],C[16])}return{c(){h=M("td"),v=M("input"),this.h()},l(w){h=H(w,"TD",{class:!0});var t=$(h);v=H(t,"INPUT",{type:!0,class:!0}),t.forEach(B),this.h()},h(){k(v,"type","text"),k(v,"class","metro-input svelte-5bc4oa"),k(h,"class","svelte-5bc4oa")},m(w,t){Z(w,h,t),z(h,v),ot(v,C[9]),g||(y=[lt(v,"input",f),lt(v,"paste",C[4])],g=!0)},p(w,t){C=w,t&4&&v.value!==C[9]&&ot(v,C[9])},d(w){w&&B(h),g=!1,Ht(y)}}}function It(C){let h,v,g='<span class="mif-cross-light"></span>',y,f=Q(C[2].getRow(C[12])),w=[];for(let t=0;t<f.length;t+=1)w[t]=Nt(Rt(C,f,t));return{c(){h=M("tr"),v=M("td"),v.innerHTML=g,y=et();for(let t=0;t<w.length;t+=1)w[t].c();this.h()},l(t){h=H(t,"TR",{});var s=$(h);v=H(s,"TD",{class:!0,"data-svelte-h":!0}),Ct(v)!=="svelte-1fn4jfg"&&(v.innerHTML=g),y=nt(s);for(let e=0;e<w.length;e+=1)w[e].l(s);s.forEach(B),this.h()},h(){k(v,"class","svelte-5bc4oa")},m(t,s){Z(t,h,s),z(h,v),z(h,y);for(let e=0;e<w.length;e+=1)w[e]&&w[e].m(h,null)},p(t,s){if(s&20){f=Q(t[2].getRow(t[12]));let e;for(e=0;e<f.length;e+=1){const o=Rt(t,f,e);w[e]?w[e].p(o,s):(w[e]=Nt(o),w[e].c(),w[e].m(h,null))}for(;e<w.length;e+=1)w[e].d(1);w.length=f.length}},d(t){t&&B(h),ct(w,t)}}}function At(C){let h,v,g,y;function f(){C[8].call(v,C[10],C[11])}return{c(){h=M("td"),v=M("input"),this.h()},l(w){h=H(w,"TD",{class:!0});var t=$(h);v=H(t,"INPUT",{type:!0,class:!0}),t.forEach(B),this.h()},h(){k(v,"type","text"),k(v,"class","metro-input svelte-5bc4oa"),k(h,"class","svelte-5bc4oa")},m(w,t){Z(w,h,t),z(h,v),ot(v,C[9]),g||(y=[lt(v,"input",f),lt(v,"paste",C[4]),lt(v,"blur",C[5])],g=!0)},p(w,t){C=w,t&2&&v.value!==C[9]&&ot(v,C[9])},d(w){w&&B(h),g=!1,Ht(y)}}}function te(C){let h,v,g,y,f,w,t,s,e,o,n='<span class="mif-chevron-thin-right"></span>',c,d=Q(C[2].getHeader()),_=[];for(let l=0;l<d.length;l+=1)_[l]=St(Bt(C,d,l));let a=Q(C[2].getAllIds()),i=[];for(let l=0;l<a.length;l+=1)i[l]=It(Lt(C,a,l));let r=Q(C[1]),p=[];for(let l=0;l<r.length;l+=1)p[l]=At(Et(C,r,l));return{c(){h=M("table"),v=M("thead"),g=M("tr"),y=M("th"),f=et();for(let l=0;l<_.length;l+=1)_[l].c();w=et(),t=M("tbody");for(let l=0;l<i.length;l+=1)i[l].c();s=et(),e=M("tr"),o=M("td"),o.innerHTML=n,c=et();for(let l=0;l<p.length;l+=1)p[l].c();this.h()},l(l){h=H(l,"TABLE",{class:!0});var u=$(h);v=H(u,"THEAD",{});var m=$(v);g=H(m,"TR",{});var b=$(g);y=H(b,"TH",{}),$(y).forEach(B),f=nt(b);for(let E=0;E<_.length;E+=1)_[E].l(b);b.forEach(B),m.forEach(B),w=nt(u),t=H(u,"TBODY",{});var x=$(t);for(let E=0;E<i.length;E+=1)i[E].l(x);s=nt(x),e=H(x,"TR",{});var q=$(e);o=H(q,"TD",{class:!0,"data-svelte-h":!0}),Ct(o)!=="svelte-qk2oid"&&(o.innerHTML=n),c=nt(q);for(let E=0;E<p.length;E+=1)p[E].l(q);q.forEach(B),x.forEach(B),u.forEach(B),this.h()},h(){k(o,"class","svelte-5bc4oa"),k(h,"class","table subcompact table-border cell-border striped")},m(l,u){Z(l,h,u),z(h,v),z(v,g),z(g,y),z(g,f);for(let m=0;m<_.length;m+=1)_[m]&&_[m].m(g,null);z(h,w),z(h,t);for(let m=0;m<i.length;m+=1)i[m]&&i[m].m(t,null);z(t,s),z(t,e),z(e,o),z(e,c);for(let m=0;m<p.length;m+=1)p[m]&&p[m].m(e,null)},p(l,[u]){if(u&4){d=Q(l[2].getHeader());let m;for(m=0;m<d.length;m+=1){const b=Bt(l,d,m);_[m]?_[m].p(b,u):(_[m]=St(b),_[m].c(),_[m].m(g,null))}for(;m<_.length;m+=1)_[m].d(1);_.length=d.length}if(u&20){a=Q(l[2].getAllIds());let m;for(m=0;m<a.length;m+=1){const b=Lt(l,a,m);i[m]?i[m].p(b,u):(i[m]=It(b),i[m].c(),i[m].m(t,s))}for(;m<i.length;m+=1)i[m].d(1);i.length=a.length}if(u&50){r=Q(l[1]);let m;for(m=0;m<r.length;m+=1){const b=Et(l,r,m);p[m]?p[m].p(b,u):(p[m]=At(b),p[m].c(),p[m].m(e,null))}for(;m<p.length;m+=1)p[m].d(1);p.length=r.length}},i:at,o:at,d(l){l&&B(h),ct(_,l),ct(i,l),ct(p,l)}}}function ee(C,h,v){let g,y,{name:f}=h,w=Ut(f);rt(C,w,c=>v(2,y=c));let t=Jt(Array(y.getHeader().length).fill(""));rt(C,t,c=>v(1,g=c)),t.reset=()=>t.update(c=>Array(y.getHeader().length).fill(""));function s(c){c.preventDefault();let _=(c.clipboardData||window.clipboardData).getData("text").split(/\n|\r/).filter(a=>a.length).map(a=>a.split(/\t/));w.update(a=>{let i=new Yt(_[0]);return _.slice(1).forEach(r=>{i.add_or_replace_row(r[0],r)}),i}),t.reset()}function e(){if(g.join("")===""){console.log("empty buffer, skipping");return}w.update(c=>(c.add_or_replace_row(g[0],g),c)),t.reset()}function o(c,d){c[d]=this.value}function n(c,d){c[d]=this.value,t.set(g)}return C.$$set=c=>{"name"in c&&v(6,f=c.name)},[t,g,y,w,s,e,f,o,n]}class kt extends vt{constructor(h){super(),yt(this,h,ee,te,wt,{name:6})}}function zt(C,h,v){const g=C.slice();return g[3]=h[v],g[4]=h,g[5]=v,g}function ne(C){let h,v,g;function y(){C[2].call(h,C[4],C[5])}return{c(){h=M("textarea"),this.h()},l(f){h=H(f,"TEXTAREA",{"data-role":!0,"data-append":!0,"data-default-value":!0}),$(h).forEach(B),this.h()},h(){k(h,"data-role","textarea"),k(h,"data-append","<span class='mif-user'></span>"),k(h,"data-default-value","My project is about...")},m(f,w){Z(f,h,w),ot(h,C[3].content),v||(g=lt(h,"input",y),v=!0)},p(f,w){C=f,w&1&&ot(h,C[3].content)},d(f){f&&B(h),v=!1,g()}}}function se(C){let h,v,g;function y(){C[1].call(h,C[4],C[5])}return{c(){h=M("textarea"),this.h()},l(f){h=H(f,"TEXTAREA",{"data-role":!0,"data-prepend":!0,"data-default-value":!0}),$(h).forEach(B),this.h()},h(){k(h,"data-role","textarea"),k(h,"data-prepend","<span class='mif-cpu'></span>"),k(h,"data-default-value","My project is about...")},m(f,w){Z(f,h,w),ot(h,C[3].content),v||(g=lt(h,"input",y),v=!0)},p(f,w){C=f,w&1&&ot(h,C[3].content)},d(f){f&&B(h),v=!1,g()}}}function Mt(C){let h;function v(f,w){if(f[3].role=="assistant"&&f[3].content!=null)return se;if(f[3].role=="user")return ne}let g=v(C),y=g&&g(C);return{c(){y&&y.c(),h=xt()},l(f){y&&y.l(f),h=xt()},m(f,w){y&&y.m(f,w),Z(f,h,w)},p(f,w){g===(g=v(f))&&y?y.p(f,w):(y&&y.d(1),y=g&&g(f),y&&(y.c(),y.m(h.parentNode,h)))},d(f){f&&B(h),y&&y.d(f)}}}function ie(C){let h,v,g,y='<li><a href="#_target_1">Tasks</a></li> <li><a href="#_target_2">Resources</a></li> <li><a href="#_target_3">Instructions</a></li>',f,w,t,s,e,o,n,c,d,_,a,i,r;s=new kt({props:{name:"tasks"}}),n=new kt({props:{name:"resources"}});let p=Q(C[0]),l=[];for(let u=0;u<p.length;u+=1)l[u]=Mt(zt(C,p,u));return i=new Zt({}),{c(){h=M("div"),v=M("div"),g=M("ul"),g.innerHTML=y,f=et(),w=M("div"),t=M("div"),dt(s.$$.fragment),e=et(),o=M("div"),dt(n.$$.fragment),c=et(),d=M("div");for(let u=0;u<l.length;u+=1)l[u].c();_=et(),a=M("div"),dt(i.$$.fragment),this.h()},l(u){h=H(u,"DIV",{"data-role":!0,class:!0,"data-split-sizes":!0});var m=$(h);v=H(m,"DIV",{class:!0});var b=$(v);g=H(b,"UL",{"data-role":!0,"data-expand":!0,"data-svelte-h":!0}),Ct(g)!=="svelte-1wsnr9t"&&(g.innerHTML=y),f=nt(b),w=H(b,"DIV",{class:!0});var x=$(w);t=H(x,"DIV",{id:!0});var q=$(t);ht(s.$$.fragment,q),q.forEach(B),e=nt(x),o=H(x,"DIV",{id:!0});var E=$(o);ht(n.$$.fragment,E),E.forEach(B),c=nt(x),d=H(x,"DIV",{id:!0});var L=$(d);for(let J=0;J<l.length;J+=1)l[J].l(L);L.forEach(B),x.forEach(B),b.forEach(B),_=nt(m),a=H(m,"DIV",{class:!0});var X=$(a);ht(i.$$.fragment,X),X.forEach(B),m.forEach(B),this.h()},h(){k(g,"data-role","tabs"),k(g,"data-expand","true"),k(t,"id","_target_1"),k(o,"id","_target_2"),k(d,"id","_target_3"),k(w,"class","border bd-default no-border-top p-2 scrollable svelte-5bc4oa"),k(v,"class",""),k(a,"class","d-flex flex-justify-center flex-align-center"),k(h,"data-role","splitter"),k(h,"class","h-100"),k(h,"data-split-sizes","30, 70")},m(u,m){Z(u,h,m),z(h,v),z(v,g),z(v,f),z(v,w),z(w,t),ut(s,t,null),z(w,e),z(w,o),ut(n,o,null),z(w,c),z(w,d);for(let b=0;b<l.length;b+=1)l[b]&&l[b].m(d,null);z(h,_),z(h,a),ut(i,a,null),r=!0},p(u,[m]){if(m&1){p=Q(u[0]);let b;for(b=0;b<p.length;b+=1){const x=zt(u,p,b);l[b]?l[b].p(x,m):(l[b]=Mt(x),l[b].c(),l[b].m(d,null))}for(;b<l.length;b+=1)l[b].d(1);l.length=p.length}},i(u){r||(pt(s.$$.fragment,u),pt(n.$$.fragment,u),pt(i.$$.fragment,u),r=!0)},o(u){ft(s.$$.fragment,u),ft(n.$$.fragment,u),ft(i.$$.fragment,u),r=!1},d(u){u&&B(h),_t(s),_t(n),ct(l,u),_t(i)}}}function oe(C,h,v){let g;rt(C,gt,w=>v(0,g=w));function y(w,t){w[t].content=this.value,gt.set(g)}function f(w,t){w[t].content=this.value,gt.set(g)}return[g,y,f]}class fe extends vt{constructor(h){super(),yt(this,h,oe,ie,wt,{})}}export{fe as component};
