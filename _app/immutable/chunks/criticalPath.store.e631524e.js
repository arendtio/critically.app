var b=(l,e,r)=>{if(!e.has(l))throw TypeError("Cannot "+r)};var i=(l,e,r)=>(b(l,e,"read from private field"),r?r.call(l):e.get(l)),h=(l,e,r)=>{if(e.has(l))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(l):e.set(l,r)},m=(l,e,r,t)=>(b(l,e,"write to private field"),t?t.call(l,r):e.set(l,r),r);var p=(l,e,r)=>(b(l,e,"access private method"),r);import{w as M}from"./index.0f227f4a.js";import{g as N}from"./tables.store.a680fdc0.js";var o,u,d,v,E,T,f,w,C,O,P,x;class D{constructor(){h(this,E);h(this,f);h(this,C);h(this,P);h(this,o,void 0);h(this,u,[]);h(this,d,[]);h(this,v,void 0);m(this,o,new Map),m(this,v,new Map)}addTask(e,r,t,a,c,s,n,F){t=j(t),a=j(a),c=j(c),s=s.split(",").map(g=>g.split("&").map(A=>A.trim())),n=n.split(",").map(g=>g.trim()).filter(g=>g!=="");let L=Math.round((t+a*4+c)/6),z={id:e,name:r,min:t,likely:a,max:c,res:s,resIdList:[],predecessors:new Set(n),successors:new Set,progress:F,earlyCol:1,es:0,ef:0,ls:0,lf:0,slack:-1,expected:L};i(this,o).set(e,z)}getTask(e){return i(this,o).get(e)}calc(){return p(this,E,T).call(this),p(this,C,O).call(this),p(this,P,x).call(this),{starts:i(this,u),map:Object.fromEntries(i(this,o)),ends:i(this,d)}}}o=new WeakMap,u=new WeakMap,d=new WeakMap,v=new WeakMap,E=new WeakSet,T=function(){i(this,o).forEach(e=>{e.predecessors.forEach(r=>{i(this,o).get(r).successors.add(e.id)})}),m(this,u,[...i(this,o).values()].filter(e=>e.predecessors.size===0).map(e=>e.id)),m(this,d,[...i(this,o).values()].filter(e=>e.successors.size===0).map(e=>e.id))},f=new WeakSet,w=function(e,r,t,a){if(t.has(e))return;t.add(e);let c=i(this,o).get(e);c[r].forEach(s=>{p(this,f,w).call(this,s,r,t,a)}),c=a(c),i(this,o).set(c.id,c)},C=new WeakSet,O=function(){let e=new Set;i(this,d).forEach(r=>{p(this,f,w).call(this,r,"predecessors",e,t=>{let a=[...t.predecessors].map(s=>i(this,o).get(s)).reduce((s,n)=>s<n.ef?n.ef:s,0),c=[...t.predecessors].map(s=>i(this,o).get(s)).reduce((s,n)=>s<n.earlyCol?n.earlyCol:s,0);return t.earlyCol=c+1,t.es=a+1,t.ef=t.es+t.expected-1,t})})},P=new WeakSet,x=function(){let e=Math.max(...i(this,d).map(t=>i(this,o).get(t).ef)),r=new Set;i(this,u).forEach(t=>{p(this,f,w).call(this,t,"successors",r,a=>{let c=[...a.successors].map(s=>i(this,o).get(s)).reduce((s,n)=>s<n.ls?s:n.ls,e+1);return a.lf=c-1,a.ls=a.lf-a.expected+1,a.slack=a.ls-a.es,a})})};const S=M({}),y=M(void 0);function j(l,e){e===void 0&&(e=navigator.languages&&navigator.languages.length?navigator.languages[0]:navigator.language);let[,r,,,,t]=1111.1.toLocaleString(e);return l=Array.from(""+l,a=>a===r?"":a===t?".":a).join(""),parseFloat(l)}S.reset=()=>S.set({});y.reset=()=>y.set(void 0);S.calculate=function(){y.set(void 0);let l;N("tasks").update(s=>(l=s,s));let r=new D;l.getAllIds().forEach(s=>{let n=l.getRow(s);r.addTask(...n)}),console.log("Starting calculation");let t=r.calc(),a=new Map;for(var c in t.map)if(Object.prototype.hasOwnProperty.call(t.map,c)){let s=t.map[c];s.predecessors=[...s.predecessors],a.set(s.id,s)}t.map=Object.fromEntries(a),console.log("Finished calculation: ",JSON.stringify(t)),S.set(t)};export{S as c,y as d,j as l};
