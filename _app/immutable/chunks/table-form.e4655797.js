import{s as He,f as B,a as ee,g as L,h as q,d as D,c as te,B as Se,j as O,i as le,r as C,w as ue,x as se,z as J,o as Be,l as Le,m as Oe,n as Pe,k as Ye,v as M,u as ie,y as ye,p as qe,D as ae}from"./scheduler.427c93e9.js";import{e as j}from"./each.5e3737eb.js";import{S as Fe,i as Me}from"./index.d4e4d1b7.js";import{g as Ue,T as he}from"./tables.store.b7563f80.js";import{w as W}from"./index.113f7b86.js";function fe(e,l,r){const n=e.slice();return n[41]=l[r],n[42]=l,n[43]=r,n}function _e(e,l,r){const n=e.slice();return n[44]=l[r],n}function ge(e,l,r){const n=e.slice();return n[41]=l[r],n[47]=l,n[48]=r,n}function pe(e,l,r){const n=e.slice();return n[49]=l[r],n}function me(e){let l,r=e[49]+"",n;return{c(){l=B("th"),n=Le(r)},l(p){l=L(p,"TH",{});var y=q(l);n=Oe(y,r),y.forEach(D)},m(p,y){le(p,l,y),C(l,n)},p(p,y){y[0]&2&&r!==(r=p[49]+"")&&Pe(n,r)},d(p){p&&D(l)}}}function we(e){let l,r,n,p,y;function E(){e[27].call(r,e[47],e[48])}function d(){return e[28](e[44])}function T(...s){return e[29](e[44],e[48],...s)}function f(...s){return e[30](e[44],e[48],...s)}function k(...s){return e[31](e[44],e[48],...s)}function H(...s){return e[32](e[44],e[48],...s)}return{c(){l=B("td"),r=B("input"),this.h()},l(s){l=L(s,"TD",{class:!0,"data-row-id":!0,"data-col-index":!0});var g=q(l);r=L(g,"INPUT",{type:!0,class:!0}),g.forEach(D),this.h()},h(){O(r,"type","text"),O(r,"class","metro-input svelte-xzcyut"),O(l,"class","data-cell svelte-xzcyut"),O(l,"data-row-id",n=e[44]),O(l,"data-col-index",e[48]),ae(l,"selected-cell",e[2]&&e[2].rowId===e[44]&&e[2].colIndex===e[48]),ae(l,"highlight",e[4]&&e[3]&&e[3].colIndex===e[48]&&e[16](e[44],e[48]))},m(s,g){le(s,l,g),C(l,r),ie(r,e[41]),p||(y=[M(r,"input",E),M(r,"paste",e[17]),M(r,"blur",d),M(r,"keydown",T),M(l,"pointerdown",f),M(l,"click",k),M(l,"keydown",H)],p=!0)},p(s,g){e=s,g[0]&2&&r.value!==e[41]&&ie(r,e[41]),g[0]&2&&n!==(n=e[44])&&O(l,"data-row-id",n),g[0]&6&&ae(l,"selected-cell",e[2]&&e[2].rowId===e[44]&&e[2].colIndex===e[48]),g[0]&65562&&ae(l,"highlight",e[4]&&e[3]&&e[3].colIndex===e[48]&&e[16](e[44],e[48]))},d(s){s&&D(l),p=!1,ye(y)}}}function be(e){var k,H;let l,r,n,p,y,E;function d(){return e[26](e[44])}let T=j(((H=(k=e[1])==null?void 0:k.getRow)==null?void 0:H.call(k,e[44]))??[]),f=[];for(let s=0;s<T.length;s+=1)f[s]=we(ge(e,T,s));return{c(){l=B("tr"),r=B("td"),n=B("span"),p=ee();for(let s=0;s<f.length;s+=1)f[s].c();this.h()},l(s){l=L(s,"TR",{});var g=q(l);r=L(g,"TD",{class:!0});var u=q(r);n=L(u,"SPAN",{class:!0,style:!0,role:!0,"aria-label":!0}),q(n).forEach(D),u.forEach(D),p=te(g);for(let A=0;A<f.length;A+=1)f[A].l(g);g.forEach(D),this.h()},h(){O(n,"class","mif-cross-light"),Ye(n,"cursor","pointer"),O(n,"role","button"),O(n,"aria-label","Delete row"),O(r,"class","svelte-xzcyut")},m(s,g){le(s,l,g),C(l,r),C(r,n),C(l,p);for(let u=0;u<f.length;u+=1)f[u]&&f[u].m(l,null);y||(E=M(n,"click",d),y=!0)},p(s,g){var u,A;if(e=s,g[0]&3399710){T=j(((A=(u=e[1])==null?void 0:u.getRow)==null?void 0:A.call(u,e[44]))??[]);let h;for(h=0;h<T.length;h+=1){const P=ge(e,T,h);f[h]?f[h].p(P,g):(f[h]=we(P),f[h].c(),f[h].m(l,null))}for(;h<f.length;h+=1)f[h].d(1);f.length=T.length}},d(s){s&&D(l),se(f,s),y=!1,E()}}}function Ie(e){let l,r,n,p;function y(){e[33].call(r,e[42],e[43])}return{c(){l=B("td"),r=B("input"),this.h()},l(E){l=L(E,"TD",{class:!0});var d=q(l);r=L(d,"INPUT",{type:!0,class:!0}),d.forEach(D),this.h()},h(){O(r,"type","text"),O(r,"class","metro-input svelte-xzcyut"),O(l,"class","svelte-xzcyut")},m(E,d){le(E,l,d),C(l,r),ie(r,e[41]),n||(p=[M(r,"input",y),M(r,"paste",e[17]),M(r,"blur",e[18])],n=!0)},p(E,d){e=E,d[0]&64&&r.value!==e[41]&&ie(r,e[41])},d(E){E&&D(l),n=!1,ye(p)}}}function Xe(e){var U,ne,G,Z;let l,r,n,p,y,E,d,T,f,k,H='<span class="mif-chevron-thin-right"></span>',s,g=j(((ne=(U=e[1])==null?void 0:U.getHeader)==null?void 0:ne.call(U))??[]),u=[];for(let i=0;i<g.length;i+=1)u[i]=me(pe(e,g,i));let A=j(((Z=(G=e[1])==null?void 0:G.getAllIds)==null?void 0:Z.call(G))??[]),h=[];for(let i=0;i<A.length;i+=1)h[i]=be(_e(e,A,i));let P=j(e[6]),b=[];for(let i=0;i<P.length;i+=1)b[i]=Ie(fe(e,P,i));return{c(){l=B("table"),r=B("thead"),n=B("tr"),p=B("th"),y=ee();for(let i=0;i<u.length;i+=1)u[i].c();E=ee(),d=B("tbody");for(let i=0;i<h.length;i+=1)h[i].c();T=ee(),f=B("tr"),k=B("td"),k.innerHTML=H,s=ee();for(let i=0;i<b.length;i+=1)b[i].c();this.h()},l(i){l=L(i,"TABLE",{class:!0});var S=q(l);r=L(S,"THEAD",{});var I=q(r);n=L(I,"TR",{});var X=q(n);p=L(X,"TH",{}),q(p).forEach(D),y=te(X);for(let o=0;o<u.length;o+=1)u[o].l(X);X.forEach(D),I.forEach(D),E=te(S),d=L(S,"TBODY",{});var Y=q(d);for(let o=0;o<h.length;o+=1)h[o].l(Y);T=te(Y),f=L(Y,"TR",{});var F=q(f);k=L(F,"TD",{class:!0,"data-svelte-h":!0}),Se(k)!=="svelte-qk2oid"&&(k.innerHTML=H),s=te(F);for(let o=0;o<b.length;o+=1)b[o].l(F);F.forEach(D),Y.forEach(D),S.forEach(D),this.h()},h(){O(k,"class","svelte-xzcyut"),O(l,"class","table subcompact table-border cell-border striped")},m(i,S){le(i,l,S),C(l,r),C(r,n),C(n,p),C(n,y);for(let I=0;I<u.length;I+=1)u[I]&&u[I].m(n,null);C(l,E),C(l,d);for(let I=0;I<h.length;I+=1)h[I]&&h[I].m(d,null);C(d,T),C(d,f),C(f,k),C(f,s);for(let I=0;I<b.length;I+=1)b[I]&&b[I].m(f,null);e[34](l)},p(i,S){var I,X,Y,F;if(S[0]&2){g=j(((X=(I=i[1])==null?void 0:I.getHeader)==null?void 0:X.call(I))??[]);let o;for(o=0;o<g.length;o+=1){const z=pe(i,g,o);u[o]?u[o].p(z,S):(u[o]=me(z),u[o].c(),u[o].m(n,null))}for(;o<u.length;o+=1)u[o].d(1);u.length=g.length}if(S[0]&3923998){A=j(((F=(Y=i[1])==null?void 0:Y.getAllIds)==null?void 0:F.call(Y))??[]);let o;for(o=0;o<A.length;o+=1){const z=_e(i,A,o);h[o]?h[o].p(z,S):(h[o]=be(z),h[o].c(),h[o].m(d,T))}for(;o<h.length;o+=1)h[o].d(1);h.length=A.length}if(S[0]&393280){P=j(i[6]);let o;for(o=0;o<P.length;o+=1){const z=fe(i,P,o);b[o]?b[o].p(z,S):(b[o]=Ie(z),b[o].c(),b[o].m(f,null))}for(;o<b.length;o+=1)b[o].d(1);b.length=P.length}},i:ue,o:ue,d(i){i&&D(l),se(u,i),se(h,i),se(b,i),e[34](null)}}}function ze(e,l,r){let n,p,y,E,d,T,f,{name:k}=l,H=Ue(k);J(e,H,t=>r(1,n=t));let s=W([]);J(e,s,t=>r(6,p=t)),s.reset=()=>s.update(t=>{var c;return(c=n==null?void 0:n.getHeader())!=null&&c.length?Array(n.getHeader().length).fill(""):[]});let g=W(null);J(e,g,t=>r(3,d=t));let u=W(null);J(e,u,t=>r(24,E=t));let A=W(!1);J(e,A,t=>r(4,T=t));let h=W(null);J(e,h,t=>r(25,f=t));let P,b=W(null);J(e,b,t=>r(2,y=t));let U=null;Be(()=>{const t=a=>{if(!T||!d)return;const _=document.elementFromPoint(a.clientX,a.clientY);if(!_)return;const m=_.closest("td.data-cell");if(!m)return;const w=m.getAttribute("data-row-id"),v=parseInt(m.getAttribute("data-col-index"));if(!f){const N=Math.abs(a.clientX-d.startX),Q=Math.abs(a.clientY-d.startY);(N>5||Q>5)&&h.set("rectangular")}u.set({rowId:w,colIndex:v}),document.querySelectorAll("td.data-cell").forEach(N=>{N.classList.remove("highlight")});const R=n.getAllIds(),K=R.indexOf(d.rowId),x=R.indexOf(w),[ce,de]=K<x?[K,x]:[x,K],[re,oe]=d.colIndex<v?[d.colIndex,v]:[v,d.colIndex];document.querySelectorAll("td.data-cell").forEach(N=>{const Q=N.getAttribute("data-row-id"),$=parseInt(N.getAttribute("data-col-index")),V=R.indexOf(Q);V>=ce&&V<=de&&$>=re&&$<=oe&&N.classList.add("highlight")})},c=a=>{if(T&&d&&E){const _=document.elementFromPoint(a.clientX,a.clientY);if(_){const m=_.closest("td.data-cell");if(m){const w=m.getAttribute("data-row-id"),v=parseInt(m.getAttribute("data-col-index")),R=n.getRow(d.rowId);if(R){const K=R[d.colIndex];ne(d.rowId,w,d.colIndex,v,K)}}}}document.querySelectorAll("td.data-cell").forEach(_=>{_.classList.remove("highlight")}),A.set(!1),g.set(null),u.set(null),b.set(null),h.set(null)};return document.addEventListener("pointermove",t),document.addEventListener("pointerup",c),()=>{document.removeEventListener("pointermove",t),document.removeEventListener("pointerup",c)}});function ne(t,c,a,_,m){const w=n.getAllIds(),v=w.indexOf(t),R=w.indexOf(c);if(v===-1||R===-1)return;const[K,x]=v<R?[v,R]:[R,v],[ce,de]=a<_?[a,_]:[_,a],re=new he(n.getHeader());w.forEach((oe,N)=>{const Q=n.getRow(oe);if(Q){const $=[...Q];if(N>=K&&N<=x)for(let V=ce;V<=de;V++)$[V]=m;re.add_or_replace_row(oe,$)}}),H.set(re)}function G(t,c,a){const _=a.currentTarget.getBoundingClientRect(),m=a.clientX-_.left,w=a.clientY-_.top;m>_.width-8&&w>_.height-8&&(A.set(!0),g.set({rowId:t,colIndex:c,startX:a.clientX,startY:a.clientY}),u.set({rowId:t,colIndex:c}),b.set({rowId:t,colIndex:c}),h.set(null),a.preventDefault(),a.stopPropagation())}function Z(t,c,a){const _=a.currentTarget.getBoundingClientRect(),m=a.clientX-_.left,w=a.clientY-_.top;m>_.width-8&&w>_.height-8||(b.set({rowId:t,colIndex:c}),a.stopPropagation())}function i(){setTimeout(()=>{var t;!T&&((t=document.activeElement)==null?void 0:t.tagName)!=="INPUT"&&b.set(null)},0)}function S(t,c){if(!T||!d||!E||d.colIndex!==c)return!1;const a=n.getAllIds(),_=a.indexOf(d.rowId),m=a.indexOf(t),w=a.indexOf(E.rowId);if(_===-1||m===-1||w===-1)return!1;const[v,R]=_<w?[_,w]:[w,_];return m>=v&&m<=R}function I(t){let c=(t.clipboardData||window.clipboardData).getData("text");const a=c.includes(`
`),_=c.includes("	");if(a&&_){t.preventDefault();let m=c.split(/\n|\r/).filter(w=>w.length).map(w=>w.split(/\t/));H.update(w=>{let v=new he(m[0]);return m.slice(1).forEach(R=>{v.add_or_replace_row(R[0],R)}),v}),s.reset()}else{const m=t.target.closest("tr")===t.target.closest("table").querySelector("tbody tr:last-child");setTimeout(m?()=>{Array.from(t.target.closest("tr").querySelectorAll("input")).some(v=>v.value.trim()!=="")&&X()}:()=>{F(t.target.closest("td").getAttribute("data-row-id"))},0)}}function X(){p.join("")!==""&&(H.update(t=>(t.add_or_replace_row(p[0],p),t)),s.reset())}function Y(t){H.update(c=>(c.delete_row(t),c))}function F(t){const c=n.getRow(t);H.update(a=>(a.add_or_replace_row(t,c),a))}function o(t,c,a){if(a.key==="Enter"||a.key==="ArrowDown"||a.key==="ArrowUp"){a.preventDefault();const _=n.getAllIds(),m=_.indexOf(t);let w;if(a.key==="ArrowUp"?w=m>0?m-1:m:w=m<_.length-1?m+1:m,w!==m){const v=_[w];b.set({rowId:v,colIndex:c})}}}const z=t=>Y(t);function Ee(t,c){t[c]=this.value}const ve=t=>{F(t),i()},Te=(t,c,a)=>o(t,c,a),ke=(t,c,a)=>G(t,c,a),Ae=(t,c,a)=>Z(t,c,a),De=(t,c,a)=>o(t,c,a);function Re(t,c){t[c]=this.value,s.set(p)}function Ce(t){qe[t?"unshift":"push"](()=>{P=t,r(5,P)})}return e.$$set=t=>{"name"in t&&r(22,k=t.name)},e.$$.update=()=>{if(e.$$.dirty[0]&8388612&&(r(23,U=y),U)){const t=document.querySelector(`td.data-cell[data-row-id="${U.rowId}"][data-col-index="${U.colIndex}"] input`);t&&document.activeElement!==t&&t.focus()}e.$$.dirty[0]&8,e.$$.dirty[0]&16777216,e.$$.dirty[0]&16,e.$$.dirty[0]&33554432,e.$$.dirty[0]&3&&n!=null&&n.getHeader()&&s.set(Array(n.getHeader().length).fill(""))},[s,n,y,d,T,P,p,H,g,u,A,h,b,G,Z,i,S,I,X,Y,F,o,k,U,E,f,z,Ee,ve,Te,ke,Ae,De,Re,Ce]}class Qe extends Fe{constructor(l){super(),Me(this,l,ze,Xe,He,{name:22},null,[-1,-1])}}export{Qe as T};
