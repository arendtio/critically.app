import{s as at,f as R,a as se,g as L,h as H,B as Ae,c as ae,d as v,j as d,i as ue,r as b,v as K,w as Pe,x as He,y as Le,z as he,o as it,l as ct,m as dt,n as ut,e as Ne,u as Oe,p as ft,C as qe}from"./scheduler.21670c10.js";import{e as we}from"./each.25ba1068.js";import{S as ht,i as gt}from"./index.f5c9f38b.js";import{g as pt,T as Ce}from"./tables.store.0c6ab06d.js";import{w as me}from"./index.4d1b706b.js";import{d as _t}from"./assistant.store.7b755d18.js";const mt=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;const{window:vt}=mt;function Me(e,t,r){const o=e.slice();return o[69]=t[r],o[70]=t,o[71]=r,o}function Fe(e,t,r){const o=e.slice();return o[72]=t[r],o}function Be(e,t,r){const o=e.slice();return o[69]=t[r],o[75]=t,o[76]=r,o}function Ue(e,t,r){const o=e.slice();return o[77]=t[r],o}function Ye(e){let t,r=e[77]+"",o;return{c(){t=R("th"),o=ct(r)},l(a){t=L(a,"TH",{});var n=H(t);o=dt(n,r),n.forEach(v)},m(a,n){ue(a,t,n),b(t,o)},p(a,n){n[0]&4&&r!==(r=a[77]+"")&&ut(o,r)},d(a){a&&v(t)}}}function Xe(e){var ie,pe;let t,r,o,a,n,h,w,C,T,y,E,B,ne,D;function I(k,S){return S[0]&4&&(a=null),a==null&&(a=!!k[22](k[72])),a?bt:wt}let Q=I(e,[-1,-1,-1]),j=Q(e);function Z(k,S){return k[7]?It:Tt}let x=Z(e),A=x(e),V=we(((pe=(ie=e[2])==null?void 0:ie.getRow)==null?void 0:pe.call(ie,e[72]))??[]),M=[];for(let k=0;k<V.length;k+=1)M[k]=Ke(Be(e,V,k));function te(){return e[55](e[72])}function ee(...k){return e[56](e[72],...k)}function ge(...k){return e[57](e[72],...k)}return{c(){t=R("tr"),r=R("td"),o=R("div"),j.c(),n=se(),h=R("td"),w=R("div"),A.c(),C=se();for(let k=0;k<M.length;k+=1)M[k].c();T=se(),y=R("td"),E=R("div"),B=R("span"),this.h()},l(k){t=L(k,"TR",{});var S=H(t);r=L(S,"TD",{class:!0});var G=H(r);o=L(G,"DIV",{class:!0});var ce=H(o);j.l(ce),ce.forEach(v),G.forEach(v),n=ae(S),h=L(S,"TD",{class:!0});var N=H(h);w=L(N,"DIV",{class:!0});var O=H(w);A.l(O),O.forEach(v),N.forEach(v),C=ae(S);for(let re=0;re<M.length;re+=1)M[re].l(S);T=ae(S),y=L(S,"TD",{class:!0});var fe=H(y);E=L(fe,"DIV",{class:!0});var U=H(E);B=L(U,"SPAN",{class:!0,role:!0,"aria-label":!0,title:!0}),H(B).forEach(v),U.forEach(v),fe.forEach(v),S.forEach(v),this.h()},h(){d(o,"class","hierarchy-controls svelte-1qhmk4t"),d(r,"class","tree-column svelte-1qhmk4t"),d(w,"class","hierarchy-controls svelte-1qhmk4t"),d(h,"class","control-column svelte-1qhmk4t"),d(B,"class","delete-button mif-cross-light svelte-1qhmk4t"),d(B,"role","button"),d(B,"aria-label","Delete row"),d(B,"title","Delete row"),d(E,"class","hierarchy-controls svelte-1qhmk4t"),d(y,"class","control-column svelte-1qhmk4t")},m(k,S){ue(k,t,S),b(t,r),b(r,o),j.m(o,null),b(t,n),b(t,h),b(h,w),A.m(w,null),b(t,C);for(let G=0;G<M.length;G+=1)M[G]&&M[G].m(t,null);b(t,T),b(t,y),b(y,E),b(E,B),ne||(D=[K(B,"click",te),K(t,"dragover",ee),K(t,"keydown",ge)],ne=!0)},p(k,S){var G,ce;if(e=k,Q===(Q=I(e,S))&&j?j.p(e,S):(j.d(1),j=Q(e),j&&(j.c(),j.m(o,null))),x===(x=Z(e))&&A?A.p(e,S):(A.d(1),A=x(e),A&&(A.c(),A.m(w,null))),S[0]&2021654588|S[1]&25){V=we(((ce=(G=e[2])==null?void 0:G.getRow)==null?void 0:ce.call(G,e[72]))??[]);let N;for(N=0;N<V.length;N+=1){const O=Be(e,V,N);M[N]?M[N].p(O,S):(M[N]=Ke(O),M[N].c(),M[N].m(t,T))}for(;N<M.length;N+=1)M[N].d(1);M.length=V.length}},d(k){k&&v(t),j.d(),A.d(),He(M,k),ne=!1,Le(D)}}}function wt(e){let t;function r(n,h){return n[0]==="tasks"?yt:kt}let o=r(e),a=o(e);return{c(){a.c(),t=Ne()},l(n){a.l(n),t=Ne()},m(n,h){a.m(n,h),ue(n,t,h)},p(n,h){o===(o=r(n))&&a?a.p(n,h):(a.d(1),a=o(n),a&&(a.c(),a.m(t.parentNode,t)))},d(n){n&&v(t),a.d(n)}}}function bt(e){let t,r,o,a,n,h,w;function C(){return e[44](e[72])}return{c(){t=R("span"),r=R("span"),this.h()},l(T){t=L(T,"SPAN",{class:!0,role:!0,"aria-label":!0,title:!0});var y=H(t);r=L(y,"SPAN",{class:!0}),H(r).forEach(v),y.forEach(v),this.h()},h(){d(r,"class",o=e[8][e[72]]?"mif-plus":"mif-minus"),d(t,"class","hierarchy-toggle svelte-1qhmk4t"),d(t,"role","button"),d(t,"aria-label",a=e[8][e[72]]?"Expand":"Collapse"),d(t,"title",n=e[8][e[72]]?"Expand":"Collapse")},m(T,y){ue(T,t,y),b(t,r),h||(w=K(t,"click",C),h=!0)},p(T,y){e=T,y[0]&260&&o!==(o=e[8][e[72]]?"mif-plus":"mif-minus")&&d(r,"class",o),y[0]&260&&a!==(a=e[8][e[72]]?"Expand":"Collapse")&&d(t,"aria-label",a),y[0]&260&&n!==(n=e[8][e[72]]?"Expand":"Collapse")&&d(t,"title",n)},d(T){T&&v(t),h=!1,w()}}}function kt(e){let t;return{c(){t=R("span"),this.h()},l(r){t=L(r,"SPAN",{class:!0}),H(t).forEach(v),this.h()},h(){d(t,"class","hierarchy-spacer svelte-1qhmk4t")},m(r,o){ue(r,t,o)},p:Pe,d(r){r&&v(t)}}}function yt(e){let t,r='<span class="mif-flow-cascade"></span>',o,a;function n(){return e[45](e[72])}return{c(){t=R("span"),t.innerHTML=r,this.h()},l(h){t=L(h,"SPAN",{class:!0,role:!0,"aria-label":!0,title:!0,"data-svelte-h":!0}),Ae(t)!=="svelte-d0tiuq"&&(t.innerHTML=r),this.h()},h(){d(t,"class","split-task-button svelte-1qhmk4t"),d(t,"role","button"),d(t,"aria-label","Split into subtasks"),d(t,"title","Split into subtasks using AI")},m(h,w){ue(h,t,w),o||(a=K(t,"click",n),o=!0)},p(h,w){e=h},d(h){h&&v(t),o=!1,a()}}}function Tt(e){let t,r,o,a,n,h;function w(){return e[47](e[72])}function C(){return e[48](e[72])}return{c(){t=R("div"),r=R("span"),o=se(),a=R("span"),this.h()},l(T){t=L(T,"DIV",{});var y=H(t);r=L(y,"SPAN",{class:!0,role:!0,"aria-label":!0,title:!0}),H(r).forEach(v),o=ae(y),a=L(y,"SPAN",{class:!0,role:!0,"aria-label":!0,title:!0}),H(a).forEach(v),y.forEach(v),this.h()},h(){d(r,"class","level-control mif-arrow-left svelte-1qhmk4t"),d(r,"role","button"),d(r,"aria-label","Decrease indentation level"),d(r,"title","Decrease indentation level (Shift+Tab)"),d(a,"class","level-control mif-arrow-right svelte-1qhmk4t"),d(a,"role","button"),d(a,"aria-label","Increase indentation level"),d(a,"title","Increase indentation level (Tab)")},m(T,y){ue(T,t,y),b(t,r),b(t,o),b(t,a),n||(h=[K(r,"click",w),K(a,"click",C)],n=!0)},p(T,y){e=T},d(T){T&&v(t),n=!1,Le(h)}}}function It(e){let t,r,o;function a(...n){return e[46](e[72],...n)}return{c(){t=R("span"),this.h()},l(n){t=L(n,"SPAN",{class:!0,role:!0,"aria-label":!0,title:!0,draggable:!0}),H(t).forEach(v),this.h()},h(){d(t,"class","reorder-handle mif-unfold-more svelte-1qhmk4t"),d(t,"role","button"),d(t,"aria-label","Drag to reorder"),d(t,"title","Drag to reorder"),d(t,"draggable",!0)},m(n,h){ue(n,t,h),r||(o=[K(t,"dragstart",a),K(t,"dragend",e[40])],r=!0)},p(n,h){e=n},d(n){n&&v(t),r=!1,Le(o)}}}function Ke(e){let t,r,o,a,n,h,w;function C(){e[49].call(r,e[75],e[76])}function T(...D){return e[50](e[72],...D)}function y(...D){return e[51](e[72],e[76],...D)}function E(...D){return e[52](e[72],e[76],...D)}function B(...D){return e[53](e[72],e[76],...D)}function ne(...D){return e[54](e[72],e[76],...D)}return{c(){t=R("td"),r=R("input"),o=se(),this.h()},l(D){t=L(D,"TD",{class:!0,style:!0,"data-row-id":!0,"data-col-index":!0});var I=H(t);r=L(I,"INPUT",{type:!0,class:!0}),o=ae(I),I.forEach(v),this.h()},h(){d(r,"type","text"),d(r,"class","metro-input svelte-1qhmk4t"),d(t,"class","data-cell svelte-1qhmk4t"),d(t,"style",a=e[76]===0&&e[23](e[72])>0?`padding-left: ${e[23](e[72])*16}px;`:""),d(t,"data-row-id",n=e[72]),d(t,"data-col-index",e[76]),qe(t,"selected-cell",e[3]&&e[3].rowId===e[72]&&e[3].colIndex===e[76]),qe(t,"highlight",e[5]&&e[4]&&e[4].colIndex===e[76]&&e[30](e[72],e[76]))},m(D,I){ue(D,t,I),b(t,r),Oe(r,e[69]),b(t,o),h||(w=[K(r,"input",C),K(r,"paste",e[31]),K(r,"blur",T),K(r,"keydown",y),K(t,"pointerdown",E),K(t,"click",B),K(t,"keydown",ne)],h=!0)},p(D,I){e=D,I[0]&4&&r.value!==e[69]&&Oe(r,e[69]),I[0]&4&&a!==(a=e[76]===0&&e[23](e[72])>0?`padding-left: ${e[23](e[72])*16}px;`:"")&&d(t,"style",a),I[0]&4&&n!==(n=e[72])&&d(t,"data-row-id",n),I[0]&12&&qe(t,"selected-cell",e[3]&&e[3].rowId===e[72]&&e[3].colIndex===e[76]),I[0]&1073741876&&qe(t,"highlight",e[5]&&e[4]&&e[4].colIndex===e[76]&&e[30](e[72],e[76]))},d(D){D&&v(t),h=!1,Le(w)}}}function Ve(e){let t=e[21](e[72]),r,o=t&&Xe(e);return{c(){o&&o.c(),r=Ne()},l(a){o&&o.l(a),r=Ne()},m(a,n){o&&o.m(a,n),ue(a,r,n)},p(a,n){n[0]&4&&(t=a[21](a[72])),t?o?o.p(a,n):(o=Xe(a),o.c(),o.m(r.parentNode,r)):o&&(o.d(1),o=null)},d(a){a&&v(r),o&&o.d(a)}}}function We(e){let t,r,o,a;function n(){e[58].call(r,e[70],e[71])}return{c(){t=R("td"),r=R("input"),this.h()},l(h){t=L(h,"TD",{class:!0});var w=H(t);r=L(w,"INPUT",{type:!0,class:!0}),w.forEach(v),this.h()},h(){d(r,"type","text"),d(r,"class","metro-input svelte-1qhmk4t"),d(t,"class","svelte-1qhmk4t")},m(h,w){ue(h,t,w),b(t,r),Oe(r,e[69]),o||(a=[K(r,"input",n),K(r,"paste",e[31]),K(r,"blur",e[32])],o=!0)},p(h,w){e=h,w[0]&512&&r.value!==e[69]&&Oe(r,e[69])},d(h){h&&v(t),o=!1,Le(a)}}}function Rt(e){var Te,Se,be,Ee;let t,r,o,a,n='<span class="hierarchy-toggle mif-tree svelte-1qhmk4t" title="Hierarchy"></span>',h,w,C,T,y,E,B,ne,D,I,Q='<span class="delete-button mif-bin svelte-1qhmk4t" title="Delete row"></span>',j,Z,x,A,V,M='<div class="hierarchy-controls svelte-1qhmk4t"><span class="hierarchy-spacer svelte-1qhmk4t"></span></div>',te,ee,ge='<div class="hierarchy-controls svelte-1qhmk4t"><span class="mif-chevron-thin-right"></span></div>',ie,pe,k,S,G,ce,N=we(((Se=(Te=e[2])==null?void 0:Te.getHeader)==null?void 0:Se.call(Te))??[]),O=[];for(let g=0;g<N.length;g+=1)O[g]=Ye(Ue(e,N,g));let fe=we(((Ee=(be=e[2])==null?void 0:be.getAllIds)==null?void 0:Ee.call(be))??[]),U=[];for(let g=0;g<fe.length;g+=1)U[g]=Ve(Fe(e,fe,g));let re=we(e[9]),W=[];for(let g=0;g<re.length;g+=1)W[g]=We(Me(e,re,g));return{c(){t=R("table"),r=R("thead"),o=R("tr"),a=R("th"),a.innerHTML=n,h=se(),w=R("th"),C=R("span"),T=R("span"),ne=se();for(let g=0;g<O.length;g+=1)O[g].c();D=se(),I=R("th"),I.innerHTML=Q,j=se(),Z=R("tbody");for(let g=0;g<U.length;g+=1)U[g].c();x=se(),A=R("tr"),V=R("td"),V.innerHTML=M,te=se(),ee=R("td"),ee.innerHTML=ge,ie=se();for(let g=0;g<W.length;g+=1)W[g].c();pe=se(),k=R("td"),this.h()},l(g){t=L(g,"TABLE",{class:!0,id:!0});var Y=H(t);r=L(Y,"THEAD",{});var F=H(r);o=L(F,"TR",{});var le=H(o);a=L(le,"TH",{class:!0,"data-svelte-h":!0}),Ae(a)!=="svelte-1focd0m"&&(a.innerHTML=n),h=ae(le),w=L(le,"TH",{class:!0});var _e=H(w);C=L(_e,"SPAN",{class:!0,role:!0,"aria-label":!0,title:!0});var ke=H(C);T=L(ke,"SPAN",{class:!0}),H(T).forEach(v),ke.forEach(v),_e.forEach(v),ne=ae(le);for(let oe=0;oe<O.length;oe+=1)O[oe].l(le);D=ae(le),I=L(le,"TH",{class:!0,"data-svelte-h":!0}),Ae(I)!=="svelte-89kh84"&&(I.innerHTML=Q),le.forEach(v),F.forEach(v),j=ae(Y),Z=L(Y,"TBODY",{});var m=H(Z);for(let oe=0;oe<U.length;oe+=1)U[oe].l(m);x=ae(m),A=L(m,"TR",{});var J=H(A);V=L(J,"TD",{class:!0,"data-svelte-h":!0}),Ae(V)!=="svelte-1r09gtc"&&(V.innerHTML=M),te=ae(J),ee=L(J,"TD",{class:!0,"data-svelte-h":!0}),Ae(ee)!=="svelte-18l50by"&&(ee.innerHTML=ge),ie=ae(J);for(let oe=0;oe<W.length;oe+=1)W[oe].l(J);pe=ae(J),k=L(J,"TD",{class:!0}),H(k).forEach(v),J.forEach(v),m.forEach(v),Y.forEach(v),this.h()},h(){d(a,"class","tree-column svelte-1qhmk4t"),d(T,"class",y=e[7]?"mif-tab":"mif-indent-increase"),d(C,"class","mode-toggle svelte-1qhmk4t"),d(C,"role","button"),d(C,"aria-label",E=e[7]?"Switch to level mode":"Switch to reorder mode"),d(C,"title",B=e[7]?"Switch to level mode":"Switch to reorder mode"),d(w,"class","control-column svelte-1qhmk4t"),d(I,"class","control-column svelte-1qhmk4t"),d(V,"class","tree-column svelte-1qhmk4t"),d(ee,"class","control-column svelte-1qhmk4t"),d(k,"class","control-column svelte-1qhmk4t"),d(t,"class","table subcompact table-border cell-border striped svelte-1qhmk4t"),d(t,"id",S=e[0]+"-table")},m(g,Y){ue(g,t,Y),b(t,r),b(r,o),b(o,a),b(o,h),b(o,w),b(w,C),b(C,T),b(o,ne);for(let F=0;F<O.length;F+=1)O[F]&&O[F].m(o,null);b(o,D),b(o,I),b(t,j),b(t,Z);for(let F=0;F<U.length;F+=1)U[F]&&U[F].m(Z,null);b(Z,x),b(Z,A),b(A,V),b(A,te),b(A,ee),b(A,ie);for(let F=0;F<W.length;F+=1)W[F]&&W[F].m(A,null);b(A,pe),b(A,k),e[59](t),G||(ce=[K(vt,"drop",e[39]),K(C,"click",e[36])],G=!0)},p(g,Y){var F,le,_e,ke;if(Y[0]&128&&y!==(y=g[7]?"mif-tab":"mif-indent-increase")&&d(T,"class",y),Y[0]&128&&E!==(E=g[7]?"Switch to level mode":"Switch to reorder mode")&&d(C,"aria-label",E),Y[0]&128&&B!==(B=g[7]?"Switch to level mode":"Switch to reorder mode")&&d(C,"title",B),Y[0]&4){N=we(((le=(F=g[2])==null?void 0:F.getHeader)==null?void 0:le.call(F))??[]);let m;for(m=0;m<N.length;m+=1){const J=Ue(g,N,m);O[m]?O[m].p(J,Y):(O[m]=Ye(J),O[m].c(),O[m].m(o,D))}for(;m<O.length;m+=1)O[m].d(1);O.length=N.length}if(Y[0]&2146435517|Y[1]&1757){fe=we(((ke=(_e=g[2])==null?void 0:_e.getAllIds)==null?void 0:ke.call(_e))??[]);let m;for(m=0;m<fe.length;m+=1){const J=Fe(g,fe,m);U[m]?U[m].p(J,Y):(U[m]=Ve(J),U[m].c(),U[m].m(Z,x))}for(;m<U.length;m+=1)U[m].d(1);U.length=fe.length}if(Y[0]&512|Y[1]&3){re=we(g[9]);let m;for(m=0;m<re.length;m+=1){const J=Me(g,re,m);W[m]?W[m].p(J,Y):(W[m]=We(J),W[m].c(),W[m].m(A,pe))}for(;m<W.length;m+=1)W[m].d(1);W.length=re.length}Y[0]&1&&S!==(S=g[0]+"-table")&&d(t,"id",S)},i:Pe,o:Pe,d(g){g&&v(t),He(O,g),He(U,g),He(W,g),e[59](null),G=!1,Le(ce)}}}function Lt(e,t,r){let o,a,n,h,w,C,T,y,E,B,ne,{name:D}=t,I=pt(D);he(e,I,l=>r(2,n=l));let Q=me([]);he(e,Q,l=>r(9,C=l));let j=me(!0);he(e,j,l=>r(7,o=l)),Q.reset=()=>Q.update(l=>{var s;return(s=n==null?void 0:n.getHeader())!=null&&s.length?Array(n.getHeader().length).fill(""):[]});let Z=me(null);he(e,Z,l=>r(4,E=l));let x=me(null);he(e,x,l=>r(42,y=l));let A=me(!1);he(e,A,l=>r(5,B=l));let V=me(null);he(e,V,l=>r(43,ne=l));let M,te=me(null);he(e,te,l=>r(3,T=l));let ee=me(null);he(e,ee,l=>r(65,a=l));let ge=me(null);he(e,ge,l=>r(66,w=l));let ie=me({});he(e,ie,l=>r(8,h=l));function pe(l){ie.update(s=>{const i={...s};return i[l]=!i[l],i}),I.update(s=>s)}function k(l){const s=h,i=n.getAllIds(),c=i.indexOf(l);if(c===-1)return!1;const f=n.getRowLevel(l);if(f<=1)return!0;for(let u=c-1;u>=0;u--){const _=i[u],p=n.getRowLevel(_);if(p<f){if(p===f-1)return s[_]?!1:k(_);continue}}return!0}function S(l){return n.getChildren(l).length>0}function G(l){const s=n.getRowLevel(l);return Math.max(0,s-1)}function ce(l){const s=n.getAllIds(),i=s.indexOf(l);if(i<=0)return;const c=n.getRowLevel(l),f=s[i-1],u=n.getRowLevel(f),_=Math.min(u+1,c+1);if(_===c)return;const p=n.getAllDescendants(l);I.update(P=>{P.setRowLevel(l,_);const X=_-c;return p.forEach($=>{const q=P.getRowLevel($);P.setRowLevel($,q+X)}),P})}function N(l){const s=n.getRowLevel(l);if(s<=1)return;const i=n.getAllDescendants(l);I.update(c=>(c.setRowLevel(l,s-1),i.forEach(f=>{const u=c.getRowLevel(f);c.setRowLevel(f,Math.max(1,u-1))}),c))}function O(l,s){s.key==="Tab"&&document.activeElement.tagName!=="INPUT"&&(s.preventDefault(),s.shiftKey?N(l):ce(l))}it(()=>{console.log("Testing new table creation:");const l=new Ce(["ID","Test1","Test2"]);console.log("Test Table Headers:",l.getHeader()),console.log("Test Table Full Headers:",l.getFullHeader()),console.log("Test Table Data:",l.toJSON());const s=c=>{if(!B||!E)return;const f=document.elementFromPoint(c.clientX,c.clientY);if(!f)return;const u=f.closest("td.data-cell");if(!u)return;const _=u.getAttribute("data-row-id"),p=parseInt(u.getAttribute("data-col-index"));if(!ne){const de=Math.abs(c.clientX-E.startX),ye=Math.abs(c.clientY-E.startY);(de>5||ye>5)&&V.set("rectangular")}x.set({rowId:_,colIndex:p}),document.querySelectorAll("td.data-cell").forEach(de=>{de.classList.remove("highlight")});const P=n.getAllIds(),X=P.indexOf(E.rowId),$=P.indexOf(_),[q,z]=X<$?[X,$]:[$,X],[ve,Ie]=E.colIndex<p?[E.colIndex,p]:[p,E.colIndex];document.querySelectorAll("td.data-cell").forEach(de=>{const ye=de.getAttribute("data-row-id"),De=parseInt(de.getAttribute("data-col-index")),Re=P.indexOf(ye);Re>=q&&Re<=z&&De>=ve&&De<=Ie&&de.classList.add("highlight")})},i=c=>{if(B&&E&&y){const f=document.elementFromPoint(c.clientX,c.clientY);if(f){const u=f.closest("td.data-cell");if(u){const _=u.getAttribute("data-row-id"),p=parseInt(u.getAttribute("data-col-index")),P=n.getRow(E.rowId);if(P){const X=P[E.colIndex];fe(E.rowId,_,E.colIndex,p,X)}}}}document.querySelectorAll("td.data-cell").forEach(f=>{f.classList.remove("highlight")}),A.set(!1),Z.set(null),x.set(null),te.set(null),V.set(null)};return document.addEventListener("pointermove",s),document.addEventListener("pointerup",i),()=>{document.removeEventListener("pointermove",s),document.removeEventListener("pointerup",i)}});function fe(l,s,i,c,f){const u=n.getAllIds(),_=u.indexOf(l),p=u.indexOf(s);if(_===-1||p===-1)return;const[P,X]=_<p?[_,p]:[p,_],[$,q]=i<c?[i,c]:[c,i],z=new Ce(n.getHeader());u.forEach((ve,Ie)=>{const de=n.getRow(ve),ye=n.getRowLevel(ve);if(de){const De=[...de];if(Ie>=P&&Ie<=X)for(let Re=$;Re<=q;Re++)De[Re]=f;z.add_rows([[ve,...De]]),z.setRowLevel(ve,ye)}}),I.set(z)}function U(l,s,i){const c=i.currentTarget.getBoundingClientRect(),f=i.clientX-c.left,u=i.clientY-c.top;f>c.width-8&&u>c.height-8&&(A.set(!0),Z.set({rowId:l,colIndex:s,startX:i.clientX,startY:i.clientY}),x.set({rowId:l,colIndex:s}),te.set({rowId:l,colIndex:s}),V.set(null),i.preventDefault(),i.stopPropagation())}function re(l,s,i){const c=i.currentTarget.getBoundingClientRect(),f=i.clientX-c.left,u=i.clientY-c.top;f>c.width-8&&u>c.height-8||((!T||T.rowId!==l||T.colIndex!==s)&&te.set({rowId:l,colIndex:s}),i.stopPropagation())}function W(){setTimeout(()=>{var l;!B&&((l=document.activeElement)==null?void 0:l.tagName)!=="INPUT"&&!document.querySelector(".data-cell:active")&&te.set(null)},50)}function Te(l,s){if(!B||!E||!y||E.colIndex!==s)return!1;const i=n.getAllIds(),c=i.indexOf(E.rowId),f=i.indexOf(l),u=i.indexOf(y.rowId);if(c===-1||f===-1||u===-1)return!1;const[_,p]=c<u?[c,u]:[u,c];return f>=_&&f<=p}function Se(l){let s=(l.clipboardData||window.clipboardData).getData("text");const i=s.includes(`
`),c=s.includes("	");if(i&&c){l.preventDefault();let f=s.split(/\n|\r/).filter(u=>u.length).map(u=>u.split(/\t/));I.update(u=>{if(f[0][0]!=="ID"){f[0].unshift("ID");for(let p=1;p<f.length;p++)f[p].unshift(String(p))}let _=new Ce(f[0]);return f.slice(1).forEach(p=>{p.length>0&&_.replace_rows([[p[0],...p]])}),_}),Q.reset()}else{const f=l.target.closest("tr")===l.target.closest("table").querySelector("tbody tr:last-child");setTimeout(f?()=>{Array.from(l.target.closest("tr").querySelectorAll("input")).some(_=>_.value.trim()!=="")&&be()}:()=>{const u=l.target.closest("td");if(u){const _=u.getAttribute("data-row-id");_?g(_):console.warn("No row ID found for paste target:",u)}else console.warn("No td element found for paste target:",l.target)},0)}}function be(){C.join("")!==""&&(I.update(l=>(l.replace_rows([[rowId,...updatedRow]]),l)),Q.reset())}function Ee(l){I.update(s=>(s.delete_row(l),s))}function g(l){if(!l){console.warn("onCellBlur called with invalid rowId:",l);return}const s=Array.from(document.querySelectorAll(`td.data-cell[data-row-id="${l}"] input`));if(!s||s.length===0){console.warn("onCellBlur: No input fields found for rowId:",l);return}const i=s.map(f=>f.value),c=n.getRowLevel(l);console.log(`onCellBlur for row ${l} (updated values):`,i);try{I.update(f=>(String(i[0])!==String(l)&&(i[0]=l),f.replace_rows([[l,...i]]),f.setRowLevel(l,c),f))}catch(f){console.error("Error updating row:",f);try{const u=n.getRow(l);if(u&&u.length>0){const _=u.map((p,P)=>P<i.length?i[P]:u[P]);_[0]=l,I.update(p=>(p.replace_rows([[l,..._]]),p.setRowLevel(l,c),p))}}catch(u){console.error("Error in fallback update:",u)}}}function Y(l,s,i){if(i.key==="Enter"||i.key==="ArrowDown"||i.key==="ArrowUp"){i.preventDefault();const c=n.getAllIds(),f=c.indexOf(l);let u;if(i.key==="ArrowUp"?u=f>0?f-1:f:u=f<c.length-1?f+1:f,u!==f){const _=c[u];te.set({rowId:_,colIndex:s}),setTimeout(function(){const p=document.querySelector(`td.data-cell[data-row-id="${_}"][data-col-index="${s}"] input`);p&&p.focus()},0)}}else if(i.key==="Tab"&&!i.ctrlKey&&!i.altKey&&!i.metaKey&&i.target.tagName==="INPUT"){const f=n.getAllIds().filter(X=>k(X)),u=f.indexOf(l),_=n.getHeader().length;let p=s,P=u;if(i.shiftKey)p--,p<0&&(P--,P<0?(P=0,p=0):p=_-1);else if(p++,p>=_)if(P++,P>=f.length){setTimeout(()=>{const X=document.querySelectorAll("tbody tr:last-child input");X.length>0&&X[0].focus()},0),i.preventDefault();return}else p=0;if(P!==u||p!==s){i.preventDefault();const X=f[P];te.set({rowId:X,colIndex:p}),setTimeout(()=>{const $=document.querySelector(`td.data-cell[data-row-id="${X}"][data-col-index="${p}"] input`);$&&$.focus()},0)}}}function F(){j.update(l=>!l)}function le(l,s){if(!o)return;s.dataTransfer.effectAllowed="move",ee.set(l);const i=s.target.closest("tr");if(i){i.classList.add("dragging");try{const c=i.cloneNode(!0);c.style.width=`${i.offsetWidth}px`,c.style.backgroundColor="#f5f5f5",c.style.opacity="0.8",c.style.position="absolute",c.style.top="-1000px",c.style.border="1px solid #0078A6",c.style.boxShadow="0 2px 5px rgba(0,0,0,0.2)",document.body.appendChild(c),s.dataTransfer.setDragImage(c,20,10),setTimeout(()=>{document.body.removeChild(c)},0)}catch(c){console.warn("Failed to create custom drag image:",c)}}}function _e(l,s){o&&(s.preventDefault(),s.dataTransfer.dropEffect="move",ge.set(l),document.querySelectorAll("tr").forEach(i=>{i.classList.remove("drag-over")}),s.currentTarget.closest("tr").classList.add("drag-over"))}function ke(l){if(o){if(l.preventDefault(),a&&w&&a!==w){const s=n.getAllIds(),i=s.indexOf(a),c=s.indexOf(w);if(i!==-1&&c!==-1){const f=n.getAllDescendants(a),u=new Ce(n.getHeader()),_=[...s],p=[_[i],...f];p.map(q=>_.indexOf(q)).sort((q,z)=>z-q).forEach(q=>{_.splice(q,1)});let X=_.indexOf(w);X===-1&&(X=_.length),_.splice(X,0,...p);let $=1;if(X>0){let q=X-1,z=_[q];for(;q>0&&!k(z);)q--,z=_[q];$=n.getRowLevel(z),S(z)&&h[z]&&($=n.getRowLevel(z))}_.forEach(q=>{const z=n.getRow(q),ve=n.getRowLevel(q);if(q===a)u.add_rows([[q,...z]]),u.setRowLevel(q,$);else if(f.includes(q)){const Ie=n.getRowLevel(q),de=n.getRowLevel(a),ye=Ie-de;u.add_rows([[q,...z]]),u.setRowLevel(q,$+ye)}else u.add_rows([[q,...z]]),u.setRowLevel(q,ve)}),I.set(u)}}ee.set(null),ge.set(null),document.querySelectorAll("tr").forEach(s=>{s.classList.remove("dragging","drag-over")})}}function m(){o&&(ee.set(null),ge.set(null),document.querySelectorAll("tr").forEach(l=>{l.classList.remove("dragging","drag-over")}))}async function J(l){D==="tasks"&&(console.log(`Splitting task ${l} into subtasks`),await _t.splitTask(l))}const oe=l=>pe(l),Je=l=>J(l),je=(l,s)=>le(l,s),Ge=l=>N(l),ze=l=>ce(l);function Qe(l,s){l[s]=this.value}const Ze=(l,s)=>{g(l);const i=s.relatedTarget,c=s.target.closest("td.data-cell");i&&c&&c.contains(i)||W()},$e=(l,s,i)=>Y(l,s,i),xe=(l,s,i)=>U(l,s,i),et=(l,s,i)=>re(l,s,i),tt=(l,s,i)=>Y(l,s,i),lt=l=>Ee(l),nt=(l,s)=>_e(l,s),rt=(l,s)=>O(l,s);function ot(l,s){l[s]=this.value,Q.set(C)}function st(l){ft[l?"unshift":"push"](()=>{M=l,r(6,M)})}return e.$$set=l=>{"name"in l&&r(0,D=l.name)},e.$$.update=()=>{if(e.$$.dirty[0]&8,e.$$.dirty[0]&16,e.$$.dirty[1]&2048,e.$$.dirty[0]&32,e.$$.dirty[1]&4096,e.$$.dirty[0]&6&&n!=null&&n.getHeader()&&(Q.set(Array(n.getHeader().length).fill("")),console.log("Table Headers:",n.getHeader()),console.log("Table Full Headers:",n.getFullHeader()),console.log("Table Data:",n.toJSON()),console.log("Table IDs:",n.getAllIds()),console.log("Raw Table Structure:",JSON.stringify(n)),n.getAllIds().length>0)){const l=n.getAllIds()[0];console.log("First Row:",n.getRow(l)),console.log("First Full Row:",n.getFullRow(l))}},[D,Q,n,T,E,B,M,o,h,C,I,j,Z,x,A,V,te,ee,ge,ie,pe,k,S,G,ce,N,O,U,re,W,Te,Se,be,Ee,g,Y,F,le,_e,ke,m,J,y,ne,oe,Je,je,Ge,ze,Qe,Ze,$e,xe,et,tt,lt,nt,rt,ot,st]}class Ht extends ht{constructor(t){super(),gt(this,t,Lt,Rt,at,{name:0},null,[-1,-1,-1])}}export{Ht as T,mt as g};
