import{d as L}from"./index.2391f01a.js";import{l as w,c as O,r as R}from"./criticalPath.store.4f990f9d.js";import{g as v}from"./gantt.store.e33e3c75.js";const A=L([O,R],([o,k])=>{let t=k.slice(0,1),b=k.slice(1).map(r=>{let u=r.slice(0,1);return u=u.concat(r.slice(1).map(d=>({free:w(d),allocations:[]}))),u});if(t=t.concat(b),o.map===void 0)return t;let h=Object.keys(o.map).sort((r,u)=>o.map[r].slack===o.map[u].slack?o.map[r].es>o.map[u].es?1:o.map[r].es<o.map[u].es?-1:0:o.map[r].slack>o.map[u].slack?1:-1),a=JSON.parse(JSON.stringify(o)),g=r=>{if(a.map[r].startDate!==void 0)return;let u=a.map[r].predecessors.reduce((e,n)=>(g(n),e===void 0||a.map[n].endDate>e?a.map[n].endDate:e),void 0),d=a.map[r].res.map(e=>e.map(s=>{let f=t[0].indexOf(s);return f<0&&(console.log("The resource",s,"in task",r,"is not defined in the resource table"),alert("The resource "+s+" in task "+r+" is not defined in the resource table")),f})),x=(e,n,s)=>{let f=0,l=t[e][n].free;if(isNaN(l)||l===0)return!1;for(;s>0;){if(e+f>=t.length)return!1;if(l=t[e+f][n].free,isNaN(l)){f++;continue}if(l===0)return!1;s-=l,f++}return!0},m;for(let e=1;e<t.length&&!(!(t[e][0]<=u)&&(m=d.reduce((n,s)=>{let f=!0;for(let l=0;l<s.length;l++)if(!x(e,s[l],a.map[r].expected)){f=!1;break}return f?{resIdList:s,row:e}:n},void 0),m!==void 0));e++);m===void 0&&alert("Task "+r+" could not be allocated. Please provide more resources or adjust constraints.");let D=(e,n,s)=>{let f=t[s][0],l,N,p=a.map[e].expected;for(let i=s;i<t.length;i++){let c=t[i][n].free;if(!isNaN(c))if(p>c)p-=c,t[i][n].allocations.push({task:e,amount:c}),t[i][n].free=0;else{t[i][n].free-=p,t[i][n].allocations.push({task:e,amount:p}),p=0,l=t[i][0],N=i;break}}a.map[e].startDate=f,a.map[e].endDate=l,a.map[e].resIdList.push(n),a.map[e].firstRow=s,a.map[e].lastRow=N};m.resIdList.forEach(e=>{D(r,e,m.row)})};return h.forEach(g),v.set(a),t});export{A as t};
