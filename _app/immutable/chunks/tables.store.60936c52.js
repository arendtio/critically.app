var A=(n,e,r)=>{if(!e.has(n))throw TypeError("Cannot "+r)};var o=(n,e,r)=>(A(n,e,"read from private field"),r?r.call(n):e.get(n)),w=(n,e,r)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,r)},h=(n,e,r,t)=>(A(n,e,"write to private field"),t?t.call(n,r):e.set(n,r),r);var d=(n,e,r)=>(A(n,e,"access private method"),r);import{w as D}from"./index.6deb0bed.js";var s,u,f,p,g,y;const _=class _{constructor(e){w(this,f);w(this,g);w(this,s,void 0);w(this,u,void 0);h(this,s,[e]),h(this,u,e)}getHeader(){return o(this,s)[0]}changeHeadings(e){if(e.length!==o(this,s)[0].length)throw new Error("New headings must have the same length as current headings");return o(this,s)[0]=e,this}getAllIds(){return o(this,s).slice(1).map(e=>e[0])}getRow(e){let r=d(this,f,p).call(this,e),t=o(this,s)[r];return t===void 0&&(t=[]),t}toJSON(){return Array.isArray(o(this,s))?o(this,s):[o(this,u)]}static fromJSON(e){const r=JSON.parse(e),t=new _(r[0]);return t.restore(r),t}restore(e){if(!Array.isArray(e))return console.error("Invalid data format for restore:",e),h(this,s,[o(this,u)]),this;const r=Array.isArray(e[0])?e[0]:o(this,u);h(this,s,[r]);for(let t=1;t<e.length;t++)Array.isArray(e[t])&&this.add_or_replace_row(e[t][0],e[t]);return this}add_or_replace_row(e,r){e||(e=r[0]);let t=d(this,f,p).call(this,e);return t===null?o(this,s).push(r):o(this,s)[t]=r,this}delete_row(e){let r=d(this,f,p).call(this,e);return o(this,s).splice(r,1),this}clear_table(){return h(this,s,[o(this,u)]),this}add_or_replace_column(e,r){if(r.length===0||r[0]!==e)throw console.error("Validation error: First value must be column name"),new Error("First value must be the column name");const t=o(this,s).length-1;if(r.length-1!==t)throw console.error("Validation error: Column values count mismatch"),new Error(`Column values must match number of rows (${t})`);let c=d(this,g,y).call(this,e);if(c===-1){c=o(this,s)[0].length,o(this,s)[0].push(e);for(let i=1;i<o(this,s).length;i++){const a=r[i];o(this,s)[i].push(a||"")}}else for(let i=0;i<t;i++){o(this,s)[i+1][c];const a=r[i+1];a!==""&&(o(this,s)[i+1][c]=a)}return this}delete_column(e){const r=d(this,g,y).call(this,e);if(r===-1)throw console.error("Error: Column does not exist"),new Error("Column does not exist");if(e==="Date")throw console.error("Error: Cannot delete Date column"),new Error("Cannot delete the Date column");return h(this,s,o(this,s).map(t=>{const c=[...t];return c.splice(r,1),c})),h(this,u,o(this,s)[0]),this}};s=new WeakMap,u=new WeakMap,f=new WeakSet,p=function(e){let r=o(this,s).slice(1).findIndex(t=>t[0]==e);return r===-1?null:r+1},g=new WeakSet,y=function(e){return o(this,s)[0].indexOf(e)};let l=_;const I=new Map;function R(n,e){let r=new l(e);I.set(n,D(r))}function C(n){return I.get(n)}function k(n){const e=new Set;return n.getAllIds().forEach(r=>{const c=n.getRow(r)[5];c&&c.split(/[,&]/).map(a=>a.trim()).filter(a=>a).forEach(a=>e.add(a))}),Array.from(e)}function H(n,e){const r=new l(e.getHeader()||["Date"]);try{const i=e.getAllIds();Array.isArray(i)&&i.forEach(a=>{const m=e.getRow(a);Array.isArray(m)&&r.add_or_replace_row(a,m)})}catch(i){console.error("Error copying existing rows:",i)}const t=k(n),c=r.getHeader().slice(1);return t.forEach(i=>{if(!c.includes(i)){const a=[i,...Array(r.getAllIds().length).fill("")];r.add_or_replace_column(i,a)}}),c.forEach(i=>{t.includes(i)||r.getAllIds().some(m=>{const x=r.getRow(m),E=r.getHeader().indexOf(i);return x[E]&&x[E].trim()!==""})||r.delete_column(i)}),r}const S=["Id","Task","Min","Likely","Max","Resources","Predecessors","Progress"];R("tasks",S);const b=["Date"];R("resources",b);const v=C("tasks"),N=C("resources");v.subscribe(n=>{if(!(n instanceof l)){console.error("Invalid table instance in subscription");return}N.update(e=>{try{e instanceof l||(e=new l(["Date"]));const r=H(n,e);return r instanceof l?r:new l(["Date"])}catch(r){return console.error("Error updating resources table:",r),new l(["Date"])}})});export{l as T,C as g};
