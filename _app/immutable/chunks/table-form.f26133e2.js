import{s as ot,f as D,a as se,g as E,h as N,B as Se,c as ae,d as b,j as u,i as me,r as m,v as W,w as Pe,x as Ne,y as Ee,z as fe,o as st,l as at,m as it,n as ct,e as Me,u as Oe,p as dt,D as Ce}from"./scheduler.427c93e9.js";import{e as we}from"./each.5e3737eb.js";import{S as ut,i as ft}from"./index.d4e4d1b7.js";import{g as ht,T as He}from"./tables.store.11ebb287.js";import{w as _e}from"./index.113f7b86.js";const gt=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;const{window:pt}=gt;function Fe(e,l,r){const o=e.slice();return o[67]=l[r],o[68]=l,o[69]=r,o}function qe(e,l,r){const o=e.slice();return o[70]=l[r],o}function Be(e,l,r){const o=e.slice();return o[67]=l[r],o[73]=l,o[74]=r,o}function Ue(e,l,r){const o=e.slice();return o[75]=l[r],o}function Ye(e){let l,r=e[75]+"",o;return{c(){l=D("th"),o=at(r)},l(i){l=E(i,"TH",{});var n=N(l);o=it(n,r),n.forEach(b)},m(i,n){me(i,l,n),m(l,o)},p(i,n){n[0]&4&&r!==(r=i[75]+"")&&ct(o,r)},d(i){i&&b(l)}}}function Xe(e){var ie,ge;let l,r,o,i,n,v,T,k,I,y,L,B,re,A;function R(w,C){return C[0]&4&&(i=null),i==null&&(i=!!w[22](w[70])),i?mt:_t}let Q=R(e,[-1,-1,-1]),J=Q(e);function Z(w,C){return w[7]?wt:vt}let x=Z(e),S=x(e),K=we(((ge=(ie=e[2])==null?void 0:ie.getRow)==null?void 0:ge.call(ie,e[70]))??[]),F=[];for(let w=0;w<K.length;w+=1)F[w]=Ke(Be(e,K,w));function te(){return e[53](e[70])}function ee(...w){return e[54](e[70],...w)}function he(...w){return e[55](e[70],...w)}return{c(){l=D("tr"),r=D("td"),o=D("div"),J.c(),n=se(),v=D("td"),T=D("div"),S.c(),k=se();for(let w=0;w<F.length;w+=1)F[w].c();I=se(),y=D("td"),L=D("div"),B=D("span"),this.h()},l(w){l=E(w,"TR",{});var C=N(l);r=E(C,"TD",{class:!0});var G=N(r);o=E(G,"DIV",{class:!0});var ce=N(o);J.l(ce),ce.forEach(b),G.forEach(b),n=ae(C),v=E(C,"TD",{class:!0});var O=N(v);T=E(O,"DIV",{class:!0});var P=N(T);S.l(P),P.forEach(b),O.forEach(b),k=ae(C);for(let ne=0;ne<F.length;ne+=1)F[ne].l(C);I=ae(C),y=E(C,"TD",{class:!0});var ue=N(y);L=E(ue,"DIV",{class:!0});var U=N(L);B=E(U,"SPAN",{class:!0,role:!0,"aria-label":!0,title:!0}),N(B).forEach(b),U.forEach(b),ue.forEach(b),C.forEach(b),this.h()},h(){u(o,"class","hierarchy-controls svelte-1rmcdss"),u(r,"class","tree-column svelte-1rmcdss"),u(T,"class","hierarchy-controls svelte-1rmcdss"),u(v,"class","control-column svelte-1rmcdss"),u(B,"class","delete-button mif-cross-light svelte-1rmcdss"),u(B,"role","button"),u(B,"aria-label","Delete row"),u(B,"title","Delete row"),u(L,"class","hierarchy-controls svelte-1rmcdss"),u(y,"class","control-column svelte-1rmcdss")},m(w,C){me(w,l,C),m(l,r),m(r,o),J.m(o,null),m(l,n),m(l,v),m(v,T),S.m(T,null),m(l,k);for(let G=0;G<F.length;G+=1)F[G]&&F[G].m(l,null);m(l,I),m(l,y),m(y,L),m(L,B),re||(A=[W(B,"click",te),W(l,"dragover",ee),W(l,"keydown",he)],re=!0)},p(w,C){var G,ce;if(e=w,Q===(Q=R(e,C))&&J?J.p(e,C):(J.d(1),J=Q(e),J&&(J.c(),J.m(o,null))),x===(x=Z(e))&&S?S.p(e,C):(S.d(1),S=x(e),S&&(S.c(),S.m(T,null))),C[0]&2021654588|C[1]&25){K=we(((ce=(G=e[2])==null?void 0:G.getRow)==null?void 0:ce.call(G,e[70]))??[]);let O;for(O=0;O<K.length;O+=1){const P=Be(e,K,O);F[O]?F[O].p(P,C):(F[O]=Ke(P),F[O].c(),F[O].m(l,I))}for(;O<F.length;O+=1)F[O].d(1);F.length=K.length}},d(w){w&&b(l),J.d(),S.d(),Ne(F,w),re=!1,Ee(A)}}}function _t(e){let l;return{c(){l=D("span"),this.h()},l(r){l=E(r,"SPAN",{class:!0}),N(l).forEach(b),this.h()},h(){u(l,"class","hierarchy-spacer svelte-1rmcdss")},m(r,o){me(r,l,o)},p:Pe,d(r){r&&b(l)}}}function mt(e){let l,r,o,i,n,v,T;function k(){return e[43](e[70])}return{c(){l=D("span"),r=D("span"),this.h()},l(I){l=E(I,"SPAN",{class:!0,role:!0,"aria-label":!0,title:!0});var y=N(l);r=E(y,"SPAN",{class:!0}),N(r).forEach(b),y.forEach(b),this.h()},h(){u(r,"class",o=e[8][e[70]]?"mif-plus":"mif-minus"),u(l,"class","hierarchy-toggle svelte-1rmcdss"),u(l,"role","button"),u(l,"aria-label",i=e[8][e[70]]?"Expand":"Collapse"),u(l,"title",n=e[8][e[70]]?"Expand":"Collapse")},m(I,y){me(I,l,y),m(l,r),v||(T=W(l,"click",k),v=!0)},p(I,y){e=I,y[0]&260&&o!==(o=e[8][e[70]]?"mif-plus":"mif-minus")&&u(r,"class",o),y[0]&260&&i!==(i=e[8][e[70]]?"Expand":"Collapse")&&u(l,"aria-label",i),y[0]&260&&n!==(n=e[8][e[70]]?"Expand":"Collapse")&&u(l,"title",n)},d(I){I&&b(l),v=!1,T()}}}function vt(e){let l,r,o,i,n,v;function T(){return e[45](e[70])}function k(){return e[46](e[70])}return{c(){l=D("div"),r=D("span"),o=se(),i=D("span"),this.h()},l(I){l=E(I,"DIV",{});var y=N(l);r=E(y,"SPAN",{class:!0,role:!0,"aria-label":!0,title:!0}),N(r).forEach(b),o=ae(y),i=E(y,"SPAN",{class:!0,role:!0,"aria-label":!0,title:!0}),N(i).forEach(b),y.forEach(b),this.h()},h(){u(r,"class","level-control mif-arrow-left svelte-1rmcdss"),u(r,"role","button"),u(r,"aria-label","Decrease indentation level"),u(r,"title","Decrease indentation level (Shift+Tab)"),u(i,"class","level-control mif-arrow-right svelte-1rmcdss"),u(i,"role","button"),u(i,"aria-label","Increase indentation level"),u(i,"title","Increase indentation level (Tab)")},m(I,y){me(I,l,y),m(l,r),m(l,o),m(l,i),n||(v=[W(r,"click",T),W(i,"click",k)],n=!0)},p(I,y){e=I},d(I){I&&b(l),n=!1,Ee(v)}}}function wt(e){let l,r,o;function i(...n){return e[44](e[70],...n)}return{c(){l=D("span"),this.h()},l(n){l=E(n,"SPAN",{class:!0,role:!0,"aria-label":!0,title:!0,draggable:!0}),N(l).forEach(b),this.h()},h(){u(l,"class","reorder-handle mif-unfold-more svelte-1rmcdss"),u(l,"role","button"),u(l,"aria-label","Drag to reorder"),u(l,"title","Drag to reorder"),u(l,"draggable",!0)},m(n,v){me(n,l,v),r||(o=[W(l,"dragstart",i),W(l,"dragend",e[40])],r=!0)},p(n,v){e=n},d(n){n&&b(l),r=!1,Ee(o)}}}function Ke(e){let l,r,o,i,n,v,T;function k(){e[47].call(r,e[73],e[74])}function I(...A){return e[48](e[70],...A)}function y(...A){return e[49](e[70],e[74],...A)}function L(...A){return e[50](e[70],e[74],...A)}function B(...A){return e[51](e[70],e[74],...A)}function re(...A){return e[52](e[70],e[74],...A)}return{c(){l=D("td"),r=D("input"),o=se(),this.h()},l(A){l=E(A,"TD",{class:!0,style:!0,"data-row-id":!0,"data-col-index":!0});var R=N(l);r=E(R,"INPUT",{type:!0,class:!0}),o=ae(R),R.forEach(b),this.h()},h(){u(r,"type","text"),u(r,"class","metro-input svelte-1rmcdss"),u(l,"class","data-cell svelte-1rmcdss"),u(l,"style",i=e[74]===0&&e[23](e[70])>0?`padding-left: ${e[23](e[70])*16}px;`:""),u(l,"data-row-id",n=e[70]),u(l,"data-col-index",e[74]),Ce(l,"selected-cell",e[3]&&e[3].rowId===e[70]&&e[3].colIndex===e[74]),Ce(l,"highlight",e[5]&&e[4]&&e[4].colIndex===e[74]&&e[30](e[70],e[74]))},m(A,R){me(A,l,R),m(l,r),Oe(r,e[67]),m(l,o),v||(T=[W(r,"input",k),W(r,"paste",e[31]),W(r,"blur",I),W(r,"keydown",y),W(l,"pointerdown",L),W(l,"click",B),W(l,"keydown",re)],v=!0)},p(A,R){e=A,R[0]&4&&r.value!==e[67]&&Oe(r,e[67]),R[0]&4&&i!==(i=e[74]===0&&e[23](e[70])>0?`padding-left: ${e[23](e[70])*16}px;`:"")&&u(l,"style",i),R[0]&4&&n!==(n=e[70])&&u(l,"data-row-id",n),R[0]&12&&Ce(l,"selected-cell",e[3]&&e[3].rowId===e[70]&&e[3].colIndex===e[74]),R[0]&1073741876&&Ce(l,"highlight",e[5]&&e[4]&&e[4].colIndex===e[74]&&e[30](e[70],e[74]))},d(A){A&&b(l),v=!1,Ee(T)}}}function Ve(e){let l=e[21](e[70]),r,o=l&&Xe(e);return{c(){o&&o.c(),r=Me()},l(i){o&&o.l(i),r=Me()},m(i,n){o&&o.m(i,n),me(i,r,n)},p(i,n){n[0]&4&&(l=i[21](i[70])),l?o?o.p(i,n):(o=Xe(i),o.c(),o.m(r.parentNode,r)):o&&(o.d(1),o=null)},d(i){i&&b(r),o&&o.d(i)}}}function We(e){let l,r,o,i;function n(){e[56].call(r,e[68],e[69])}return{c(){l=D("td"),r=D("input"),this.h()},l(v){l=E(v,"TD",{class:!0});var T=N(l);r=E(T,"INPUT",{type:!0,class:!0}),T.forEach(b),this.h()},h(){u(r,"type","text"),u(r,"class","metro-input svelte-1rmcdss"),u(l,"class","svelte-1rmcdss")},m(v,T){me(v,l,T),m(l,r),Oe(r,e[67]),o||(i=[W(r,"input",n),W(r,"paste",e[31]),W(r,"blur",e[32])],o=!0)},p(v,T){e=v,T[0]&512&&r.value!==e[67]&&Oe(r,e[67])},d(v){v&&b(l),o=!1,Ee(i)}}}function bt(e){var Ie,Ae,be,Le;let l,r,o,i,n='<span class="hierarchy-toggle mif-tree svelte-1rmcdss" title="Hierarchy"></span>',v,T,k,I,y,L,B,re,A,R,Q='<span class="delete-button mif-bin svelte-1rmcdss" title="Delete row"></span>',J,Z,x,S,K,F='<div class="hierarchy-controls svelte-1rmcdss"><span class="hierarchy-spacer svelte-1rmcdss"></span></div>',te,ee,he='<div class="hierarchy-controls svelte-1rmcdss"><span class="mif-chevron-thin-right"></span></div>',ie,ge,w,C,G,ce,O=we(((Ae=(Ie=e[2])==null?void 0:Ie.getHeader)==null?void 0:Ae.call(Ie))??[]),P=[];for(let h=0;h<O.length;h+=1)P[h]=Ye(Ue(e,O,h));let ue=we(((Le=(be=e[2])==null?void 0:be.getAllIds)==null?void 0:Le.call(be))??[]),U=[];for(let h=0;h<ue.length;h+=1)U[h]=Ve(qe(e,ue,h));let ne=we(e[9]),V=[];for(let h=0;h<ne.length;h+=1)V[h]=We(Fe(e,ne,h));return{c(){l=D("table"),r=D("thead"),o=D("tr"),i=D("th"),i.innerHTML=n,v=se(),T=D("th"),k=D("span"),I=D("span"),re=se();for(let h=0;h<P.length;h+=1)P[h].c();A=se(),R=D("th"),R.innerHTML=Q,J=se(),Z=D("tbody");for(let h=0;h<U.length;h+=1)U[h].c();x=se(),S=D("tr"),K=D("td"),K.innerHTML=F,te=se(),ee=D("td"),ee.innerHTML=he,ie=se();for(let h=0;h<V.length;h+=1)V[h].c();ge=se(),w=D("td"),this.h()},l(h){l=E(h,"TABLE",{class:!0,id:!0});var Y=N(l);r=E(Y,"THEAD",{});var q=N(r);o=E(q,"TR",{});var le=N(o);i=E(le,"TH",{class:!0,"data-svelte-h":!0}),Se(i)!=="svelte-1focd0m"&&(i.innerHTML=n),v=ae(le),T=E(le,"TH",{class:!0});var pe=N(T);k=E(pe,"SPAN",{class:!0,role:!0,"aria-label":!0,title:!0});var ye=N(k);I=E(ye,"SPAN",{class:!0}),N(I).forEach(b),ye.forEach(b),pe.forEach(b),re=ae(le);for(let oe=0;oe<P.length;oe+=1)P[oe].l(le);A=ae(le),R=E(le,"TH",{class:!0,"data-svelte-h":!0}),Se(R)!=="svelte-89kh84"&&(R.innerHTML=Q),le.forEach(b),q.forEach(b),J=ae(Y),Z=E(Y,"TBODY",{});var _=N(Z);for(let oe=0;oe<U.length;oe+=1)U[oe].l(_);x=ae(_),S=E(_,"TR",{});var j=N(S);K=E(j,"TD",{class:!0,"data-svelte-h":!0}),Se(K)!=="svelte-1r09gtc"&&(K.innerHTML=F),te=ae(j),ee=E(j,"TD",{class:!0,"data-svelte-h":!0}),Se(ee)!=="svelte-18l50by"&&(ee.innerHTML=he),ie=ae(j);for(let oe=0;oe<V.length;oe+=1)V[oe].l(j);ge=ae(j),w=E(j,"TD",{class:!0}),N(w).forEach(b),j.forEach(b),_.forEach(b),Y.forEach(b),this.h()},h(){u(i,"class","tree-column svelte-1rmcdss"),u(I,"class",y=e[7]?"mif-tab":"mif-indent-increase"),u(k,"class","mode-toggle svelte-1rmcdss"),u(k,"role","button"),u(k,"aria-label",L=e[7]?"Switch to level mode":"Switch to reorder mode"),u(k,"title",B=e[7]?"Switch to level mode":"Switch to reorder mode"),u(T,"class","control-column svelte-1rmcdss"),u(R,"class","control-column svelte-1rmcdss"),u(K,"class","tree-column svelte-1rmcdss"),u(ee,"class","control-column svelte-1rmcdss"),u(w,"class","control-column svelte-1rmcdss"),u(l,"class","table subcompact table-border cell-border striped svelte-1rmcdss"),u(l,"id",C=e[0]+"-table")},m(h,Y){me(h,l,Y),m(l,r),m(r,o),m(o,i),m(o,v),m(o,T),m(T,k),m(k,I),m(o,re);for(let q=0;q<P.length;q+=1)P[q]&&P[q].m(o,null);m(o,A),m(o,R),m(l,J),m(l,Z);for(let q=0;q<U.length;q+=1)U[q]&&U[q].m(Z,null);m(Z,x),m(Z,S),m(S,K),m(S,te),m(S,ee),m(S,ie);for(let q=0;q<V.length;q+=1)V[q]&&V[q].m(S,null);m(S,ge),m(S,w),e[57](l),G||(ce=[W(pt,"drop",e[39]),W(k,"click",e[36])],G=!0)},p(h,Y){var q,le,pe,ye;if(Y[0]&128&&y!==(y=h[7]?"mif-tab":"mif-indent-increase")&&u(I,"class",y),Y[0]&128&&L!==(L=h[7]?"Switch to level mode":"Switch to reorder mode")&&u(k,"aria-label",L),Y[0]&128&&B!==(B=h[7]?"Switch to level mode":"Switch to reorder mode")&&u(k,"title",B),Y[0]&4){O=we(((le=(q=h[2])==null?void 0:q.getHeader)==null?void 0:le.call(q))??[]);let _;for(_=0;_<O.length;_+=1){const j=Ue(h,O,_);P[_]?P[_].p(j,Y):(P[_]=Ye(j),P[_].c(),P[_].m(o,A))}for(;_<P.length;_+=1)P[_].d(1);P.length=O.length}if(Y[0]&2146435516|Y[1]&733){ue=we(((ye=(pe=h[2])==null?void 0:pe.getAllIds)==null?void 0:ye.call(pe))??[]);let _;for(_=0;_<ue.length;_+=1){const j=qe(h,ue,_);U[_]?U[_].p(j,Y):(U[_]=Ve(j),U[_].c(),U[_].m(Z,x))}for(;_<U.length;_+=1)U[_].d(1);U.length=ue.length}if(Y[0]&512|Y[1]&3){ne=we(h[9]);let _;for(_=0;_<ne.length;_+=1){const j=Fe(h,ne,_);V[_]?V[_].p(j,Y):(V[_]=We(j),V[_].c(),V[_].m(S,ge))}for(;_<V.length;_+=1)V[_].d(1);V.length=ne.length}Y[0]&1&&C!==(C=h[0]+"-table")&&u(l,"id",C)},i:Pe,o:Pe,d(h){h&&b(l),Ne(P,h),Ne(U,h),Ne(V,h),e[57](null),G=!1,Ee(ce)}}}function yt(e,l,r){let o,i,n,v,T,k,I,y,L,B,re,{name:A}=l,R=ht(A);fe(e,R,t=>r(2,n=t));let Q=_e([]);fe(e,Q,t=>r(9,k=t));let J=_e(!0);fe(e,J,t=>r(7,o=t)),Q.reset=()=>Q.update(t=>{var s;return(s=n==null?void 0:n.getHeader())!=null&&s.length?Array(n.getHeader().length).fill(""):[]});let Z=_e(null);fe(e,Z,t=>r(4,L=t));let x=_e(null);fe(e,x,t=>r(41,y=t));let S=_e(!1);fe(e,S,t=>r(5,B=t));let K=_e(null);fe(e,K,t=>r(42,re=t));let F,te=_e(null);fe(e,te,t=>r(3,I=t));let ee=_e(null);fe(e,ee,t=>r(63,i=t));let he=_e(null);fe(e,he,t=>r(64,T=t));let ie=_e({});fe(e,ie,t=>r(8,v=t));function ge(t){ie.update(s=>{const a={...s};return a[t]=!a[t],a}),R.update(s=>s)}function w(t){const s=v,a=n.getAllIds(),c=a.indexOf(t);if(c===-1)return!1;const f=n.getRowLevel(t);if(f<=1)return!0;for(let d=c-1;d>=0;d--){const p=a[d],g=n.getRowLevel(p);if(g<f){if(g===f-1)return s[p]?!1:w(p);continue}}return!0}function C(t){return n.getChildren(t).length>0}function G(t){const s=n.getRowLevel(t);return Math.max(0,s-1)}function ce(t){const s=n.getAllIds(),a=s.indexOf(t);if(a<=0)return;const c=n.getRowLevel(t),f=s[a-1],d=n.getRowLevel(f),p=Math.min(d+1,c+1);if(p===c)return;const g=n.getAllDescendants(t);R.update(M=>{M.setRowLevel(t,p);const X=p-c;return g.forEach($=>{const H=M.getRowLevel($);M.setRowLevel($,H+X)}),M})}function O(t){const s=n.getRowLevel(t);if(s<=1)return;const a=n.getAllDescendants(t);R.update(c=>(c.setRowLevel(t,s-1),a.forEach(f=>{const d=c.getRowLevel(f);c.setRowLevel(f,Math.max(1,d-1))}),c))}function P(t,s){s.key==="Tab"&&document.activeElement.tagName!=="INPUT"&&(s.preventDefault(),s.shiftKey?O(t):ce(t))}st(()=>{console.log("Testing new table creation:");const t=new He(["ID","Test1","Test2"]);console.log("Test Table Headers:",t.getHeader()),console.log("Test Table Full Headers:",t.getFullHeader()),console.log("Test Table Data:",t.toJSON());const s=c=>{if(!B||!L)return;const f=document.elementFromPoint(c.clientX,c.clientY);if(!f)return;const d=f.closest("td.data-cell");if(!d)return;const p=d.getAttribute("data-row-id"),g=parseInt(d.getAttribute("data-col-index"));if(!re){const de=Math.abs(c.clientX-L.startX),Te=Math.abs(c.clientY-L.startY);(de>5||Te>5)&&K.set("rectangular")}x.set({rowId:p,colIndex:g}),document.querySelectorAll("td.data-cell").forEach(de=>{de.classList.remove("highlight")});const M=n.getAllIds(),X=M.indexOf(L.rowId),$=M.indexOf(p),[H,z]=X<$?[X,$]:[$,X],[ve,Re]=L.colIndex<g?[L.colIndex,g]:[g,L.colIndex];document.querySelectorAll("td.data-cell").forEach(de=>{const Te=de.getAttribute("data-row-id"),ke=parseInt(de.getAttribute("data-col-index")),De=M.indexOf(Te);De>=H&&De<=z&&ke>=ve&&ke<=Re&&de.classList.add("highlight")})},a=c=>{if(B&&L&&y){const f=document.elementFromPoint(c.clientX,c.clientY);if(f){const d=f.closest("td.data-cell");if(d){const p=d.getAttribute("data-row-id"),g=parseInt(d.getAttribute("data-col-index")),M=n.getRow(L.rowId);if(M){const X=M[L.colIndex];ue(L.rowId,p,L.colIndex,g,X)}}}}document.querySelectorAll("td.data-cell").forEach(f=>{f.classList.remove("highlight")}),S.set(!1),Z.set(null),x.set(null),te.set(null),K.set(null)};return document.addEventListener("pointermove",s),document.addEventListener("pointerup",a),()=>{document.removeEventListener("pointermove",s),document.removeEventListener("pointerup",a)}});function ue(t,s,a,c,f){const d=n.getAllIds(),p=d.indexOf(t),g=d.indexOf(s);if(p===-1||g===-1)return;const[M,X]=p<g?[p,g]:[g,p],[$,H]=a<c?[a,c]:[c,a],z=new He(n.getHeader());d.forEach((ve,Re)=>{const de=n.getRow(ve),Te=n.getRowLevel(ve);if(de){const ke=[...de];if(Re>=M&&Re<=X)for(let De=$;De<=H;De++)ke[De]=f;z.add_or_replace_row(ve,ke),z.setRowLevel(ve,Te)}}),R.set(z)}function U(t,s,a){const c=a.currentTarget.getBoundingClientRect(),f=a.clientX-c.left,d=a.clientY-c.top;f>c.width-8&&d>c.height-8&&(S.set(!0),Z.set({rowId:t,colIndex:s,startX:a.clientX,startY:a.clientY}),x.set({rowId:t,colIndex:s}),te.set({rowId:t,colIndex:s}),K.set(null),a.preventDefault(),a.stopPropagation())}function ne(t,s,a){const c=a.currentTarget.getBoundingClientRect(),f=a.clientX-c.left,d=a.clientY-c.top;f>c.width-8&&d>c.height-8||((!I||I.rowId!==t||I.colIndex!==s)&&te.set({rowId:t,colIndex:s}),a.stopPropagation())}function V(){setTimeout(()=>{var t;!B&&((t=document.activeElement)==null?void 0:t.tagName)!=="INPUT"&&!document.querySelector(".data-cell:active")&&te.set(null)},50)}function Ie(t,s){if(!B||!L||!y||L.colIndex!==s)return!1;const a=n.getAllIds(),c=a.indexOf(L.rowId),f=a.indexOf(t),d=a.indexOf(y.rowId);if(c===-1||f===-1||d===-1)return!1;const[p,g]=c<d?[c,d]:[d,c];return f>=p&&f<=g}function Ae(t){let s=(t.clipboardData||window.clipboardData).getData("text");const a=s.includes(`
`),c=s.includes("	");if(a&&c){t.preventDefault();let f=s.split(/\n|\r/).filter(d=>d.length).map(d=>d.split(/\t/));R.update(d=>{if(f[0][0]!=="ID"){f[0].unshift("ID");for(let g=1;g<f.length;g++)f[g].unshift(String(g))}let p=new He(f[0]);return f.slice(1).forEach(g=>{g.length>0&&p.add_or_replace_row(g[0],g)}),p}),Q.reset()}else{const f=t.target.closest("tr")===t.target.closest("table").querySelector("tbody tr:last-child");setTimeout(f?()=>{Array.from(t.target.closest("tr").querySelectorAll("input")).some(p=>p.value.trim()!=="")&&be()}:()=>{const d=t.target.closest("td");if(d){const p=d.getAttribute("data-row-id");p?h(p):console.warn("No row ID found for paste target:",d)}else console.warn("No td element found for paste target:",t.target)},0)}}function be(){k.join("")!==""&&(R.update(t=>(t.add_or_replace_row(k[0],k),t)),Q.reset())}function Le(t){R.update(s=>(s.delete_row(t),s))}function h(t){if(!t){console.warn("onCellBlur called with invalid rowId:",t);return}const s=Array.from(document.querySelectorAll(`td.data-cell[data-row-id="${t}"] input`));if(!s||s.length===0){console.warn("onCellBlur: No input fields found for rowId:",t);return}const a=s.map(f=>f.value),c=n.getRowLevel(t);console.log(`onCellBlur for row ${t} (updated values):`,a);try{R.update(f=>(String(a[0])!==String(t)&&(a[0]=t),f.add_or_replace_row(t,a),f.setRowLevel(t,c),f))}catch(f){console.error("Error updating row:",f);try{const d=n.getRow(t);if(d&&d.length>0){const p=d.map((g,M)=>M<a.length?a[M]:d[M]);p[0]=t,R.update(g=>(g.add_or_replace_row(t,p),g.setRowLevel(t,c),g))}}catch(d){console.error("Error in fallback update:",d)}}}function Y(t,s,a){if(a.key==="Enter"||a.key==="ArrowDown"||a.key==="ArrowUp"){a.preventDefault();const c=n.getAllIds(),f=c.indexOf(t);let d;if(a.key==="ArrowUp"?d=f>0?f-1:f:d=f<c.length-1?f+1:f,d!==f){const p=c[d];te.set({rowId:p,colIndex:s}),setTimeout(function(){const g=document.querySelector(`td.data-cell[data-row-id="${p}"][data-col-index="${s}"] input`);g&&g.focus()},0)}}else if(a.key==="Tab"&&!a.ctrlKey&&!a.altKey&&!a.metaKey&&a.target.tagName==="INPUT"){const f=n.getAllIds().filter(X=>w(X)),d=f.indexOf(t),p=n.getHeader().length;let g=s,M=d;if(a.shiftKey)g--,g<0&&(M--,M<0?(M=0,g=0):g=p-1);else if(g++,g>=p)if(M++,M>=f.length){setTimeout(()=>{const X=document.querySelectorAll("tbody tr:last-child input");X.length>0&&X[0].focus()},0),a.preventDefault();return}else g=0;if(M!==d||g!==s){a.preventDefault();const X=f[M];te.set({rowId:X,colIndex:g}),setTimeout(()=>{const $=document.querySelector(`td.data-cell[data-row-id="${X}"][data-col-index="${g}"] input`);$&&$.focus()},0)}}}function q(){J.update(t=>!t)}function le(t,s){if(!o)return;s.dataTransfer.effectAllowed="move",ee.set(t);const a=s.target.closest("tr");if(a){a.classList.add("dragging");try{const c=a.cloneNode(!0);c.style.width=`${a.offsetWidth}px`,c.style.backgroundColor="#f5f5f5",c.style.opacity="0.8",c.style.position="absolute",c.style.top="-1000px",c.style.border="1px solid #0078A6",c.style.boxShadow="0 2px 5px rgba(0,0,0,0.2)",document.body.appendChild(c),s.dataTransfer.setDragImage(c,20,10),setTimeout(()=>{document.body.removeChild(c)},0)}catch(c){console.warn("Failed to create custom drag image:",c)}}}function pe(t,s){o&&(s.preventDefault(),s.dataTransfer.dropEffect="move",he.set(t),document.querySelectorAll("tr").forEach(a=>{a.classList.remove("drag-over")}),s.currentTarget.closest("tr").classList.add("drag-over"))}function ye(t){if(o){if(t.preventDefault(),i&&T&&i!==T){const s=n.getAllIds(),a=s.indexOf(i),c=s.indexOf(T);if(a!==-1&&c!==-1){const f=n.getAllDescendants(i),d=new He(n.getHeader()),p=[...s],g=[p[a],...f];g.map(H=>p.indexOf(H)).sort((H,z)=>z-H).forEach(H=>{p.splice(H,1)});let X=p.indexOf(T);X===-1&&(X=p.length),p.splice(X,0,...g);let $=1;if(X>0){let H=X-1,z=p[H];for(;H>0&&!w(z);)H--,z=p[H];$=n.getRowLevel(z),C(z)&&v[z]&&($=n.getRowLevel(z))}p.forEach(H=>{const z=n.getRow(H),ve=n.getRowLevel(H);if(H===i)d.add_or_replace_row(H,z),d.setRowLevel(H,$);else if(f.includes(H)){const Re=n.getRowLevel(H),de=n.getRowLevel(i),Te=Re-de;d.add_or_replace_row(H,z),d.setRowLevel(H,$+Te)}else d.add_or_replace_row(H,z),d.setRowLevel(H,ve)}),R.set(d)}}ee.set(null),he.set(null),document.querySelectorAll("tr").forEach(s=>{s.classList.remove("dragging","drag-over")})}}function _(){o&&(ee.set(null),he.set(null),document.querySelectorAll("tr").forEach(t=>{t.classList.remove("dragging","drag-over")}))}const j=t=>ge(t),oe=(t,s)=>le(t,s),Je=t=>O(t),je=t=>ce(t);function Ge(t,s){t[s]=this.value}const ze=(t,s)=>{h(t);const a=s.relatedTarget,c=s.target.closest("td.data-cell");a&&c&&c.contains(a)||V()},Qe=(t,s,a)=>Y(t,s,a),Ze=(t,s,a)=>U(t,s,a),$e=(t,s,a)=>ne(t,s,a),xe=(t,s,a)=>Y(t,s,a),et=t=>Le(t),tt=(t,s)=>pe(t,s),lt=(t,s)=>P(t,s);function rt(t,s){t[s]=this.value,Q.set(k)}function nt(t){dt[t?"unshift":"push"](()=>{F=t,r(6,F)})}return e.$$set=t=>{"name"in t&&r(0,A=t.name)},e.$$.update=()=>{if(e.$$.dirty[0]&8,e.$$.dirty[0]&16,e.$$.dirty[1]&1024,e.$$.dirty[0]&32,e.$$.dirty[1]&2048,e.$$.dirty[0]&6&&n!=null&&n.getHeader()&&(Q.set(Array(n.getHeader().length).fill("")),console.log("Table Headers:",n.getHeader()),console.log("Table Full Headers:",n.getFullHeader()),console.log("Table Data:",n.toJSON()),console.log("Table IDs:",n.getAllIds()),console.log("Raw Table Structure:",JSON.stringify(n)),n.getAllIds().length>0)){const t=n.getAllIds()[0];console.log("First Row:",n.getRow(t)),console.log("First Full Row:",n.getFullRow(t))}},[A,Q,n,I,L,B,F,o,v,k,R,J,Z,x,S,K,te,ee,he,ie,ge,w,C,G,ce,O,P,U,ne,V,Ie,Ae,be,Le,h,Y,q,le,pe,ye,_,y,re,j,oe,Je,je,Ge,ze,Qe,Ze,$e,xe,et,tt,lt,rt,nt]}class Lt extends ut{constructor(l){super(),ft(this,l,yt,bt,ot,{name:0},null,[-1,-1,-1])}}export{Lt as T,gt as g};
