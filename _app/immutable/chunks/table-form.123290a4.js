import{s as mt,f as A,a as ce,g as L,h as q,B as Ae,c as ue,d as v,j as u,i as ee,r as y,v as Y,a5 as Oe,w as Ne,x as qe,y as Ce,z as ge,o as vt,e as ve,p as wt,l as bt,m as kt,n as It,u as Ue,C as Se}from"./scheduler.d96d3362.js";import{e as Re}from"./each.8281f9b4.js";import{S as yt,i as Rt}from"./index.c23aaf79.js";import{g as Et,T as Tt}from"./tables.store.38b25df8.js";import{w as me}from"./index.9f5fd596.js";import{d as Ct}from"./assistant.store.58c697f4.js";const At=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;const{window:Be}=At;function Fe(e,t,n){var d,f;const r=e.slice();r[71]=t[n],r[73]=t,r[74]=n;const l=(f=(d=r[2])==null?void 0:d.getHeader)==null?void 0:f.call(d)[r[74]];return r[72]=l,r}function Ve(e,t,n){const r=e.slice();return r[75]=t[n],r[77]=n,r}function Ye(e,t,n){var d,f;const r=e.slice();r[71]=t[n],r[79]=n;const l=(f=(d=r[2])==null?void 0:d.getHeader)==null?void 0:f.call(d)[r[79]];return r[72]=l,r}function He(e){const t=e.slice(),n=t[31](t[75],t[79]);return t[80]=n,t}function Xe(e,t,n){const r=e.slice();return r[81]=t[n],r}function Ke(e){let t,n=e[81]+"",r;return{c(){t=A("th"),r=bt(n)},l(l){t=L(l,"TH",{});var d=q(t);r=kt(d,n),d.forEach(v)},m(l,d){ee(l,t,d),y(t,r)},p(l,d){d[0]&4&&n!==(n=l[81]+"")&&It(r,n)},d(l){l&&v(t)}}}function je(e){let t,n=e[81]!=="_level"&&Ke(e);return{c(){n&&n.c(),t=ve()},l(r){n&&n.l(r),t=ve()},m(r,l){n&&n.m(r,l),ee(r,t,l)},p(r,l){r[81]!=="_level"?n?n.p(r,l):(n=Ke(r),n.c(),n.m(t.parentNode,t)):n&&(n.d(1),n=null)},d(r){r&&v(t),n&&n.d(r)}}}function We(e){var fe,_e;let t,n,r,l,d,f,c,E,T,_,k,C,Z,te;function B(R,H){return H[0]&4&&(l=null),l==null&&(l=!!R[23](R[75])),l?Dt:Lt}let z=B(e,[-1,-1,-1]),G=z(e);function x(R,H){return R[7]?Nt:Ht}let le=x(e),S=le(e),j=Re(((_e=(fe=e[2])==null?void 0:fe.getRow)==null?void 0:_e.call(fe,e[75]))??[]),M=[];for(let R=0;R<j.length;R+=1)M[R]=Je(Ye(e,j,R));function ne(){return e[56](e[75])}function se(...R){return e[57](e[75],...R)}function we(...R){return e[58](e[75],...R)}function be(...R){return e[59](e[75],...R)}return{c(){t=A("tr"),n=A("td"),r=A("div"),G.c(),d=ce(),f=A("td"),c=A("div"),S.c(),E=ce();for(let R=0;R<M.length;R+=1)M[R].c();T=ce(),_=A("td"),k=A("div"),C=A("span"),this.h()},l(R){t=L(R,"TR",{});var H=q(t);n=L(H,"TD",{class:!0});var Q=q(n);r=L(Q,"DIV",{class:!0});var $=q(r);G.l($),$.forEach(v),Q.forEach(v),d=ue(H),f=L(H,"TD",{class:!0});var I=q(f);c=L(I,"DIV",{class:!0});var re=q(c);S.l(re),re.forEach(v),I.forEach(v),E=ue(H);for(let O=0;O<M.length;O+=1)M[O].l(H);T=ue(H),_=L(H,"TD",{class:!0});var F=q(_);k=L(F,"DIV",{class:!0});var he=q(k);C=L(he,"SPAN",{class:!0,role:!0,"aria-label":!0,title:!0}),q(C).forEach(v),he.forEach(v),F.forEach(v),H.forEach(v),this.h()},h(){u(r,"class","hierarchy-controls svelte-1qhmk4t"),u(n,"class","tree-column svelte-1qhmk4t"),u(c,"class","hierarchy-controls svelte-1qhmk4t"),u(f,"class","control-column svelte-1qhmk4t"),u(C,"class","delete-button mif-cross-light svelte-1qhmk4t"),u(C,"role","button"),u(C,"aria-label","Delete row"),u(C,"title","Delete row"),u(k,"class","hierarchy-controls svelte-1qhmk4t"),u(_,"class","control-column svelte-1qhmk4t")},m(R,H){ee(R,t,H),y(t,n),y(n,r),G.m(r,null),y(t,d),y(t,f),y(f,c),S.m(c,null),y(t,E);for(let Q=0;Q<M.length;Q+=1)M[Q]&&M[Q].m(t,null);y(t,T),y(t,_),y(_,k),y(k,C),Z||(te=[Y(C,"click",ne),Y(t,"dragover",se),Y(t,"keydown",we),Y(t,"drop",be)],Z=!0)},p(R,H){var Q,$;if(e=R,z===(z=B(e,H))&&G?G.p(e,H):(G.d(1),G=z(e),G&&(G.c(),G.m(r,null))),le===(le=x(e))&&S?S.p(e,H):(S.d(1),S=le(e),S&&(S.c(),S.m(c,null))),H[0]&1895825468|H[1]&79){j=Re((($=(Q=e[2])==null?void 0:Q.getRow)==null?void 0:$.call(Q,e[75]))??[]);let I;for(I=0;I<j.length;I+=1){const re=Ye(e,j,I);M[I]?M[I].p(re,H):(M[I]=Je(re),M[I].c(),M[I].m(t,T))}for(;I<M.length;I+=1)M[I].d(1);M.length=j.length}},d(R){R&&v(t),G.d(),S.d(),qe(M,R),Z=!1,Ce(te)}}}function Lt(e){let t;function n(d,f){return d[0]==="tasks"?qt:St}let r=n(e),l=r(e);return{c(){l.c(),t=ve()},l(d){l.l(d),t=ve()},m(d,f){l.m(d,f),ee(d,t,f)},p(d,f){r===(r=n(d))&&l?l.p(d,f):(l.d(1),l=r(d),l&&(l.c(),l.m(t.parentNode,t)))},d(d){d&&v(t),l.d(d)}}}function Dt(e){let t,n,r,l,d,f,c;function E(){return e[46](e[75])}return{c(){t=A("span"),n=A("span"),this.h()},l(T){t=L(T,"SPAN",{class:!0,role:!0,"aria-label":!0,title:!0});var _=q(t);n=L(_,"SPAN",{class:!0}),q(n).forEach(v),_.forEach(v),this.h()},h(){u(n,"class",r=e[10][e[75]]?"mif-plus":"mif-minus"),u(t,"class","hierarchy-toggle svelte-1qhmk4t"),u(t,"role","button"),u(t,"aria-label",l=e[10][e[75]]?"Expand":"Collapse"),u(t,"title",d=e[10][e[75]]?"Expand":"Collapse")},m(T,_){ee(T,t,_),y(t,n),f||(c=Y(t,"click",E),f=!0)},p(T,_){e=T,_[0]&1028&&r!==(r=e[10][e[75]]?"mif-plus":"mif-minus")&&u(n,"class",r),_[0]&1028&&l!==(l=e[10][e[75]]?"Expand":"Collapse")&&u(t,"aria-label",l),_[0]&1028&&d!==(d=e[10][e[75]]?"Expand":"Collapse")&&u(t,"title",d)},d(T){T&&v(t),f=!1,c()}}}function St(e){let t;return{c(){t=A("span"),this.h()},l(n){t=L(n,"SPAN",{class:!0}),q(t).forEach(v),this.h()},h(){u(t,"class","hierarchy-spacer svelte-1qhmk4t")},m(n,r){ee(n,t,r)},p:Ne,d(n){n&&v(t)}}}function qt(e){let t,n='<span class="mif-flow-cascade"></span>',r,l;function d(){return e[47](e[75])}return{c(){t=A("span"),t.innerHTML=n,this.h()},l(f){t=L(f,"SPAN",{class:!0,role:!0,"aria-label":!0,title:!0,"data-svelte-h":!0}),Ae(t)!=="svelte-d0tiuq"&&(t.innerHTML=n),this.h()},h(){u(t,"class","split-task-button svelte-1qhmk4t"),u(t,"role","button"),u(t,"aria-label","Split into subtasks"),u(t,"title","Split into subtasks using AI")},m(f,c){ee(f,t,c),r||(l=Y(t,"click",d),r=!0)},p(f,c){e=f},d(f){f&&v(t),r=!1,l()}}}function Ht(e){let t,n,r,l,d,f;function c(){return e[49](e[75])}function E(){return e[50](e[75])}return{c(){t=A("div"),n=A("span"),r=ce(),l=A("span"),this.h()},l(T){t=L(T,"DIV",{});var _=q(t);n=L(_,"SPAN",{class:!0,role:!0,"aria-label":!0,title:!0}),q(n).forEach(v),r=ue(_),l=L(_,"SPAN",{class:!0,role:!0,"aria-label":!0,title:!0}),q(l).forEach(v),_.forEach(v),this.h()},h(){u(n,"class","level-control mif-arrow-left svelte-1qhmk4t"),u(n,"role","button"),u(n,"aria-label","Decrease indentation level"),u(n,"title","Decrease indentation level (Shift+Tab)"),u(l,"class","level-control mif-arrow-right svelte-1qhmk4t"),u(l,"role","button"),u(l,"aria-label","Increase indentation level"),u(l,"title","Increase indentation level (Tab)")},m(T,_){ee(T,t,_),y(t,n),y(t,r),y(t,l),d||(f=[Y(n,"click",c),Y(l,"click",E)],d=!0)},p(T,_){e=T},d(T){T&&v(t),d=!1,Ce(f)}}}function Nt(e){let t,n,r;function l(...d){return e[48](e[75],...d)}return{c(){t=A("span"),this.h()},l(d){t=L(d,"SPAN",{class:!0,role:!0,"aria-label":!0,title:!0,draggable:!0}),q(t).forEach(v),this.h()},h(){u(t,"class","reorder-handle mif-unfold-more svelte-1qhmk4t"),u(t,"role","button"),u(t,"aria-label","Drag to reorder"),u(t,"title","Drag to reorder"),u(t,"draggable",!0)},m(d,f){ee(d,t,f),n||(r=[Y(t,"dragstart",l),Y(t,"dragend",e[42])],n=!0)},p(d,f){e=d},d(d){d&&v(t),n=!1,Ce(r)}}}function Ge(e){let t,n,r,l,d,f,c=e[2]&&ze(He(e));function E(...k){return e[53](e[75],e[79],...k)}function T(...k){return e[54](e[75],e[79],...k)}function _(...k){return e[55](e[75],e[79],...k)}return{c(){t=A("td"),c&&c.c(),n=ce(),this.h()},l(k){t=L(k,"TD",{class:!0,style:!0,"data-row-id":!0,"data-col-index":!0});var C=q(t);c&&c.l(C),n=ue(C),C.forEach(v),this.h()},h(){var k,C;u(t,"class","data-cell svelte-1qhmk4t"),u(t,"style",r=$e(e[79],(C=(k=e[2])==null?void 0:k.getHeader)==null?void 0:C.call(k))&&e[24](e[75])>0?`padding-left: ${e[24](e[75])*16}px;`:""),u(t,"data-row-id",l=e[75]),u(t,"data-col-index",e[79]),Se(t,"selected-cell",e[3]&&e[3].rowId===e[75]&&e[3].colIndex===e[79]),Se(t,"highlight",e[5]&&e[4]&&e[4].colIndex===e[79]&&e[33](e[75],e[79]))},m(k,C){ee(k,t,C),c&&c.m(t,null),y(t,n),d||(f=[Y(t,"pointerdown",E),Y(t,"click",T),Y(t,"keydown",_)],d=!0)},p(k,C){var Z,te;e=k,e[2]?c?c.p(He(e),C):(c=ze(He(e)),c.c(),c.m(t,n)):c&&(c.d(1),c=null),C[0]&4&&r!==(r=$e(e[79],(te=(Z=e[2])==null?void 0:Z.getHeader)==null?void 0:te.call(Z))&&e[24](e[75])>0?`padding-left: ${e[24](e[75])*16}px;`:"")&&u(t,"style",r),C[0]&4&&l!==(l=e[75])&&u(t,"data-row-id",l),C[0]&12&&Se(t,"selected-cell",e[3]&&e[3].rowId===e[75]&&e[3].colIndex===e[79]),C[0]&52|C[1]&4&&Se(t,"highlight",e[5]&&e[4]&&e[4].colIndex===e[79]&&e[33](e[75],e[79]))},d(k){k&&v(t),c&&c.d(),d=!1,Ce(f)}}}function ze(e){let t,n,r,l;function d(...c){return e[51](e[75],e[79],...c)}function f(...c){return e[52](e[75],e[79],...c)}return{c(){t=A("input"),this.h()},l(c){t=L(c,"INPUT",{type:!0,class:!0}),this.h()},h(){u(t,"type","text"),t.value=n=e[80],u(t,"class","metro-input svelte-1qhmk4t")},m(c,E){ee(c,t,E),r||(l=[Y(t,"paste",e[34]),Y(t,"blur",d),Y(t,"keydown",f)],r=!0)},p(c,E){e=c,E[0]&4&&n!==(n=e[80])&&t.value!==n&&(t.value=n)},d(c){c&&v(t),r=!1,Ce(l)}}}function Je(e){let t,n=e[72]!=="_level"&&Ge(e);return{c(){n&&n.c(),t=ve()},l(r){n&&n.l(r),t=ve()},m(r,l){n&&n.m(r,l),ee(r,t,l)},p(r,l){r[72]!=="_level"?n?n.p(r,l):(n=Ge(r),n.c(),n.m(t.parentNode,t)):n&&(n.d(1),n=null)},d(r){r&&v(t),n&&n.d(r)}}}function Qe(e){let t=e[22](e[75]),n,r=t&&We(e);return{c(){r&&r.c(),n=ve()},l(l){r&&r.l(l),n=ve()},m(l,d){r&&r.m(l,d),ee(l,n,d)},p(l,d){d[0]&4&&(t=l[22](l[75])),t?r?r.p(l,d):(r=We(l),r.c(),r.m(n.parentNode,n)):r&&(r.d(1),r=null)},d(l){l&&v(n),r&&r.d(l)}}}function Ze(e){let t,n,r,l;function d(){e[60].call(n,e[73],e[74])}return{c(){t=A("td"),n=A("input"),this.h()},l(f){t=L(f,"TD",{class:!0});var c=q(t);n=L(c,"INPUT",{type:!0,class:!0}),c.forEach(v),this.h()},h(){u(n,"type","text"),u(n,"class","metro-input svelte-1qhmk4t"),u(t,"class","svelte-1qhmk4t")},m(f,c){ee(f,t,c),y(t,n),Ue(n,e[71]),r||(l=[Y(n,"input",d),Y(n,"paste",e[34]),Y(n,"blur",e[35])],r=!0)},p(f,c){e=f,c[0]&512&&n.value!==e[71]&&Ue(n,e[71])},d(f){f&&v(t),r=!1,Ce(l)}}}function xe(e){let t,n=e[72]!=="_level"&&Ze(e);return{c(){n&&n.c(),t=ve()},l(r){n&&n.l(r),t=ve()},m(r,l){n&&n.m(r,l),ee(r,t,l)},p(r,l){r[72]!=="_level"?n?n.p(r,l):(n=Ze(r),n.c(),n.m(t.parentNode,t)):n&&(n.d(1),n=null)},d(r){r&&v(t),n&&n.d(r)}}}function Pt(e){var Ee,Le,Te,De;let t,n,r,l,d='<span class="hierarchy-toggle mif-tree svelte-1qhmk4t" title="Hierarchy"></span>',f,c,E,T,_,k,C,Z,te,B,z='<span class="delete-button mif-bin svelte-1qhmk4t" title="Delete row"></span>',G,x,le,S,j,M='<div class="hierarchy-controls svelte-1qhmk4t"><span class="hierarchy-spacer svelte-1qhmk4t"></span></div>',ne,se,we='<div class="hierarchy-controls svelte-1qhmk4t"><span class="mif-chevron-thin-right"></span></div>',be,fe,_e,R,H,Q,$=Re(((Le=(Ee=e[2])==null?void 0:Ee.getHeader)==null?void 0:Le.call(Ee))??[]),I=[];for(let g=0;g<$.length;g+=1)I[g]=je(Xe(e,$,g));let re=Re(((De=(Te=e[2])==null?void 0:Te.getAllIds)==null?void 0:De.call(Te))??[]),F=[];for(let g=0;g<re.length;g+=1)F[g]=Qe(Ve(e,re,g));let he=Re(e[9]),O=[];for(let g=0;g<he.length;g+=1)O[g]=xe(Fe(e,he,g));return{c(){t=A("table"),n=A("thead"),r=A("tr"),l=A("th"),l.innerHTML=d,f=ce(),c=A("th"),E=A("span"),T=A("span"),Z=ce();for(let g=0;g<I.length;g+=1)I[g].c();te=ce(),B=A("th"),B.innerHTML=z,G=ce(),x=A("tbody");for(let g=0;g<F.length;g+=1)F[g].c();le=ce(),S=A("tr"),j=A("td"),j.innerHTML=M,ne=ce(),se=A("td"),se.innerHTML=we,be=ce();for(let g=0;g<O.length;g+=1)O[g].c();fe=ce(),_e=A("td"),this.h()},l(g){t=L(g,"TABLE",{class:!0,id:!0});var V=q(t);n=L(V,"THEAD",{});var P=q(n);r=L(P,"TR",{});var oe=q(r);l=L(oe,"TH",{class:!0,"data-svelte-h":!0}),Ae(l)!=="svelte-1focd0m"&&(l.innerHTML=d),f=ue(oe),c=L(oe,"TH",{class:!0});var ke=q(c);E=L(ke,"SPAN",{class:!0,role:!0,"aria-label":!0,title:!0});var ye=q(E);T=L(ye,"SPAN",{class:!0}),q(T).forEach(v),ye.forEach(v),ke.forEach(v),Z=ue(oe);for(let ie=0;ie<I.length;ie+=1)I[ie].l(oe);te=ue(oe),B=L(oe,"TH",{class:!0,"data-svelte-h":!0}),Ae(B)!=="svelte-89kh84"&&(B.innerHTML=z),oe.forEach(v),P.forEach(v),G=ue(V),x=L(V,"TBODY",{});var m=q(x);for(let ie=0;ie<F.length;ie+=1)F[ie].l(m);le=ue(m),S=L(m,"TR",{});var W=q(S);j=L(W,"TD",{class:!0,"data-svelte-h":!0}),Ae(j)!=="svelte-1r09gtc"&&(j.innerHTML=M),ne=ue(W),se=L(W,"TD",{class:!0,"data-svelte-h":!0}),Ae(se)!=="svelte-18l50by"&&(se.innerHTML=we),be=ue(W);for(let ie=0;ie<O.length;ie+=1)O[ie].l(W);fe=ue(W),_e=L(W,"TD",{class:!0}),q(_e).forEach(v),W.forEach(v),m.forEach(v),V.forEach(v),this.h()},h(){u(l,"class","tree-column svelte-1qhmk4t"),u(T,"class",_=e[7]?"mif-tab":"mif-indent-increase"),u(E,"class","mode-toggle svelte-1qhmk4t"),u(E,"role","button"),u(E,"aria-label",k=e[7]?"Switch to level mode":"Switch to reorder mode"),u(E,"title",C=e[7]?"Switch to level mode":"Switch to reorder mode"),u(c,"class","control-column svelte-1qhmk4t"),u(B,"class","control-column svelte-1qhmk4t"),u(j,"class","tree-column svelte-1qhmk4t"),u(se,"class","control-column svelte-1qhmk4t"),u(_e,"class","control-column svelte-1qhmk4t"),u(t,"class","table subcompact table-border cell-border striped svelte-1qhmk4t"),u(t,"id",R=e[0]+"-table")},m(g,V){ee(g,t,V),y(t,n),y(n,r),y(r,l),y(r,f),y(r,c),y(c,E),y(E,T),y(r,Z);for(let P=0;P<I.length;P+=1)I[P]&&I[P].m(r,null);y(r,te),y(r,B),y(t,G),y(t,x);for(let P=0;P<F.length;P+=1)F[P]&&F[P].m(x,null);y(x,le),y(x,S),y(S,j),y(S,ne),y(S,se),y(S,be);for(let P=0;P<O.length;P+=1)O[P]&&O[P].m(S,null);y(S,fe),y(S,_e),e[61](t),H||(Q=[Y(Be,"drop",Oe(e[41])),Y(Be,"dragover",Oe(Mt)),Y(E,"click",e[38])],H=!0)},p(g,V){var P,oe,ke,ye;if(V[0]&128&&_!==(_=g[7]?"mif-tab":"mif-indent-increase")&&u(T,"class",_),V[0]&128&&k!==(k=g[7]?"Switch to level mode":"Switch to reorder mode")&&u(E,"aria-label",k),V[0]&128&&C!==(C=g[7]?"Switch to level mode":"Switch to reorder mode")&&u(E,"title",C),V[0]&4){$=Re(((oe=(P=g[2])==null?void 0:P.getHeader)==null?void 0:oe.call(P))??[]);let m;for(m=0;m<$.length;m+=1){const W=Xe(g,$,m);I[m]?I[m].p(W,V):(I[m]=je(W),I[m].c(),I[m].m(r,te))}for(;m<I.length;m+=1)I[m].d(1);I.length=$.length}if(V[0]&2145387965|V[1]&8047){re=Re(((ye=(ke=g[2])==null?void 0:ke.getAllIds)==null?void 0:ye.call(ke))??[]);let m;for(m=0;m<re.length;m+=1){const W=Ve(g,re,m);F[m]?F[m].p(W,V):(F[m]=Qe(W),F[m].c(),F[m].m(x,le))}for(;m<F.length;m+=1)F[m].d(1);F.length=re.length}if(V[0]&516|V[1]&24){he=Re(g[9]);let m;for(m=0;m<he.length;m+=1){const W=Fe(g,he,m);O[m]?O[m].p(W,V):(O[m]=xe(W),O[m].c(),O[m].m(S,fe))}for(;m<O.length;m+=1)O[m].d(1);O.length=he.length}V[0]&1&&R!==(R=g[0]+"-table")&&u(t,"id",R)},i:Ne,o:Ne,d(g){g&&v(t),qe(I,g),qe(F,g),qe(O,g),e[61](null),H=!1,Ce(Q)}}}function $e(e,t){if(!t||!Array.isArray(t))return!1;for(let n=0;n<t.length;n++)if(t[n]!=="_level")return e===n;return!1}const Mt=()=>{};function Ot(e,t,n){let r,l,d,f,c,E,T,_,k,C,Z,{name:te}=t,B=Et(te);ge(e,B,o=>n(2,l=o));let z=me([]);ge(e,z,o=>n(9,c=o));let G=me(!0);ge(e,G,o=>n(7,r=o)),z.reset=()=>z.update(o=>{var s;const a=((s=l==null?void 0:l.getHeader)==null?void 0:s.call(l))??[];return Array(a.length).fill("")});let x=me(null);ge(e,x,o=>n(4,_=o));let le=me(null);ge(e,le,o=>n(44,T=o));let S=me(!1);ge(e,S,o=>n(5,k=o));let j=me(null);ge(e,j,o=>n(45,C=o));let M,ne=me(null);ge(e,ne,o=>n(3,E=o));let se=me(null);ge(e,se,o=>n(8,f=o));let we=me(null);ge(e,we,o=>n(67,d=o));let be=me({});ge(e,be,o=>n(10,Z=o));function fe(o){be.update(a=>{const s={...a};return s[o]=!s[o],s}),B.update(a=>a)}function _e(o){let a=R(o);for(;a;){if(Z[a])return!1;a=R(a)}return!0}function R(o){return l?l.getRowParent?l.getRowParent(o):l.getParent?l.getParent(o):null:null}function H(o){return l&&l.getChildren?l.getChildren(o).length>0:!1}function Q(o){return l.getRowLevel?l.getRowLevel(o)-1:0}function $(o){const a=l.getAllIds(),s=a.indexOf(o);if(s<=0)return;const i=l.getRowLevel(o),h=a[s-1],p=l.getRowLevel(h),w=Math.min(p+1,i+1);if(w===i)return;const b=l.getAllChildren(o);B.update(N=>{N.setRowLevel(o,w);const X=w-i;return b.forEach(ae=>{const D=N.getRowLevel(ae);N.setRowLevel(ae,D+X)}),N})}function I(o){const a=l.getRowLevel(o);if(a<=1)return;const s=l.getAllChildren(o);B.update(i=>(i.setRowLevel(o,a-1),s.forEach(h=>{const p=i.getRowLevel(h);i.setRowLevel(h,Math.max(1,p-1))}),i))}function re(o,a){a.key==="Tab"&&document.activeElement.tagName!=="INPUT"&&(a.preventDefault(),a.shiftKey?I(o):$(o))}vt(()=>{const o=s=>{if(!k||!_)return;const i=document.elementFromPoint(s.clientX,s.clientY);if(!i)return;const h=i.closest("td.data-cell");if(!h)return;const p=h.getAttribute("data-row-id"),w=parseInt(h.getAttribute("data-col-index"));if(!C){const U=Math.abs(s.clientX-_.startX),K=Math.abs(s.clientY-_.startY);(U>5||K>5)&&j.set("rectangular")}le.set({rowId:p,colIndex:w}),document.querySelectorAll("td.data-cell").forEach(U=>{U.classList.remove("highlight")});const b=l.getAllIds(),N=b.indexOf(_.rowId),X=b.indexOf(p),[ae,D]=N<X?[N,X]:[X,N],[de,pe]=_.colIndex<w?[_.colIndex,w]:[w,_.colIndex];document.querySelectorAll("td.data-cell").forEach(U=>{const K=U.getAttribute("data-row-id"),J=parseInt(U.getAttribute("data-col-index")),Ie=b.indexOf(K);Ie>=ae&&Ie<=D&&J>=de&&J<=pe&&U.classList.add("highlight")})},a=s=>{if(k&&_&&T){const i=document.elementFromPoint(s.clientX,s.clientY);if(i){const h=i.closest("td.data-cell");if(h){const p=h.getAttribute("data-row-id"),w=parseInt(h.getAttribute("data-col-index")),b=l.getRow(_.rowId);if(b){const N=b[_.colIndex];F(_.rowId,p,_.colIndex,w,N)}}}}document.querySelectorAll("td.data-cell").forEach(i=>{i.classList.remove("highlight")}),S.set(!1),x.set(null),le.set(null),ne.set(null),j.set(null)};return document.addEventListener("pointermove",o),document.addEventListener("pointerup",a),()=>{document.removeEventListener("pointermove",o),document.removeEventListener("pointerup",a)}});function F(o,a,s,i,h){const p=l.getAllIds(),w=p.indexOf(o),b=p.indexOf(a);if(w===-1||b===-1)return;const[N,X]=w<b?[w,b]:[b,w],[ae,D]=s<i?[s,i]:[i,s],de=l.getHeader(),pe=[];for(let K=ae;K<=D;K++)de[K]!=="_level"&&pe.push(K);const U=[];for(let K=N;K<=X;K++){const J=p[K],Ie=l.getRow(J);if(Ie){const Me=[...Ie];pe.forEach(pt=>{Me[pt]=h}),U.push(Me)}}U.length>0&&B.update(K=>(K.replace_rows(U),K))}function he(o,a,s){const i=s.currentTarget.getBoundingClientRect(),h=s.clientX-i.left,p=s.clientY-i.top;h>i.width-8&&p>i.height-8&&(S.set(!0),x.set({rowId:o,colIndex:a,startX:s.clientX,startY:s.clientY}),le.set({rowId:o,colIndex:a}),ne.set({rowId:o,colIndex:a}),j.set(null),s.preventDefault(),s.stopPropagation())}function O(o,a,s){const i=s.currentTarget.getBoundingClientRect(),h=s.clientX-i.left,p=s.clientY-i.top;h>i.width-8&&p>i.height-8||((!E||E.rowId!==o||E.colIndex!==a)&&ne.set({rowId:o,colIndex:a}),s.stopPropagation())}function Ee(){setTimeout(()=>{var o;!k&&((o=document.activeElement)==null?void 0:o.tagName)!=="INPUT"&&!document.querySelector(".data-cell:active")&&ne.set(null)},50)}function Le(o,a){var i;const s=(i=l==null?void 0:l.getRow)==null?void 0:i.call(l,o);return s?s[a]:""}function Te(o,a,s){if(l)try{const i=l.getRow(o);if(!i)return;const h=[...i];h[a]=s;const p=l.getIdColumnIndex();B.update(w=>{try{a===p&&s!==o?(w.add_rows([h]),w.delete_row(o),E&&E.rowId===o&&ne.set({rowId:s,colIndex:E.colIndex})):w.replace_rows([h])}catch(b){console.error("Error updating cell:",b,o,a,s)}return w})}catch(i){console.error("Error in updateCellValue:",i,o,a,s)}}function De(o,a){if(!k||!_||!T||_.colIndex!==a)return!1;const s=l.getAllIds(),i=s.indexOf(_.rowId),h=s.indexOf(o),p=s.indexOf(T.rowId);if(i===-1||h===-1||p===-1)return!1;const[w,b]=i<p?[i,p]:[p,i];return h>=w&&h<=b}function g(o){let a=(o.clipboardData||window.clipboardData).getData("text");const s=a.includes(`
`),i=a.includes("	");if(s&&i){o.preventDefault();let h=a.split(/\n|\r/).filter(p=>p.length).map(p=>p.split(/\t/));B.update(p=>{const w=p.getHeader()||[],b=p.getIdColumnName();let N=[...w],X=new Tt(N,b);const ae=h[0],D=new Map;return ae.forEach((de,pe)=>{const U=w.indexOf(de);U!==-1&&D.set(pe,U)}),h.slice(1).forEach((de,pe)=>{if(de.length>0){const U=new Array(N.length).fill("");D.forEach((K,J)=>{J<de.length&&(U[K]=de[J])}),X.add_rows([U])}}),X}),z.reset()}else o.target.closest("tr")===o.target.closest("table").querySelector("tbody tr:last-child")&&setTimeout(()=>{Array.from(o.target.closest("tr").querySelectorAll("input")).some(w=>w.value.trim()!=="")&&V()},0)}function V(){var o,a;if(c.join("")!=="")try{const s=((o=l==null?void 0:l.getHeader)==null?void 0:o.call(l))??[],i=((a=l==null?void 0:l.getIdColumnName)==null?void 0:a.call(l))??"Id",h=s.indexOf(i),p=[...c];B.update(w=>{try{w.add_rows([p])}catch(b){console.error("Error adding row:",b,p)}return w}),z.reset()}catch(s){console.error("Error in addEntry:",s)}}function P(o){B.update(a=>(a.delete_row_with_children(o),a))}function oe(o,a,s){if(s.key==="Enter"||s.key==="ArrowDown"||s.key==="ArrowUp"){s.preventDefault();const i=l.getAllIds(),h=i.indexOf(o);let p;if(s.key==="ArrowUp"?p=h>0?h-1:h:p=h<i.length-1?h+1:h,p!==h){const w=i[p];ne.set({rowId:w,colIndex:a}),setTimeout(function(){const b=document.querySelector(`td.data-cell[data-row-id="${w}"][data-col-index="${a}"] input`);b&&b.focus()},0)}}else if(s.key==="Tab"&&!s.ctrlKey&&!s.altKey&&!s.metaKey&&s.target.tagName==="INPUT"){const h=l.getAllIds().filter(X=>_e(X)),p=h.indexOf(o),w=l.getHeader().length;let b=a,N=p;if(s.shiftKey)b--,b<0&&(N--,N<0?(N=0,b=0):b=w-1);else if(b++,b>=w)if(N++,N>=h.length){setTimeout(()=>{const X=document.querySelectorAll("tbody tr:last-child input");X.length>0&&X[0].focus()},0),s.preventDefault();return}else b=0;if(N!==p||b!==a){s.preventDefault();const X=h[N];ne.set({rowId:X,colIndex:b}),setTimeout(()=>{const ae=document.querySelector(`td.data-cell[data-row-id="${X}"][data-col-index="${b}"] input`);ae&&ae.focus()},0)}}}function ke(){G.update(o=>!o)}function ye(o,a){if(!r)return;a.dataTransfer.effectAllowed="move",se.set(o);const s=a.target.closest("tr");if(s){s.classList.add("dragging");try{const i=s.cloneNode(!0);i.style.width=`${s.offsetWidth}px`,i.style.backgroundColor="#f5f5f5",i.style.opacity="0.8",i.style.position="absolute",i.style.top="-1000px",i.style.border="1px solid #0078A6",i.style.boxShadow="0 2px 5px rgba(0,0,0,0.2)",document.body.appendChild(i),a.dataTransfer.setDragImage(i,20,10),setTimeout(()=>{document.body.removeChild(i)},0)}catch(i){console.warn("Failed to create custom drag image:",i)}}}function m(o,a){r&&(a.preventDefault(),a.dataTransfer.dropEffect="move",we.set(o),document.querySelectorAll("tr").forEach(s=>{s.classList.remove("drag-over")}),a.currentTarget.closest("tr").classList.add("drag-over"))}function W(o){const a=o.source||{index:l.getAllIds().indexOf(f)},s=o.destination||{index:l.getAllIds().indexOf(d)},i=o.draggableId||f;if(!a||!s||!i){console.warn("Missing required drop information");return}const h=l.getAllIds(),p=h.indexOf(i),w=s.index||h.indexOf(d);if(p===-1||p===w){console.warn("Invalid source or destination index");return}const b=l.getRow(i),N=l.getRowLevel?l.getRowLevel(i):1;if(!b){console.warn("Row to move not found:",i);return}const X=l.getAllChildren(i),ae=X.map(D=>({id:D,row:l.getRow(D),level:l.getRowLevel?l.getRowLevel(D):1}));B.update(D=>{D.delete_row_with_children(i);let de=w;p<w&&(de-=1+X.length);const pe=D.getAllIds();if(de>=pe.length)D.add_rows([b]),D.setRowLevel(i,N),ae.forEach(({row:U,level:K})=>{D.add_rows([U]),D.setRowLevel(U[D.getIdColumnIndex()],K)});else{const U=pe.slice(de),K=U.map(J=>({row:D.getRow(J),level:D.getRowLevel?D.getRowLevel(J):1}));U.forEach(J=>D.delete_row(J)),D.add_rows([b]),D.setRowLevel(i,N),ae.forEach(({row:J,level:Ie})=>{D.add_rows([J]),D.setRowLevel(J[D.getIdColumnIndex()],Ie)}),K.forEach(({row:J,level:Ie})=>{D.add_rows([J]),D.setRowLevel(J[D.getIdColumnIndex()],Ie)})}return D})}function ie(){r&&(se.set(null),we.set(null),document.querySelectorAll("tr").forEach(o=>{o.classList.remove("dragging","drag-over")}))}async function Pe(o){te==="tasks"&&await Ct.splitTask(o)}const et=o=>fe(o),tt=o=>Pe(o),lt=(o,a)=>ye(o,a),nt=o=>I(o),rt=o=>$(o),ot=(o,a,s)=>{Te(o,a,s.target.value);const i=s.relatedTarget,h=s.target.closest("td.data-cell");i&&h&&h.contains(i)||Ee()},st=(o,a,s)=>oe(o,a,s),at=(o,a,s)=>he(o,a,s),it=(o,a,s)=>O(o,a,s),dt=(o,a,s)=>oe(o,a,s),ct=o=>P(o),ut=(o,a)=>m(o,a),ft=(o,a)=>re(o,a),ht=(o,a)=>{a.preventDefault(),a.stopPropagation();const s={draggableId:f,source:{index:l.getAllIds().indexOf(f)},destination:{index:l.getAllIds().indexOf(o)}};W(s)};function _t(o,a){o[a]=this.value,z.set(c)}function gt(o){wt[o?"unshift":"push"](()=>{M=o,n(6,M)})}return e.$$set=o=>{"name"in o&&n(0,te=o.name)},e.$$.update=()=>{if(e.$$.dirty[0]&8,e.$$.dirty[0]&16,e.$$.dirty[1]&8192,e.$$.dirty[0]&32,e.$$.dirty[1]&16384,e.$$.dirty[0]&6&&l!=null&&l.getHeader()){z.set(Array(l.getHeader().length).fill(""));const o=l.getLevelColumnName?l.getLevelColumnName():"_level",a=l.getHeader().indexOf(o);a!==-1&&n(1,z[a]="1",z),l.getAllIds().length>0&&l.getAllIds()[0]}},[te,z,l,E,_,k,M,r,f,c,Z,B,G,x,le,S,j,ne,se,we,be,fe,_e,H,Q,$,I,re,he,O,Ee,Le,Te,De,g,V,P,oe,ke,ye,m,W,ie,Pe,T,C,et,tt,lt,nt,rt,ot,st,at,it,dt,ct,ut,ft,ht,_t,gt]}class Kt extends yt{constructor(t){super(),Rt(this,t,Ot,Pt,mt,{name:0},null,[-1,-1,-1])}}export{Kt as T,At as g};
