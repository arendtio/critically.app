var C=(a,e,s)=>{if(!e.has(a))throw TypeError("Cannot "+s)};var l=(a,e,s)=>(C(a,e,"read from private field"),s?s.call(a):e.get(a)),h=(a,e,s)=>{if(e.has(a))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(a):e.set(a,s)},w=(a,e,s,t)=>(C(a,e,"write to private field"),t?t.call(a,s):e.set(a,s),s);var f=(a,e,s)=>(C(a,e,"access private method"),s);import{w as M}from"./index.7c868b58.js";import{g as N}from"./tables.store.731d7076.js";import{M as z}from"./scheduler.1fe6c427.js";var p,u,g,E,x,O,m,S,y,F,T,$;class _{constructor(){h(this,x);h(this,m);h(this,y);h(this,T);h(this,p,void 0);h(this,u,[]);h(this,g,[]);h(this,E,void 0);w(this,p,new Map),w(this,E,new Map)}addTask(e,s,t,r,n,i,c,o){t=P(t),r=P(r),n=P(n),i=i.split(",").map(d=>d.split("&").map(L=>L.trim())),c=c.split(",").map(d=>d.trim()).filter(d=>d!=="");let b=Math.round((t+r*4+n)/6),A={id:e,name:s,min:t,likely:r,max:n,res:i,resIdList:[],predecessors:new Set(c),successors:new Set,progress:o,earlyCol:1,es:0,ef:0,ls:0,lf:0,slack:-1,expected:b};l(this,p).set(e,A)}getTask(e){return l(this,p).get(e)}calc(){return f(this,x,O).call(this),f(this,y,F).call(this),f(this,T,$).call(this),{starts:l(this,u),map:Object.fromEntries(l(this,p)),ends:l(this,g)}}}p=new WeakMap,u=new WeakMap,g=new WeakMap,E=new WeakMap,x=new WeakSet,O=function(){l(this,p).forEach(e=>{e.predecessors.forEach(s=>{l(this,p).get(s).successors.add(e.id)})}),w(this,u,[...l(this,p).values()].filter(e=>e.predecessors.size===0).map(e=>e.id)),w(this,g,[...l(this,p).values()].filter(e=>e.successors.size===0).map(e=>e.id))},m=new WeakSet,S=function(e,s,t,r){if(t.has(e))return;t.add(e);let n=l(this,p).get(e);n[s].forEach(i=>{f(this,m,S).call(this,i,s,t,r)}),n=r(n),l(this,p).set(n.id,n)},y=new WeakSet,F=function(){let e=new Set;l(this,g).forEach(s=>{f(this,m,S).call(this,s,"predecessors",e,t=>{let r=[...t.predecessors].map(i=>l(this,p).get(i)).reduce((i,c)=>i<c.ef?c.ef:i,0),n=[...t.predecessors].map(i=>l(this,p).get(i)).reduce((i,c)=>i<c.earlyCol?c.earlyCol:i,0);return t.earlyCol=n+1,t.es=r+1,t.ef=t.es+t.expected-1,t})})},T=new WeakSet,$=function(){let e=Math.max(...l(this,g).map(t=>l(this,p).get(t).ef)),s=new Set;l(this,u).forEach(t=>{f(this,m,S).call(this,t,"successors",s,r=>{let n=[...r.successors].map(i=>l(this,p).get(i)).reduce((i,c)=>i<c.ls?i:c.ls,e+1);return r.lf=n-1,r.ls=r.lf-r.expected+1,r.slack=r.ls-r.es,r})})};const v=M({}),j=M(void 0);function P(a,e){e===void 0&&(e=navigator.languages&&navigator.languages.length?navigator.languages[0]:navigator.language);let[,s,,,,t]=1111.1.toLocaleString(e);return a=Array.from(""+a,r=>r===s?"":r===t?".":r).join(""),parseFloat(a)}v.reset=()=>v.set({});j.reset=()=>j.set(void 0);v.calculate=function(){j.set(void 0);let a;N("tasks").update(o=>(a=o,o));let s=new _;a.getAllIds().forEach(o=>{let b=a.getRow(o);s.addTask(...b)}),console.log("Starting calculation");let t=s.calc(),r=new Map;for(var n in t.map)if(Object.prototype.hasOwnProperty.call(t.map,n)){let o=t.map[n];o.predecessors=[...o.predecessors],r.set(o.id,o)}t.map=Object.fromEntries(r);const c=z(v).map||{};console.log("Existing positions before preservation:",c),Object.keys(t.map).forEach(o=>{console.log(`Task ${o} - Before:`,t.map[o]),c[o]?(console.log(`Existing position for ${o}:`,c[o]),t.map[o].x=c[o].x,t.map[o].y=c[o].y,console.log(`Task ${o} - After:`,t.map[o])):console.log(`Task ${o} - No existing position found`)}),console.log("Final positions after preservation:",t.map),console.log("Finished calculation: ",JSON.stringify(t)),v.set(t)};export{v as c,j as d,P as l};
