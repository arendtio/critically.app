import{d as D}from"./index.2391f01a.js";import{l as O,c as R,r as v}from"./criticalPath.store.6d3a6c20.js";import{g as y}from"./gantt.store.e991d7de.js";const J=D([R,v],([s,k])=>{let t=k.slice(0,1),b=k.slice(1).map(r=>{let l=r.slice(0,1);return l=l.concat(r.slice(1).map(d=>({free:O(d),allocations:[]}))),l});if(t=t.concat(b),s.map===void 0)return t;let w=Object.keys(s.map).sort((r,l)=>s.map[r].slack===s.map[l].slack?s.map[r].es>s.map[l].es?1:s.map[r].es<s.map[l].es?-1:0:s.map[r].slack>s.map[l].slack?1:-1),a=JSON.parse(JSON.stringify(s)),g=r=>{if(a.map[r].startDate!==void 0)return;let l=a.map[r].predecessors.reduce((e,n)=>(g(n),e===void 0||a.map[n].endDate>e?a.map[n].endDate:e),void 0),d=a.map[r].res.map(e=>{let n=t[0].indexOf(e);return n<0&&(console.log("The resource",e,"in task",r,"is not defined in the resource table"),alert("The resource "+e+" in task "+r+" is not defined in the resource table")),n}),x=(e,n,o)=>{let i=0,f=t[e][n].free;if(isNaN(f)||f===0)return!1;for(;o>0;){if(e+i>=t.length)return!1;if(f=t[e+i][n].free,isNaN(f)){i++;continue}if(f===0)return!1;o-=f,i++}return!0},m;for(let e=1;e<t.length&&!(!(t[e][0]<=l)&&(m=d.reduce((n,o)=>x(e,o,a.map[r].expected)?{resId:o,row:e}:n,void 0),m!==void 0));e++);m===void 0&&alert("Task "+r+" could not be allocated. Please provide more resources or adjust constraints."),((e,n,o)=>{let i=t[o][0],f,N,p=a.map[e].expected;for(let u=o;u<t.length;u++){let c=t[u][n].free;if(!isNaN(c))if(p>c)p-=c,t[u][n].allocations.push({task:e,amount:c}),t[u][n].free=0;else{t[u][n].free-=p,t[u][n].allocations.push({task:e,amount:p}),p=0,f=t[u][0],N=u;break}}a.map[e].startDate=i,a.map[e].endDate=f,a.map[e].resId=n,a.map[e].resPlanned=t[0][n],a.map[e].firstRow=o,a.map[e].lastRow=N})(r,m.resId,m.row)};return w.forEach(g),y.set(a),t});export{J as t};
