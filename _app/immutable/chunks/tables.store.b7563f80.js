var p=(o,r,e)=>{if(!r.has(o))throw TypeError("Cannot "+e)};var n=(o,r,e)=>(p(o,r,"read from private field"),e?e.call(o):r.get(o)),y=(o,r,e)=>{if(r.has(o))throw TypeError("Cannot add the same private member more than once");r instanceof WeakSet?r.add(o):r.set(o,e)},f=(o,r,e,t)=>(p(o,r,"write to private field"),t?t.call(o,e):r.set(o,e),e);var m=(o,r,e)=>(p(o,r,"access private method"),e);import{w as b}from"./index.113f7b86.js";var s,d,g,A,_,E;const I=class I{constructor(r){y(this,g);y(this,_);y(this,s,void 0);y(this,d,void 0);f(this,s,[r]),f(this,d,r)}getHeader(){return n(this,s)[0]}changeHeadings(r){if(r.length!==n(this,s)[0].length)throw new Error("New headings must have the same length as current headings");return n(this,s)[0]=r,this}getAllIds(){return n(this,s).slice(1).map(r=>String(r[0]))}getRow(r){let e=m(this,g,A).call(this,r),t=n(this,s)[e];return t===void 0&&(t=[]),t}toJSON(){return Array.isArray(n(this,s))?n(this,s):[n(this,d)]}static fromJSON(r){const e=JSON.parse(r),t=new I(e[0]);return t.restore(e),t}restore(r){if(!Array.isArray(r))return console.error("Invalid data format for restore:",r),f(this,s,[n(this,d)]),this;const e=Array.isArray(r[0])?r[0]:n(this,d);f(this,s,[e]);for(let t=1;t<r.length;t++)Array.isArray(r[t])&&this.add_or_replace_row(r[t][0],r[t]);return this}add_or_replace_rows(r){if(!Array.isArray(r))throw new Error("Rows must be an array");return r.forEach(e=>{if(!Array.isArray(e))throw new Error("Each row must be an array");if(!e[0])throw new Error("Each row must have an ID (first element)");if(e.length!==n(this,s)[0].length)throw new Error(`Row must have ${n(this,s)[0].length} elements to match header length`);let t=m(this,g,A).call(this,e[0]);t===null?n(this,s).push(e):n(this,s)[t]=e}),this}add_or_replace_row(r,e){return this.add_or_replace_rows([e])}delete_rows(r){if(!Array.isArray(r))throw new Error("IDs must be an array");return r.map(t=>m(this,g,A).call(this,t)).filter(t=>t!==null).sort((t,c)=>c-t).forEach(t=>{n(this,s).splice(t,1)}),this}delete_row(r){return this.delete_rows([r])}clear_table(){return f(this,s,[n(this,d)]),this}add_or_replace_columns(r,e){if(!Array.isArray(r)||!Array.isArray(e))throw new Error("Column names and values must be arrays");if(r.length!==e.length)throw new Error("Number of column names must match number of value arrays");return r.forEach((t,c)=>{const a=e[c];if(!Array.isArray(a)||a.length===0||a[0]!==t)throw new Error("Each value array must start with its column name");const i=n(this,s).length-1;if(a.length-1!==i)throw new Error(`Column values must match number of rows (${i})`);let u=m(this,_,E).call(this,t);if(u===-1){u=n(this,s)[0].length,n(this,s)[0].push(t);for(let h=1;h<n(this,s).length;h++){const w=a[h];n(this,s)[h].push(w||"")}}else for(let h=0;h<i;h++){n(this,s)[h+1][u];const w=a[h+1];w!==""&&(n(this,s)[h+1][u]=w)}}),this}add_or_replace_column(r,e){return this.add_or_replace_columns([r],[e])}delete_column(r){const e=m(this,_,E).call(this,r);if(e===-1)throw console.error("Error: Column does not exist"),new Error("Column does not exist");return f(this,s,n(this,s).map(t=>{const c=[...t];return c.splice(e,1),c})),f(this,d,n(this,s)[0]),this}};s=new WeakMap,d=new WeakMap,g=new WeakSet,A=function(r){let e=n(this,s).slice(1).findIndex(t=>t[0]==r);return e===-1?null:e+1},_=new WeakSet,E=function(r){return n(this,s)[0].indexOf(r)};let l=I;const x=new Map;function R(o,r){let e=new l(r);x.set(o,b(e))}function D(o){return x.get(o)}function v(o){const r=new Set;return o.getAllIds().forEach(e=>{const c=o.getRow(e)[5];c&&c.split(/[,&]/).map(i=>i.trim()).filter(i=>i).forEach(i=>r.add(i))}),Array.from(r)}function C(o,r){const e=new l(r.getHeader()||["Date"]);try{const a=r.getAllIds();Array.isArray(a)&&a.forEach(i=>{const u=r.getRow(i);Array.isArray(u)&&e.add_or_replace_row(i,u)})}catch(a){console.error("Error copying existing rows:",a)}const t=v(o),c=e.getHeader().slice(1);return t.forEach(a=>{if(!c.includes(a)){const i=[a,...Array(e.getAllIds().length).fill("")];e.add_or_replace_column(a,i)}}),c.forEach(a=>{t.includes(a)||e.getAllIds().some(u=>{const h=e.getRow(u),w=e.getHeader().indexOf(a);return h[w]&&h[w].trim()!==""})||e.delete_column(a)}),e}const S=["Id","Task","Min","Likely","Max","Resources","Predecessors","Progress","Start","Deadline"];R("tasks",S);const k=["Date"];R("resources",k);const H=D("tasks"),O=D("resources");H.subscribe(o=>{if(!(o instanceof l)){console.error("Invalid table instance in subscription");return}O.update(r=>{try{r instanceof l||(r=new l(["Date"]));const e=C(o,r);return e instanceof l?e:new l(["Date"])}catch(e){return console.error("Error updating resources table:",e),new l(["Date"])}})});export{l as T,D as g};
